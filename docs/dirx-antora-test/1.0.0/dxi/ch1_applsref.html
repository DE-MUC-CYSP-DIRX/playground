<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Understanding the Default Application Workflow Technology :: DirX Docs Test with Antora</title>
    <meta name="generator" content="Antora 3.1.9">
    <link rel="stylesheet" href="../../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">DirX Docs Test with Antora</a>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="dirx-antora-test" data-version="1.0.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../index.html">dirx-antora-test</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Overview</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Start</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">DirX Identity</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="DirX-Identity-V8.10-SP2_497680389.html">DirX Identity V8.10 SP2</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="Documentation_501940226.html">Documentation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="Introduction_501022729.html">Introduction</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="Challenge_502300686.html">Challenge</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="Overview_501350431.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="Glossary_501678118.html">Glossary</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="Tutorial_501842013.html">Tutorial</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="Getting-Started_502267994.html">Getting Started</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="Tutorials_502005954.html">Tutorials</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="Sample-Domain_503283770.html">Sample Domain</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="Provisioning-Administration-Guide_504201235.html">Provisioning Administration Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="Managing-the-Provisioning-System_504463382.html">Managing the Provisioning System</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="Planning-Checklist_504660043.html">Planning Checklist</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="User-Management_506724354.html">User Management</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Application Development Guide</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#understanding_the_default_application_workflow_technology">Understanding the Default Application Workflow Technology</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#understanding_request_workflows">Understanding Request Workflows</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#understanding_java_based_workflows">Understanding Java-based Workflows</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#understanding_tcl_based_workflows">Understanding Tcl-based Workflows</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="ch2_reqWFs.html#using_request_workflows">Using Request Workflows</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ch2_reqWFs.html#understanding_creation_workflows">Understanding Creation Workflows</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ch2_reqWFs.html#understanding_modification_workflows">Understanding Modification Workflows</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ch2_reqWFs.html#understanding_assignment_workflows">Understanding Assignment Workflows</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ch2_reqWFs.html#understanding_deletion_workflows">Understanding Deletion Workflows</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ch2_reqWFs.html#understanding_certification_workflows">Understanding Certification Workflows</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ch2_reqWFs.html#understanding_service_management_workflows">Understanding Service Management Workflows</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ch3_configScen.html#configuring_custom_scenarios">Configuring Custom Scenarios</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">dirx-antora-test</span>
    <span class="version">1.0.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="../index.html">dirx-antora-test</a></div>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">dirx-antora-test</a></li>
    <li>Application Development Guide</li>
    <li><a href="#understanding_the_default_application_workflow_technology">Understanding the Default Application Workflow Technology</a></li>
  </ul>
</nav>
<div class="edit-this-page"><a href="https://github.com/DE-MUC-CYSP-DIRX/playground.wiki/edit/master/docs/modules/dxi/pages/ch1_applsref.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Understanding the Default Application Workflow Technology</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The default applications are constructed from three different workflow architectures:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Request workflows, which handle self-service and delegated administration requests that may require authorization by one or more human approvers. Request workflows operate inside the DirX Identity Store and allow you to define processes like creating a new user or modifying a user&#8217;s attributes and manage the approvals that are often required as part of these processes.Request workflows can work with any DirX Identity object type, for example, roles or policies.Request workflows can automatically trigger Java-based or Tcl-based workflows to provision the resulting identity data updates to the connected systems.The default request workflows provided with DirX Identity are available in the DirX Identity Manager&#8217;s <strong>Provisioning</strong> view group.</p>
</li>
<li>
<p>Java-based workflows, which handle both real-time and scheduled provisioning and synchronization.Java-based workflows work mainly with the user, account and group objects in the Identity Store and the source and connected systems.They operate primarily outside of the Identity Store and perform the provisioning / synchronization of identity data between source systems and the Identity Store and between connected systems and the Identity Store.(Note that it is possible to build Java-based workflows that work from the Identity Store to the Identity Store; the DirX Identity maintenance workflows are representatives of this type.) The runtime environment for Java-based workflows is provided by the Java-based Identity Server (IdS-J).The default Java-based workflows provided with DirX Identity are available in Identity Manager&#8217;s <strong>Connectivity</strong> view group</p>
</li>
<li>
<p>Tcl-based workflows, which handle scheduled provisioning and synchronization using the DirX Identity meta controller (<strong>metacp</strong>) and agents.Like the Java-based workflows, Tcl-based workflows work mainly with the user, account and group objects in the Identity Store and the source and connected systems, operate primarily outside of the Identity Store (the maintenance workflows are the exception) and provision and synchronize between the source systems, connected systems, and Identity Store.The runtime environment for Tcl-based workflows is provided by the C++-based Identity Server (IdS-C).Like the Java-based workflows, the default Tcl-based workflows provided with DirX Identity are available in Identity Manager&#8217;s <strong>Connectivity</strong> view group.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This chapter provides the following information about these workflows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"Understanding Request Workflows" describes the architecture used for request workflows and how to customize them to your requirements.</p>
</li>
<li>
<p>"Understanding Java-based Workflows" describes the architecture used for the Java-based default connectivity workflows and how to customize them to your requirements.</p>
</li>
<li>
<p>"Understanding Tcl-based Workflows" describes the architecture used for the Tcl-based default connectivity workflows and how to customize them to your requirements.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="understanding_request_workflows"><a class="anchor" href="#understanding_request_workflows"></a>Understanding Request Workflows</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section provides information about Java-based workflows, including information about:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Request workflow architecture</p>
</li>
<li>
<p>Customizing request workflows</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_request_workflow_architecture"><a class="anchor" href="#_request_workflow_architecture"></a>Request Workflow Architecture</h3>
<div class="paragraph">
<p>You can use request workflows for a variety of tasks, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Controlling user self registration</p>
</li>
<li>
<p>Creating objects (users, roles, and so on) with or without approval</p>
</li>
<li>
<p>Modifying objects (users, roles, and so on) and approving object attribute changes</p>
</li>
<li>
<p>Approving privilege assignment changes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>DirX Identity Provisioning handles request workflows of any complexity with a wide variety of features, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Graphical workflow configuration with multiple steps</p>
</li>
<li>
<p>Static, dynamic, group-based and rule-based approver list generation</p>
</li>
<li>
<p>Filters to help reduce or adapt a list of approvers</p>
</li>
<li>
<p>Constraints to specify, for example, minimum requirements on the number of participants</p>
</li>
<li>
<p>Dynamic activity generation based on lists</p>
</li>
<li>
<p>Sequential and parallel activity execution</p>
</li>
<li>
<p>Conditions like "All must succeed" or "Only one may decide"</p>
</li>
<li>
<p>WhenApplicable rules to restrict the application of a specific workflow template</p>
</li>
<li>
<p>Start conditions for activities, including AND and OR</p>
</li>
<li>
<p>Timeout definition for workflow and activities</p>
</li>
<li>
<p>Easy setup of e-mail notification</p>
</li>
<li>
<p>An unlimited number of escalation steps for each activity</p>
</li>
<li>
<p>An "active" flag to prohibit the execution of incomplete rules</p>
</li>
<li>
<p>Lifetime definition for workflow instances including automatic removal</p>
</li>
<li>
<p>Auditing</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The next section discusses the application of request workflows and provides some examples that explain the features in more detail.</p>
</div>
<div class="sect3">
<h4 id="_understanding_activity_types"><a class="anchor" href="#_understanding_activity_types"></a>Understanding Activity Types</h4>
<div class="paragraph">
<p>Request workflows consist of steps that we call "activities". Three basic types of request workflow activity exist:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>People activities</strong> - activities executed by one or more persons, which we call "participants". This type of activity needs some time (from several seconds to days).</p>
</li>
<li>
<p><strong>Error activities</strong> - activities that handle error conditions. These activities generally send e-mail to well-defined administrators.</p>
</li>
<li>
<p><strong>Automatic activities</strong> - activities executed by automated procedures. Examples of these activities include creating a global unique ID (GUID) for a user and creating the LDAP entry upon creation approval and sending an e-mail message.</p>
</li>
<li>
<p><strong>Conditional activities</strong> - activities that wait for some event. An example is the completion of a sub-workflow.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>DirX Identity supplies the following default <strong>people activities</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Approve assignment</strong>, which asks a participant to approve a specific user-to-privilege assignment. You define the participants and optionally the escalation steps. You typically set up an e-mail notification to inform the participants about this task.</p>
</li>
<li>
<p><strong>Approve delete</strong>, which asks a participant to approve an object deletion.</p>
</li>
<li>
<p><strong>Approve modification</strong>, which asks a participant to approve an object modification.</p>
</li>
<li>
<p><strong>Approve object</strong>, which presents a list of attributes to a participant that he must approve. You define the list and the sequence of attributes, the participants and optionally the escalation steps. You typically set up an e-mail notification to inform the participants about this task.</p>
</li>
<li>
<p><strong>Enter</strong> a<strong>ttributes</strong>, which allows a participant to enter a set of attributes for a new object. You define the list of attributes, their display name and whether they are optional or mandatory.</p>
</li>
<li>
<p><strong>Request privileges</strong>, which allows a participant to assign privileges. You can define the types of privileges (role, permission, group).</p>
</li>
<li>
<p><strong>Certification</strong> <strong>Campaigns</strong>, which allows a participant to certify a subject: a privilege or a user. For example, he can verify all manually assigned users of a role or manually assigned roles of a user.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>DirX Identity supplies the following default <strong>error activities</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>General Error</strong>, which sends an e-mail notification to someone who can analyze and solve the problem. This activity is discussed in more detail in the section "Request Workflow Error Handling".</p>
</li>
<li>
<p><strong>Error Handler</strong>, which sends an e-mail notification to someone if the workflow ran on timeout (status FAILED.EXPIRED).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>DirX Identity supplies the following default <strong>automatic activities</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Apply approved privileges</strong>, which implements a privilege assignment after approval was performed. It performs a privilege resolution and starts the necessary updates by creating update events (but only if <strong>Enable Real-time Provisioning</strong> is set at the target system).</p>
</li>
<li>
<p><strong>Apply object</strong>, which either creates the object if it does not yet exist or it performs all attribute changes as defined in the corresponding subject order (created by previous activity steps or workflows).<br>
<strong>Creation</strong> - can be used for all objects besides users. For users, use <strong>the Apply User With Assignments</strong> activity instead.<br>
<strong>Modification</strong> - can be used for all objects. It adds new attributes and modifies or deletes existing attributes. If the target object is a user, the activity checks whether one or more attributes are permission parameters and performs a privilege resolution if true. Privilege resolution may result in the creation of events for real-time synchronization workflows.</p>
</li>
<li>
<p><strong>Apply orders from ticket</strong>, which applies the subject order (if the flag is selected) that can be either a creation or a modification request for an object. In case of a user object it additionally evaluates assignments and starts (if required) approval workflows as child workflows.<br>
In conjunction with a <strong>Wait for child workflows</strong> activity the parent workflow is notified when the child workflow(s) are complete.<br>
If you use the <strong>Track changes in child</strong> workflows flag then all child workflows propagate their provisioning changes to the parent workflow. You can use the <strong>Wait for completed provisioning</strong> activity to check for completed provisioning of accounts and groups.</p>
</li>
<li>
<p><strong>Apply user with assignments</strong>, which either creates the user if it does not yet exist or it performs all attribute changes as defined in the corresponding subject order (created by previous activity steps or workflows). Additionally it evaluates all assignments as defined in the corresponding resource orders (created by previous activity steps or workflows).<br>
If an assignment requires approval, it starts an independent approval workflow. Otherwise, it performs a privilege resolution and starts the necessary updates by creating update events (but only if <strong>Enable Real-time Provisioning</strong> is set at the target system).</p>
</li>
<li>
<p><strong>Acknowledge update</strong>, used in manual provisioning workflows to set the states according to the performed action. Note that this activity cannot verify whether the administrator performed the action correctly. This activity sets the <strong>TS State</strong> account or group states as defined by the <strong>State</strong> attribute and the membership states as defined by DirX Identity.</p>
</li>
<li>
<p><strong>Calculate VMID GUID</strong>, which calculates a VMID global unique identifier and adds the calculated value into a definable object attribute.</p>
</li>
<li>
<p><strong>Calculate Siemens GUID</strong>, which calls the Siemens internal GUID generator web service to calculate a global unique identifier and adds the calculated value into a definable object attribute. The activity provides a new GUID value for an identity or an error message if the request is not sufficient or the identity already exists. An optional search can be configured that retrieves the existing GUID if the GUID generation failed because the identity already exists.</p>
</li>
<li>
<p><strong>Calculate Risk</strong>, used in risk approval workflows to compute the risk level that a requested privilege assignment would have if it was approved. For new/deleted group assignments, the activity calculates the risk and then merges these new risks with the risk values that have already been calculated to define the new possible risk level. This new risk level is stored in the application state and in the workflow context (name: <strong>risklevel</strong>). Values of 0, 1, 2 and 3 are possible, where 3 indicates high risk. The user&#8217;s old risk level is stored in the workflow context (name: <strong>oldrisklevel</strong>). If risk checking is not active at the domain, nothing is done and the activity succeeds. If risk checking is active but there is no active risk policy, the activity generates an error. You can use the parameter <strong>Force An Error If no actual RiskLevel</strong> is available to control how the activity functions when risk is active but risk values have not already been computed for a given user. If this parameter is unchecked, the value 0 is used as the risk level and is stored in the application state and the workflow context. You can configure your workflow&#8217;s start conditions to respond to this value in a particular way; otherwise, an error is generated. You can also use the workflow&#8217;s <strong>risklevel</strong> or <strong>oldrisklevel</strong> context variables for the start conditions of other activities to respond to special values.</p>
</li>
<li>
<p><strong>Check SoD</strong>, which checks for SoD violations and automatically starts approval workflows if an SoD violation is detected.</p>
</li>
<li>
<p><strong>Map attributes</strong>, which lets you define additional attributes or recalculate existing ones (in this workflow order). You can use it to set constants or to combine attributes to fill another attribute (for example 'cn=${sn} + " " + ${givenName}').</p>
</li>
<li>
<p><strong>Send e-mail</strong>, which sends an e-mail notification. Use this type of activity if the e-mail notification is conditional; that is, it&#8217;s only executed if a specific workflow application state (see the section "Handling Request Workflow States") or state of the previous activity occurs. Activities of this type are visible in the graphical workflow structure.</p>
</li>
<li>
<p><strong>Split order</strong>, which delivers an Application State attribute according to the order type. Valid values are <strong>Add</strong>, <strong>Modify</strong> or <strong>Delete</strong>.</p>
</li>
<li>
<p><strong>Wait for completed provisioning</strong>, which is a conditional activity that waits for the completion of all related provisioning steps that were initiated by the parent workflow and all child workflows. The activity polls for the expected provisioning results. On completion, the workflow proceeds and the results are available in the workflow context. If some provisioning results are pending, the activity uses the retry mechanism to wait for some period of time before performing the next check. Configure the retry mechanism - for example, for 500 retries of 5 minutes - to be sure that provisioning has enough time to complete.<br>
This activity requires correct settings of previous activities:</p>
</li>
<li>
<p>All apply activities have the flag <strong>Track changes</strong>. If you set it, all resulting provisioning actions of this activity are noted in a list in the workflow context.</p>
</li>
<li>
<p>The <strong>Apply Order</strong> activity also has the flag <strong>Track Changes in Child Workflow</strong>. When set, it enforces the child workflows to propagate all resulting provisioning actions to the parent workflow. They are integrated into the list in the workflow context.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The filled list is then used by the <strong>Wait for completed provisioning</strong> activity to check the results.</p>
</div>
<div class="paragraph">
<p>DirX Identity supplies the following default <strong>conditional activities</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Wait for child workflows</strong> is a conditional activity that waits for completion of child workflows. It checks whether child workflows are started. If so, it stops further execution of the workflow. If a child workflow finishes, it notifies this activity about its completion, its states, and the changes it performed if the flag <strong>Track Changes in Child Workflow</strong> was checked at the preceding Apply Order activity. Parent and child workflows must be correctly and consistently configured. In the parent workflow, the <strong>Wait for child workflows</strong> activity requires a preceding <strong>Apply Order</strong> activity where you can set the aforementioned flag. If all child workflows are finished, workflow execution continues.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_about_the_activity_sub_structure"><a class="anchor" href="#_about_the_activity_sub_structure"></a>About the Activity Sub-Structure</h4>
<div class="paragraph">
<p>Request workflow activities have a fixed sub-structure that makes workflow design easier and keeps workflow definitions simple. The following figure illustrates this sub-structure:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch1_applsref/image1.gif" alt="Activity Sub-structure">
</div>
<div class="title">Figure 1. Activity Sub-structure</div>
</div>
<div class="paragraph">
<p>Activity sub-structure elements are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Pre step</strong> - an optional step that typically contains a notification to the participants of the main step. Note that failure of this step is logged but has no effect on the state of the activity.</p>
</li>
<li>
<p><strong>Main step</strong> - the main part of the activity, for example, an approval step. This step sets the state and application state values for the entire activity.</p>
</li>
<li>
<p><strong>Post step</strong> - an optional step that typically contains a notification after the main activity is completed. Note that failure of this step is logged but has no effect on the state of the activity.</p>
</li>
<li>
<p><strong>Error</strong> <strong>step</strong> - an optional definition of the error notification to be sent to the administrator if the main step fails. If this sub activity is not configured, the activity goes to state <strong>Failed</strong> and the <strong>General</strong> <strong>Error</strong> activity is activated. See the section "Request Workflow Error Handling" for more details.</p>
</li>
<li>
<p><strong>Escalations</strong> <strong>step</strong> - an optional definition of escalation steps. If escalations are defined, the complete activity is re-calculated with the escalation definition and run again. The previous activity remains in state <strong>Failed</strong>.<strong>Expired</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The main step is always present and must be defined. All other steps are optional. You can activate and deactivate them as required. An active step is shown in yellow, while an inactive step is shown in gray.</p>
</div>
</div>
<div class="sect3">
<h4 id="_understanding_notifications"><a class="anchor" href="#_understanding_notifications"></a>Understanding Notifications</h4>
<div class="paragraph">
<p>You can define explicit or implicit notifications:</p>
</div>
<div class="paragraph">
<p><strong>Explicit notifications</strong> are directly visible in the graphical workflow structure. You use an explicit notification for conditional e-mail notification; for example, an e-mail to be sent if an approval is rejected or if a previous activity fails.</p>
</div>
<div class="paragraph">
<p><strong>Implicit notifications</strong> are part of the (fixed) sub-structure of an activity (see the section "About the Activity Sub-Structure" for details). You can activate or deactivate this type of activity. Use an implicit notification if it is closely related to the activity&#8217;s main task. Typical uses are a notification request to the participants of an approval task or an informational notification after a task has been performed.</p>
</div>
<div class="paragraph">
<p>In some cases, it is up to you to choose between an explicit or implicit notification. Implicit notifications help to keep workflow definitions simple by reducing superfluous or recurring information.</p>
</div>
</div>
<div class="sect3">
<h4 id="_html_notifications"><a class="anchor" href="#_html_notifications"></a>HTML Notifications</h4>
<div class="paragraph">
<p>You can send notifications in plain text or in HTML format.</p>
</div>
<div class="paragraph">
<p>Most of the request workflow templates delivered with DirX Identity are set up as plain text mails. One example is set up as HTML mail.</p>
</div>
<div class="paragraph">
<p>Default &#8594; Assignments &#8594; Manager Nomination &#8594; Approval by Company Head (notifyBefore)</p>
</div>
<div class="paragraph">
<p>In this example, we did not set up nationalization to show the HTML code in one piece.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"&gt;
&lt;HTML&gt;
&lt;HEAD&gt;
&lt;META http-equiv=Content-Type content="text/html; charset=iso-8859-1"&gt;
&lt;STYLE type=text/css&gt;P.generalquestions {
BORDER-RIGHT: #bcd 1px solid; BORDER-TOP: #bcd 1px solid; FONT-SIZE: 10px; BORDER-LEFT: #bcd 1px solid; COLOR: #039; BORDER-BOTTOM: #bcd 1px solid; FONT-FAMILY: Arial,sans-serif}
&lt;/STYLE&gt;
&lt;META content="MSHTML 6.00.6000.17102" name=GENERATOR&gt;
&lt;/HEAD&gt;
&lt;BODY&gt;
&lt;B&gt;
&lt;? if ${to.gender} == "W" ?&gt;
Dear Mrs. ${to.sn},
&lt;? else ?&gt;
Dear Mr. ${to.sn},
&lt;? endif ?&gt;
&lt;/B&gt;
&lt;P&gt;&lt;/P&gt;
&lt;P&gt;Please approve the following privilege assignment:
&lt;BR&gt;User: &lt;B&gt;${workflow.subject.cn}&lt;/B&gt;
&lt;BR&gt;Privilege: &lt;B&gt;${workflow.resources[0].dxrassignto@cn}&lt;/B&gt; &lt;/P&gt;
&lt;P&gt;To approve, follow the link: &lt;A href="${workflow.approvalLink}"&gt;Web Center&lt;/A&gt; &lt;/P&gt;
&lt;P&gt;&lt;I&gt;This is an automatically generated mail. Please do not reply.&lt;/I&gt; &lt;/P&gt;
&lt;P class=generalquestions&gt;For general questions about this workflow please contact:
&lt;I&gt;&lt;A href="mailto:${workflow.owner.mail}"&gt;Pitton Lavina&lt;/A&gt;&lt;/I&gt;
&lt;BR&gt;Workflow: ${workflow.path}
&lt;BR&gt;Activity: ${name} &lt;/P&gt;
&lt;/BODY&gt;
&lt;/HTML&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The SendMail workflow recognizes the HTML format from the DOCTYPE statement at the very beginning. The example shows that you can integrate variables (for example ${workflow.subject.cn}) and conditional statements (here the &lt;? if ?&gt; statement) without any problems. Read more about using variables and conditional statements in the section "Using Variable Substitution".</p>
</div>
<div class="paragraph">
<p>Although you can separate pieces of this code into nationalization items, we recommend setting up the whole HTML code first, testing it and then dividing it into nationalization items that you can then reuse.</p>
</div>
<div class="paragraph">
<p>To play with this example, for example, in the My-Company sample domain:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Copy the workflow and activate it.</p>
</li>
<li>
<p>Restart the Java-based Server or perform <strong>Load IdS-J Configuration</strong>.</p>
</li>
<li>
<p>Assign the workflow to any privilege directly.</p>
</li>
<li>
<p>Assign the privilege to a user.</p>
</li>
<li>
<p>An approval workflow should be started and the mail should be sent.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_understanding_request_workflow_states"><a class="anchor" href="#_understanding_request_workflow_states"></a>Understanding Request Workflow States</h4>
<div class="paragraph">
<p>The states of the request workflow and its activities are closely related. This section describes request workflow states and activity states.</p>
</div>
<div class="sect4">
<h5 id="_types_of_request_workflow_states"><a class="anchor" href="#_types_of_request_workflow_states"></a>Types of Request Workflow States</h5>
<div class="paragraph">
<p>A request workflow object has two types of state:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A workflow state, which indicates the general state of the workflow and has fixed values such as <strong>Succeeded</strong> or <strong>Failed</strong>. DirX Identity&#8217;s request workflow service automatically sets this state.</p>
</li>
<li>
<p>A workflow application state, which is a programmable state that is controlled by the specific workflow definition. For approval workflows, the possible values for the workflow application state are <strong>Accepted</strong> or <strong>Rejected</strong>. DirX Identity customers can define their own states, and if there are no special states defined, the application state value can also be empty.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following figure illustrates request workflow states:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch1_applsref/image2.gif" alt="Request Workflow States">
</div>
<div class="title">Figure 2. Request Workflow States</div>
</div>
<div class="paragraph">
<p>Workflow states are:</p>
</div>
<div class="paragraph">
<p><strong>(None)</strong> - the Java-based Identity Server is aware of the workflow definition (because it is flagged as active) but instances of the workflow do not yet exist.</p>
</div>
<div class="paragraph">
<p><strong>Running</strong> - the request workflow service has started an instance of this workflow definition after receiving an appropriate event.</p>
</div>
<div class="paragraph">
<p><strong>Succeeded</strong> - the run of the workflow instance is formally successful; that is, a final activity has succeeded. If this activity contains an application state, the workflow instance inherits it. The request workflow service takes the application state from the calculated value of the final activity or, if there is no value there, the display name of the start condition. If the display name is empty, the application state will be empty, too.</p>
</div>
<div class="paragraph">
<p>*Failed.*<em>state</em> - the run of the workflow instance has failed. Check the activity states to see the details. <em>state</em> indicates the following special states:</p>
</div>
<div class="paragraph">
<p><strong>Failed.Prepare</strong> - the state inherited from the relevant activity, which is the activity that an administrator or the request workflow service (for example, by retries) could not resolve before it reached its defined timeout value and entered an error condition.</p>
</div>
<div class="paragraph">
<p><strong>Failed.Incomplete</strong> - the request workflow service discovered a structural error in the workflow definition but the workflow has not yet completed because:<br>
- a startable activity no longer exists<br>
- a running activity no longer exists<br>
- a finished final activity is not available</p>
</div>
<div class="paragraph">
<p><strong>Failed.Expired</strong> - there was either a timeout inherited by the relevant activity or a timeout of the complete workflow.</p>
</div>
<div class="paragraph">
<p><strong>Failed.Aborted</strong> - either a user has cancelled this workflow instance or the timeout was inherited from the relevant activity (a user has cancelled this activity). If a user cancels the workflow, all activities that are still running go to status Failed.Aborted, too.<br>
<br>
If parallel activities must all succeed, this state is also reached if one of the parallel activities goes to state REJECTED.</p>
</div>
<div class="paragraph">
<p><strong>Failed</strong> - any other error inherited from the relevant activity</p>
</div>
<div class="paragraph">
<p>See the section "Request Workflow Error Handling" for more information.</p>
</div>
</div>
<div class="sect4">
<h5 id="_understanding_request_workflow_activity_states"><a class="anchor" href="#_understanding_request_workflow_activity_states"></a>Understanding Request Workflow Activity States</h5>
<div class="paragraph">
<p>The following figure illustrates the request workflow activity states:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch1_applsref/image3.gif" alt="Request Workflow Activities">
</div>
<div class="title">Figure 3. Request Workflow Activities</div>
</div>
<div class="paragraph">
<p>Activity states are:</p>
</div>
<div class="paragraph">
<p><strong>(None)</strong> - the activity instance exists but the start condition is not yet satisfied.</p>
</div>
<div class="paragraph">
<p><strong>Running</strong> - the activity instance is running due to a satisfied start condition.</p>
</div>
<div class="paragraph">
<p><strong>Succeeded</strong> - the run of this activity instance was successful.</p>
</div>
<div class="paragraph">
<p><strong>Failed.Prepare</strong> - an exception occurred during the participant constraint calculation that is not ConstraintViolationException.</p>
</div>
<div class="paragraph">
<p><strong>Failed.Temporary</strong> - the activity determined that the error that occurred is only temporary (for example, the network is temporarily unavailable). If retries are configured for this activity, the request workflow service starts the activity after the <strong>Wait before retry</strong> period to resolve the error. If no retries remain, the activity goes to status <strong>Failed.Expired</strong>.</p>
</div>
<div class="paragraph">
<p><strong>Failed</strong> - the run of this activity instance failed due to a non recoverable error and no <strong>Error</strong> sub activity is configured.</p>
</div>
<div class="paragraph">
<p><strong>WaitInError</strong> - the run of this activity instance failed due to a non-recoverable error and an <strong>Error</strong> sub activity is configured. This error activity is used to send a notification to the administrator, who can resolve the problem and resume the workflow, or cancel the workflow if he cannot resolve the problem.</p>
</div>
<div class="paragraph">
<p><strong>Failed.Aborted</strong> - a user cancelled this activity.</p>
</div>
<div class="paragraph">
<p><strong>Cancelled</strong> - the request workflow service canceled this (parallel) activity because another user approved this step.</p>
</div>
<div class="paragraph">
<p><strong>Failed.Expired</strong> - the run of this activity instance failed due to a timeout or a <strong>Failed.Temporary</strong> condition. In this case, the request workflow service checks whether retries are configured. If they are, it restarts the activity. If the activity sub-structure contains a pre-step, it reminds the relevant user that there is still a task to do. If retries are not configured, the workflow engine sets the activity state to <strong>Failed.Expired</strong> and determines whether an escalations step is configured and still available. If no, the activity is completed and remains in the <strong>Failed</strong>.<strong>Expired</strong> state. If yes, the escalation definition is evaluated and a new activity is started.</p>
</div>
<div class="paragraph">
<p>See also the section "Request Workflow Error Handling" for more information.</p>
</div>
<div class="paragraph">
<p>The workflow calculates participants in an activity by evaluating:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The configured participant calculation mechanism; for example, a static list or access policies.</p>
</li>
<li>
<p>The participants filter (it removes, for example, the initiator of this workflow).</p>
</li>
<li>
<p>The participants constraints, as follows:</p>
</li>
<li>
<p>If participant constraints are not defined and no approver is retrieved, the request workflow service assumes a correct approval (activity state = <strong>Succeeded</strong>, application state = <strong>Accepted</strong>).</p>
</li>
<li>
<p>If participant constraints are defined and the exception thrown is <strong>ConstraintViolationException</strong>, the routine (Java class) that the workflow designer has written to calculate the constraints can set the state and application state to any value and return it to the workflow engine. Thus in this case, the workflow designer has complete control over these values.</p>
</li>
<li>
<p>If participant constraints are defined and the exception thrown is <em>not</em> <strong>ConstraintViolationException</strong>, the workflow&#8217;s General Error activity starts and sets this activity and the workflow state to <strong>Failed.Prepare</strong> to indicates a serious error.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_understanding_the_full_checker"><a class="anchor" href="#_understanding_the_full_checker"></a>Understanding the Full Checker</h4>
<div class="paragraph">
<p>The full checker is a built-in service to handle running request workflow instances. It runs on a regular basis and checks all entries that are still in a "running" state for special conditions.</p>
</div>
<div class="paragraph">
<p>The full check that works on all running workflows is no longer needed, thus the checkallinterval is set to 0 to disable it by default.</p>
</div>
<div class="sect4">
<h5 id="_full_check_for_expired_workflows_and_activities"><a class="anchor" href="#_full_check_for_expired_workflows_and_activities"></a>Full Check for Expired Workflows and Activities</h5>
<div class="paragraph">
<p>Checks for expired workflows and activities.</p>
</div>
<div class="paragraph">
<p>The filter for workflow instances is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ldap hljs" data-lang="ldap">|(&amp;(dxrExpirationDate&lt;=__current_date__)(dxrState="RUNNING"))(dxrState="UNDERCONSTRUCTION")(dxrState=RUNNABLE)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The filter for activity instances is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ldap hljs" data-lang="ldap">|(&amp;(dxrExpirationDate&lt;=__current_date__)(dxrState="RUNNING"))(dxrState=RETRY)(dxrState=WAITINERROR)(dxrState=RUNNABLE)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This type of the full checker runs every 30 minutes by default.</p>
</div>
</div>
<div class="sect4">
<h5 id="_full_check_for_all_running_workflows"><a class="anchor" href="#_full_check_for_all_running_workflows"></a>Full Check for All Running Workflows</h5>
<div class="paragraph">
<p>Checks all instances in state running for these conditions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Determines whether a timeout condition occurred. If yes, it handles the timeout (see the section "Understanding Request Workflow States" for details).</p>
</li>
<li>
<p>Checks whether there are running workflows and/or activities that have expired. If such workflows or activities are detected, the corresponding workflows are forwarded to the workflow engine, which will calculate the next activities.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The filter to search for these instances is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ldap hljs" data-lang="ldap">|(dxrState="RUNNABLE")(dxrState="RUNNING")(dxrState="UNDERCONSTRUCTION")(!(dxrState=*))</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, this type of the full checker is disabled. If it is enabled, it is started automatically about 1 minute after server start.</p>
</div>
</div>
<div class="sect4">
<h5 id="_full_checker_configuration"><a class="anchor" href="#_full_checker_configuration"></a>Full Checker Configuration</h5>
<div class="paragraph">
<p>You can change the full checker intervals in the <strong>server.xml</strong> for request workflows under this path:</p>
</div>
<div class="paragraph">
<p><em>install_path</em>*\ids-j-<strong><em>domain</em></strong>-S*<em>n</em>*\extensions\com.siemens.idm.requestworkflow\server.xml*</p>
</div>
<div class="paragraph">
<p>where <em>domain</em> is the domain for which the IdS-J server is running and <strong>S*<em>n</em> is the server number (counts per domain). For example, *ids-j-My-Company-S1</strong>. See the section on "Naming Schemes" in the section "Managing Java-based Servers" in the <em>DirX Identity Connectivity Administration Guide</em> for a discussion of the naming schemes used for DirX Identity services.</p>
</div>
<div class="paragraph">
<p>Search for the <code>&lt;schedules&gt;</code> tag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;schedules&gt;
&lt;RequestWorkflowFullCheck&gt;
&lt;class&gt;com.siemens.idm.requestworkflow.tasks.FullCheck&lt;/class&gt;
&lt;start&gt;0&lt;/start&gt;
&lt;!-- interval when all expired workflows and activities are checked (in msec) --&gt;
&lt;period&gt;**1800000**&lt;/period&gt;
&lt;singleton&gt;true&lt;/singleton&gt;
&lt;!-- interval when all (running) workflows are checked (in msec) --&gt;
&lt;checkallinterval&gt;**0**&lt;/checkallinterval&gt;
&lt;/RequestWorkflowFullCheck&gt;
&lt;/schedules&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can set the full check interval for expiration checks with the parameter &lt;period&gt; in milliseconds. By default, 1800 000 ms = 30 min are set.</p>
</div>
<div class="paragraph">
<p>You can also set the full check interval for all running workflows with the parameter &lt;checkallinterval&gt; in milliseconds. By default, this mode is disabled.</p>
</div>
<div class="paragraph">
<p>If you want to run with a large number of running workflows, we recommend using these settings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;period&gt;3600000&lt;/period&gt; &lt;!-- 60 minutes --&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;checkallinterval&gt;0&lt;/checkallinterval&gt; &lt;!-- service disabled --&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_request_workflow_error_handling"><a class="anchor" href="#_request_workflow_error_handling"></a>Request Workflow Error Handling</h4>
<div class="paragraph">
<p>The request workflow service handles various types of errors. See the section "Understanding Request Workflow States" for details.</p>
</div>
<div class="paragraph">
<p>For each request workflow activity, you can configure an <strong>Error</strong> sub-structure element that allows you to define a specific error notification to be sent to the administrator if the activity&#8217;s main step fails (see the section "About the Activity Sub-Structure" for details). If a non-recoverable error occurs in an activity, it goes to state <strong>WaitInError</strong>. If the <strong>Error</strong> sub-activity is not defined, the activity goes to state <strong>Failed</strong> and the default error activity <strong>General</strong> <strong>Error</strong> takes control.</p>
</div>
<div class="paragraph">
<p>For each workflow, the <strong>General Error</strong> activity is configured by default as Error Activity, which sends a notification to the workflow initiator that something is wrong. You can create your own workflow-specific or workflow group-specific error activities and link them to a workflow or a group of workflows to implement special behavior.</p>
</div>
<div class="paragraph">
<p>The request workflow service calls the <strong>General</strong> <strong>Error</strong> activity once during each workflow re-calculation (either triggered by an internal status change event from an activity or by a full check from the workflow engine itself). The <strong>General</strong> <strong>Error</strong> activity:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Checks all activities to determine whether they are in a <strong>Failed</strong>.<em>state</em> that is not <strong>Failed</strong>.<strong>Expired</strong> or <strong>Failed</strong>.<strong>Temporary</strong>.</p>
</li>
<li>
<p>For activities that meet this determination, the request workflow service aborts the workflow and sets the workflow state and application state to the states of the failed activity. If several activities in a workflow meet the determination, the request workflow service selects one at random and uses its states.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can configure an <strong>ErrorHandler</strong> for workflow timeout (status FAILED.EXPIRED). Simply add this activity to your workflow definition. It should not be connected to any other activity. It sends an e-mail if the workflow times out.</p>
</div>
</div>
<div class="sect3">
<h4 id="_nationalizing_request_workflows"><a class="anchor" href="#_nationalizing_request_workflows"></a>Nationalizing Request Workflows</h4>
<div class="paragraph">
<p>People activities within request workflows create dynamic pages in Web Center. For complete nationalization of Web Center pages, you need to</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the Web Center&#8217;s nationalization feature for all static pages (see the chapter "Adding Languages" in the <em>Identity Web Center Customization Guide</em>).</p>
</li>
<li>
<p>Use the Request Workflow&#8217;s nationalization feature for all dynamic pages.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The next section describes the nationalization concept for dynamic pages.</p>
</div>
<div class="paragraph">
<p>Note that DirX Identity is delivered by default with message items in the locales <strong>en</strong> and <strong>de</strong>.</p>
</div>
<div class="sect4">
<h5 id="_understanding_request_workflow_nationalization"><a class="anchor" href="#_understanding_request_workflow_nationalization"></a>Understanding Request Workflow Nationalization</h5>
<div class="paragraph">
<p>DirX Identity&#8217;s concept for nationalization of dynamic Web Pages and also mail content is based on the Java concept for nationalization. A text element can keep one or more message items that are replaced during runtime with text that corresponds to the user&#8217;s requested language.</p>
</div>
<div class="paragraph">
<p>An example for a mail body within a request workflow activity is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">#{Request Workflows/Assignment Workflows.AssignmentOfPrivilegeRejected_body}

#{Common Text.ContactPersonsThatRejected}

&lt;? for activity in ${workflow.activities} ?&gt;
&lt;? if ${activity.applicationState} == "REJECTED" ?&gt;
&lt;? for participant in ${activity.approvers} ?&gt;
#{Request Workflows/Assignment Workflows.AssignmentOfPrivilegeRejected_loopline}
&lt;? endfor ?&gt;
&lt;? endif ?&gt;
&lt;? endfor ?&gt;

#{Common Text.AutomaticGeneratedMail}

#{Common Text.GeneralQuestions}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the English language is requested, this generic text definition is resolved as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">The assignment of privilege ${workflow.resources[0].dxrassignto@cn} to user ${workflow.subject.cn} was rejected.

Please contact the persons that rejected the request:

&lt;? for activity in ${workflow.activities} ?&gt;
&lt;? if ${activity.applicationState} == "REJECTED" ?&gt;
&lt;? for participant in ${activity.approvers} ?&gt;
- Activity step: '${activity.name}': User ${participant.cn} with reason: ${activity.reason}
&lt;? endfor ?&gt;
&lt;? endif ?&gt;
&lt;? endfor ?&gt;

This is an automatically generated mail. Please do not reply.

For general questions about this workflow please contact: ${workflow.owner.mail} +
Workflow: ${workflow.path} +
Activity: ${name}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, the definition</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">#{Common Text.AutomaticGeneratedMail}</code></pre>
</div>
</div>
<div class="paragraph">
<p>is resolved to</p>
</div>
<div class="paragraph">
<p>This is an automatically generated mail. Please do not reply.</p>
</div>
<div class="paragraph">
<p>Note that message items can contain variables, for example ${workflow.subject.cn} that are replaced during runtime with the corresponding value, in this case the common name of the subject. For more information about this concept, see the section "Using Variable Substitution" in the <em>DirX Identity Application Development Guide</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_using_the_nationalization_wizard"><a class="anchor" href="#_using_the_nationalization_wizard"></a>Using the Nationalization Wizard</h5>
<div class="paragraph">
<p>Some fields within DirX Identity support nationalization. Typical fields are the subject or the body of a mail definition.</p>
</div>
<div class="paragraph">
<p>To determine whether a field supports nationalization, use the Identity Manager to view the description of the individual field in the online help. Alternatively, you can click in a field and view the context menu, which may show you the menu items of the nationalization wizard.</p>
</div>
<div class="paragraph">
<p>In read mode, one menu item is available:</p>
</div>
<div class="paragraph">
<p><strong>Show resolved text</strong> - click this item to resolve all message items to the language definitions defined by the <strong>Default Language</strong> field in the domain object.</p>
</div>
<div class="paragraph">
<p>In edit mode, these menu items are visible:</p>
</div>
<div class="paragraph">
<p><strong>Insert a message</strong> - the nationalization wizard opens and presents the central message item tree under Configuration &#8594; Nationalization. Select a message item object in the language of your choice and then select a message from the list of message items. The wizard inserts the corresponding message item at the cursor location.</p>
</div>
<div class="paragraph">
<p><strong>Insert a message relative</strong> - the nationalization wizard opens and presents the local message items for this workflow. Select a message item object in the language of your choice and then select a message from the list of message items. The wizard inserts the corresponding message item at the cursor location.</p>
</div>
<div class="paragraph">
<p><strong>Show resolved text</strong> - click this item to resolve all message items to the language definitions defined by the <strong>Default Language</strong> field in the domain object.</p>
</div>
</div>
<div class="sect4">
<h5 id="_organizing_message_topics"><a class="anchor" href="#_organizing_message_topics"></a>Organizing Message Topics</h5>
<div class="paragraph">
<p>To optimize nationalization message management, you can define messages at two locations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can define more common message items in the central Nationalization folder in the Domain Configuration, which allows you to reuse messages in many objects. Message references to these items can be seen as absolute references.</p>
</li>
<li>
<p>You can define specific message items together with your configuration object, for example, the request workflow definition. Message references to these items can be seen as relative references. If you copy this type of configuration object, the message items are also copied and the references are still valid and point to your copied configuration object.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Use both methods to structure your message catalog. Try to reuse messages as much as possible.</p>
</div>
</div>
<div class="sect4">
<h5 id="_customizing_request_workflow_nationalization"><a class="anchor" href="#_customizing_request_workflow_nationalization"></a>Customizing Request Workflow Nationalization</h5>
<div class="paragraph">
<p>DirX Identity provides three methods for customizing request workflow nationalization:</p>
</div>
<div class="paragraph">
<p><strong>Local message items</strong> - you can copy a request workflow together with its local nationalization items. You can change the local items because they are copies of the original objects. You can also extend them with other locales.</p>
</div>
<div class="paragraph">
<p><strong>Central default message items</strong> (under the path <strong>Nationalization</strong>) - you can extend the existing default message items with additional locales but you cannot change the delivered default message items.</p>
</div>
<div class="paragraph">
<p><strong>Custom default message items</strong> (under the path <strong>Nationalization &#8594; Customer Extensions</strong>) - if you need additional central message item definitions, define them under this folder. Use folders to structure the items accordingly. Set up items for all required locales.</p>
</div>
</div>
<div class="sect4">
<h5 id="_using_an_external_nationalization_editor"><a class="anchor" href="#_using_an_external_nationalization_editor"></a>Using an External Nationalization Editor</h5>
<div class="paragraph">
<p>You can use the built-in features of the Identity Manager to create and maintain message items, particularly if you create new workflow definitions with the corresponding message items in the primary language.</p>
</div>
<div class="paragraph">
<p>Use an external nationalization editor primarily to</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Check the consistency of a large number of message items</p>
</li>
<li>
<p>Add a new language</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The export file format is comma-separated values (CSV). You can use any tools that allow you to edit CSV files correctly.</p>
</div>
<div class="paragraph">
<p>The following sections explain how to export and import nationalization information and how to edit the items with Microsoft Excel.</p>
</div>
<div class="paragraph">
<p>Exporting Nationalization Information</p>
</div>
<div class="paragraph">
<p>You can export the complete nationalization information into one file or you can select specific parts of the information:</p>
</div>
<div class="paragraph">
<p><strong>File &#8594; Export Nationalization Items</strong> - use this menu item from the menu bar to export all nationalization information into one file. A file selection dialog asks for the file location and name.</p>
</div>
<div class="paragraph">
<p><strong>Export Nationalization Items</strong> - use this context menu item at a message item folder or message item to export a subtree or a single item into a file. A file selection dialog asks for the file location and name.</p>
</div>
<div class="paragraph">
<p>You can specify the delimiter that is used with the parameter <strong>nationalization.csv.delimiter</strong> in the file <strong>dxi.cfg</strong>. By default, we use a semicolon ';'. Note: after changing this file, you must restart the Identity Manager.</p>
</div>
<div class="paragraph">
<p>The format of the file looks like this if two languages are exported (Excel representation):</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 26%;">
<col style="width: 22%;">
<col style="width: 27%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>path</strong></th>
<th class="tableblock halign-left valign-top"><strong>key</strong></th>
<th class="tableblock halign-left valign-top"><strong>de</strong></th>
<th class="tableblock halign-left valign-top"><strong>en</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prov:Configuration/Nat&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dxrStartDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start Datum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start Date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mobile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mobiltelefonnummer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mobile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prov:Configuration/Nat&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RequestApproval_body</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bitte genehmigen Sie die folgende Anforderung:<br>
Benutzer : ${workflow.subject.cn}<br>
Berechtigung: ${workflow.resources[0].dxrassignto@cn}"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Please approve the following request:<br>
User: ${workflow.subject.cn}<br>
Resource: ${workflow.resources[0].dxrassignto@cn}"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The first line is the header line. The field definitions are as follows:</p>
</div>
<div class="paragraph">
<p>path - the object path of this message item (for example, "Conn:Configuration/Nationalization/Attribute Descriptions"). The last part is the name of the message item (here "Attribute Descriptions").</p>
</div>
<div class="paragraph">
<p>key - the key in the file (for example, mobile).</p>
</div>
<div class="paragraph">
<p><em>language</em> - a column for each language in alphabetical order.</p>
</div>
<div class="paragraph">
<p>The next lines contain collections of message items (the key and the information for each language). The first line contains the path, while the last line is empty and serves as a separator.</p>
</div>
<div class="paragraph">
<p>Editing in an External Editor</p>
</div>
<div class="paragraph">
<p>You can use any editor that allows editing of CSV files. Examples are Microsoft Excel or Microsoft Access.</p>
</div>
<div class="paragraph">
<p>Before you start editing a large amount of data the first time, we recommend that you test the editor with a small amount of data. Perform an export, edit the data and then import it into DirX Identity. You should then check the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Were national characters handled correctly?</p>
</li>
<li>
<p>Did the editor handle multi line message items correctly?</p>
</li>
<li>
<p>Could you create a new key with no problems (result should be new message items)?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If all these issues worked well, you can start editing.</p>
</div>
<div class="paragraph">
<p>We tested with Microsoft Excel. Here are some hints on how to work with it:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use a colon ';' or a comma ',' as a delimiter for the export. For ease of handling, you should use the default Excel delimiter, which depends on your language settings. The colon is the default delimiter.</p>
</li>
<li>
<p>Double-click the CSV file. Excel should open it with correctly populated columns. If not, you used the wrong delimiter.</p>
</li>
<li>
<p>Now you can edit the file with all Excel features.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can perform these operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Change an existing language information field. This action changes the corresponding line in the message item.</p>
</li>
<li>
<p>Populate an empty field (translate it from another language). Copy the language item (for example, in the English language) to the empty field.<br>
After import, this operation populates the corresponding line in the message item.</p>
</li>
<li>
<p>Add a new line with a key and language information.<br>
After import, this operation adds a new line to the corresponding message item.</p>
</li>
<li>
<p>Delete a line with key and language information.<br>
After import this removes the line from the corresponding message item.</p>
</li>
<li>
<p>Add a new column to add a new language. Write the language code in the header line (for example 'it').<br>
After import this creates the new message items.</p>
</li>
<li>
<p>You can reorder the language columns for easier editing but do not touch the path or key columns.</p>
</li>
<li>
<p>You can check easily if cells for a specific language are not filled correctly.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are some restrictions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Do not destroy the structure of the file. In particular, do not remove or reorder the <strong>path</strong> or <strong>key</strong> columns. These columns must be the first two columns.</p>
</li>
<li>
<p>If you created a new language column and during import the option "Create empty objects" is set, a large number of empty objects may be created. There is no way to remove these objects as a whole.</p>
</li>
<li>
<p>If you change the language code in the header, no rename is performed. Instead all objects are created with the new name. The old objects with the old name persist and must be manually removed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Importing Nationalization Information</p>
</div>
<div class="paragraph">
<p>To import exported and edited nationalization information files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Back up the database to be able to revert to the previous state (optional).</p>
</li>
<li>
<p>Select <strong>File</strong> &#8594; <strong>Import Nationalization Items</strong> from the menu bar within in the Identity Manager.</p>
</li>
<li>
<p>A file selection dialog asks for the file location and name of the file to import. It also contains these parameters:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Create empty objects</strong> - setting this option will create menu items that contain only keys but no language data. This option is useful for creating empty message items that you populate later on in the Identity Manager.</p>
</div>
<div class="paragraph">
<p><strong>Report object creation as error</strong> - setting this option will cause all object creations to be reported as errors. This option is useful if you made changes only in your nationalization information and you want to be warned if you destroyed something.</p>
</div>
<div class="paragraph">
<p>Note that the import method automatically calculates the delimiter from the header line in the file.</p>
</div>
</div>
<div class="sect4">
<h5 id="_determining_the_language"><a class="anchor" href="#_determining_the_language"></a>Determining the Language</h5>
<div class="paragraph">
<p>The process used to determine the correct language to use differs depending on the DirX Identity feature.</p>
</div>
<div class="paragraph">
<p>Web Center Pages</p>
</div>
<div class="paragraph">
<p>The language in which a Web Center page is displayed (this is valid for static and dynamic pages) is calculated in this sequence:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The user can select a language from the Web Center language selection. This value is stored in a cookie and is used during the next login.<br>
Note: if you delete the cookie, the language setting must be repeated.</p>
</li>
<li>
<p>After login of a user, the configured browser language is used.<br>
Note: if SSO with NetWeaver is configured, NetWeaver passes the language setting to Web Center.</p>
</li>
<li>
<p>If the language cannot be evaluated or the evaluated language cannot be resolved (no nationalization text available), English is used by default.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Notification Resolution</p>
</div>
<div class="paragraph">
<p>The language that is used to resolve a defined notification object is calculated in this sequence:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Language field of the notification object is evaluated. If this field resolves to a valid language, this language is used. Keep in mind that the resolved message text is shown as <strong>???*<em>original text</em></strong>???* if nationalized messages are not available for that language or if the <em>original text</em> for that language doesn’t exist.</p>
</li>
<li>
<p>If the language cannot be evaluated and resolves to null, English is used by default.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_handling_message_items_during_runtime"><a class="anchor" href="#_handling_message_items_during_runtime"></a>Handling Message Items during Runtime</h5>
<div class="paragraph">
<p>DirX Identity handles message items during runtime as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>During the Java-based Server startup, all message items are read and resolved to Java resource files.</p>
</li>
<li>
<p>If you request a re-load of the server configuration (Load IdS-J Configuration), all message items are re-loaded.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The load procedure resolves message items to absolute paths in a pre-defined folder structure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The common path for all message items starts with<em><br>
install_path</em>*\ids-j-<strong><em>domain</em></strong>-S*<em>n</em>*\tmp\nat\classes\*</p>
</li>
<li>
<p>Message items for request workflows are located under <strong>rqwfs</strong>.</p>
</li>
<li>
<p>Global items are resolved to the sub-folder <strong>gen</strong>.</p>
</li>
<li>
<p>Local items are resolved to the sub-folder <strong>wfs</strong>.</p>
</li>
<li>
<p>Under the global and workflow paths, the items are located in the corresponding item structure.</p>
</li>
<li>
<p>You will find message files for all locations under this path. The file name is:*<br>
messages_*<em>locale</em>*.properties*</p>
</li>
<li>
<p>The content appears as follows if it is identical to the message item content:<br></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">#
#Sun Feb 15 12:51:48 CET 2009
RequestWasRejected_body=We regret to inform you that your self-registration request was rejected.
DearUser_body=Dear User,</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The local definitions of the Customer Self Registration message items reside beneath the path Definitions &#8594; Default &#8594; Users &#8594; Customer Self Registration &#8594; _Nationalization.</p>
</li>
<li>
<p>After loading, the path is:_<br>
install_path_*ids-j-*<em>domain</em>*-S*<em>n</em>*\tmp\nat\classes\rqwfs\wfs\Default\Users\Customer Self Registration\_Nationalization*</p>
</li>
<li>
<p>You will find the files messages_en.properties and messages_de.properties</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Load Effort for Nationalization</p>
</div>
<div class="paragraph">
<p>Reading and processing the nationalization information during startup or during <strong>Load IdS-J Configuration</strong> of the Java-based Server requires some additional time. You can measure this overhead with the following procedure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Open the Web Admin</p>
</li>
<li>
<p>Select the logging configuration section.</p>
</li>
<li>
<p>Add the Java Class <strong>com.siemens.idm.server.nationalization</strong> and set the logging to <strong>Finest</strong>.</p>
</li>
<li>
<p>Restart the Java-based Server.</p>
</li>
<li>
<p>Check in the server log files for this string:<br>
"Loading resource files takes … ms"</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_selecting_request_workflows"><a class="anchor" href="#_selecting_request_workflows"></a>Selecting Request Workflows</h4>
<div class="paragraph">
<p>Selection of request workflows is different for creation, modification and assignment workflows and also depends on the calling source (Web Center, Manager or Web Services). The next sections describe request workflow selection for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creation workflows</p>
</li>
<li>
<p>Modification workflows</p>
</li>
<li>
<p>Assignment workflows</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_creation_workflow_selection"><a class="anchor" href="#_creation_workflow_selection"></a>Creation Workflow Selection</h5>
<div class="paragraph">
<p>The selection methods for creation workflows depend on the calling client:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Web Center</p>
</li>
<li>
<p>Identity Manager</p>
</li>
<li>
<p>Web Services</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Workflow Selection from Web Center</p>
</div>
<div class="paragraph">
<p>Workflow selection depends on the type of license you have.</p>
</div>
<div class="paragraph">
<p>If you have a <strong>Business Suite</strong> license, you cannot run request workflows. In this case, the ability to create a user depends on the creation access policies established for this user. For more information, see the section "Policies for Object Creation" in "Managing Access Policies" in "Delegated Administration" in the "Managing Policies" chapter of the <em>DirX Identity Provisioning Administration Guide</em>.</p>
</div>
<div class="paragraph">
<p>If you have the <strong>Professional Suite</strong> license, you can create objects in three ways (note that you can set up a mix of these methods within one Web Center application):</p>
</div>
<div class="paragraph">
<p>a. Object creation via request workflows (default):</p>
</div>
<div class="paragraph">
<p>If you click, for example, the "Add user"' menu item, the Web Center application retrieves all workflows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>that the logged-in user is allowed to execute (this depends on the access policies established for this user)</p>
</li>
<li>
<p>that have the <strong>Type</strong> field in the When Applicable section of the workflow set to <strong>Create</strong></p>
</li>
<li>
<p>that have the <strong>Subject</strong> field set to <strong>User</strong></p>
</li>
<li>
<p>and that have an empty <strong>Resources</strong> field</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If more than one creation workflow is found, the list is presented to the user for further selection. If only one workflow is found, this workflow is started immediately. If no workflow is found, an error is returned to the user that he is not allowed to execute any creation workflows.</p>
</div>
<div class="paragraph">
<p>The same algorithm is applied if the creation for a different object type is requested (for example, a <strong>Role</strong>).</p>
</div>
<div class="paragraph">
<p>b. Object creation via the Create user by request workflow flag feature:</p>
</div>
<div class="paragraph">
<p>You can customize Web Center to use the <strong>Create user by request workflow</strong> flag feature. Collect all necessary information to create an object (for example, user attributes, assignment of privileges) and then save the user object. This results in a start of a request workflow that stores the object later on.</p>
</div>
<div class="paragraph">
<p>Setting the <strong>Create user by request workflow</strong> flag at the domain object influences the save operation of the object. Instead of saving the object directly, the save operation is converted to a request workflow start where the entered data is transferred as input parameters in the form of an order object. The corresponding activity of the request workflows defines when to store the object (typically this activity is named <strong>Apply changes</strong>).</p>
</div>
<div class="paragraph">
<p>c. Object creation via Creation Access Policies</p>
</div>
<div class="paragraph">
<p>You can customize Web Center to use Creation access policies. For examples, see the pages set up for the Business Suite license.</p>
</div>
<div class="paragraph">
<p>Workflow Selection from Identity Manager</p>
</div>
<div class="paragraph">
<p>Workflow selection depends upon the type of license you have.</p>
</div>
<div class="paragraph">
<p>If you have a <strong>Business Suite</strong> license, you cannot run request workflows. In this case, objects are always stored directly when pressing the <strong>Save</strong> button.</p>
</div>
<div class="paragraph">
<p>If you have a <strong>Professional Suite</strong> license, the creation depends on the <strong>Create user by request workflow</strong> flag at the domain object:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the flag is not set, an object is created directly when clicking the <strong>Save</strong> button.</p>
</li>
<li>
<p>If the flag is set, the system tries to start a corresponding request workflow when clicking the <strong>Save</strong> button.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, if a user object is to be created, the Identity services retrieve all workflows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>that the logged in user is allowed to execute (this depends on the set up access policies for this user)</p>
</li>
<li>
<p>that have the <strong>Type</strong> field in the <strong>When Applicable</strong> section of the workflow set to <strong>Create</strong></p>
</li>
<li>
<p>that have the <strong>Subject</strong> field set to <strong>User</strong></p>
</li>
<li>
<p>and that have an empty <strong>Resources</strong> field</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If only one workflow is found, this workflow is started immediately. If more than one workflow or no workflow is found, an error is returned to the user if the <strong>Create user directly if no workflow available</strong> flag is not set. Otherwise the user entry is created directly.</p>
</div>
<div class="paragraph">
<p>The same algorithm is applied if the creation for a different object type is requested (for example, a <strong>Role</strong>).</p>
</div>
<div class="paragraph">
<p>Workflow Selection from Web Services</p>
</div>
<div class="paragraph">
<p>Workflow selection depends on the <strong>Create user by request workflow</strong> flag at the domain object:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the flag is not set, an object is created directly when executing an Add Object operation.</p>
</li>
<li>
<p>If the flag is set, the system tries to start a corresponding request workflow when executing an Add Object operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, if a user object is to be created, the Identity services retrieve all workflows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>that the requesting service is allowed to execute (this depends on the access policies established for the user account that is used by the service to authenticate)</p>
</li>
<li>
<p>that have the <strong>Type</strong> field in the When Applicable section of the workflow set to <strong>Create</strong></p>
</li>
<li>
<p>that have the <strong>Subject</strong> field set to <strong>User</strong></p>
</li>
<li>
<p>and that have an empty <strong>Resources</strong> field</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If only one workflow is found, this workflow is started immediately. If more than one workflow or no workflow is found, an error is returned to the service if the <strong>Create user directly if no workflow available</strong> flag is not set. Otherwise, the user entry is created directly.</p>
</div>
<div class="paragraph">
<p>The same algorithm is applied if the creation for a different object type is requested (for example, a <strong>Role</strong>).</p>
</div>
</div>
<div class="sect4">
<h5 id="_modification_workflow_selection"><a class="anchor" href="#_modification_workflow_selection"></a>Modification Workflow Selection</h5>
<div class="paragraph">
<p>This section describes the request workflow selection methods for modification workflows.</p>
</div>
<div class="paragraph">
<p>You can set up <strong>Attribute Policies</strong> for any object type to define the request workflows for attribute modification. (See the section "Attribute Policies for Users" in "Managing Attribute Policies" in the chapter "Managing Policies" in the <em>DirX Identity Provisioning Administration Guide</em> for details.</p>
</div>
<div class="paragraph">
<p>If an attribute of an object is changed, the service layer checks the change against the defined attribute policies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It retrieves all attribute policies for the relevant object type (for example dxrUser).</p>
</li>
<li>
<p>It checks whether the changed attribute is part of the Selected list in the Configuration tab of the attribute policy.</p>
</li>
<li>
<p>If no policy matches, the attribute is changed directly.</p>
</li>
<li>
<p>If a policy matches, the configured approval workflow is started.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If more than one policy is configured for an object type (for example, one for mail changes and one for department changes), and both attributes are changed, for each affected policy one workflow is started.</p>
</div>
<div class="paragraph">
<p>If a workflow link is set at the attribute policy, the referenced workflow is started. If no link is set, the workflow being started is selected by evaluating the <strong>When</strong> <strong>Applicable</strong> section of all workflows.</p>
</div>
<div class="paragraph">
<p>This mechanism is performed independently for each affected policy. If no matching workflow is found for a policy when saving the object, an error message is displayed.</p>
</div>
<div class="paragraph">
<p>If an attribute policy contains multiple attributes and several of them are changed, only one approval workflow is started.</p>
</div>
<div class="paragraph">
<p>Note that Java-based workflows do not evaluate attribute policies due to performance reasons. They only send events if enabled for an object type.</p>
</div>
</div>
<div class="sect4">
<h5 id="_assignment_workflow_selection"><a class="anchor" href="#_assignment_workflow_selection"></a>Assignment Workflow Selection</h5>
<div class="paragraph">
<p>DirX Identity provides two mechanisms to select the correct workflow for a specific privilege:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Direct workflow selection</strong> - sets a direct link from the privilege to the workflow</p>
</li>
<li>
<p><strong>Rule-based workflow selection</strong> - sets up <strong>When</strong> <strong>Applicable</strong> at each workflow definition</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The algorithm is slightly different depending on the assignment environment. We distinguish between these types for user-to-privilege assignments:</p>
</div>
<div class="paragraph">
<p>User-to-Privilege assignment - assignment, modification or removal of a privilege to or from a user (the corresponding operations for the assignment are create, modify, delete)</p>
</div>
<div class="paragraph">
<p>Segregation of duties (SoD) - an SoD policy requests an approval workflow for a user-to-privilege assignment</p>
</div>
<div class="paragraph">
<p>Re-approval - requires regular starts of re-approval workflows for a user-to-privilege assignment</p>
</div>
<div class="paragraph">
<p>Selection of approval for approval of links between privileges is handled in a similar way.</p>
</div>
<div class="paragraph">
<p>Workflow Selection Algorithm for User-to-Privilege Assignments</p>
</div>
<div class="paragraph">
<p>The calculation mechanism for workflow selection works as follows:</p>
</div>
<div class="paragraph">
<p>Calculate all workflows the logged-in user is allowed to execute. You can define the number of workflows for a specific user via access policies. (See the section "Managing Access Policies" in the section "Delegated Administration" in the chapter "Managing Policies" in the <em>DirX Identity Administration Guide</em> for details.)</p>
</div>
<div class="paragraph">
<p>The next steps depend on the direct workflow assignments at the privilege and the rule definitions in the <strong>When Applicable</strong> tab of the request workflow definitions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If a privilege is flagged with "Requires Approval", the service evaluates the type of operation (create, modify or delete) and request from the request workflow engine (running in the Java-based Server) to start a request workflow.</p>
</li>
<li>
<p>The request workflow engine checks whether a direct link to a workflow is set for this privilege and for this type of operation.</p>
</li>
<li>
<p>If yes, it takes this workflow and starts it.</p>
</li>
<li>
<p>If no, it selects all workflows that fit with the defined <strong>Type</strong> (the operation), the <strong>Subject type</strong> and the <strong>Resource type(s)</strong>.</p>
</li>
<li>
<p>If an optional <strong>Condition</strong> is set, it filters the list of workflows accordingly.</p>
</li>
<li>
<p>If the list still contains multiple workflows, it takes the workflow with the highest priority and starts it.</p>
</li>
<li>
<p>If there are several workflows with the highest priority, it takes one by random.</p>
</li>
<li>
<p>If the list is empty and operation type is <strong>create</strong>, an error is returned to the calling routine.</p>
</li>
<li>
<p>Otherwise it tries to use the workflow for create &#8594; start again with step 2 and type <strong>create</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Workflow Selection Algorithm for SoD</p>
</div>
<div class="paragraph">
<p>The calculation mechanism for workflow selection works as follows:</p>
</div>
<div class="paragraph">
<p>Calculate all workflows the logged in user is allowed to execute. You can define the amount of workflows for a specific user via access policies. (See subsection "Managing Access Policies" in section "Delegated Administration" in chapter "Managing Policies" in the <em>DirX Identity Administration Guide</em> for details.)</p>
</div>
<div class="paragraph">
<p>The next steps depend on the direct workflow assignments at the privilege and the rule definitions in the tab <strong>When Applicable</strong> of the request workflow definitions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The service sets the operation to <strong>SoD</strong> and request from the request workflow engine (running in the Java-based Server) to start a request workflow.</p>
</li>
<li>
<p>The request workflow engine checks whether the direct workflow link for SoD is set for this privilege.</p>
</li>
<li>
<p>If yes, it takes this workflow and starts it.</p>
</li>
<li>
<p>If no, it selects all workflows that fit for operation type SoD, the <strong>Subject type</strong> and the <strong>Resource type(s)</strong>.</p>
</li>
<li>
<p>If an optional <strong>Condition</strong> is set, it filters the list of workflows accordingly.</p>
</li>
<li>
<p>If the list still contains multiple workflows, it takes the workflow with the highest priority and starts it.</p>
</li>
<li>
<p>If there are several workflows with the highest priority, it takes one by random.</p>
</li>
<li>
<p>If the list is empty, it tries to use the workflow for create &#8594; start again with step 2 and type <strong>create</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Workflow Selection Algorithm for Re-Approval</p>
</div>
<div class="paragraph">
<p>The calculation mechanism for workflow selection works as follows:</p>
</div>
<div class="paragraph">
<p>Calculate all workflows the logged-in user is allowed to run. You can define the number of workflows for a specific user via access policies. (See the subsection "Managing Access Policies" in the section "Delegated Administration" in the chapter "Managing Policies" in the <em>DirX Identity Administration Guide</em> for details.)</p>
</div>
<div class="paragraph">
<p>The next steps depend on the direct workflow assignments at the privilege and the rule definitions in the tab <strong>When Applicable</strong> of the request workflow definitions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The service sets the operation to <strong>re-approve</strong> and request from the request workflow engine (running in the Java-based Server) to start a request workflow.</p>
</li>
<li>
<p>The request workflow engine checks whether the direct workflow link for re-approval is set for this privilege.</p>
</li>
<li>
<p>If yes, it takes this workflow and starts it.</p>
</li>
<li>
<p>If no, it selects all workflows that fit for operation type <strong>re-approval</strong>, the <strong>Subject type</strong> and the <strong>Resource type(s)</strong>.</p>
</li>
<li>
<p>If an optional <strong>Condition</strong> is set, it filters the list of workflows accordingly.</p>
</li>
<li>
<p>If the list still contains multiple workflows, it takes the workflow with the highest priority and starts it.</p>
</li>
<li>
<p>If there are several workflows with the highest priority it takes one by random.</p>
</li>
<li>
<p>If the list is empty it tries to use the workflow for create &#8594; start again with step 2 and type <strong>create</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Workflow Selection Algorithm for Approval of Links between Privileges</p>
</div>
<div class="paragraph">
<p>The calculation mechanism for workflow selection works as follows:</p>
</div>
<div class="paragraph">
<p>Calculate all workflows the logged in user is allowed to run. You can define the number of workflows for a specific user via access policies. (See the subsection "Managing Access Policies" in the section "Delegated Administration" in the chapter "Managing Policies" in the <em>DirX Identity Administration Guide</em> for details.)</p>
</div>
<div class="paragraph">
<p>The next steps depend on the direct workflow assignments at the privilege and the rule definitions in the tab <strong>When Applicable</strong> of the request workflow definitions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If a privilege is flagged with "Requires Approval" in the section <strong><em>Privilege</em></strong> <strong>Assignment Configuration</strong>, the service evaluates the type of operation (assign or remove) and request from the request workflow engine (running in the Java-based server) to start a request workflow.</p>
</li>
<li>
<p>The request workflow engine checks whether a direct link to a workflow is set for this privilege and for this type of operation.</p>
</li>
<li>
<p>If yes, it takes this workflow and starts it.</p>
</li>
<li>
<p>If no, it selects all workflows that fit with the defined <strong>Type</strong> (the operation), the <strong>Subject type</strong> and the <strong>Resource type(s)</strong>.</p>
</li>
<li>
<p>If an optional <strong>Condition</strong> is set, it filters the list of workflows accordingly.</p>
</li>
<li>
<p>If the list still contains multiple workflows, it takes the workflow with the highest priority and starts it.</p>
</li>
<li>
<p>If there are several workflows with the highest priority, it takes one at random.</p>
</li>
<li>
<p>If the list is empty and operation type is <strong>create</strong>, an error is returned to the calling routine.</p>
</li>
<li>
<p>Otherwise, it tries to use the workflow for create &#8594; start again with step 2 and type <strong>create</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_executing_request_workflows"><a class="anchor" href="#_executing_request_workflows"></a>Executing Request Workflows</h4>
<div class="paragraph">
<p>To execute a request workflow, the services calculate the URL to which the HTTP request is to be sent. The steps are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The service performs a search for the related IdS-J server. The filter used is:<br></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ldap hljs" data-lang="ldap">(&amp;(objectClass=dxmIDMServer)(!(dxmType=workerContainer))(dxmDomain=&lt;domain&gt;))</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>If no server configuration object is found for the domain, the search is repeated with the following filter:<br></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ldap hljs" data-lang="ldap">(&amp;(objectClass=dxmIDMServer)(!(dxmType=workerContainer))(!(dxmDomain=*)))</code></pre>
</div>
</div>
<div class="paragraph">
<p>This filter is applied for compatibility reasons, to find a server if no domain is explicitly configured.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The link to the service (dxmService-DN) defines as set of attributes:<br>
dxmSpecificAttributes(ssl) - an SSL connection is established if this value is 'true'.<br>
dxmDataPort - this port number is used if SSL is not enabled.<br>
dxmSecurePort - this port number is used if SSL is enabled.</p>
</li>
<li>
<p>The link to the system object (dxmSystem-DN) defines the host address. If the host address at the system object is empty, the host field of the service object is taken.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The resulting URL is as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If SSL is not enabled:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-url hljs" data-lang="url">http://$(dxmAddress):$(dxmDataPort)//RequestWorkflow/reqwfsvc</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>If SSL is enabled:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-url hljs" data-lang="url">https://$(dxmAddress):$(dxmSecurePort)//RequestWorkflow/reqwfsvc</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_customizing_request_workflows"><a class="anchor" href="#_customizing_request_workflows"></a>Customizing Request Workflows</h3>
<div class="paragraph">
<p>DirX Identity comes with a set of default request workflows that are sufficient for many purposes. Nevertheless, details must be adapted to the customer environment or new workflows should be created. The following sections explain how to customize the default request workflows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Working with Variable substitution</p>
</li>
<li>
<p>Implementing an activity</p>
</li>
<li>
<p>Implementing a Java class for finding participants</p>
</li>
<li>
<p>Implementing participant filters and constraints</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For a discussion of request workflow management, see the chapter "Managing Request Workflows" in the <em>DirX Identity Provisioning Administration Guide</em>.</p>
</div>
<div class="sect3">
<h4 id="_using_variable_substitution"><a class="anchor" href="#_using_variable_substitution"></a>Using Variable Substitution</h4>
<div class="paragraph">
<p>DirX Identity provides an easy-to-use variable substitution mechanism that can be used to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>define variable text sections for e-mails to be substituted during runtime. A typical application of this mechanism is e-mail texts. You can use variables in all text fields like From, To, Subject and Body. You can use simple variables to insert small text pieces like an e-mail address, or you can use control-flow statements with included variables to create more complex structures such as several lines of text coming from lists of objects (for example, a list of all workflow participants).</p>
</li>
<li>
<p>calculate participants for approval activities according to a dynamic specification.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is an example that shows how the mechanism works within e-mails:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">User '${workflow.initiatorEntry.cn}' launched the workflow '${workflow.name}' for '${workflow.subject.cn}'.
This request was rejected.

Please contact the persons that rejected the request:

&lt;? for activity in ${workflow.activities} ?&gt;
&lt;? if ${activity.applicationState} == "REJECTED" ?&gt;
&lt;? for participant in ${activity.approvers} ?&gt;
- User ${participant.givenName} ${participant.sn} rejected with reason: ${workflow.activity.reason}
&lt;? endfor ?&gt;
&lt;? endif ?&gt;
&lt;? endfor ?&gt;

This is an automatically generated mail. Please do not reply.</code></pre>
</div>
</div>
<div class="paragraph">
<p>At runtime, this template is expanded to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">User 'Donegan Mark 1234' launched the workflow 'Create User' for 'Sober Marietta 9876'.
This request was rejected.

Please contact the persons that rejected the request:

- User Fred Strober rejected with reason: Not the right person.
- User Donald Duck rejected with reason: Do not like him.

This is an automatically generated mail. Please do not reply.

Read the next sections for details about e-mail text variables.

Here are several examples that apply to participant calculation:

${workflow.subject.manager} - retrieves the manager(s) of the subject (uses the manager link to look up the manager DNs)
${workflow.subject.owner} - retrieves all owner of the subject (uses the owner link to look up the owner DNs)
${workflow.subject.manager.manager} - retrieves the manager of the subject's manager (useful for escalation)
${workflow.subject.dxrLocationLink.manager} - retrieves the manager of the location the subject is assigned to
${previousParticipants.manager} - retrieves the manager(s) of the previous activity during an escalation</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the static selection of the Participants tab of an approval definition to setup such definitions. For a detailed description see the section Participant Calculation below.</p>
</div>
<div class="sect4">
<h5 id="_elements"><a class="anchor" href="#_elements"></a>Elements</h5>
<div class="paragraph">
<p>A variable definition looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">${root.object.object...object.attribute}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It starts with a root object that can be composed of many sub-objects. The last element must be an attribute.</p>
</div>
<div class="paragraph">
<p><strong>Root element</strong></p>
</div>
<div class="paragraph">
<p>Root elements are:</p>
</div>
<div class="paragraph">
<p><strong>server</strong> - provides some general variables of the Java-based Server.</p>
</div>
<div class="paragraph">
<p><strong>workflow</strong> - represents the start element of the current workflow instance. From here you can access sub elements and structures.</p>
</div>
<div class="paragraph">
<p>&lt;empty&gt; - if nothing is specified, the current activity is assumed.</p>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$(workflow.subject.mail)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This statement retrieves the mail attribute of the subject this workflow handles.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$(workflow.subject.manager.mail)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This statement retrieves the mail attribute of the subject&#8217;s manager.</p>
</div>
</div>
<div class="sect4">
<h5 id="_structures"><a class="anchor" href="#_structures"></a>Structures</h5>
<div class="paragraph">
<p>This section explains the structures that can occur within request workflows. This has to do with the orders that such a workflow contains.</p>
</div>
<div class="paragraph">
<p>The general structure is:</p>
</div>
<div class="paragraph">
<p><strong>Workflow &#8594; One subject order &#8594; Zero or more resource orders</strong></p>
</div>
<div class="paragraph">
<p>Note that the resource orders are about assignments and not the objects itself. From here you can access the subject and the real resources:</p>
</div>
<div class="paragraph">
<p><strong>${workflow.resources[0].dxrassignfrom@&#8230;&#8203;}</strong> - allows accessing the subject (so this is equivalent to the workflow.subject construct).*<br>
${workflow.resources[0].dxrassignto@&#8230;&#8203;}* - allows accessing the resources.</p>
</div>
<div class="paragraph">
<p>Examples and how to access information:</p>
</div>
<div class="paragraph">
<p><strong>User modification: Workflow &#8594; User</strong><br>
${workflow.subject.cn} - name of the user<br>
${workflow.subject.mail} - mail address of the user<br>
${workflow.subject.manager.mail} - mail address of the user&#8217;s manager<br>
${workflow.subject.dxrLocationLink.manager.sn} - the surname of the location manager</p>
</div>
<div class="paragraph">
<p><strong>Privilege assignment: Workflow &#8594; User &#8594; Assignment</strong><br>
${workflow.resources[0].dxrStartDate} - the start date of the assignment<br>
${workflow.resources[0].roleParameter_Project@value} - the value of the role parameter Project.<br>
${workflow.resources[0].roleParameter_Project@oldvalue} - the value of the role parameter Project.<br>
${workflow.resources[0].roleParameter_Project@modified} - indicates the modification of the Project role parameter. The value is either TRUE or FALSE.<br>
${workflow.resources[0].dxrassignfrom@mail} - the mail address of the user (you can use workflow.subject.mail instead).<br>
${workflow.resources[0].dxrassignto@cn} - the name of the privilege.<br>
${workflow.resources[0].<a href="mailto:dxrassignto@owner.mail">dxrassignto@owner.mail</a>} - the mail address of the privilege owner.<br>
${workflow.resources[0].<a href="mailto:dxrassignto@owner.manager.mail">dxrassignto@owner.manager.mail</a>} - the mail address of the privilege owner&#8217;s manager.</p>
</div>
<div class="paragraph">
<p><strong>Multiple privilege assignments: Workflow &#8594; User &#8594; Assignments</strong><br>
You can use the same definitions as shown for one assignment if you define the index with control constructs.</p>
</div>
<div class="paragraph">
<p><strong>Access certification: Workflow &#8594; Privilege &#8594; Users</strong><br>
${workflow.resources[0].dxrStartDate} - the start date of the assignment<br>
${workflow.resources[0].roleParameter_Project@value} - the value of the role parameter Project.<br>
${workflow.resources[0].roleParameter_Project@oldvalue} - the value of the role parameter Project.<br>
${workflow.resources[0].roleParameter_Project@modified} - indicates the modification of the Project role parameter. The value is either TRUE or FALSE.<br>
${workflow.resources[0].dxrassignfrom@description} - the description of the privilege (you can use workflow.subject.description instead).<br>
${workflow.resources[0].dxrassignto@sn} - the surname of the user.<br>
${workflow.resources[0].dxrassignto@mail} - the mail address of the user.<br>
${workflow.resources[0].<a href="mailto:dxrassignto@manager.mail">dxrassignto@manager.mail</a>} - the mail address of the user&#8217;s manager.<br>
${workflow.resources[0].<a href="mailto:dxrassignto@dxrLocationLink.manager.sn">dxrassignto@dxrLocationLink.manager.sn</a>} - the surname of the location manager.</p>
</div>
<div class="paragraph">
<p>Note that in the examples we access a specific object if multiple objects are available (resources[0]). Use control structures to evaluate complete lists of objects.</p>
</div>
</div>
<div class="sect4">
<h5 id="_server_variables"><a class="anchor" href="#_server_variables"></a>Server Variables</h5>
<div class="paragraph">
<p>The Java-based Server reads some variables at startup. The following attributes are available:</p>
</div>
<div class="paragraph">
<p><strong>Domain</strong> - the domain name for which this server works</p>
</div>
<div class="paragraph">
<p><strong>TechnicalDomain</strong> - the technical domain name for which this server works</p>
</div>
</div>
<div class="sect4">
<h5 id="_workflow_instance"><a class="anchor" href="#_workflow_instance"></a>Workflow Instance</h5>
<div class="paragraph">
<p>The available attributes of a workflow instance are:</p>
</div>
<div class="paragraph">
<p><strong>absoluteDisplayName</strong> (string) - the path of the workflow instance. It contains the display name and all preceding folder names separated by "/" . See <strong>path</strong> for the display name of the workflow definition.</p>
</div>
<div class="paragraph">
<p><strong>activities</strong> (list of objects) - the list of activities.</p>
</div>
<div class="paragraph">
<p><strong>applicationState</strong> (string) - the instance&#8217;s (application) logical state. This state is calculated at the end of a workflow run depending on the final or erroneous activity.</p>
</div>
<div class="paragraph">
<p><strong>context</strong> (map) - a hash list of customer-defined variables (name / value pairs). Can be empty.</p>
</div>
<div class="paragraph">
<p><strong>contextAttributes</strong> (map) - a hash list of customer-defined variables (name / value pairs). Can be empty. Note that this is just an alternative to using “context”.</p>
</div>
<div class="paragraph">
<p>Keep in mind that all (string) context variables are stored as specific attributes in LDAP, too (LDAP attribute: dxmSpecificAttributes). Context variables that are added or modified are in sync with the LDAP attribute. Variables that are deleted from the context are not synchronized to the LDAP attribute. Therefore when deleting a variable from the context you additionally should create an own variable indicating that the original variable is deleted. Then this new variable can easily be processed using "dxmSpecificAttributes".</p>
</div>
<div class="paragraph">
<p><strong>displayName</strong> (string) - the human-readable name of this workflow instance.</p>
</div>
<div class="paragraph">
<p><strong>endTime</strong> (string) - the date and time in ms (calculated from 1.1.1970) at which the workflow run finished.</p>
</div>
<div class="paragraph">
<p><strong>expirationTime</strong> (string) - the date and time at which the workflow instance expires. This is the workflows start time plus the configured timeout value.</p>
</div>
<div class="paragraph">
<p><strong>initiator</strong> (string) - the user that initiated this workflow.</p>
</div>
<div class="paragraph">
<p><strong>initiatorEntry</strong> (object) - the initiator object with all attributes.</p>
</div>
<div class="paragraph">
<p><strong>path</strong> (string) - the path of the workflow definition. It contains the display name and all preceding folder names separated by "/". See <strong>absoluteDisplayName</strong> for the display name of the workflow definition.</p>
</div>
<div class="paragraph">
<p><strong>resources</strong> (list of objects) - the list of resource objects<br>
Examples: roles, permissions, groups, users.<br>
You can access specific attributes of user to privilege assignments:</p>
</div>
<div class="paragraph">
<p>Access to a new role parameter value:*<br>
${workflow.resources[0].roleParameter_*<em>name</em>*@value}*</p>
</div>
<div class="paragraph">
<p>For modifications, you can also access the old value:<br>
<strong>${workflow.resources[0].roleParameter_*<em>name</em></strong>@oldvalue}*<br>
Please keep in mind that this expression only works in emails that are sent before the object has been changed in an “Apply Changes” activity.</p>
</div>
<div class="paragraph">
<p>This flag allows recognition whether the value was changed (you can use it for conditions):*<br>
${workflow.resources[0].roleParameter_*<em>name</em>*@modified}*<br>
The delivered value is either TRUE or FALSE.</p>
</div>
<div class="paragraph">
<p>Example for role parameter <strong>Project</strong>:<br>
${workflow.resources[0].roleParameter_Project@value}</p>
</div>
<div class="paragraph">
<p>You can access specific parameters of accounts (works only if the assignment is of type group):</p>
</div>
<div class="paragraph">
<p><strong>${workflow.resources[0].dxrassignto@account_*<em>name</em></strong>}*</p>
</div>
<div class="paragraph">
<p>Example for the description attribute:<br>
${workflow.resources[0].dxrassignto@account_description}</p>
</div>
<div class="paragraph">
<p>This definition retrieves the description attribute of the primary account.</p>
</div>
<div class="paragraph">
<p>You can access specific parameters of a target system (works only if the assignment is of type group):</p>
</div>
<div class="paragraph">
<p><strong>${workflow.resources[0].dxrassignto@targetsystem_*<em>name</em></strong>}*</p>
</div>
<div class="paragraph">
<p>Example for the description attribute:<br>
${workflow.resources[0].dxrassignto@targetsystem_description}</p>
</div>
<div class="paragraph">
<p>This definition retrieves the description attribute of the target system.</p>
</div>
<div class="paragraph">
<p>You can access specific parameters of an assignment:</p>
</div>
<div class="paragraph">
<p><strong>${workflow.resources[0].controllerLink.</strong>attribute<strong>}<br>
</strong>Example: <strong>${workflow.resources[0].controllerLink.mail}</strong><br>
This definition retrieves the DN of the person(s) that performed the access certification approval.</p>
</div>
<div class="paragraph">
<p><strong>${workflow.resources[0].userInfo}</strong><br>
This definition retrieves the flag that can be set by the approver during an access certification to indicate that this user shall be informed via e-mail.</p>
</div>
<div class="paragraph">
<p><strong>${workflow.resources[0].typeOfOrder}</strong><br>
This definition retrieves the type of the order. The possible values are ADD, MODIFY or DELETE.</p>
</div>
<div class="paragraph">
<p><strong>subject</strong> (object) - the subject object of this workflow<br>
Examples: the user to be created, the user to assign a privilege, &#8230;&#8203;</p>
</div>
<div class="paragraph">
<p><strong>startTime</strong> (string) - the date and time in ms (calculated from 1.1.1970) when the workflow run was started.</p>
</div>
<div class="paragraph">
<p><strong>state</strong> - the workflow state (SUCCEEDED, FAILED, &#8230;&#8203;).</p>
</div>
<div class="paragraph">
<p><strong>UID</strong> (string) - the workflow instance&#8217;s unique ID.</p>
</div>
</div>
<div class="sect4">
<h5 id="_activity_instance"><a class="anchor" href="#_activity_instance"></a>Activity Instance</h5>
<div class="paragraph">
<p>The available attributes of an activity instance are:</p>
</div>
<div class="paragraph">
<p><strong>activityType</strong> (string) - the type of activity, for example: applyChange, enterAttributes, approveCreate, e-mail etc.</p>
</div>
<div class="paragraph">
<p><strong>activitySubType</strong> (string) - currently equal to the activityType.</p>
</div>
<div class="paragraph">
<p><strong>applicationState</strong> (string) - the instance&#8217;s (application&#8217;s) logical state (for example REJECTED or ACCEPTED).</p>
</div>
<div class="paragraph">
<p><strong>approvalResult</strong> (string) - the approval result of the activity (for example REJECTED or ACCEPTED).</p>
</div>
<div class="paragraph">
<p><strong>approvers</strong> (list of objects) - the list of participants for this activity that really approved/rejected. This attribute represents a list of users. You can access all existing user attributes.</p>
</div>
<div class="paragraph">
<p><strong>category</strong> (string) - one of the categories "operational" or "errorhandler".</p>
</div>
<div class="paragraph">
<p><strong>context</strong> (map) - a hash list of customer-defined variables (name / value pairs). This attribute can be empty.<br>
Example: ${workflow.context.myVar}<br>
retrieves the value of the context variable myVar for further processing.</p>
</div>
<div class="paragraph">
<p>Keep in mind that all (string) context variables are stored as specific attributes in LDAP, too (LDAP attribute: dxmSpecificAttributes). Context variables that are added or modified are in sync with the LDAP attribute. Variables that are deleted from the context are not synchronized to the LDAP attribute. Therefore when deleting a variable from the context you additionally should create an own variable indicating that the original variable is deleted. Then this new variable can easily be processed using "dxmSpecificAttributes".</p>
</div>
<div class="paragraph">
<p><strong>endTime</strong> (string) - the date and time in milliseconds (ms) (calculated from 1.1.1970) at which the workflow run finished.</p>
</div>
<div class="paragraph">
<p><strong>escalationLevel</strong> (integer) - current escalation level.</p>
</div>
<div class="paragraph">
<p><strong>0</strong> escalation not yet started<br>
<strong>&gt; 0</strong> level of escalation</p>
</div>
<div class="paragraph">
<p><strong>expirationTime</strong> (string) - the date and time at which the workflow instance expires. This is the workflows start time plus the configured timeout value.</p>
</div>
<div class="paragraph">
<p><strong>immutableJob</strong> (object) - the job definition of this activity. It contains these attributes:</p>
</div>
<div class="paragraph">
<p><strong>baseName</strong> (string) - the base name at which the job&#8217;s classes and lib directory reside.</p>
</div>
<div class="paragraph">
<p><strong>className</strong> (string) - the class name of the associated job implementation.</p>
</div>
<div class="paragraph">
<p><strong>extensionsName</strong> (string) - the name of the server-extensions where the job resides.</p>
</div>
<div class="paragraph">
<p><strong>name</strong> (string) - the job name.</p>
</div>
<div class="paragraph">
<p><strong>params</strong> (map) - name/value pairs of job-specific information.</p>
</div>
<div class="paragraph">
<p><strong>interactiveTaskDescription</strong> (list of interactiveAttributes) - defines the user task to be performed at the Web interface (for example, to enter attributes). Attributes for interactiveAttributes are:</p>
</div>
<div class="paragraph">
<p><strong>description</strong> - the display name of this attribute at the Web interface.</p>
</div>
<div class="paragraph">
<p><strong>mandatory</strong> - defines mandatory attributes if set to true. Otherwise the value is false.</p>
</div>
<div class="paragraph">
<p><strong>name</strong> - the name of this attribute (typically the LDAP name).</p>
</div>
<div class="paragraph">
<p><strong>master</strong> (string) - the master activity. When calculating approvers and <em>n</em> approvers are found, the master activity is expanded to <em>n</em> activities.</p>
</div>
<div class="paragraph">
<p><strong>name</strong> (string) - identifies the activity within the workflow.</p>
</div>
<div class="paragraph">
<p><strong>participantEntries</strong> (list of objects) - the list of participants for this activity. This attribute represents a list of users. You can access all existing user attributes.</p>
</div>
<div class="paragraph">
<p><strong>reason</strong> (string) - the reason why the approver accepted or rejected the approval request.</p>
</div>
<div class="paragraph">
<p><strong>startTime</strong> (string) - the date and time in ms (calculated from 1.1.1970) at which the workflow run started.</p>
</div>
<div class="paragraph">
<p><strong>state</strong> (string) - the activity state (SUCCEEDED, FAILED, &#8230;&#8203;).</p>
</div>
<div class="paragraph">
<p><strong>timeout</strong> (string) - the timeout of this activity in milliseconds (ms) (calculated from 1.1.1970).</p>
</div>
</div>
<div class="sect4">
<h5 id="_control_structures"><a class="anchor" href="#_control_structures"></a>Control Structures</h5>
<div class="paragraph">
<p>Control structures allow you to generate more complex text structures. Controls are surrounded by &lt;? <em>statement</em> ?&gt;, where the blank between &lt;? and <em>statement</em> is mandatory. Control structures consist of if/else statements for condition handling, for statements for loop handling, and Java statements for defining your own text structures.</p>
</div>
<div class="paragraph">
<p>If/Else Statement</p>
</div>
<div class="paragraph">
<p>The if/else statement allows you to handle conditions. The syntax is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">&lt;? if condition ?&gt;
…
&lt;? else ?&gt;
…
&lt;? endif ?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>condition</em> compares two values, the overall syntax is</p>
</div>
<div class="paragraph">
<p><em>operand1 comparator operand2</em></p>
</div>
<div class="paragraph">
<p>The <em>comparator</em> is one of:</p>
</div>
<div class="paragraph">
<p><strong>== | eq | equals</strong> - compares whether the two operands are equal.</p>
</div>
<div class="paragraph">
<p><strong>!= | ne | notequals</strong> - compares whether the two operands are not equal.</p>
</div>
<div class="paragraph">
<p><strong>&lt; | lt</strong> - checks whether the first operand is smaller than the second one.</p>
</div>
<div class="paragraph">
<p><strong>&gt; | gt</strong> - checks whether the first operand is greater than the second one.</p>
</div>
<div class="paragraph">
<p><strong>&#8656; | le</strong> - checks whether the first operand is smaller than the second one or equal to the second one.</p>
</div>
<div class="paragraph">
<p><strong>&gt;= | ge</strong> - checks whether the first operand is greater than the second one or equal to the second one.</p>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">&lt;? if ${to.gender} != null ?&gt;
&lt;? if ${to.gender} == “W” ?&gt;
Dear Mrs. ${to.sn},
&lt;? else ?&gt;
Dear Mr. ${to.sn},
&lt;? endif ?&gt;
&lt;? else ?&gt;
Dear Mrs./Mr. ${to.sn},
&lt;? endif ?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous statement tests whether the gender attribute of the participant is filled. If yes, it defines the correct salutation for male and female participants. If not, it defines a more general salutation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">&lt;? if ${name} == “joe” ?&gt;
...
&lt;? endif ?&gt;

&lt;? if ${name} != “joe” ?&gt;
... +
&lt;? endif ?&gt;

&lt;? if ${value} lt 1 ?&gt;
...
&lt;? endif ?&gt;

&lt;? if ${name} gt “abc” ?&gt;
...
&lt;? endif ?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>For Statement</strong></p>
</div>
<div class="paragraph">
<p>The for statement allows you to handle loops. The syntax is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">&lt;? for variable in list ?&gt;
…
&lt;? endfor ?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <em>variable</em> is the name of a placeholder which can be subsequently used and <em>list</em> a list of “ “ delimited values (either constants or delivered by a placeholder whose type is a list).</p>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">&lt;? for activity in ${workflow.activities} ?&gt;
&lt;? if ${activity.approvalResult} == "REJECTED" ?&gt;
&lt;? for participant in ${activity.approvers} ?&gt;
- User ${participant.cn} rejected with reason: ${activity.reason}
&lt;? endfor ?&gt;
&lt;? endif ?&gt;
&lt;? endfor ?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>which could result in</p>
</div>
<div class="ulist">
<ul>
<li>
<p>User Huber Fritz rejected with reason: Do not like this person<br></p>
</li>
<li>
<p>User Berner Hans rejected with reason: Maybe a security risk?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that the line "- User ${participant.cn} rejected with reason: ${activity.reason}" acts like a template. You can also define several lines as template text.</p>
</div>
<div class="paragraph">
<p><strong>Java Statement</strong></p>
</div>
<div class="paragraph">
<p>The Java statement allows you to define your own text structures. The syntax is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">&lt;? Java class1 class2 ... classN ?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <em>classX</em> represent Java classes that must implement the interface JavaPlugin.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">&lt;? java placeholder.TestPlugin placeholder.TestPlugin ?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>is resolved to</p>
</div>
<div class="paragraph">
<p>Hello here I am!<br>
Hello here I am!</p>
</div>
<div class="paragraph">
<p>where placeholder.TestPlugin is defined as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package placeholder;
import java.io.PrintWriter;
import com.siemens.idm.text.parser.JavaPlugin;
import com.siemens.idm.text.parser.ParserException;
import com.siemens.idm.text.parser.TextParser;
public class TestPlugin implements JavaPlugin {
    public void execute(TextParser parser, PrintWriter out) throws ParserException {
        out.println("Hello here I am!");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Java Function</strong></p>
</div>
<div class="paragraph">
<p>The Java statement allows you to define your own text structures. The syntax is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">&lt;? JavaFunction class input ?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>where</p>
</div>
<div class="paragraph">
<p><em>class</em> - represents a Java classname that must implement the interface JavaPluginExt.</p>
</div>
<div class="paragraph">
<p>input - is a string / an expression that is passed to the specified Java class (execute method).</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">&lt;? JavaFunction com.siemens.idm.jini.util.GeneralizedTime2ISO8601 ${workflow.initiatorEntry.dayOfBirth} ?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If input = ${workflow.initiatorEntry.dayOfBirth} and dayOfBirth has the value 19700218230000Z the function retrieves 1970-02-19 as result.</p>
</div>
<div class="paragraph">
<p>The class com.siemens.idm.jini.util.GeneralizedTime2ISO8601 is defined as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.siemens.idm.jini.util;
import java.io.PrintWriter;
import java.text.SimpleDateFormat;
import com.siemens.date.GeneralizedTime;
import com.siemens.idm.text.parser.JavaPluginExt;
import com.siemens.idm.text.parser.ParserException;
import com.siemens.idm.text.parser.TextParser;

public class GeneralizedTime2ISO8601 implements JavaPluginExt {
    /**
    * transforms given string from generalizedTime format to yyyy-MM-dd format.
    * @param parser the parser
    * @param toBeProcessed the string to be transformed
    * @param out write transformed string to the PrintWriter
    * @return transformed string; &lt;code&gt;NULL&lt;/code&gt; if toBeProcessed == null or &lt;code&gt;not a GeneralizedTime&lt;/code&gt; if invalid format
    */
    public void execute(TextParser parser, String toBeProcessed, PrintWriter out) throws ParserException {
        String res = toBePocessed;
        if (res == null) {
            out.println("NULL");
        }
        //out.println("String: " + res);
        GeneralizedTime t;
        try {
            t = new GeneralizedTime(s);
        } catch (Exception e) {
            // error
            out.println("not a GeneralizedTime");
            return;
        }
        SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd");
        String result = dateFormat.format(t.getDate());
        out.println(result); // result
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_reduced_run_time_activities"><a class="anchor" href="#_reduced_run_time_activities"></a>Reduced Run-time Activities</h5>
<div class="paragraph">
<p>For approval activities, DirX Identity can run in two modes that depend on the setting of the <strong>Reduce Runtime Activities</strong> flag that is visible in the <strong>Participants</strong> tab of a request workflow definition. The meaning of the values is:</p>
</div>
<div class="paragraph">
<p><strong>false</strong> (default) - besides the original master activity one activity for each approver is created. This mode is compatible with versions prior to 8.2A.</p>
</div>
<div class="paragraph">
<p><strong>true</strong> - besides the original master activity it keeps only one common activity that handles all approvers together.</p>
</div>
<div class="paragraph">
<p>Use the corresponding variables in your mail text to guarantee correct resolution during runtime. For additional information how to fill the address fields see the section Filling the Address Fields.</p>
</div>
<div class="paragraph">
<p>Reduce Runtime Activities = false</p>
</div>
<div class="paragraph">
<p>Use the following variable references in mails:</p>
</div>
<div class="paragraph">
<p><strong>To</strong> - use <strong>${participantEntries[0].mail}</strong> to send the mail to the (single) participant.</p>
</div>
<div class="paragraph">
<p><strong>Language</strong> - use <strong>${participantEntries[0].preferredLanguage}</strong> to select the language for the resulting mail text if you use e-mail nationalization.</p>
</div>
<div class="paragraph">
<p><strong>Body</strong> - use for example <strong>${participantEntries[0].sn}</strong> to include the surname of the participant into the mail text.</p>
</div>
<div class="paragraph">
<p>You can also use these settings with the same result:</p>
</div>
<div class="paragraph">
<p><strong>To</strong> - use <strong>${participantEntries.mail}</strong> to send the mail to the (single) participant.</p>
</div>
<div class="paragraph">
<p><strong>Language</strong> - use <strong>${to.preferredLanguage}</strong> to select the language for the resulting mail text if you use e-mail nationalization.</p>
</div>
<div class="paragraph">
<p><strong>Body</strong> - use for example <strong>${to.sn}</strong> to include the surname of the participant into the mail text.</p>
</div>
<div class="paragraph">
<p>This allows you to use the same mail text fragments for workflows with Reduce Run-time Activities set or not set.</p>
</div>
<div class="paragraph">
<p>Reduce Runtime Activities = true / Separate mails = false</p>
</div>
<div class="paragraph">
<p>This mode creates only one activity for all approvers. Use the following variable references in mails:</p>
</div>
<div class="paragraph">
<p><strong>To</strong> - use <strong>${participantEntries.mail}</strong> to add all participants of this activity into this field.</p>
</div>
<div class="paragraph">
<p><strong>Language</strong> - use <strong>${participantEntries[0].preferredLanguage}</strong> to select the language for the resulting mail text if you use e-mail nationalization.<br>
Note: if the definition resolves to several languages, English is taken per default.</p>
</div>
<div class="paragraph">
<p><strong>Body</strong> - use for example <strong>${participantEntries.sn}</strong> to include all surnames separated with blanks into the mail text. Alternatively you can use the variable <strong>${to.sn}</strong> to obtain the same result. If you use <strong>${to[0].sn}</strong> you will obtain the sn of the first participant. Use the for statement (for example with the loop variable 'i') and <strong>${to[i].sn}</strong> to process all participants as you need it.</p>
</div>
<div class="paragraph">
<p>Reduce Runtime Activities = true / Separate mails = true</p>
</div>
<div class="paragraph">
<p>A more comfortable solution is to send separate mails to each of the participants. In this case set the <strong>Separate mails</strong> flag and use these settings:</p>
</div>
<div class="paragraph">
<p><strong>To</strong> - use <strong>${participantEntries.mail}</strong> to add all participants of this activity into this field.</p>
</div>
<div class="paragraph">
<p><strong>Language</strong> - use <strong>${to.preferredLanguage}</strong> to select the language for the resulting mail text if you use e-mail nationalization.</p>
</div>
<div class="paragraph">
<p><strong>Body</strong> - use for example <strong>${to.sn}</strong> to include the surname into the mail text. You can address any other attribute of the participant here, for example <strong>${to.givenName}</strong>.<br>
Using <strong>${to.gender}</strong> allows distinguishing text for men and women, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">&lt;? if ${to.gender} == “W” ?&gt;
Dear Mrs. ${to.sn},
&lt;? else ?&gt;
Dear Mr. ${to.sn},
&lt;? endif ?&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_filling_the_address_fields"><a class="anchor" href="#_filling_the_address_fields"></a>Filling the Address Fields</h5>
<div class="paragraph">
<p>There are various methods to fill the address fields of a mail template (From, To, CC, BCC). This section explains the features and provides some examples.</p>
</div>
<div class="paragraph">
<p>Read also the section Reduced Run-time Activities because this flag influences mail generation.</p>
</div>
<div class="paragraph">
<p>Some general rules apply for the field calculation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can send a mail to several persons only in one language. Set the <strong>Language</strong> field accordingly.</p>
</li>
<li>
<p>Users with no mail address do not lead to an error as long as there are other mail addresses available.</p>
</li>
<li>
<p>An error is generated if after calculating the From or To field no mail address is available.</p>
</li>
<li>
<p>There are specific errors (To field only) returned from the mail server that result in a send error (for example "550 Relaying denied to &lt;<a href="mailto:tester@alphabeta.com">tester@alphabeta.com</a>&gt;"). In this case the mail is also not sent to the other members of the To field.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Addressing a Single User</p>
</div>
<div class="paragraph">
<p>In many cases you send the e-mail to exactly one person. In this case you can use the expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">${participantEntries[0].mail}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the mail attribute contains only one value, it retrieves a single mail address, for example: <a href="mailto:Nik.Taspatch@My-Company.com">Nik.Taspatch@My-Company.com</a></p>
</div>
<div class="paragraph">
<p>If the mail attribute contains multiple mail addresses, the result is for example: <a href="mailto:Nik.Taspatch@My-Company.com">Nik.Taspatch@My-Company.com</a> <a href="mailto:Niki@gmx.com">Niki@gmx.com</a></p>
</div>
<div class="paragraph">
<p>Note that the addresses are separated by blanks.</p>
</div>
<div class="paragraph">
<p>If this expression is set in the To field, the user might get multiple instances of the same mail.</p>
</div>
<div class="paragraph">
<p>If this expression is set in the From field, the first address is taken, the others are ignored (depends also on the mail server type).</p>
</div>
<div class="paragraph">
<p>If you want to enforce only one value, you can use the expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">${participantEntries[0].mail[0]}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is no way to define which value is taken from the list.</p>
</div>
<div class="paragraph">
<p>Addressing Multiple Users</p>
</div>
<div class="paragraph">
<p>You can use the expression</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">${participantEntries.mail}</code></pre>
</div>
</div>
<div class="paragraph">
<p>to retrieve the mail addresses of all participants. The resulting string could be for example:</p>
</div>
<div class="paragraph">
<p><a href="mailto:Nik.Taspatch@My-Company.com">Nik.Taspatch@My-Company.com</a> <a href="mailto:Niki@gmx.com">Niki@gmx.com</a>; <a href="mailto:Lavina.Pitton@My-Company.com">Lavina.Pitton@My-Company.com</a> ; <a href="mailto:Retha.Wagner@My-Company.com">Retha.Wagner@My-Company.com</a> ;</p>
</div>
<div class="paragraph">
<p>The addresses of one user are separated by blanks (here for Nik Taspatch), the users are separated by semicolon.</p>
</div>
<div class="paragraph">
<p>If you use this definition in the To field, you can work with the <strong>to</strong> variable in conjunction with the <strong>Separate mail</strong> flag. See the section Reduced Run-time Activities for more information.</p>
</div>
<div class="paragraph">
<p>You can use semicolon to define multiple expressions in one line, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">${participantEntries[0].mail};${workflow.subject.mail}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Defining Conditional Addresses</p>
</div>
<div class="paragraph">
<p>In some cases you might want to define conditional addresses. This is for example useful in privilege access certification workflows where you want to inform only the users that their privilege assignment is removed. Define a conditional expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">&lt;? for res in ${workflow.resources} ?&gt;&lt;? if ${res.userInfo} == "true" ?&gt;${res.dxrassignto@mail};&lt;? endif ?&gt;&lt;? endfor ?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>which is a loop that filters all assignments where the userInfo flag is set to true:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">&lt;? for res in ${workflow.resources} ?&gt;
&lt;? if ${res.userInfo} == "true" ?&gt;
${res.dxrassignto@mail};
&lt;? endif ?&gt;
&lt;? endfor ?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The mail addresses are separated by a semicolon.</p>
</div>
<div class="paragraph">
<p>Using the “To” Variable</p>
</div>
<div class="paragraph">
<p>If you use expressions in the <strong>To</strong> address field that include the substrings “.mail” or “@mail” then a <strong>to</strong> variable (representing user objects) is set internally. This <strong>to</strong> variable can then be used in other expressions, too.</p>
</div>
<div class="paragraph">
<p>For example, in the message body:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">&lt;? if ${to.gender} != null ?&gt;
&lt;? if ${to.gender} == "W" ?&gt;
Dear Mrs. ${to.sn},
&lt;? else ?&gt;
Dear Mr. ${to.sn},
&lt;? endif ?&gt;
&lt;? else ?&gt;
Dear Mrs./Mr. ${to.sn},
&lt;? endif ?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Keep in mind that this kind of approach only works if the <strong>Separate mails</strong> flag is turned on.</p>
</div>
</div>
<div class="sect4">
<h5 id="_participant_calculation"><a class="anchor" href="#_participant_calculation"></a>Participant Calculation</h5>
<div class="paragraph">
<p>You can define participants in many ways. The method described here is easy to understand, powerful and well suited to a directory object structure that works with links.</p>
</div>
<div class="paragraph">
<p>Select the <strong>static</strong> method from the drop-down selection in a <strong>Participants</strong> tab in approval activities. Here you can define a mix of</p>
</div>
<div class="ulist">
<ul>
<li>
<p>static participant definitions (for example cn=Berner Hans,ou=Human Resources,o=My-Company,cn=Users,cn=My-Company</p>
</li>
<li>
<p>or dynamic participant definitions (for example ${workflow.subject.manager} which retrieves the manager of the subject this workflow is for).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If an attribute (for example ${workflow.subject.owner}) contains several links, all are used as participants.</p>
</div>
<div class="paragraph">
<p>Start Objects</p>
</div>
<div class="paragraph">
<p>There are several start objects for dynamic participant definitions:</p>
</div>
<div class="paragraph">
<p><strong>workflow.subject</strong> - the subject of the request workflow (for example a user, a privilege or a business object)</p>
</div>
<div class="paragraph">
<p><strong>workflow.resources.dxrassignto</strong> - the resource(s) of the request workflow</p>
</div>
<div class="paragraph">
<p><strong>workflow.initiatorEntry</strong> - the initiator of the workflow</p>
</div>
<div class="paragraph">
<p><strong>previousParticipants</strong> - the previous participant (can be used during escalations). Note that you cannot use the participantEntries start object because this is the one that is in calculation.</p>
</div>
<div class="paragraph">
<p>Methods to set up dynamic definitions are:</p>
</div>
<div class="paragraph">
<p>One-level Definitions</p>
</div>
<div class="paragraph">
<p>These definitions use a link attribute at the start object.</p>
</div>
<div class="paragraph">
<p>${workflow.subject.manager} - retrieves the manager(s) of the subject (uses the manager link to look up the manager DNs)<br>
${workflow.subject.owner} - retrieves all owner of the subject (uses the owner link to look up the owner DNs)<br>
${workflow.initiatorEntry.manager} - retrieves the initiator&#8217;s manager.<br>
${workflow.resources.dxrassignto@owner} - retrieves the privilege owner(s).<br>
${workflow.resources.dxrassignto@owner.manager} - retrieves the manager(s) of the privilege owner(s).</p>
</div>
<div class="paragraph">
<p>Multi-level Definitions</p>
</div>
<div class="paragraph">
<p>Definitions of this type use a link chain to get the attribute where to retrieve the participants from.</p>
</div>
<div class="paragraph">
<p>${workflow.subject.manager.manager} - retrieves the manager of the subject&#8217;s manager (useful for escalation)<br>
${workflow.subject.dxrLocationLink.manager} - retrieves the manager of the location the subject is assigned to</p>
</div>
<div class="paragraph">
<p>Relative Definitions</p>
</div>
<div class="paragraph">
<p>During escalation you can refer to the previous participant(s) of an approval activity.</p>
</div>
<div class="paragraph">
<p>${previousParticipants.manager} - retrieves the manager(s) of all participants of the previous activity during an escalation<br>
${previousParticipants[0].manager} - gets the manager of the first participant of the previous activity during an escalation</p>
</div>
<div class="paragraph">
<p>Multiple Definitions</p>
</div>
<div class="paragraph">
<p>To retrieve participants from different links, use multiple lines in the <strong>static</strong> table of the <strong>Participants</strong> tab, for example:</p>
</div>
<div class="paragraph">
<p>${workflow.subject.manager} - retrieves the manager<br>
${workflow.subject.secretary} - additionally retrieves the secretary<br>
${workflow.subject.sponsor} - and finally evaluates the sponsor link</p>
</div>
</div>
<div class="sect4">
<h5 id="_tips_and_tricks"><a class="anchor" href="#_tips_and_tricks"></a>Tips and Tricks</h5>
<div class="paragraph">
<p>This section provides some examples of variable substitution as well as valuable tips and tricks.</p>
</div>
<div class="paragraph">
<p>Representing Fields and Strings</p>
</div>
<div class="paragraph">
<p>The syntax you use in field and string representations depends on the internal representation of a requested field (whether it is a string or an array of strings) and the location where the field is used.</p>
</div>
<div class="paragraph">
<p>Example 1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Dear Mr. ${workflow.subject.sn}</code></pre>
</div>
</div>
<div class="paragraph">
<p>might be resolved to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Dear Mr. Smith</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example 2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">&lt;? if ${workflow.subject.sn[0]} == "Smith" ?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>is resolved to true if sn = "Smith"</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">If you are in doubt try both variants.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Evaluating the Resource Order Type</p>
</div>
<div class="paragraph">
<p>Use the attribute <strong>typeOfOrder</strong> to determine the resource order type for privilege assignments, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">&lt;? if ${workflow.resources[0].typeOfOrder} == "ADD" ?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The possible values are ADD, MODIFY or DELETE.</p>
</div>
<div class="paragraph">
<p>Creating Correct Salutations in Email</p>
</div>
<div class="paragraph">
<p>You can create correct salutation with these statements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">&lt;? if ${participantEntries[0].dxrSalutation[0]} == Herr ?&gt; Sehr geehrter Herr ${participantEntries[0].sn}, &lt;? endif ?&gt;
&lt;? if ${participantEntries[0].dxrSalutation[0]} == Frau ?&gt; Sehr geehrte Frau ${participantEntries[0].sn}, &lt;? endif ?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In an international environment, you may want to include the preferredLanguage attribute for correct salutation.</p>
</div>
<div class="paragraph">
<p>Creating Escalation Specific Bodies in Email</p>
</div>
<div class="paragraph">
<p>You can create escalation specific mail bodies by evaluating the variable <strong>${escalationLevel}</strong>, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">&lt;? if ${escalationLevel} == "0" ?&gt;
... body without escalation ...
&lt;? else ?&gt;
&lt;? if ${escalationLevel} &gt; "1" ?&gt;
... body for levels &gt; 1 ...
&lt;? else ?&gt;
... body for level = 1
&lt;? endif ?&gt;
&lt;? endif ?&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_implementing_a_new_activity"><a class="anchor" href="#_implementing_a_new_activity"></a>Implementing a New Activity</h4>
<div class="paragraph">
<p>The preferred way to create a customized job implementation is to leverage the socketed job framework for automatic activities (see the chapter "Implementing a Socketed Job Framework-based Activity" for more details). You only need to define a brand-new activity if the socketed job framework is not sufficient for your needs. This section describes the general steps necessary to define and implement such an activity.</p>
</div>
<div class="paragraph">
<p>To create your own job implementation, you must:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define configuration parameters</p>
</li>
<li>
<p>Supply a component description</p>
</li>
<li>
<p>Implement the job as a Java class</p>
</li>
<li>
<p>Read the job configuration</p>
</li>
<li>
<p>Read the workflow instance data</p>
</li>
<li>
<p>Modify the workflow instance data</p>
</li>
<li>
<p>Read and change orders</p>
</li>
<li>
<p>Deploy your job implementation</p>
</li>
<li>
<p>Obtain a connection to the Identity domain</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For the API documentation, consult the following folder on your DVD:</p>
</div>
<div class="paragraph">
<p><strong>Documentation\DirXIdentity\RequestWorkflows\index.html</strong>.</p>
</div>
<div class="paragraph">
<p>For sample sources, see the following folder on your DVD:</p>
</div>
<div class="paragraph">
<p><strong>Additions\RequestWorkflows\samples</strong>.</p>
</div>
<div class="sect4">
<h5 id="_defining_configuration_parameters"><a class="anchor" href="#_defining_configuration_parameters"></a>Defining Configuration Parameters</h5>
<div class="paragraph">
<p>The entire workflow configuration is passed to the server as an XML document. The configuration parameters for the job are part of this document. When the server starts the job, it passes am XML configuration object with the &lt;job&gt; element as the parent node. It should conform to the following structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;job&gt;
&lt;basename&gt;myjob&lt;/basename&gt;
&lt;class&gt;com.mycompany.myorg.MyJobImpl&lt;/class&gt;
&lt;params&gt;
&lt;param name="param1" value="value1"/&gt;
&lt;param name="param2" value="value2"/&gt;
&lt;/params&gt;
&lt;/job&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>basename:</p>
</div>
<div class="paragraph">
<p>The basename string value tells the server&#8217;s class loader the name of the folder in which to search for your job classes. It must be a folder underneath</p>
</div>
<div class="paragraph">
<p><em>install_path</em>*/ids-j-<strong><em>domain</em></strong>-S*<em>n</em>/<strong>confdb/jobs</strong>.</p>
</div>
<div class="paragraph">
<p>In the above sample, the server assumes your classes are in the following folder:</p>
</div>
<div class="paragraph">
<p><em>install_path</em>*/ids-j-<strong><em>domain</em></strong>-S*<em>n</em>*/confdb/jobs/myjob*.</p>
</div>
<div class="paragraph">
<p>class:</p>
</div>
<div class="paragraph">
<p>The full class name of your job implementation; that is, the class that implements the interface</p>
</div>
<div class="paragraph">
<p>com.siemens.idm.api.Job.</p>
</div>
<div class="paragraph">
<p>params:</p>
</div>
<div class="paragraph">
<p>The &lt;params&gt; element contains a list of &lt;param&gt; sub-elements with your configuration parameters. For each parameter, you specify its name and the value. It&#8217;s the responsibility of your job implementation to evaluate them.</p>
</div>
</div>
<div class="sect4">
<h5 id="_supplying_a_component_description"><a class="anchor" href="#_supplying_a_component_description"></a>Supplying a Component Description</h5>
<div class="paragraph">
<p>To allow Identity Manager to configure an activity with your job, you must supply a component description. The component description extends an abstract object description of an activity. The activity creation wizard searches for activity component descriptions and presents them in a list.</p>
</div>
<div class="paragraph">
<p>Adding the Component Description LDAP Entry</p>
</div>
<div class="paragraph">
<p>You must add your component description LDAP entry underneath the workflow configuration folder in the Identity domain:</p>
</div>
<div class="paragraph">
<p>cn=Activity Types,cn=Configuration,cn=wfRoot,cn=&lt;your domain&gt;.</p>
</div>
<div class="paragraph">
<p>We recommend that you create your own subfolder (for example, "cn=Customer Extensions") to clearly separate your configurations from configurations installed with DirX Identity.</p>
</div>
<div class="paragraph">
<p>Please supply values for the following LDAP attributes. They help to present your activity appropriately in the wizard.</p>
</div>
<div class="paragraph">
<p>objectclass - needs the values <strong>dxmComponentDescription</strong> and <strong>top</strong>.</p>
</div>
<div class="paragraph">
<p>cn - the naming attribute.</p>
</div>
<div class="paragraph">
<p>dxmComponentType - needs the value <strong>activity</strong> for the activity creation wizard, which only presents component descriptions with this attribute value.</p>
</div>
<div class="paragraph">
<p>dxmType - categorizes the basic activity type. The following values are supported:</p>
</div>
<div class="paragraph">
<p><strong>automatic</strong>: an activity that runs automatically without any human interaction. It is started by the server as soon as the start conditions of the activity evaluate to true. Typically, this is the value you should provide.</p>
</div>
<div class="paragraph">
<p><strong>notify</strong>: an activity that can be used for notifications, especially in case of errors or at the end of a workflow. DirX Identity already supplies e-mail notifications.</p>
</div>
<div class="paragraph">
<p><strong>people</strong>: an activity that requires human interaction. It is not applicable for your job implementation.</p>
</div>
<div class="paragraph">
<p>dxmActivityType - a string value that helps to further categorize the activity. It is displayed in the selection page of the create activity wizard.</p>
</div>
<div class="paragraph">
<p>description - the description that is displayed in the selection page of the create activity wizard.</p>
</div>
<div class="paragraph">
<p>dxmContent - the XML document that represents the component description.</p>
</div>
<div class="paragraph">
<p>Creating the Component Description XML Document</p>
</div>
<div class="paragraph">
<p>Use the following template for your own component description:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;componentDescription
name="Name of your component"
componentCategory="activity"
&gt;
&lt;extendsComponentDescription&gt;automaticActivity&lt;/extendsComponentDescription&gt;
&lt;rootelement&gt;activity&lt;/rootelement&gt;
&lt;element name="activity" extends="activity"&gt;
&lt;properties&gt;
&lt;property name="dxmActivityType" &gt;
&lt;value&gt;applyChange&lt;/value&gt;
&lt;/property&gt;
&lt;/properties&gt;
&lt;element ref="job" minOccurs="1" maxOccurs="1"/&gt;
&lt;/element&gt;
&lt;element name="job" extends="job"&gt;
&lt;properties&gt;
&lt;property name="basename" xmlNotation="SimpleElementProperty"
elementname="basename" &gt;
&lt;value&gt;**Your Job classes folder**&lt;/value&gt;
&lt;/property&gt;
&lt;property name="class" xmlNotation="SimpleElementProperty"
elementname="class" &gt;
&lt;value&gt;**com.mycompany.myorg.MyJobImpl**&lt;/value&gt;
&lt;/property&gt;
&lt;/properties&gt;
&lt;element ref="params" minOccurs="1" maxOccurs="1"/&gt;
&lt;/element&gt;
&lt;element name="params" extends="params"&gt;
&lt;properties&gt;
&lt;property name="*param1*" xmlNotation="NameValueProperty"
elementname="param" type="java.lang.Boolean"&gt;
&lt;value&gt;false&lt;/value&gt;
&lt;/property&gt;
&lt;property name="*param2*" xmlNotation="NameValueProperty"
elementname="param" type="java.lang.String"&gt;
&lt;value default="true"&gt;the default value&lt;/value&gt;
&lt;value&gt;value2&lt;/value&gt;
&lt;/property&gt;
&lt;/properties&gt;
&lt;/element&gt;
&lt;presentationDescription&gt;
&lt;propertypage name="JobTab"
insertafter="GeneralTab"
class="siemens.dxr.manager.nodes.customizer.GenericPropertyPage"
title="Parameters"
layout="properties: *job/params/param1,job/params/param2*"
/&gt;
&lt;propertyPresentations&gt;
&lt;property name="*job/params/param1*"&gt;
&lt;label&gt;**Param 1**&lt;/label&gt;
&lt;/property&gt;
&lt;property name="*job/params/param2*" &gt;
&lt;label&gt;**Param 2**&lt;/label&gt;
&lt;/property&gt;
&lt;/propertyPresentations&gt;
&lt;/presentationDescription&gt;

&lt;/componentDescription&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Leave most of the template unchanged. You only need to insert the name of your component, your job class folder, the class name of your job implementation and for each configuration parameter, a description of the property and its presentation. See also "Defining Configuration Parameters".</p>
</div>
<div class="paragraph">
<p>Element &lt;componentDescription&gt;, attribute name:</p>
</div>
<div class="paragraph">
<p>The name of your component description as it is displayed in the column "component" in the selection page of the activity creation wizard.</p>
</div>
<div class="paragraph">
<p>In the element named job: &lt;element name="job" &#8230;&#8203;/&gt;:</p>
</div>
<div class="paragraph">
<p>In &lt;property name="basename":</p>
</div>
<div class="paragraph">
<p>In the &lt;value&gt; sub-element, enter the name of the subfolder in which the class loader of the IdS-J server searches for the classes of your job implementation.</p>
</div>
<div class="paragraph">
<p>In &lt;property name="class":</p>
</div>
<div class="paragraph">
<p>In the &lt;value&gt; sub-element, enter the full class name of your implementation.</p>
</div>
<div class="paragraph">
<p>In &lt;element name="params", sub-element &lt;properties&gt;:</p>
</div>
<div class="paragraph">
<p>For each configuration parameter, enter an element &lt;property&gt; with the following attributes:</p>
</div>
<div class="paragraph">
<p><strong>name</strong>: the parameter name, for example, param1.</p>
</div>
<div class="paragraph">
<p>xmlNotation: always use the value "NameValueProperty".</p>
</div>
<div class="paragraph">
<p>elementname: always use the value "param".</p>
</div>
<div class="paragraph">
<p><strong>type</strong>: designates the data type of the parameter. Common values are: java.lang.Boolean, java.lang.String.</p>
</div>
<div class="paragraph">
<p>Provide allowed values as a list of <strong>&lt;value&gt;</strong> sub-elements. Flag the default value by the attribute default set to true.</p>
</div>
<div class="paragraph">
<p>The presentation of your configuration parameters in the Identity Manager is specified in the &lt;presentationDescription&gt; element.</p>
</div>
<div class="paragraph">
<p>The &lt;propertypage&gt; sub-element defines a property page. Make sure that all your parameters are listed in the <strong>layout</strong> attribute. They are presented in the same order as the list. Pay special attention to the parameter names: they must be prefixed with the XML parent element names in XPath format. For our scenarios, this is always "job/params/". To present your parameters "param1" and "param2" you must enter:</p>
</div>
<div class="paragraph">
<p>layout="properties: job/params/param1, job/params/param2"</p>
</div>
<div class="paragraph">
<p>The presentation of your parameters is specified in the &lt;propertyPresentations&gt; element. Enter a &lt;<strong>property</strong>&gt; sub-element for each of your parameters.</p>
</div>
<div class="paragraph">
<p>Attribute <strong>name</strong>:</p>
</div>
<div class="paragraph">
<p>The name of your property in the same format as used for the &lt;propertypage&gt;. This means: Use "job/params/param1" for parameter "param1"!</p>
</div>
<div class="paragraph">
<p>Sub-element &lt;<strong>label</strong>&gt;:</p>
</div>
<div class="paragraph">
<p>The name of your parameter as it is displayed in the property page.</p>
</div>
<div class="paragraph">
<p>If you entered a list of allowed values in the &lt;element&gt;&lt;property&gt; definition, Identity Manager automatically presents them as a combo box.</p>
</div>
</div>
<div class="sect4">
<h5 id="_implementing_the_job"><a class="anchor" href="#_implementing_the_job"></a>Implementing the Job</h5>
<div class="paragraph">
<p>When an activity is to be started, the IdS-J server loads a class with the name configured in the &lt;classname&gt; sub-element of the &lt;job&gt;. The server expects that this class has a default constructor and implements the interface com.siemens.idm.api.Job.</p>
</div>
<div class="paragraph">
<p>This interface requires the following methods:</p>
</div>
<div class="paragraph">
<p>setConfiguration(IDMJob cfg):</p>
</div>
<div class="paragraph">
<p>The server calls this method before the run() method to hand over the job configuration.</p>
</div>
<div class="paragraph">
<p>It passes the configuration in a class that wraps the XML fragment containing the job configuration. The root element is the &lt;job&gt; element with the configuration parameters in its params/param element. See "Reading the Job Configuration" for details.</p>
</div>
<div class="paragraph">
<p>run(TaskContext ctx, Map modifications):</p>
</div>
<div class="paragraph">
<p>This method starts the job. The server passes two parameters.</p>
</div>
<div class="paragraph">
<p>The task context gives read access to the activity and workflow instance, especially to the workflow and activity states, the workflow initiator, the subject and the optional resources.</p>
</div>
<div class="paragraph">
<p>The job can indirectly modify the workflow by entering the desired modifications into the passed modification map. Use this facility to set the resulting activity state or application state.</p>
</div>
<div class="paragraph">
<p>Handling Retries</p>
</div>
<div class="paragraph">
<p>In error situations, the workflow engine re-starts a job according the retry configuration: retry limit and "wait before retry". The engine assumes an error if the job implementation throws an exception. As a result, the job implementation does not need to handle retries. It just throws an exception and relies on the workflow engine to start it again later on. If the job sets an application state (see "Modifying Instance Data" for information on how to do this), it is taken as application state for the activity after the last retry failed.</p>
</div>
<div class="paragraph">
<p>Activity Timeout</p>
</div>
<div class="paragraph">
<p>A timeout is indicated to the job via the TaskContext. If the job does not react or does not react in a timely fashion an interrupt for the thread is called. The resulting InterruptedException should not be ignored. For more information, see the Use Case documentation <em>Java Programming in DirX Identity</em>.</p>
</div>
<div class="paragraph">
<p>Importing Required Libraries</p>
</div>
<div class="paragraph">
<p>When compiling your class, make sure you have the following jar file on your classpath:</p>
</div>
<div class="paragraph">
<p>com.siemens.idm.server-api.jar<br>
com.siemens.idm.requestworkflow-api.jar<br>
dxmAPI.jar<br>
dxmUtil.jar<br>
dxmOrder.jar</p>
</div>
<div class="paragraph">
<p>For the API documentation, consult the following folder on your DVD:</p>
</div>
<div class="paragraph">
<p><strong>Documentation\DirXIdentity\RequestWorkflows\index.html</strong>.</p>
</div>
<div class="paragraph">
<p>For sample sources, see the following folder on your DVD:</p>
</div>
<div class="paragraph">
<p><strong>Additions\RequestWorkflows\samples</strong>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_reading_the_job_configuration"><a class="anchor" href="#_reading_the_job_configuration"></a>Reading the Job Configuration</h5>
<div class="paragraph">
<p>The IdS-J server provides a convenience class <em>XmlNodeMapImpl</em> that holds the configuration parameters in a Map. Get a parameter string value using the parameter name as a key. Here is a sample snippet for a string and a boolean parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Node paramsNode = _cfg.getNode("params");
Map map = new com.siemens.idm.jini.util.xml.XmlNodeMapImpl(paramsNode);
_attributeName = String.valueOf(map.get("attributeName"));
String s = String.valueOf(map.get("modifySubject"));
_modifySubject = Boolean.valueOf(s);</code></pre>
</div>
</div>
<div class="paragraph">
<p>See also the readConfiguration() method in the sample.</p>
</div>
</div>
<div class="sect4">
<h5 id="_reading_the_workflow_instance_data"><a class="anchor" href="#_reading_the_workflow_instance_data"></a>Reading the Workflow Instance Data</h5>
<div class="paragraph">
<p>The configuration object passed in the run(&#8230;&#8203;) method allows us to obtain the activity and the workflow instance object as in the following sample snippet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">com.siemens.idm.api.nodes.IDMActivity activity = _cfg.getActivity();
com.siemens.idm.api.nodes.IDMWorkflow wf = activity.getWorkflow();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This gives us the interface of a standard workflow. Since we are working here with a request workflow, we want the specialized interface, which we get by class casting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">com.siemens.idm.requestworkflow.api.RequestWorkflowInstance rqwf = (RequestWorkflowInstance)wf;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we are able to obtain some data from the workflow, such as the initiator, the subject and the resource(s). Here is a snippet that reads the DN of the workflow initiator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">String initiator = wf.getInitiator();</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the following sections, we show how to read the subject and the resources. For reading other properties, see the javadoc of the API.</p>
</div>
<div class="paragraph">
<p>Reading the Workflow Subject</p>
</div>
<div class="paragraph">
<p>The workflow subject is the entry that represents</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the user who is created with this workflow or</p>
</li>
<li>
<p>whose attributes are modified or</p>
</li>
<li>
<p>who is assigned some privilege or</p>
</li>
<li>
<p>the role or other object which is created or modified.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The subject is stored in the workflow instance as an XML object, which we call "Order". An order is basically an SPML request that is extended with some properties such as the activation date, the creator, and so on. There are several types of orders: Add- or Modify-Orders are used with a creation or an "approve-modification" workflow, while an Info-Order represents a subject that is not modified as with a user-assignment approval. Note that you can change an Add- or Modify-Order from within an activity, but not an Info-Order.</p>
</div>
<div class="paragraph">
<p>You obtain a subject via the request workflow instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">com.siemens.dxm.api.order.Order subject = rqwf.getSubject();</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are a number of "getters" to read properties such as the DN, the order type (Add, Modify, Info, and so on) or the directory type (user, role, &#8230;&#8203;) of the order instance. Here are a few samples. For more details, see the API.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">String subjectDN = subject.getID();
String orderType = subject.getType();
String directoryType = subject.getDirectoryType();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note: if you want to modify the subject and store it persistently for further use in follow-up activities, don&#8217;t use the "setter" methods; use the modification object passed in the calling run(&#8230;&#8203;) method. See the section "Modifying Workflow Instance Data" for more details.</p>
</div>
<div class="paragraph">
<p>Reading the Workflow Resource(s)</p>
</div>
<div class="paragraph">
<p>A workflow instance may contain no resources, one resource, or more than one resource. For example, a workflow for creating a (user) object or approving its modification does not need a resource. In a workflow for approving a user-role assignment, the role assignment is the resource.</p>
</div>
<div class="paragraph">
<p>The resources in a workflow instance are very similar to workflow subjects: they are represented as an "Order".</p>
</div>
<div class="paragraph">
<p>To work with resources, you have the following alternatives:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Handle them as orders. This is the preferred way.</p>
</li>
<li>
<p>Handle them as XML strings.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To work with resources as orders, you obtain an array of resources from a workflow instance by issuing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Order[] resourceOrders = null;
resourceOrders = rqwf.getResources();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following code snippet shows how to read attributes from a resource and set some value. For the complete code, see the sample delivered with DirX Identity.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">for (Order resource: resourcesArray) {
    log.info("Resource: resource type=" + resource.getResourceType() + ", Order Type=" + resource.getType() + ", Resource ID="+resource.getID());
    String[] attrnames = resource.getAttributeNames();
    for (String attrname: attrnames) {
        log.info("Value(s) of resource attribute " + attrname + ": " + stringArray2String(resource.getValues(attrname)));
    }
    if (!modifySubject) {
        resource.setProperty(_attributeName, _attributeValue);
        log.info("Resource modified: "+resource.toXMLString());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To work with resources as strings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Obtain the resources as a collection from a workflow instance by calling its getResourceAsString method:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ArrayList resourceStrings = null;
Collection resources = rqwf.getResourceStrings();
resourceStrings = processResourceStrings(resources.iterator());</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Transform the resource string to an order with the following code snippet:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">while (it.hasNext()) {
    String rs = (String)it.next();
    OrderFactory factory = new OrderFactoryImpl();
    Order resource = factory.create(rs);
    // now you can handle the resource order as above
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Get back the resource as string with the order method toXMLString():</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">String resourceString = resource.toXMLString();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note: if you want to modify the resource and store it persistently for further use in follow-up activities, don&#8217;t use the setter methods. Use the modification object passed in the calling run(&#8230;&#8203;) method. See the section "Modifying the Workflow Instance Data" for more details.</p>
</div>
</div>
<div class="sect4">
<h5 id="_modifying_the_workflow_instance_data"><a class="anchor" href="#_modifying_the_workflow_instance_data"></a>Modifying the Workflow Instance Data</h5>
<div class="paragraph">
<p>Use caution when modifying a subject or a resource in a workflow instance. With a normal class, you expect to use the setter methods to store new or modified values. You can do this for orders, too, but the changes are not stored back in the workflow instance; they are lost when your job ends. To store your changes in the workflow instance and make them available to downstream activities, you must return them to the workflow engine as modifications.</p>
</div>
<div class="paragraph">
<p>An empty modifications map is passed to your job as parameter of the "run" method call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">run(TaskContext ctx, _Map modifications_)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use this map to return your changes and make them persistent. Put the changed objects into the map using some predefined keys. The following snippets are taken from the sample job implementation delivered with DirX Identity and demonstrate how to store the changes for a subject or a resource as an order or an XML string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// subject as an order: +
modifications.put(RequestWorkflowInstance.KEY_WF_SUBJECT, subject);

// subject as string: +
modifications.put(RequestWorkflowInstance.KEY_WF_SUBJECTSTRING, subject.toXMLString());

// resource as an order: +
modifications.put(RequestWorkflowInstance.KEY_WF_RESOURCES, resourceOrders);

// resource as string: +
modifications.put(RequestWorkflowInstance.KEY_WF_RESOURCESTRINGS, resourceStrings);</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are other standard keys. You find them as static properties of the <em>RequestWorkflowInstance</em> interface. A very important key is KEY_ACT_APPLICATION_STATE to set the application state of an activity. Use it to set the activity state explicitly. A workflow designer can then easily configure different downstream activities depending on the state of your job implementation. The following sample sets the application state to success:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">modifications.put(RequestWorkflowInstance.KEY_ACT_APPLICATION_STATE, "success");</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more details on changing an order see the section Reading and Changing Orders.</p>
</div>
</div>
<div class="sect4">
<h5 id="_read_and_write_context_properties"><a class="anchor" href="#_read_and_write_context_properties"></a>Read and Write Context Properties</h5>
<div class="paragraph">
<p>You can use the workflow context to store application-specific information in a request flow activity and then read it later on in a downstream activity. The context allows you to store custom properties as you would in a Java map. You obtain the context from the request workflow instance as shown in the following snippet (for details, see "Reading the Workflow Instance Data"):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">IDMActivity activity = _cfg.getActivity(); +
IDMWorkflow wf = activity.getWorkflow(); +
RequestWorkflowInstance rqwf = (RequestWorkflowInstance)wf; +
IDMWorkflowContext *ctx = rqwf.getContext()*;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following snippet shows how to put a property named "testtest" with the ID of the Java Virtual Machine into the context:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">VMID vmid = new VMID(); +
String id = vmid.toString();* +
ctx.put*("testtest", id);* +
rqwf.setContext*(ctx);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Don&#8217;t forget to set the modified context at the workflow!</p>
</div>
<div class="paragraph">
<p>Obtaining a property from the context is as easy as reading it from a map:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">String test = (String) *ctx.get*("testtest"); +
logger.info("retrieve testtest:" + ((test !=null) ? test: "nada"));</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_reading_and_changing_orders"><a class="anchor" href="#_reading_and_changing_orders"></a>Reading and Changing Orders</h5>
<div class="paragraph">
<p>Subjects and resources in a workflow instance are orders. The section "Reading the Workflow Instance Data" shows how to obtain them from the workflow. Orders implement the interface com.siemens.dxm.api.order.Order.</p>
</div>
<div class="paragraph">
<p>An order is either of type <strong>InfoOrderRequest</strong>, <strong>AddOrderRequest</strong>, <strong>ModifyOrderRequest</strong> or <strong>DeleteOrderRequest</strong> (short: info order, add order, etc). The type depends on the workflow type and on the data with which the workflow was created. In a workflow with resources (that is, assignments for a subject user) the subject is always an info order. An info order contains only a number of attributes for the subject, no modifications. If the workflow is for creating an object (for example, creating a user), for approving subject attributes or for deleting an object, the order is of type add, modify or delete respectively.</p>
</div>
<div class="paragraph">
<p>Use the method <strong>getType</strong> to determine the type of the order. With <strong>getID</strong>, you obtain the object&#8217;s DN and with <strong>getValues(*<em>propertyname</em></strong>)*, you get the values of an property as a string array. For more details, examine the appropriate API.</p>
</div>
<div class="paragraph">
<p>The following methods are provided for changing an order:</p>
</div>
<div class="paragraph">
<p><strong>setSubjectDN(*<em>dn</em></strong>)* / <strong>setResourceDN(*<em>dn</em></strong>)*:</p>
</div>
<div class="paragraph">
<p>Sets the identifier (the distinguished name) of the subject with respect to the resource.</p>
</div>
<div class="paragraph">
<p><strong>setProperty(*<em>name</em></strong>,* <em>value</em>*)*:</p>
</div>
<div class="paragraph">
<p>Sets or changes attributes controlled in an order. Note that the behavior depends on the type of the order. For:</p>
</div>
<div class="paragraph">
<p>Info Order:</p>
</div>
<div class="paragraph">
<p>This method simply sets the value for the attribute. Changes are NOT stored in the subject entry in LDAP, they reside only in the workflow.</p>
</div>
<div class="paragraph">
<p>If the value is empty, or an empty String (<strong>""</strong>) or an array of length 0, the old attribute value is removed from the order.</p>
</div>
<div class="paragraph">
<p>Add Order:</p>
</div>
<div class="paragraph">
<p>Attribute changes are stored in the workflow and the apply Change activity stores them in the new subject / resource entry in LDAP.</p>
</div>
<div class="paragraph">
<p>If the value is empty, or an empty String (<strong>""</strong>) or an array of length 0, the old attribute value is removed from the order.</p>
</div>
<div class="paragraph">
<p>Modify Order:</p>
</div>
<div class="paragraph">
<p>Attribute changes are stored in the workflow and the apply Change activity stores them in the updated subject / resource entry in LDAP.</p>
</div>
<div class="paragraph">
<p>Modify orders are different from add orders in that they contain modifications for attributes. An attribute modification contains an operation. This means a <strong>setProperty</strong> overrides the property modification. Therefore, the name attribute is evaluated differently from the other order types:</p>
</div>
<div class="paragraph">
<p>It is expected in the format <strong>"*<em>operation</em></strong>",* <strong>"*<em>property-name</em></strong>"* where <em>operation</em> is <strong>add</strong>, <strong>replace</strong> or <strong>delete</strong>, <em>name</em> is the name of the property as you use it in <strong>getProperty</strong> or <strong>getValues</strong>.</p>
</div>
<div class="paragraph">
<p>Samples:</p>
</div>
<div class="paragraph">
<p><strong>setProperty("add-description", "New Description")</strong></p>
</div>
<div class="paragraph">
<p>adds the value "New Description" to the attribute"description".</p>
</div>
<div class="paragraph">
<p><strong>setProperty("delete-mail", "<a href="mailto:sample@gmx.de">sample@gmx.de</a>")</strong></p>
</div>
<div class="paragraph">
<p>deletes the value "<a href="mailto:sample@gmx.de">sample@gmx.de</a>" from the attribute "mail".</p>
</div>
<div class="paragraph">
<p>As in the add and info order, an empty value deletes the modification. For example:</p>
</div>
<div class="paragraph">
<p><strong>setProperty("delete-mail", "")</strong> or <strong>setProperty("delete-mail", null)</strong></p>
</div>
<div class="paragraph">
<p>deletes the modification previously produced with <strong>setProperty("delete-mail", "<a href="mailto:sample@gmx.de">sample@gmx.de</a>")</strong>.</p>
</div>
<div class="paragraph">
<p>A <strong>setProperty("*<em>name</em></strong>",* <em>value</em>*)* is not expected here. As empty values delete modifications, only a <strong>setProperty("*<em>name</em></strong>"," ")* can be accepted for the modification.</p>
</div>
</div>
<div class="sect4">
<h5 id="_deploying_the_job"><a class="anchor" href="#_deploying_the_job"></a>Deploying the Job</h5>
<div class="paragraph">
<p>When you have compiled your job classes and have produced a jar file, you must then deploy it to the IdS-J server. The class loader of the server searches the job-specific classes in a separate folder for your job underneath the server&#8217;s "confdb/jobs" folder. Suppose we have a job named "sampleJob". We need to create the folder</p>
</div>
<div class="paragraph">
<p><em>install_path</em>*/ids-j-<strong><em>domain</em></strong>-S*<em>n</em>*/confdb/jobs/sampleJob/lib*</p>
</div>
<div class="paragraph">
<p>You need to place all the jar files your job needs underneath the <strong>lib</strong> subfolder. This is the jar file of your job implementation and optionally other third-party jar files that your job requires (and which are not yet available in the <strong>confdb/common/lib</strong> folder). If the class loader doesn&#8217;t find a class here, it searches in the <strong>confdb/common/lib</strong> folder.</p>
</div>
</div>
<div class="sect4">
<h5 id="_obtaining_a_connection_to_the_identity_domain"><a class="anchor" href="#_obtaining_a_connection_to_the_identity_domain"></a>Obtaining a Connection to the Identity Domain</h5>
<div class="paragraph">
<p>Sometimes custom implementations need an LDAP connection to the Identity domain. There are two methods to obtain this information. We recommend using the job interface described in the following sections. The DomainSessionAccessor method is deprecated.</p>
</div>
</div>
<div class="sect4">
<h5 id="_implementing_a_job_with_access_to_the_identity_domain"><a class="anchor" href="#_implementing_a_job_with_access_to_the_identity_domain"></a>Implementing a Job with access to the Identity Domain</h5>
<div class="paragraph">
<p>A job interface is available that provides access to the Identity domain, the subject and resource orders, and the job configuration parameters.</p>
</div>
<div class="paragraph">
<p>Implementing the Job</p>
</div>
<div class="paragraph">
<p>You need to derive your job class from the class <strong>com.siemens.idm.jobs.BasicJob</strong>. This class provides an extended run interface that supplies a SvcSession object that is managed in a session pool, subject- and resource orders and a map of configuration parameters.</p>
</div>
<div class="paragraph">
<p>The Interface</p>
</div>
<div class="paragraph">
<p>You need to implement the following interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/**
* A run method providing session access.
* Implement this run method in the derived class
* @param taskCtx The task context
* @param modifications The modifications to be applied to the workflow instance
* @param session The service session, providing LDAP Access
* @param subject The subject order
* @param resources The resource orders
* @param parameters The map of configuration parameters
* @throws Exception An exception leads to a temporary error (retry).
*/
protected abstract void run (TaskContext taskCtx, Map modifications, SvcSession session, Order subject, Order[] resources, Map parameters) throws Exception;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A Sample Job</p>
</div>
<div class="paragraph">
<p>A sample job is provided on the DVD in the folder <strong>Additions &#8594; RequestWorkflows &#8594; samples</strong> (class <strong>SampleJobWithSession</strong>). It shows how to read job configuration parameters, to search objects in LDAP and to set the application state.</p>
</div>
<div class="paragraph">
<p>Deployment</p>
</div>
<div class="paragraph">
<p>The basic class <strong>com.siemens.idm.jobs.BasicJob</strong> is deployed in the jar file <strong>orderImpl.jar</strong>. Consequently, you can deploy your jar file to <strong>confdb/jobs/order/lib</strong>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_using_the_domainsessionaccessor_method"><a class="anchor" href="#_using_the_domainsessionaccessor_method"></a>Using the DomainSessionAccessor Method</h5>
<div class="paragraph">
<p>You can obtain the connection parameters from the IdS-J server using the static method getSessionClone() of the singleton DomainSessionAccessor. Here is a code snippet that shows how to perform this task:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// get a clone of the domain session
SvcSession session = DomainSessionAccessor.getClone(50000);
netscape.ldap.LDAPConnection ldapcon = session.getLDAPConnection().getLdapConnection.getLDAPConnection();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because this method clones the session, it can create memory problems and thus this method is deprecated. We recommend using the job interface described above.</p>
</div>
</div>
<div class="sect4">
<h5 id="_implementing_a_user_hook_for_an_applychange_activity"><a class="anchor" href="#_implementing_a_user_hook_for_an_applychange_activity"></a>Implementing a User Hook for an applyChange Activity</h5>
<div class="paragraph">
<p>ApplyChange activities are used in a request workflow to apply the changes stored in the subject and/or resource orders to the data store. The applyChange activities allow you to add a user hook that is called before and after the application of each order. You can use this user hook to modify the data before the change is applied or to change the order after the change is processed. Changed orders are written back to the workflow instance and can be read in successive activities.</p>
</div>
<div class="paragraph">
<p>Configuring the User Hook</p>
</div>
<div class="paragraph">
<p>To configure a user hook, enter its fully-qualified class name in the <strong>Class name</strong> text entry field of the activity’s Parameters tab. If you want to use the sample user hook, you must enter the class name com.siemens.idm.jobs.sample.SampleApplyChangesUserhook here.</p>
</div>
<div class="paragraph">
<p>The Interface</p>
</div>
<div class="paragraph">
<p>The user hook must be written in Java. It must implement the following interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package siemens.dxr.service.order.api;
public interface ApplyChangesUserHook {
/**
* Calls a UserHook before applying the orders
* - changes to the orders are updated at the worklow instance
* - if an ApplyChangesException is thrown, processing is aborted.
* - in this case, workflow context and the activity's application state are updated from the exception if non-null values are provided
* - settings of workflow context / activity application state to the apply changes context are not considered if an exception is thrown
* @param subject The subject order that is applied in the next step.
* @param resource The resource order that is applied in the next step. May be null if no resource is assigned.
* @param context The context object
* @param ld A clone of the session's LDAP connection. Is closed by ApplyChanges.
* @throws OrderJobException Aborts processing
*/
void preProcess(Order subject, Order resource, ApplyChangesContext context, LDAPConnection ld) throws OrderJobException;

/**
* Calls a UserHook after applying the orders
* - changes to the orders are updated at the worklow instance
* - if an ApplyChangesException is thrown, processing is aborted.
* - in this case, workflow context and the activity's application state are updated from the exception if non-null values are provided
* - settings of workflow context / activity application state to the apply changes context are not considered if an exception is thrown
* @param subject The subject order that is applied in the next step.
* @param resource The resource order that is applied in the next step. May be null if no resource is assigned.
* @param context The context object
* @param ld A clone of the session's LDAP connection. Is closed by ApplyChanges.
* @throws OrderJobException Aborts processing
*/
void postProcess(Order subject, Order resource, ApplyChangesContext context, LDAPConnection ld) throws OrderJobException;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A context object is passed to the user hook methods. The context object implements the following interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package siemens.dxr.service.order.api;
public interface ApplyChangesContext {

    /**
    * Boolean flag indicating that subject orders are applied
    * @return flag to apply subject orders
    */
    public boolean isApplyAttributeChanges();

    /**
    * Boolean flag indicating that resource orders are applied
    * @return flag to apply resource orders
    */
    public boolean isEvaluateAssignments();

    /**
    * Boolean flag indicating that an approval workflow is started for a privilege requiring approval
    * @return flag for starting approval workflow for resource order
    */
    public boolean isStartApprovalWorkflows();

    /**
    * sets the activity's application state.
    * @param aState The application state to set. If set here, the activity's application state is set to that value after ApplyChanges has completed.
    */
    public void setActivityApplicationState(String aState);

    /**
    * gets the activity's application state
    * @return the activity's application state
    */
    public String getActivityApplicationState();

    /**
    * The audit master uid
    * @return The audit master uid
    */
    public String getAuditMasterUID();

    /**
    * Reads the workflow context
    * @return The workflow context.
    */
    public Map&lt;String, String&gt; getWorkflowContext();

    /**
    * sets the workflow context. If set, the values stored in the context are added to the workflow context after applyChanges has completed.
    * Use getWorkflowContext to get the current context and modify it. Then use setWorkflowContext to make the changes permanent after ApplyChanges has finished.
    * @param wfContext
    */
    public void setWorkflowContext(Map&lt;String, String&gt; wfContext);

    /**
    * The workflow instance ID
    * @return The workflow instance ID
    */
    public String getWfInstId();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A Sample Job</p>
</div>
<div class="paragraph">
<p>A sample job is provided on the DVD in the folder <strong>Additions/RequestWorkflows/samples</strong> (class <strong>SampleApplyChangesUserhook</strong>). It shows how to set a unique ID at the subject order and adds a start date to a resource order before it is applied to the data store.</p>
</div>
<div class="paragraph">
<p>The postProcess call is not used in the sample; it has an empty body.</p>
</div>
<div class="paragraph">
<p>Deployment</p>
</div>
<div class="paragraph">
<p>The interface <strong>siemens.dxr.service.order.api.ApplyChangesUserHook</strong> is deployed in the jar file <strong>dxrServices.jar</strong>. You should deploy your jar file to <strong>confdb/commons/lib</strong>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_implementing_a_socketed_job_framework_based_activity"><a class="anchor" href="#_implementing_a_socketed_job_framework_based_activity"></a>Implementing a Socketed Job Framework-based Activity</h4>
<div class="paragraph">
<p>The socketed job framework allows you to implement your own automatic activity with minimal configuration effort and Java code writing. The idea is simple: you configure a predefined universal activity type <strong>Run socketed job</strong> which invokes your implementing Java class specified as a common parameter. The framework provides access to the Identity domain, the subject and resource orders and the predefined job configuration parameters, which means that no new component description is necessary.</p>
</div>
<div class="paragraph">
<p>To create your own job implementation, you must:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add a new activity of the type Run socketed job</p>
</li>
<li>
<p>Specify values for predefined configuration parameters</p>
</li>
<li>
<p>Implement the job as a Java class</p>
</li>
<li>
<p>Read the job configuration</p>
</li>
<li>
<p>Read the workflow instance data</p>
</li>
<li>
<p>Modify the workflow instance data</p>
</li>
<li>
<p>Read and change orders</p>
</li>
<li>
<p>Deploy your job implementation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The socketed job framework is based on the common request workflow API. Consult the following folder on your DVD:</p>
</div>
<div class="paragraph">
<p><strong>Documentation\DirXIdentity\RequestWorkflows\index.html.</strong></p>
</div>
<div class="paragraph">
<p>For the specific API and sample sources, see the following folders on your DVD:</p>
</div>
<div class="paragraph">
<p><strong>Additions\SocketedJob\api</strong></p>
</div>
<div class="paragraph">
<p>Additions\SocketedJob\samples</p>
</div>
<div class="sect4">
<h5 id="_adding_the_new_socketed_job_framework_activity"><a class="anchor" href="#_adding_the_new_socketed_job_framework_activity"></a>Adding the New Socketed Job Framework Activity</h5>
<div class="paragraph">
<p>When defining a request workflow, select the universal automatic activity template <strong>Run socketed job</strong>. Connect it with other activities and define the start conditions. Use start conditions based on application state; for details, see the section "Understanding Request Workflow States" in the chapter "Request Workflow Architecture".</p>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_predefined_configuration_parameters"><a class="anchor" href="#_specifying_predefined_configuration_parameters"></a>Specifying Predefined Configuration Parameters</h5>
<div class="paragraph">
<p>The Run socketed job already contains the following predefined configuration parameter names:</p>
</div>
<div class="paragraph">
<p>Class name for socket job - the parameter is accessible as <strong>className</strong> in the XML configuration of the job. This parameter is mandatory and must contain a fully qualified class name of a Java class implementing one of the following interfaces:</p>
</div>
<div class="paragraph">
<p>com.siemens.idm.jobs.socketed.api.CustomSocketJob</p>
</div>
<div class="paragraph">
<p>com.siemens.idm.jobs.socketed.api.CustomSocketSvcSessionJob</p>
</div>
<div class="paragraph">
<p>The specified class must be stored in the following folder:</p>
</div>
<div class="paragraph">
<p><em>install_path</em>*/ids-j-<strong><em>domain</em></strong>-S*<em>n</em>*/confdb/jobs/socketed/lib*</p>
</div>
<div class="paragraph">
<p>1. Parameter to be passed to job - the parameter is accessible as <strong>paramOne</strong> in the XML configuration of the job.</p>
</div>
<div class="paragraph">
<p>2. Parameter to be passed to job - the parameter is accessible as <strong>paramTwo</strong> in the XML configuration of the job.</p>
</div>
<div class="paragraph">
<p>3. Parameter to be passed to job - the parameter is accessible as <strong>paramThree</strong> in the XML configuration of the job.</p>
</div>
<div class="paragraph">
<p>4. Parameter to be passed to job - the parameter is accessible as <strong>paramFour</strong> in the XML configuration of the job.</p>
</div>
<div class="paragraph">
<p>5. Parameter to be passed to job - the parameter is accessible as <strong>paramFive</strong> in the XML configuration of the job.</p>
</div>
<div class="paragraph">
<p>These parameters are optional and can be used to pass any configuration parameter value to the custom socket job. You can pass any value that can be stored as a common string: for example, a path to a file, a number or a boolean value. Note that the name of the parameter cannot be changed and you should document its meaning in the relevant socket job activity implementation. These parameters are also always available only as string constants. You need to convert these strings to the correct types in your socket job class if necessary.</p>
</div>
<div class="paragraph">
<p>The number of parameters cannot be changed without modifying the component description for the Run socketed activity job (<strong>Run socketed job.xml</strong>). If necessary, define a new component description. Do not rewrite the default one. See the section "Supplying a Component Description" in the chapter "Implementing a New Activity" for more details.</p>
</div>
</div>
<div class="sect4">
<h5 id="_implementing_the_job_2"><a class="anchor" href="#_implementing_the_job_2"></a>Implementing the Job</h5>
<div class="paragraph">
<p>When running the activity, the IdS-J server will search for a class defined in the mandatory configuration parameter class name for socket job. This class must implement one of these very similar interfaces:</p>
</div>
<div class="paragraph">
<p>com.siemens.idm.jobs.socketed.api.CustomSocketJob - use this interface when no access to the Identity domain is required, it requires only one method:</p>
</div>
<div class="paragraph">
<p>executeSocketJob(TaskContext taskCtx, Map&lt;String, Object&gt; modifications, Order subject, Order[] resources, Map&lt;String, Object&gt; parameters, RequestWorkflowInstance wfInstance)</p>
</div>
<div class="paragraph">
<p>This method contains the main logic of the job. The server passes six parameters.</p>
</div>
<div class="paragraph">
<p>The task context gives read access to the activity and workflow instance, especially to the workflow and activity states, the workflow initiator, the subject and the optional resources.</p>
</div>
<div class="paragraph">
<p>The job can indirectly modify the workflow by entering the desired modifications into the passed modification map. Use this facility to set the resulting activity state or application state.</p>
</div>
<div class="paragraph">
<p>The subject contains the subject order of the request workflow as stored within the task context. It is a convenient way to access it directly.</p>
</div>
<div class="paragraph">
<p>The resources contain the resource orders of the request workflow as stored within the task context. It is a convenient way to access it directly. Note that the resource orders may be not available for some request workflow types.</p>
</div>
<div class="paragraph">
<p>The parameters map contains the values for predefined configuration parameters. The values are accessible for key names <strong>paramOne</strong>, <strong>paramTwo</strong>, <strong>paramThree</strong>, <strong>paramFour</strong> and <strong>paramFive</strong> as described in the section "Specifying Predefined Configuration Parameters".</p>
</div>
<div class="paragraph">
<p>The request workflow instance contains the object as it is stored within the task context. It is a convenient way how to access it directly.</p>
</div>
<div class="paragraph">
<p>com.siemens.idm.jobs.socketed.api.CustomSocketSvcSessionJob – use this interface when you need direct access to the Identity domain; it requires only one method:</p>
</div>
<div class="paragraph">
<p>executeSocketJob(TaskContext taskCtx, Map&lt;String, Object&gt; modifications, SvcSession session, Order subject, Order[] resources, Map&lt;String, Object&gt; parameters, RequestWorkflowInstance wfInstance)</p>
</div>
<div class="paragraph">
<p>This method contains the main logic of the job but this time the server passes seven parameters. The signature of the method and its logic are almost the same as the previous interface.</p>
</div>
<div class="paragraph">
<p>This interface also provides session-representing access to the Identity domain.</p>
</div>
<div class="paragraph">
<p>Handling States</p>
</div>
<div class="paragraph">
<p>We recommend using application state when returning a result of the activity to be used as a start condition for a next activity. Use constants from com.siemens.idm.requestworkflow.api.ApplicationState or a custom value and use them in the start conditions. See the section "Modifying the Workflow Instance Data" in the chapter "Implementing a Generic Activity" for more details.</p>
</div>
<div class="paragraph">
<p>Do not set state (com.siemens.idm.api.Job.STATE) directly. It will be set automatically to <strong>Succeeded</strong> if no exception occurs or to <strong>Failed.Temporary</strong> if an unhandled exception is thrown. See the section "Understanding Request Workflow Activity States" in the chapter "Request Workflow Architecture" for more details.</p>
</div>
<div class="paragraph">
<p>Importing Required Libraries</p>
</div>
<div class="paragraph">
<p>When compiling your class, make sure you have the following jar files in your classpath:</p>
</div>
<div class="paragraph">
<p>commons-pool.jar<br>
com.siemens.idm.requestworkflow.jar<br>
com.siemens.idm.requestworkflow-api.jar<br>
com.siemens.idm.server-api.jar<br>
com.siemens.idm.server-config.jar<br>
com.siemens.idm.server-core.jar<br>
dxcLogging.jar<br>
dxiSocketedJob.jar<br>
dxmAPI.jar<br>
dxrServices.jar<br>
ldapjdk.jar<br>
storage.jar</p>
</div>
<div class="paragraph">
<p>Note that the list might not be complete since it depends on the customer extensions. You may also need to add jar files with missing dependencies to the deployment directory; see the section "Deploying the Job".</p>
</div>
</div>
<div class="sect4">
<h5 id="_reading_the_job_configuration_2"><a class="anchor" href="#_reading_the_job_configuration_2"></a>Reading the Job Configuration</h5>
<div class="paragraph">
<p>The socketed job framework provides methods and keys to access the predefined configuration parameter values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">String p1 = SocketedJob.getParameterAsString(ActivityConstants._PARAM_ONE_, parameters);

String p2 = SocketedJob.getParameterAsString(ActivityConstants._PARAM_TWO_, parameters);

String p3 = SocketedJob.getParameterAsString(ActivityConstants._PARAM_THREE_, parameters);

String p4 = SocketedJob.getParameterAsString(ActivityConstants._PARAM_FOUR_, parameters);

String p5 = SocketedJob.getParameterAsString(ActivityConstants._PARAM_FIVE_, parameters);</code></pre>
</div>
</div>
<div class="paragraph">
<p>See also the <strong>ParamListingJob</strong> class in the sample directory.</p>
</div>
</div>
<div class="sect4">
<h5 id="_reading_the_workflow_instance_data_2"><a class="anchor" href="#_reading_the_workflow_instance_data_2"></a>Reading the Workflow Instance Data</h5>
<div class="paragraph">
<p>The socket job interfaces give you direct access to the request workflow instance, to the subject and to the resources if available. You can also read the participant of the previous people activities or read the initiator of the workflow. See the class <strong>ParamListingJob</strong> and <strong>Utils</strong> in the sample directory for these advanced examples.</p>
</div>
</div>
<div class="sect4">
<h5 id="_modifying_the_workflow_instance_data_2"><a class="anchor" href="#_modifying_the_workflow_instance_data_2"></a>Modifying the Workflow Instance Data</h5>
<div class="paragraph">
<p>The socketed job framework is based on common request workflow API. Use the methods described in the section "Modifying the Workflow Instance Data" in the chapter "Implementing a New Activity" for more details.</p>
</div>
</div>
<div class="sect4">
<h5 id="_read_and_write_context_properties_2"><a class="anchor" href="#_read_and_write_context_properties_2"></a>Read and Write Context Properties</h5>
<div class="paragraph">
<p>The socketed job framework is based on common request workflow API, use the methods described in the section "Read and Write Context Properties" in the section "Implementing a New Activity" for more details.</p>
</div>
</div>
<div class="sect4">
<h5 id="_reading_and_changing_orders_2"><a class="anchor" href="#_reading_and_changing_orders_2"></a>Reading and Changing Orders</h5>
<div class="paragraph">
<p>The socketed job framework is based on common request workflow API. Use the methods described in the section "Reading and Changing Orders" in the section "Implementing a New Activity" for more details.</p>
</div>
</div>
<div class="sect4">
<h5 id="_deploying_the_job_2"><a class="anchor" href="#_deploying_the_job_2"></a>Deploying the Job</h5>
<div class="paragraph">
<p>The jar file containing compiled custom implementation of the socketed job APIs must be placed within the folder <em>install_path</em>*/ids-j-<strong><em>domain</em></strong>-S*<em>n</em>*/confdb/jobs/socketed/lib*. Do not add other jar files to this directory unless it is necessary due to class loader problems. It is mainly necessary when using other third-party dependencies.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_implementing_a_java_class_for_finding_participants"><a class="anchor" href="#_implementing_a_java_class_for_finding_participants"></a>Implementing a Java Class for Finding Participants</h4>
<div class="paragraph">
<p>Instead of finding the participants of a people activity by approval policies or group lists, you can write your own Java class to do it. To create your own "find participants" implementation, you must:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define configuration parameters</p>
</li>
<li>
<p>Implement a Java class</p>
</li>
<li>
<p>Deploy the Java class</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For the API documentation, consult the following folder on your DVD:</p>
</div>
<div class="paragraph">
<p><strong>Documentation\DirXIdentity\RequestWorkflows\index.html</strong>.</p>
</div>
<div class="paragraph">
<p>For sample sources, see the following folder on your DVD:</p>
</div>
<div class="paragraph">
<p><strong>Additions\RequestWorkflows\samples</strong>.</p>
</div>
<div class="sect4">
<h5 id="_defining_configuration_parameters_2"><a class="anchor" href="#_defining_configuration_parameters_2"></a>Defining Configuration Parameters</h5>
<div class="paragraph">
<p>When you create or modify a people activity, select the type <strong>class</strong> from the drop-down list at the top of the Participants tab.</p>
</div>
<div class="paragraph">
<p>In the "Class" field, enter the full class name of your Java class. For the sample class described here, enter: <strong>com.siemens.idm.participants.sample.FindParticipantsSample</strong>.</p>
</div>
<div class="paragraph">
<p>If your class needs configuration parameters, enter them in the "Parameters" table. For each parameter, enter the parameter name into the left column and the value into the right column. Suppose you want to read some data from a file; in this case, you might define a parameter "filename" in the left column and then enter the absolute path name of the file "c:\myconfigdata\findparticipant.properties" in the right column.</p>
</div>
<div class="paragraph">
<p>See the section "Implementing the Java Class" for information on how to read them in your Java class.</p>
</div>
</div>
<div class="sect4">
<h5 id="_implementing_the_java_class"><a class="anchor" href="#_implementing_the_java_class"></a>Implementing the Java Class</h5>
<div class="paragraph">
<p>The Java class must provide a default constructor and implement the interface <strong>com.siemens.idm.api.custom.Participants</strong>. Optionally, it can implement the interface <strong>com.siemens.idm.api.custom.ParticipantsExtended</strong>: it enables the custom class to obtain a connection to the Identity Store.</p>
</div>
<div class="paragraph">
<p>Implementing the Participants Interface</p>
</div>
<div class="paragraph">
<p>For the <strong>Participants</strong> interface, the only method you need to realize is <strong>findParticipants(</strong>&#8230;&#8203;<strong>)</strong>. The IdS-J server passes the following parameters from the workflow and activity instance:</p>
</div>
<div class="paragraph">
<p><em>operation</em> - the operation string taken from the workflow definition.</p>
</div>
<div class="paragraph">
<p><em>subjecttype</em> - the subject type taken from the workflow definition. In most cases, the subject of the workflow is a user.</p>
</div>
<div class="paragraph">
<p><em>subjectDn</em> - the distinguished name of the workflow&#8217;s subject.</p>
</div>
<div class="paragraph">
<p>Note: If there is an escalation, the subjectDN is the DN of the participant of the previous level. For example, in the first escalation level, you get the DN of the original activity participant, in the second level, the DN of the participant of the first level. Nevertheless, you have access to the workflow subject via the activity. For more details, see the section "Reading the Workflow Instance Data". Here are the necessary commands:<br>
<br>
com.siemens.idm.api.nodes.IDMActivity activity = _cfg.getActivity();<br>
com.siemens.idm.requestworkflow.api.RequestWorkflowInstance rqwf = (RequestWorkflowInstance) activity.getWorkflow(); com.siemens.dxm.api.order.Order subject = rqwf.getSubject();</p>
</div>
<div class="paragraph">
<p><strong>properties</strong> - a map of configuration parameters taken from the activity definition. See the section "Defining Configuration Parameters" for information on how to specify and set them in the workflow.</p>
</div>
<div class="paragraph">
<p><strong>activity</strong> - the interface to access the activity instance and through it the workflow instance. Your class must return a collection of String objects that represent the distinguished names of the participants.</p>
</div>
<div class="paragraph">
<p>Implementing the ParticipantsExtended Interface</p>
</div>
<div class="paragraph">
<p>The <strong>ParticipantsExtended</strong> interface allows a participant finder to obtain a context, which especially gives access to an LDAP connection to the DirX Identity domain. This interface defines a setter for a <strong>ParticipantContext</strong>. The <strong>com.siewmens.idm.api.custom.ParticipantContext</strong> defines the following methods that are to be implemented:</p>
</div>
<div class="paragraph">
<p><strong>LDAPConnection getLdapConnection()</strong> - returns a “netscape.ldap.LDAPConnection”. It is connected to the DirX Identity domain and you use it to retrieve any LDAP entries in the domain. You can also change any LDAP entry, so be careful when using it.</p>
</div>
<div class="paragraph">
<p>Reading Configuration Parameters</p>
</div>
<div class="paragraph">
<p>Reading the configuration parameters is very simple: just call the <strong>get(</strong>&#8230;&#8203;<strong>)</strong> method of the properties map and provide the parameter name as the key, as shown in this sample:</p>
</div>
<div class="paragraph">
<p>String filename = (String)properties.get("filename");</p>
</div>
<div class="paragraph">
<p>Note that the parameter values are treated as strings.</p>
</div>
<div class="paragraph">
<p>Returning Participants</p>
</div>
<div class="paragraph">
<p>The server expects the participants as a collection of strings.</p>
</div>
<div class="paragraph">
<p>The following code snippet simply constructs a list of DN strings and returns them:</p>
</div>
<div class="paragraph">
<p>ArrayList&lt;String&gt; res = new ArrayList&lt;String&gt;(1);<br>
res.add("cn=Taspatch Nik,ou=Global IT,o=My-Company,cn=Users,cn=My-Company");<br>
return res;</p>
</div>
<div class="paragraph">
<p>Importing the Required Libraries</p>
</div>
<div class="paragraph">
<p>When compiling your class, make sure you have the following jar files in your classpath:</p>
</div>
<div class="paragraph">
<p>dxmApi.jar<br>
com.siemens.idm.server-api.jar<br>
com.siemens.idm.requestworkflow-api.jar</p>
</div>
<div class="paragraph">
<p>For the API documentation<strong>,</strong> consult the following file on your DVD:</p>
</div>
<div class="paragraph">
<p><strong>Documentation\DirXIdentity\RequestWorkflows\index.html</strong>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_deploying_the_java_class"><a class="anchor" href="#_deploying_the_java_class"></a>Deploying the Java Class</h5>
<div class="paragraph">
<p>When you have compiled your classes and produced a jar file, you must deploy it to the IdS-J server. Place it into the folder:</p>
</div>
<div class="paragraph">
<p><em>install_path</em>*/ids-j-<strong><em>domain</em></strong>-S*<em>n</em>*/confdb/common/lib*</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_implementing_participant_filters_and_constraints"><a class="anchor" href="#_implementing_participant_filters_and_constraints"></a>Implementing Participant Filters and Constraints</h4>
<div class="paragraph">
<p>Each people activity allows for specifying a participant filter and participant constraints which are applied to the result of the "find participants" implementation. The filter allows for reducing the list of participants; for example, skipping the workflow initiator. The constraint implementation decides whether the number of participants meets the workflow&#8217;s requirements ("4-eye-principle").</p>
</div>
<div class="paragraph">
<p>Implementation of a filter and a constraint are quite similar. Both must be realized as Java classes. The server passes the list of participants and the current activity. Only the result of their operation is different.</p>
</div>
<div class="paragraph">
<p>Participant Filter:</p>
</div>
<div class="paragraph">
<p>A participant filter must implement the interface <strong>com.siemens.idm.requestworkflow.api.ParticipantsFilter</strong>. In its only method <strong>filterParticipants(</strong>&#8230;&#8203;<strong>)</strong> it receives the list of participants and the current activity. It must return the allowed participants as a list of strings denoting the distinguished names of the participants. For details, see the section "Implementing a Participant Filter".</p>
</div>
<div class="paragraph">
<p>Participant Constraints:</p>
</div>
<div class="paragraph">
<p>A participant constraints class implements the interface <strong>com.siemens.idm.requestworkflow.api.ParticipantConstraints</strong>. In its only method <strong>checkParticipantsConstraints(</strong>&#8230;&#8203;<strong>)</strong> it receives the list of participants and the current activity. If it rejects the participants, it must throw a ConstraintViolationException. For details, see the section "Implementing Participant Constraints".</p>
</div>
<div class="paragraph">
<p>Filters and Constraints as Joblets (Deprecated):</p>
</div>
<div class="paragraph">
<p>As an alternative to providing Java classes implementing the interfaces <strong>ParticipantsFilter</strong> and <strong>ParticipantConstraints</strong>, filters or constraints can be realized as joblets. Joblets are Java sources implementing the <strong>IDMJob</strong> interface that are compiled and started at runtime by the IdS-J server. See the sections "Configuring a Joblet" and "Implementing a Joblet" for instructions on how to realize a joblet.</p>
</div>
<div class="paragraph">
<p>Deploy Filters and Constraints:</p>
</div>
<div class="paragraph">
<p>For details, see the section "Deploying Filters and Constraints".</p>
</div>
<div class="paragraph">
<p>For the API documentation, consult the following folder on your DVD:</p>
</div>
<div class="paragraph">
<p><strong>Documentation\DirXIdentity\RequestWorkflows\index.html</strong>.</p>
</div>
<div class="paragraph">
<p>For sample sources, see the following folder on your DVD:</p>
</div>
<div class="paragraph">
<p><strong>Additions\RequestWorkflows\samples</strong>.</p>
</div>
<div class="sect4">
<h5 id="_implementing_a_participants_filter"><a class="anchor" href="#_implementing_a_participants_filter"></a>Implementing a Participants Filter</h5>
<div class="paragraph">
<p>Your participants filter implementation should have a default constructor and implement the interface <strong>com.siemens.idm.requestworkflow.api.ParticipantsFilter</strong>. The only method of the interface is <strong>filterParticipants(</strong>&#8230;&#8203;<strong>)</strong>. The additional interface <strong>com.siemens.idm.requestworkflow.api.ParticipantsFilterExtended</strong> allows you to obtain a context with the LDAP connection to the Identity domain.</p>
</div>
<div class="paragraph">
<p>Interface ParticipantsFilter:</p>
</div>
<div class="paragraph">
<p>The only method you must implement is: <strong>filterParticipants(</strong>&#8230;&#8203;<strong>)</strong>. The server passes two parameters:</p>
</div>
<div class="paragraph">
<p><em>participants</em>: the list of participants calculated so far, each as a distinguished name string.</p>
</div>
<div class="paragraph">
<p><em>activity</em>: the current activity for which the participants are to be calculated.</p>
</div>
<div class="paragraph">
<p>The method returns the list of filtered participants as a collection of strings, each representing a participant&#8217;s distinguished name.</p>
</div>
<div class="paragraph">
<p>The following snippet shows you how to read the workflow initiator&#8217;s DN, exclude the initiator from the participants and return the new participant list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RequestWorkflowInstance wf = (RequestWorkflowInstance) activity.getWorkflow();
String initiator = wf.getInitiator();
ArrayList allowedParticipants = new ArrayList();
Iterator it = participants.iterator();
while (it.hasNext()) {
    Object o = it.next();
    String participant = (String)o;
    if (participant.equalsIgnoreCase(initiator)) {
        log.info("ParticipantFilterSample - participant: " + participant + " not allowed for approval");
    } else {
        allowedParticipants.add(participant);
    }
}
return allowedParticipants;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Interface ParticipantsFilterExtended</p>
</div>
<div class="paragraph">
<p>This interface extends ParticipantsFilter and establishes the ParticipantContext. This allows obtaining an LDAP connection to the DirX Identity domain and thus to execute LDAP operations. You must implement the following methods:</p>
</div>
<div class="paragraph">
<p>public void setParticipantContext(ParticipantContext ctx): the server passes a com.siemens.idm.api.custom.ParticipantContext. See below.</p>
</div>
<div class="paragraph">
<p>Interface ParticipantContext</p>
</div>
<div class="paragraph">
<p>This interface provides the following method:</p>
</div>
<div class="paragraph">
<p>public LDAPConnection getLdapConnection(): it returns an LDAP connection to the DirX Identity domain.</p>
</div>
<div class="paragraph">
<p>Writing Logs</p>
</div>
<div class="paragraph">
<p>You can issue log messages that appear in the server&#8217;s log files. The server&#8217;s log support <strong>com.siemens.idm.jini.util.logging.LogSupport</strong> provides the usual log interface, especially the following methods:</p>
</div>
<div class="paragraph">
<p><strong>log.error(</strong>&#8230;&#8203;<strong>)</strong>: error message</p>
</div>
<div class="paragraph">
<p><strong>log.warning(</strong>&#8230;&#8203;<strong>)</strong>: warning message</p>
</div>
<div class="paragraph">
<p><strong>log.info(</strong>&#8230;&#8203;<strong>)</strong>: normal informational message</p>
</div>
<div class="paragraph">
<p><strong>log.finest(</strong>&#8230;&#8203;<strong>)</strong>: debug message</p>
</div>
</div>
<div class="sect4">
<h5 id="_implementing_participant_constraints"><a class="anchor" href="#_implementing_participant_constraints"></a>Implementing Participant Constraints</h5>
<div class="paragraph">
<p>Your participant constraints implementation should have a default constructor and implement the interface <strong>com.siemens.idm.requestworkflow.api.ParticipantConstraints</strong>. Optionally it can also implement <strong>com.siemens.idm.requestworkflow.api.ParticipantConstraintsExtended</strong>. The only method of the interface is <strong>checkParticipantConstraints(</strong>&#8230;&#8203;<strong>)</strong>.</p>
</div>
<div class="paragraph">
<p>Interface ParticipantConstraints</p>
</div>
<div class="paragraph">
<p>You must implement the only method <strong>checkParticipantConstraints(</strong>&#8230;&#8203;*)*<em>.</em> The server passes two parameters:</p>
</div>
<div class="paragraph">
<p><em>participants</em>: the list of participants calculated so far, each as a distinguished name string.</p>
</div>
<div class="paragraph">
<p><em>activity</em>: the current activity for which the participants are to be calculated.</p>
</div>
<div class="paragraph">
<p>A participant constraints implementation returns a ConstraintViolationException to notify the server that the participant list does not meet the constraint conditions. In the exception constructor, you can supply the desired resulting activity state and application state along with an error message that will be stored with the activity instance. This allows you to configure subsequent activities that are started in this case.</p>
</div>
<div class="paragraph">
<p>The following snippet shows you how to make sure that the list contains at least one participant:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">if (participants == null || participants.size() &lt; 1)
    throw new ConstraintViolationException("SUCCEEDED", "REJECTED", "Too few approvers, at least one approver required!") +
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If not enough participants are found, the server sets the resulting activity state to "SUCCEEDED" and the activity application state to "REJECTED".</p>
</div>
<div class="paragraph">
<p>Interface ParticipantConstraintsExtended</p>
</div>
<div class="paragraph">
<p>This interface extends ParticipantConstraints and establishes the ParticipantContext. This allows accessing the LDAP connection and thus to execute LDAP operations. You must implement the following methods:</p>
</div>
<div class="paragraph">
<p><strong>public void setParticipantContext(ParticipantContext ctx)</strong>: the server passes a <strong>com.siemens.idm.api.custom.ParticipantContext</strong>. See below.</p>
</div>
<div class="paragraph">
<p>Interface ParticipantContext</p>
</div>
<div class="paragraph">
<p>This interface provides the following method:</p>
</div>
<div class="paragraph">
<p><strong>public LDAPConnection getLdapConnection()</strong>: it returns an LDAP connection to the DirX Identity domain.</p>
</div>
<div class="paragraph">
<p>Writing Logs</p>
</div>
<div class="paragraph">
<p>You can issue log messages that appear in the server&#8217;s log files. The server&#8217;s log support provides the usual log interface, especially the following methods:</p>
</div>
<div class="paragraph">
<p><strong>log.error(</strong>&#8230;&#8203;<strong>)</strong>: error message</p>
</div>
<div class="paragraph">
<p><strong>log.warning(</strong>&#8230;&#8203;<strong>)</strong>: warning message</p>
</div>
<div class="paragraph">
<p><strong>log.info(</strong>&#8230;&#8203;<strong>)</strong>: normal informational message</p>
</div>
<div class="paragraph">
<p><strong>log.finest(</strong>&#8230;&#8203;<strong>)</strong>: debug message</p>
</div>
</div>
<div class="sect4">
<h5 id="_configuring_a_joblet"><a class="anchor" href="#_configuring_a_joblet"></a>Configuring a Joblet</h5>
<div class="paragraph">
<p>A joblet is a Java class source code that is compiled by the Java-based Server (IdS-J) at runtime. The server includes the body of the configured Java source code into a template, compiles it and loads the compilation unit.</p>
</div>
<div class="paragraph">
<p>The template contains the common parts of the Java source code implementing the <strong>com.siemens.idm.jobs.java.Joblet</strong> interface:</p>
</div>
<div class="paragraph">
<p>The leading package line</p>
</div>
<div class="paragraph">
<p>It is built dynamically including the workflow and activity name.</p>
</div>
<div class="paragraph">
<p>The common import statements</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.util.Map;
import com.siemens.idm.jini.util.logging.LogSupport;
import com.siemens.idm.api.nodes.IDMJob;
import com.siemens.idm.api.context.TaskContext;
import com.siemens.idm.jobs.java.Joblet;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The class and interface method declaration.</p>
</div>
<div class="paragraph">
<p>And the trailing closing brackets for the interface method and the class definition.</p>
</div>
<div class="paragraph">
<p>You must provide the missing parts of the source code in two fields:</p>
</div>
<div class="paragraph">
<p>Imports: The additional import statements.</p>
</div>
<div class="paragraph">
<p>For each additional import, supply the full class name <strong>without</strong> the leading "import" and the trailing "<em>;</em>" strings.</p>
</div>
<div class="paragraph">
<p>Code: The method body.</p>
</div>
<div class="paragraph">
<p>See the section "Implementing a Joblet" for details.</p>
</div>
</div>
<div class="sect4">
<h5 id="_implementing_a_joblet"><a class="anchor" href="#_implementing_a_joblet"></a>Implementing a Joblet</h5>
<div class="paragraph">
<p>A joblet must implement the <strong>com.siemens.idm.jobs.java.Joblet</strong> interface with the method:</p>
</div>
<div class="paragraph">
<p><strong>public void run(IDMJob job, TaskContext taskCtx, Map modifications) throws Exception;</strong></p>
</div>
<div class="paragraph">
<p>The server passes the following parameters when running the joblet:</p>
</div>
<div class="paragraph">
<p><strong>Job</strong>: gives access to the job, which in turns allows reading the activity and the workflow instance.</p>
</div>
<div class="paragraph">
<p><strong>Task Context</strong>: gives access to a map of context properties. It can be used as an application-specific properties container.</p>
</div>
<div class="paragraph">
<p><strong>modifications</strong>: An empty map for returning modifications that are made on the workflow instance. This parameter should not be used in participant filters and constraints!</p>
</div>
<div class="paragraph">
<p>When implementing a joblet, you only need to provide the additions to the surrounding template: the additional class names to be imported and the body of the run(&#8230;&#8203;) method.</p>
</div>
<div class="paragraph">
<p><strong>Note</strong>:</p>
</div>
<div class="paragraph">
<p>The joblets are compiled at runtime using <strong>Java 1.4</strong> compiler settings. Do not include Java 5 constructs such as generics or the loop enhancements.</p>
</div>
<div class="paragraph">
<p>For the API documentation, consult the following file on your DVD:</p>
</div>
<div class="paragraph">
<p><strong>Documentation\DirXIdentity\RequestWorkflows\index.html</strong>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_deploying_filters_and_constraints"><a class="anchor" href="#_deploying_filters_and_constraints"></a>Deploying Filters and Constraints</h5>
<div class="paragraph">
<p>When you have compiled your filter and constraint classes, you must produce a jar file and then deploy it to the IdS-J server. The class loader of the server searches the filter and constraint classes in its common folder</p>
</div>
<div class="paragraph">
<p><em>install_path</em>*/ids-j-<strong><em>domain</em></strong>-S*<em>n</em>*/confdb/common/lib*.</p>
</div>
<div class="paragraph">
<p>If you need additional jar files, place them into the same folder.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_testing_request_workflows"><a class="anchor" href="#_testing_request_workflows"></a>Testing Request Workflows</h3>
<div class="paragraph">
<p>Request workflows can be quite complex.Therefore we recommend intensive testing.Use these methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Test the workflow in a test environment.Use collections in conjunction with the transport feature to transfer tested workflows between test and production environments.</p>
</li>
<li>
<p>While in a development or test environment, set up the Map Mail Address field to your mail address.Then you can evaluate and adjust notification mails easily.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="understanding_java_based_workflows"><a class="anchor" href="#understanding_java_based_workflows"></a>Understanding Java-based Workflows</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section provides information about Java-based workflows, including information about:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java-based Connectivity architecture</p>
</li>
<li>
<p>Customizing Java-based workflows</p>
</li>
<li>
<p>Customizing event-based maintenance workflows</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_java_based_workflow_architecture"><a class="anchor" href="#_java_based_workflow_architecture"></a>Java-based Workflow Architecture</h3>
<div class="paragraph">
<p>Java-based workflows can be separated into "provisioning workflow" and "event-based maintenance workflow" categories.</p>
</div>
<div class="paragraph">
<p>Provisioning workflows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Provision account and group attributes and memberships to connected systems.</p>
</li>
<li>
<p>Validate connected systems.</p>
</li>
<li>
<p>Update user passwords and provision password changes to connected systems.</p>
</li>
<li>
<p>Import users and other entries from other source systems.</p>
</li>
<li>
<p>Can work in full or delta mode.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Event-based maintenance workflows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Are only started upon a change event of an entry in the Identity domain.</p>
</li>
<li>
<p>Apply rules (consistency, provisioning and validation) depending on the type, check links and update associated users where necessary.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Java-based workflows are hosted by the Java-based Identity Server (IdS-J). Depending on the type, they can be started by an event, by a schedule or manually in Identity Manager.</p>
</div>
<div class="paragraph">
<p>The following sections describe:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The differences between full export, delta and event-based workflows</p>
</li>
<li>
<p>The location of delta state</p>
</li>
<li>
<p>How to start a Java-based workflow</p>
</li>
<li>
<p>The structure of a provisioning workflow</p>
</li>
<li>
<p>Workflow classification</p>
</li>
<li>
<p>Mapping</p>
</li>
<li>
<p>Cross-memberships</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_full_delta_and_event_based_workflows"><a class="anchor" href="#_full_delta_and_event_based_workflows"></a>Full, Delta and Event-based Workflows</h4>
<div class="paragraph">
<p>This section gives information on workflow types that perform a full or delta export or those that are triggered by change events.</p>
</div>
<div class="paragraph">
<p>When started by a <strong>change event</strong>, the workflow processes the entry identified by the event.</p>
</div>
<div class="paragraph">
<p>When started by <strong>schedule</strong> or by Identity Manager, the workflow exports and processes the entries of all channels matching the search criteria. This is typical for Validation or <strong>Full Export</strong> workflows.</p>
</div>
<div class="paragraph">
<p>A <strong>delta</strong> workflow is also started by a schedule or by Identity Manager, but it exports only those entries that have been changed since the last run. When a delta workflow finishes successfully, it stores the delta time in a delta state entry in the Identity domain. Note that each channel has its own delta state. When a delta workflow runs for the first time (it has no delta state), it exports all of the entries from the source system.</p>
</div>
<div class="paragraph">
<p>Compared to the delta features provided by Tcl-based workflows, the Java-based workflows</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Support the delta feature for all connectors and all systems that supply attributes that indicate the last modification time.</p>
</li>
<li>
<p>Additionally support reading deleted entries from Active Directory.</p>
</li>
<li>
<p>Store their delta state in the Identity domain rather than in the configuration database.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_location_of_delta_state"><a class="anchor" href="#_location_of_delta_state"></a>Location of Delta State</h4>
<div class="paragraph">
<p>If a delta workflow synchronizes accounts or groups of a target system, it stores the delta state beneath the target system&#8217;s configuration folder. The DN is composed of the RDN display names of the workflow definition and the channel. For example: Windows Domain Europe / Configuration / Delta / My-Company / Target Realtime / ADS / ADS_Ident_Realtime_Delta / accounts.</p>
</div>
<div class="paragraph">
<p>If the workflow is not associated with a target system, it stores the delta state beneath the workflow root of the domain. For example: My-Company / wfRoot / Monitor / Delta / My-Company / Source Realtime / ADS / Import Users from ADS / users.</p>
</div>
<div class="paragraph">
<p>Note that delta workflows read both the attributes requested in the channel and those that are needed to issue delta searches. For LDAP systems in particular, these are the operational attributes createTimestamp and modifyTimestamp. Make sure that the bind account has sufficient access rights to read them.</p>
</div>
</div>
<div class="sect3">
<h4 id="_java_based_workflow_structure"><a class="anchor" href="#_java_based_workflow_structure"></a>Java-based Workflow Structure</h4>
<div class="paragraph">
<p>The structure of Java-based workflows is nearly always the same. The following figure illustrates this structure:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch1_applsref/image4.gif" alt="Java-based Workflow Structure">
</div>
<div class="title">Figure 4. Java-based Workflow Structure</div>
</div>
<div class="paragraph">
<p>As shown in the figure, the Java-based workflow consists of two activities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The "join" activity, which is responsible for the workflow functionality and is the productive activity.</p>
</li>
<li>
<p>The "error" activity, which is only involved if errors occur. The join activity passes request and response of a failed update request into the error channel. The workflow engine keeps these requests and re-starts the workflow with such events after a retry waiting time. The failed events are passed to the error activity only if the retry limit is reached. The error activity then usually sends e-mail to an administrator.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The workflow can either be started by an event, by a schedule or manually. It receives the events in its input channel.</p>
</div>
<div class="paragraph">
<p>Normally, the workflow synchronizes data between an Identity domain and a connected system. These items are configured as ports named "IdentityDomain" and "TS" respectively. The join activity&#8217;s controller determines the specific behavior. If configured to do so, the workflow sends e-mails using a "notify" channel with the appropriate connector, usually the mail connector.</p>
</div>
<div class="paragraph">
<p>Some workflows only work with the Identity domain and therefore need only the configuration for the "IdentityDomain" port. The User and Account Password Managers are examples. The "Event-based Resolution" workflow only works with the Identity domain and by default takes the connection from the Identity server.</p>
</div>
<div class="paragraph">
<p>The structure of a Provisioning activity is also nearly always the same, and is illustrated in the following figure:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch1_applsref/image5.gif" alt="Provisioning Activity Structure">
</div>
<div class="title">Figure 5. Provisioning Activity Structure</div>
</div>
<div class="paragraph">
<p>The controller determines the activity&#8217;s behavior and thus the complete workflow behavior. The controller is often called the "join engine". See the section "Workflow Types" for the list of controllers. In Identity Manager, when you have selected the join activity in a workflow, you can select the controller from a proposal list. This allows you to easily change the type of a workflow.</p>
</div>
<div class="paragraph">
<p>To access the Identity domain and the connected system, the controller uses the connectors configured for the port: the LDAP connector to the Identity domain and a connector that is appropriate for the type of connected system.</p>
</div>
<div class="paragraph">
<p>The activity is responsible for all entries of the connected system and the associated target system sub-tree in the Identity domain; that is, for all accounts and groups of the target system. These entries are defined via the included channels.</p>
</div>
<div class="paragraph">
<p>When configuring a provisioning port in Identity Manager, you must select a "channel parent" entry. The subtree beneath it contains all of the channels that are considered to be part of the port, as shown in the following figure.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch1_applsref/image6.gif" alt="Provisioning Ports and Channels">
</div>
<div class="title">Figure 6. Provisioning Ports and Channels</div>
</div>
<div class="paragraph">
<p>Each channel represents a type of entry in the attached system. Among other items, the channel defines the search base and search filter for identifying the entries in its export section. For more details, see the "Channels and Mapping" section.</p>
</div>
<div class="paragraph">
<p>The workflow and activity structure for cluster workflows is the same as for single systems. They simply use the appropriate type of cluster controller. The following figure illustrates this structure:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch1_applsref/image7.gif" alt="Cluster Workflow and Activity Structure">
</div>
<div class="title">Figure 7. Cluster Workflow and Activity Structure</div>
</div>
<div class="paragraph">
<p>The workflow is configured for a default connected system. When the workflow is started, the controller reads the configuration data for the actual connected system from the appropriate target system entry:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the workflow has been triggered by an event, it searches the target system entry to which the changed account or group belongs. The target system entry contains address and binding information for the connected system as well as other options used for mapping. The controller reads this data and updates the connector configuration and environment properties accordingly.</p>
</li>
<li>
<p>If the workflow has been started by a schedule or manually, the start request contains attributes to identify the target system that needs to be provisioned. This information allows the controller to find the target system entry and read and update the configuration data as previously described.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that the structure for cluster target systems is fixed:</p>
</div>
<div class="paragraph">
<p>Target Systems &#8594; <em>cluster_container</em> &#8594; <em>cluster</em> &#8594; <em>target_system</em></p>
</div>
<div class="paragraph">
<p>Cluster containers can only reside at the top level directly between the node cn=Target Systems. This is due to performance aspects. It allows the software to find the related object descriptions of a cluster at a fixed place. No costly evaluation of tree nodes is necessary.</p>
</div>
<div class="paragraph">
<p>For details about how to configure clustered workflows, see the chapter "Creating Cluster Target Systems" in this guide or the chapter "Cluster Workflows" in the <em>DirX Identity Connectivity Administration Guid</em>e.</p>
</div>
<div class="paragraph">
<p><strong>Change Events:</strong></p>
</div>
<div class="paragraph">
<p>After the join engine has changed an entry in the Identity domain, it sends change events depending on the configuration.</p>
</div>
<div class="paragraph">
<p>It searches the appropriate active attribute policy using the object type configured in the channel. It uses the same object type to find the audit policy. If the attribute policy flag for sending events is set, the join engine sends a change event using the JMS connector in the event port. The join engine builds the event topic as it does other events: values for type, cluster and resource are prefixed with a value that indicates the type of the event. In this case, the join engine uses the prefix "dxm.event" to distinguish it from a provisioning request event that starts a synchronization workflow.</p>
</div>
<div class="paragraph">
<p>If the event is for a target system account or a group, the values for type cluster and resource are taken from the respective attribute of the target system entry. This action allows for different workflows for each target system.</p>
</div>
<div class="paragraph">
<p>For other types of objects (such as users, roles, and organizations), the type is the object description name of the changed object, the cluster is the server name where the Identity domain resides and the resource is the domain name.</p>
</div>
<div class="paragraph">
<p>This event is to be processed by the event workflow responsible for this type of object and if appropriate for the target system.</p>
</div>
<div class="paragraph">
<p>Note that for performance reasons, Java-based workflows do not take attribute policies into account.</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="paragraph">
<p>The join engine writes audit logs for each update operation both at the Identity and at the connected system side. If the audit flag in the port configuration is set, the join engine searches the appropriate audit policy for the given object type. It includes the configured identifying attributes into the record and passes it through the audit channel (which is always internally configured) to the audit log listener(s).</p>
</div>
</div>
<div class="sect3">
<h4 id="_controller_types"><a class="anchor" href="#_controller_types"></a>Controller Types</h4>
<div class="paragraph">
<p>DirX Identity supports a set of different Java-based workflow types. The type of a workflow is determined by the controller of the join activity (see the section "Workflow Structure"). These controllers can be divided into the following categories:</p>
</div>
<div class="paragraph">
<p>Target System Provisioning (single system)</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Sync2TS (event-based)</strong> - an event-based synchronization from the Identity Store to a connected system and backwards.</p>
</li>
<li>
<p><strong>Sync2TS (scheduled)</strong> - a scheduled synchronization from the Identity Store to a connected system and backwards.</p>
</li>
<li>
<p><strong>SyncOneWay2TS (event-based)</strong> - an event-based synchronization from the Identity Store to a connected system.</p>
</li>
<li>
<p><strong>SyncOneWay2TS (scheduled)</strong> - a scheduled synchronization from the Identity Store to a connected system.</p>
</li>
<li>
<p><strong>SyncOneWay2Identity (scheduled)</strong> - a scheduled synchronization from a connected system to the Identity Store. Note that there is no event-based synchronization when using the <strong>SyncOneWay2Identity</strong> controller.</p>
</li>
<li>
<p><strong>SyncOneWay (event-based)</strong> - an event-based synchronization from the Identity Store to a connected system. Note that this controller is only available for compatibility reasons; it has been replaced by <strong>SyncOneWay2TS</strong>.</p>
</li>
<li>
<p><strong>SyncOneWay (scheduled)</strong> - a scheduled synchronization from the Identity Store to a connected system. Note that this controller is only available for compatibility reasons; it has been replaced by <strong>SyncOneWay2TS</strong>.</p>
</li>
<li>
<p><strong>Validation (scheduled)</strong> - a scheduled validation from a connected system to the Identity Store. Note that this controller works in mode <strong>InitialLoad</strong> as long as the <strong>Last Validation</strong> date field in the <strong>General</strong> tab of the target system object is empty. After a run, this field is updated and the next run performs a <strong>Validation</strong>. A run in Validation mode means that changes are reported in ToDo fields.</p>
</li>
<li>
<p>FullImport (scheduled) - a scheduled workflow from a connected system to the Identity Store.</p>
</li>
<li>
<p>RestoreTS (scheduled) - a scheduled workflow that restores a connected system from Identity Store.</p>
</li>
<li>
<p><strong>FullSyncToHistoryDB</strong> (scheduled) - a controller for a scheduled workflow that synchronizes all entries of a configured type from Identity Store to the DirX Audit History Database.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Clustered Target System Provisioning</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ClusterSynchronization - a workflow that synchronizes clusters of target systems from Identity Store to connected systems and backwards. It can be started by a scheduled or triggered by a change event.</p>
</li>
<li>
<p>ClusterValidation - a workflow that validates clusters of connected systems into Identity Store.</p>
</li>
<li>
<p><strong>ClusterRestoreTS</strong> - a workflow that can restore clusters of connected systems from Identity Store.</p>
</li>
<li>
<p><strong>ClusterSyncOneWay2Identity</strong> - a workflow that synchronizes clusters of connected systems into Identity Store.</p>
</li>
<li>
<p><strong>ClusterSyncOneWay2TS</strong> - a workflow that synchronizes clusters of target systems from Identity Store to connected systems.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Password Synchronization</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>UserPasswordEventManager -</strong> a workflow that accepts password changes from Windows domain accounts or from Web Center, updates them at the Identity users and requests password changes for each affected account.</p>
</li>
<li>
<p><strong>PwdExpiration</strong> - a workflow that checks for expired account passwords and generates new ones in case the workflow runs scheduled. In the event-based situation it accepts account password changes from Web Center and changes the given account password.</p>
</li>
<li>
<p><strong>PwdReset</strong> - a scheduled workflow that can be configured for privileged or for personal accounts by setting the respective search filter. If configured for privileged accounts it generates a new password for every privileged account and sets it at the account. If configured for personal accounts it reads the password from the associated user and sets it at the account.</p>
</li>
<li>
<p><strong>PwdUserExpiration</strong> - a scheduled workflow that sends notification messages to users whose passwords are about to expire.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Target System Delta Provisioning (single system)</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>DeltaSyncOneWay2TS</strong> (scheduled) - a scheduled synchronization from the Identity Store to a connected system. The controller searches only for the entries that were changed since the previous run.</p>
</li>
<li>
<p><strong>DeltaSynchronization</strong> (scheduled) - a scheduled synchronization from the Identity Store to a connected system and backwards. The controller searches only for the entries that were changed since the previous run.</p>
</li>
<li>
<p><strong>DeltaSyncOneWay2Identity</strong> (scheduled) - a scheduled synchronization from a connected system to the Identity Store. The controller searches only for the entries that were changed since the previous run. Note that there is no event-based synchronization with this controller.</p>
</li>
<li>
<p><strong>DeltaSyncToHistoryDB</strong> (scheduled) - a controller for a scheduled workflow that synchronizes all entries of a configured type from Identity Store to the DirX Audit History Database. The controller searches only for the entries that were changed since the previous run.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Clustered Target System Delta Provisioning</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>DeltaClusterSynchronization</strong> (scheduled) - a workflow that synchronizes clusters of target systems from Identity Store to connected systems and backwards. It searches only for the entries that were changed since the previous run.</p>
</li>
<li>
<p><strong>DeltaClusterSyncOneWay2TS</strong> (scheduled) - a scheduled synchronization from the Identity Store to a cluster of connected systems. The controller searches only for the entries that were changed since the previous run.</p>
</li>
<li>
<p><strong>DeltaClusterSyncOneWay2Identity</strong> (scheduled) - a scheduled synchronization from a cluster of connected systems to the Identity Store. The controller searches only for the entries that were changed since the previous run.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Maintenance Workflows</p>
</div>
<div class="paragraph">
<p>Maintenance workflows apply rules on changed entries in the Identity domain. Their actions depend on the type of the changed entry and on the changes notified in the event:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Event-based User Resolution</strong> - a workflow that operates on changes to a DirX Identity user. It analyzes the changes and either performs a complete user resolution, updates attributes of the associated accounts or does nothing, if none of the critical attributes have been changed.</p>
</li>
<li>
<p><strong>Business Objects (such as Organization, Organizational Unit and Context)</strong> - workflows that apply the consistency rules whose filters match the entry attributes, check for broken links to and from the entry and update associated users.</p>
</li>
<li>
<p><strong>Generic Event Controller</strong> - allows configuring event-based processing workflows for custom objects.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It does not make sense to start maintenance workflows manually or by a schedule because they only handle events.</p>
</div>
<div class="paragraph">
<p>Note that workflows that are marked as scheduled can also be started in Identity Manager and operate as if they were started by a schedule.</p>
</div>
<div class="paragraph">
<p>Target System Synchronization Controllers</p>
</div>
<div class="paragraph">
<p>The Sync2TS controller provisions entries of the target system in the Identity domain to the connected system and synchronizes their state back to the Identity domain. The operation depends on whether it is called via an event or a schedule. The following figure illustrates the processing:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch1_applsref/image8.gif" alt="Sync2TS Controller Processing">
</div>
<div class="title">Figure 8. Sync2TS Controller Processing</div>
</div>
<div class="paragraph">
<p>As illustrated in the figure:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The event contains the DN of the changed entry in the DirX Identity domain.</p>
</li>
<li>
<p>The join engine reads this entry. Based on the DN or on other read attributes, it selects the appropriate channel. If no event is given, the join engine assumes it was started by a schedule or manually. It then performs a search evaluating the configuration in the &lt;export&gt; section. Then it processes the entries of the search result one by one the same way as it does in the event case. Note that in this case the channel sequence is determined by the sequence numbers of the destination channels, in this case the channels attached to the connected system.</p>
</li>
<li>
<p>The join engine searches the joined entry using the join conditions of the corresponding channel. The join conditions are performed one after the other until a single entry has been found. The join engine evaluates the join conditions in the following way: if the join condition defines a search base, then that object is read; if the join condition defines an SPML filter, then that filter is used and is combined with the search base defined in the &lt;export&gt; section. Depending on the search result, the join engine provides the (default) entry operation for the mapping step: ADD if no entry has been found), MODIFY if an entry has been found.</p>
</li>
<li>
<p>The join engine performs mapping and builds an add, modify or delete request depending on the mapping result. It updates the joined entry or creates a new one by passing this request to the connector.</p>
</li>
<li>
<p>The join engine reads the updated entry again using the returned entry identifier for backward synchronization and to retrieve attributes that were indirectly set by the connected system.</p>
</li>
<li>
<p>The join engine performs mapping for the other backward direction using the configuration of the channel attached to the Identity domain.</p>
</li>
<li>
<p>Depending on the mapping result, the join engine builds an add or modify request and updates the entry in the Identity domain.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note that the Sync2TS controller is also used to synchronize passwords to the connected system (and optionally back to IdentityStore). If the topic of the incoming event starts with either "dxm.setPasswordRequest." or "&lt;Domain&gt;.dxm.setPasswordRequest." then passwords are synchronized to the connected system and optionally password relevant attribute information is synchronized back to IdentityStore. If the password channel on Identity side is missing then synchronisation is done only to the connected system; otherwise synchronisation is done both ways.</p>
</div>
<div class="paragraph">
<p>No other attributes than defined in account or group channels are synchronized.</p>
</div>
<div class="paragraph">
<p>Target System Validation Controller</p>
</div>
<div class="paragraph">
<p>The validation controller performs a target system validation against the content of the target system representation in the Identity Store. The following figure shows the processing:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch1_applsref/image9.gif" alt="Validation Controller Processing">
</div>
<div class="title">Figure 9. Validation Controller Processing</div>
</div>
<div class="paragraph">
<p>As shown in the figure, the validation controller performs the following actions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Searches the entries in the connected system by constructing a search request for each channel based on the channel&#8217;s &lt;export&gt; section. The channel sequence is determined by the sequence numbers of the destination channels, in this case the channels attached to the target system in the DirX Identity domain. Let&#8217;s assume the account channel in DirX Identity has sequence number 1, because the membership references are stored in the groups. In this case, the corresponding channel in the connected system - the one for the users - is searched first. When all entries of the result are processed, the controller issues the search for the next channel (here, the groups) and processes them.</p>
</li>
<li>
<p>Evaluates the join conditions of the DirX Identity channel and searches the joined entry. (For details on evaluation of the join condition see step 3 of "Sync2TS" controller above.)</p>
</li>
<li>
<p>Performs the mapping configured in the DirX Identity channel, constructs the appropriate request (add, modify or delete) and passes it to the LDAP connector for updating the joined entry in the DirX Identity domain.<br></p>
<div class="paragraph">
<p>The validation controller deletes entries in the Identity domain that have no corresponding entry in the connected system. In order to identify these entries, the validation controller uses two different algorithms that depend on the definition of the sort attribute in the &lt;export&gt; section:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a <strong>sort attribute</strong> is configured at both sides, the controller searches both the source and the destination. It processes the source search result entries one by one, and:</p>
</li>
<li>
<p>If the source entry matches the next destination entry according to the join conditions, it considers this entry the joined entry and updates it. Then it continues with next source entry and next destination entry.</p>
</li>
<li>
<p>If the source entry&#8217;s sort attribute is lexicographically smaller than the destination entry&#8217;s sort attribute, it assumes that the destination entry needs to be created. Then it continues with the next source entry.</p>
</li>
<li>
<p>If the source entry is lexicographically greater than the destination entry, the controller assumes that the destination entry needs to be deleted. It either issues a delete request for the destination entry or delegates the task to the user hook according the user hook&#8217;s response to the "getCallDelete()" method. The controller then continues by comparing current the source entry with the next destination entry.</p>
</li>
<li>
<p>When there are still source entries available and all destination entries have been processed, then all these remaining source entries will be created (after having performed the appropriate mappings).</p>
</li>
<li>
<p>When there are still destination entries available and all source entries have been processed, then all these remaining destination entries need to be deleted. (For details on deletion algorithm look at the previous steps.)</p>
</li>
<li>
<p>In <strong>all other cases</strong>, the controller first searches for all identifiers of the destination and stores them in a map. Then, it exports the source entries and joins one after the other in the destination:</p>
</li>
<li>
<p>If no matching entry is found, the entry will be created in the destination.</p>
</li>
<li>
<p>If a matching entry is found, the entry is eventually modified and the joined entry is deleted from the map.</p>
</li>
<li>
<p>In the end, only the entries that have no corresponding source entries remain in the map. The validation controller either deletes them itself or delegates this task to the user hook.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note:</p>
</div>
<div class="paragraph">
<p>As a consequence of the algorithms described above, you should configure a Sort Attribute if you configure Paged Read in a channel&#8217;s &lt;export&gt; section. This configuration enables the validation controller to process the entries page by page rather than having to read all pages first into memory before starting the comparison algorithm. As a result, Paged Read, which especially makes sense for large search results, performs in an optimal way if a Sort Attribute is configured, too. Also keep in mind to configure an appropriate size limit at the LDAP Server for the complete search result even if you choose Paged Read.</p>
</div>
<div class="paragraph">
<p>a. Full Import Controllers</p>
</div>
<div class="paragraph">
<p>The "full import" controller performs a full import from a connected system into DirX Identity. Its operation is identical to the validation controller with one exception: the validation controller updates the "last validation date" at the target system when the job is finished. In other words, full import is the same as initial load with respect to a connected system. Full import can be used not only for connected systems with accounts and groups, but also for all types of systems and objects, especially for importing users.</p>
</div>
<div class="paragraph">
<p>b. Restore Target System Controller</p>
</div>
<div class="paragraph">
<p>The "restore target system" controller restores a connected system with the entries stored in the Identity Store after a crash of the connected system. The controller works like the "full import" controller, but from the Identity Store to the connected system. It should be started by a schedule or (preferably) by hand using Identity Manager. It exports all entries of the "IdentityDomain" port and imports them into the connected system. It deletes entries in the connected system that have no representative in the Identity Store.</p>
</div>
<div class="paragraph">
<p>Note: if you don’t want objects that do not have a representative in the Identity Store to be deleted in the connected system, you should use the Sync-One-Way-2-TS Controller, which only adds or modifies objects. We recommend using this controller first when going productive to test if your environment and your mapping are correct before using the Restore Target System Controller.</p>
</div>
<div class="paragraph">
<p>c. Sync-One-Way Controller / Sync-One-Way-2-TS Controller</p>
</div>
<div class="paragraph">
<p>The "sync-one-way" controller synchronizes entries from the Identity Store to the connected system. Its operation differs from the "Restore" controller in that it does not delete entries that were deleted in the Identity Store. Its operation differs from the "Sync2TS" controller in that it does not synchronize the changes back from the connected system to Identity Store: it works only "one-way".</p>
</div>
<div class="paragraph">
<p>d. Sync-One-Way-2-Identity Controller</p>
</div>
<div class="paragraph">
<p>The "sync-one-way-2-identity" controller synchronizes entries from the connected system to the connected system. Its operation differs from the "FullImport" controller in that it does not delete entries that were deleted in the connected system, and it does not update the “last validation date”. Its operation differs from the "Sync2TS" controller in that it does not synchronize the changes back from the Identity Store to the connected system: it works only "one-way".</p>
</div>
<div class="paragraph">
<p>e. Cluster Synchronization Controller</p>
</div>
<div class="paragraph">
<p>The "cluster synchronization" controller is like the "Sync2TS" controller except that it serves not only one target system, but a cluster of them. The appropriate workflows accept change events for a target system, but can also be started by a schedule or manually by Identity Manager.</p>
</div>
<div class="paragraph">
<p>When started by a schedule or by hand, the workflow expects the DN of the target system, its type, cluster and domain attributes as start parameters. The controller reads the connector configuration and the environment properties from the target system entry, opens the target system connector with the new configuration data and provisions the entries of the Identity Store to the connected system exactly the same way as the "Sync2TS" controller.</p>
</div>
<div class="paragraph">
<p>When started by a change event, the controller finds the target system by evaluating the event topic: The topic contains the type, domain and cluster attributes of the target system.</p>
</div>
<div class="paragraph">
<p>f. Cluster Validation Controller</p>
</div>
<div class="paragraph">
<p>The "cluster validation" controller is like the normal "validation" controller except that it serves not only one target system, but a cluster of them. For more details on cluster handling, see the Cluster Synchronization Controller.</p>
</div>
<div class="paragraph">
<p>g. Cluster Restore TS Controller</p>
</div>
<div class="paragraph">
<p>The "cluster restore" controller is like the normal "restore target system" controller except that it serves not only one target system, but a cluster of them. For more details on cluster handling, see the Cluster Synchronization Controller.</p>
</div>
<div class="paragraph">
<p>h. Password Reset TS Controller</p>
</div>
<div class="paragraph">
<p>The "password reset TS" controller resets the passwords of the accounts of a DirX Identity target system. If the workflow is configured for personal accounts, it reads the password from the user and sets it at the account. If it is configured for privileged accounts, it generates a new password and sets it at the account. For each change, it sends a change event that triggers the password synchronization workflow to update the password at the connected system. The controller does not handle change events.</p>
</div>
<div class="paragraph">
<p>i. Password Expiration Controller</p>
</div>
<div class="paragraph">
<p>The "password expiration" controller checks for expired passwords of privileged accounts in DirX Identity. The controller searches for passwords that are going to expire according to the configured filter. The number of days before expiration is configurable. The controller generates a new password, sets it at the account and sends the change event to trigger the password synchronization workflow. The controller does not handle change events.</p>
</div>
</div>
<div class="sect3">
<h4 id="_channels_and_mapping"><a class="anchor" href="#_channels_and_mapping"></a>Channels and Mapping</h4>
<div class="paragraph">
<p>The channel configuration specifies how to find entries in the attached system and how to map them to corresponding system.</p>
</div>
<div class="paragraph">
<p>A channel is always attached to a connected directory, which represents either a connected system or a target system sub-tree in an Identity domain. We differentiate between a number of channel types, as shown in the following figure.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch1_applsref/image10.gif" alt="Channel Types">
</div>
<div class="title">Figure 10. Channel Types</div>
</div>
<div class="paragraph">
<p>As shown in the figure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Main or <strong>primary channels</strong> represent the entries of a certain type, typically accounts or groups. They have a reference to the corresponding channel, which represents the entries at the other system. Typically, an accounts channel for the Identity domain has a corresponding channel for the users in the connected system. The same holds for groups.</p>
</li>
<li>
<p><strong>Member channels</strong> represent the account-group memberships. In order to support "cross-membership" scenarios (for more details, see the section<br>
"Cross Memberships"), the attributes that hold the membership information (for example, for LDAP: attribute "members") are separated and managed in the member channel. The member channel is referenced from one of the primary channels, which indicates that the membership attributes are stored in the primary entry. The member channel also has a corresponding channel that may be attached to another primary channel that is not the corresponding channel of the source. This relationship defines a "cross-memberships" scenario, where members are stored in groups at one side and in users at the other.</p>
</li>
<li>
<p><strong>Password channels</strong> represent the password-related attributes of an entry type; that is, of users and accounts. These attributes include the attribute that stores the password (for example, "userPassword" for LDAP systems), and can include additional ones, especially for password reset information. The password channel references the primary channel for the entry that holds its attributes. Separating the password attributes from the normal ones allows the join engine to identify the attributes to be updated upon password change events. The password channel on Identity side is an optional one and will be used when synchronizing password relevant attribute information from Connected System back to IdentityStore.</p>
</li>
<li>
<p><strong>Secondary channels</strong> are mainly intended for relational database systems, which store entry attributes in several joined tables. Each secondary channel has a reference to its primary channel. When reading an entry from the attached system, the join engine also reads the attributes from the secondary channel(s). As a result, it needs some information from the schema of the database:</p>
</li>
<li>
<p>The storage location of the reference between primary and secondary channel</p>
</li>
<li>
<p>The attributes that hold the reference in the source and which are referenced in the destination</p>
</li>
<li>
<p>The type of relationship: 1-to-1, 1-to-many.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The channel configuration is separated into the following sections:</p>
</div>
<div class="paragraph">
<p><strong>Export</strong>: Defines the elements to search the entries in the attached system, usually search base, search filter and scope (for hierarchical systems). Furthermore, the controller can be advised to perform a paged search (with page size, time limit, etc.). You should only activate this option if the appropriate connectors support this functionality.</p>
</div>
<div class="paragraph">
<p><strong>Delta</strong>: The settings here are only evaluated by delta controllers. You have two options here:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Extend the search filters in order to obtain only the changed entries since the last change. This option can be applied to any connector and any connected system that supports attributes representing the creation and or modification time. Typical samples are LDAP servers with the attributes “createTimestamp” and “modifyTimestamp”. You just need to supply the list of attributes containing the creation or modification time.</p>
</li>
<li>
<p>This option, called the “Expert Operational Attributes”, is only for special connectors that explicitly support delta handling. The most important sample is the Active Directory connector. It is able to not only obtain the changed entries, but also those, which were deleted since the last export. In this case you just need to select the “Expert Operational Attributes” option and enter a fixed XML String containing the value “${LastDeltaValue}” for the operational attribute “dxm.delta”.<br>
<br>
For more information about the specific aspects when selecting this option for the Active Directory Delta Workflow see "Using the Target System (Provisioning) Workflows &#8594; Understanding Java-based target System Workflows - &gt; Active Directory (ADS) Workflows &#8594; Customizing the ADS Workflows &#8594; Delta Workflows" in this guide</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Join</strong>: Specifies a number of join conditions that the join engine is to evaluate when it tries to find the joined entry in the destination, given an entry from the source system. The conditions are applied one after the other. If any one condition leads to exactly one resulting entry in the search, the join engine considers this to be the joined entry. Otherwise, it evaluates the next one in the list. You have two options for formulating a join condition:</p>
</div>
<div class="paragraph">
<p>Specify a <strong>search base</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;searchBase type="..."&gt;&lt;spml:id&gt;${source.dxrPrimaryKey}&lt;/spml:id&gt;&lt;/searchBase&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The join engine in the search request replaces the search base defined in the export section with this one. This option is appropriate if you know the identifier from the source entry. You can use placeholders for referencing attributes of the source, the target entry or the environment. In case of a target entry, the mapping for this attribute is performed.</p>
</div>
<div class="paragraph">
<p>Specify a <strong>filter extension</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;filterExtension&gt;&lt;dsml:equalityMatch name="..."&gt;&lt;dsml:value&gt;...</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the search request, the join engine extends the filter given in the export section with this term by "and-ing" the given conditions. For the values, you can use the same placeholders as mentioned above and in attribute mapping in general.</p>
</div>
<div class="paragraph">
<p><strong>Import</strong>: The import section specifies some options that are evaluated when the join engine creates, updates or deletes an entry in the attached system. In particular, you can define, if a notification is to be sent, when an entry is created or deleted.</p>
</div>
<div class="paragraph">
<p><strong>Mapping</strong>: The mapping section contains the mapping for all attributes of the destination system when a source entry is to be updated / imported at the attached system. You have several options for specifying the mapping, ranging from direct mapping to simple expressions with placeholders to Java mapping classes. You can even specify a post mapping that is called after all the attribute mappings. For details, see the help page on the channel and the customization chapter for Java attribute mapping.</p>
</div>
<div class="paragraph">
<p><strong>Operational Attributes</strong>: A list of so-called "operational attributes" can be passed to the connector with each request. This list depends on the connector. In most cases, you can ignore them.</p>
</div>
</div>
<div class="sect3">
<h4 id="_cross_memberships"><a class="anchor" href="#_cross_memberships"></a>Cross-Memberships</h4>
<div class="paragraph">
<p>In most applications and systems, user-group memberships are stored at the group. This is typical for LDAP and Active Directory systems: users are members in groups. Scenarios with large groups may face performance problems: the long member lists often must be read and updated. Storing the memberships at the user would normally be much faster.</p>
</div>
<div class="paragraph">
<p>You cannot change how memberships are stored at existing connected systems. But you can change it for the accounts and groups in a DirX Identity target system. If the flag "Reference group from account" is checked, group memberships are stored in the attributes of an account. You can easily change this setting, but you must make sure that the Provisioning workflow is configured consistently.</p>
</div>
<div class="paragraph">
<p>Memberships are Stored in Groups at Both Sides</p>
</div>
<div class="paragraph">
<p>At the DirX Identity target system entry, the flag "Reference group from account" is not checked.</p>
</div>
<div class="paragraph">
<p>In the workflow configuration, the channel "members" is set as the member channel of the groups channel for both connected directories. Make sure that the groups are synchronized after the accounts / users by setting the "Export Sequence Number" to "2" in the groups channels and to "1" in the accounts channels.</p>
</div>
<div class="paragraph">
<p>Memberships are Stored in the Account or User at Both Sides</p>
</div>
<div class="paragraph">
<p>At the DirX Identity target system entry, the flag "Reference group from account" is checked.</p>
</div>
<div class="paragraph">
<p>In the workflow configuration, the channel "members" is set as the member channel of the accounts channel for both connected directories. Make sure that the accounts are synchronized after the groups by setting the "Export Sequence Number" to "2" in the accounts channels and to "1" in the groups channels.</p>
</div>
<div class="paragraph">
<p>Cross-Membership Scenario</p>
</div>
<div class="paragraph">
<p>When the memberships are stored at the accounts in DirX Identity and at the groups in the connected system we call this a "cross-membership" scenario.</p>
</div>
<div class="paragraph">
<p>At the DirX Identity target system entry the flag "Reference group from account" is checked. If in the connected system the identifier of the user is not used as reference in the group, we need to set the attribute "Source for referenced property" at the target system: Set the attribute name of the user, which is used in the member attribute of the group in the connected system. For a Lotus Notes system this would be the "fullname". For LDAP and Active Directory systems it is the DN, which is also used as identifier in mapping: Hence you can leave this attribute empty.</p>
</div>
<div class="paragraph">
<p>In the workflow configuration, the channels must be handled differently:</p>
</div>
<div class="paragraph">
<p>For the connected directory representing the DirX Identity target system, the channel <strong>members</strong> must be assigned as the member channel in the <strong>General</strong> tab of the accounts channel and must be de-assigned at the group channel. The accounts must be imported after the groups. Therefore, the "Export Sequence Number" in the accounts channel must be set to "2" and that of the groups channel must be set to "1".</p>
</div>
<div class="paragraph">
<p>For the connected directory representing the connected system, it is the other way around: The groups must be imported after the users / accounts. Therefore, the "Export Sequence Number" in the accounts channel must be set to "1" and that of the groups channel must be set to "2". Also regarding the members channel assignment the default setting - members channel is assigned at the groups channel - can be left.</p>
</div>
</div>
<div class="sect3">
<h4 id="_starting_java_based_workflows"><a class="anchor" href="#_starting_java_based_workflows"></a>Starting Java-based Workflows</h4>
<div class="paragraph">
<p>Java-based workflows are started:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>as the result of an event sent because of an object change</p>
</li>
<li>
<p>regularly by a schedule</p>
</li>
<li>
<p>manually in Identity Manager</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The next sections provide more information about these start-up methods.</p>
</div>
<div class="sect4">
<h5 id="_event_based_workflows"><a class="anchor" href="#_event_based_workflows"></a>Event-Based Workflows</h5>
<div class="paragraph">
<p>Conceptually, we distinguish between the following types of event-based workflows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Provisioning workflows, which provision accounts and groups to a connected system.</p>
</li>
<li>
<p>Password change workflows, which receive password changes of a user or a privileged account and update them in the Identity domain and in the user&#8217;s associated accounts in connected systems as necessary.</p>
</li>
<li>
<p>Event-based maintenance workflows, which are started when an entry (such as a user, a role, or an organizational unit) within the Identity domain is changed. They determine the changes that must be made to the entry itself or to associated entries within the domain. Typical reasons for such changes are provisioning or consistency rules that must be applied.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Provisioning Workflows</p>
</div>
<div class="paragraph">
<p>Typically <strong>account or group changes</strong> trigger a real-time workflow, as illustrated in the following figure.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch1_applsref/image11.gif" alt="Event-Triggered Provisioning Workflow">
</div>
<div class="title">Figure 11. Event-Triggered Provisioning Workflow</div>
</div>
<div class="paragraph">
<p>Suppose a manager at Web Center or Identity Manager assigns a role to a user. DirX Identity resolves the resulting access rights, creates an account in the Identity Store, puts it into the member list of a group and sends two change events: one for the account, and one for the group. A workflow associated with the target system receives the events and synchronizes the changes in Identity Store with the connected system.</p>
</div>
<div class="paragraph">
<p>The same process occurs as result of a <strong>request workflow</strong>. Usually, the last activity in an approval or object creation workflow is the "apply change" activity. It stores the changes requested in the workflow and sends the same change events for accounts and groups as in the previous scenario.</p>
</div>
<div class="paragraph">
<p>Note that DirX Identity sends the changes only if the flag "Enable Real-time Provisioning" is set to active.</p>
</div>
<div class="paragraph">
<p>Password Workflows</p>
</div>
<div class="paragraph">
<p>Real-time provisioning workflows are also involved in <strong>password changes</strong>. A typical scenario is illustrated in the following figure.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch1_applsref/image11.gif" alt="Password Change Workflow">
</div>
<div class="title">Figure 12. Password Change Workflow</div>
</div>
<div class="paragraph">
<p>Assume that a user changes her password in the Windows domain. the DirX Identity Windows Password Listener captures the new password at the domain controller and sends an appropriate change event. The "User Password Event Manager" receives the event, searches the Windows account and then the user entry and updates the password in the Identity Store. Then it finds all accounts of the user for which password synchronization is enabled (see the flag at the target system entry) and sends messages that request the password change at the connected systems. These requests are handled by a "set password" workflow. It takes the new password and if required, the current password out of the message and updates them at the connected system.</p>
</div>
<div class="paragraph">
<p>Nearly the same process occurs if the user changes her password with Web Center. The "User Password Event Manager" workflow finds the user directly with the DN given in the event, updates the password and sends the change requests for the accounts.</p>
</div>
<div class="paragraph">
<p>A user can also use Web Center to change the password of a privileged account. Web Center sends a password change event for the account, which is processed by the "Account Password Manager" workflow. It updates the password at the account in the Identity Store and sends the same password change request as in the previous scenarios to update the password at the connected system.</p>
</div>
<div class="paragraph">
<p>Event-based Maintenance Workflows</p>
</div>
<div class="paragraph">
<p>The maintenance workflows work only with the DirX Identity domain. They are invoked when a domain entry is created or changed, not only accounts or groups but also users, roles, permissions and business objects. Their processing depends upon the entry type, but typically they apply provisioning and consistency rules and check for broken links. The following figure illustrates maintenance workflow operation.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch1_applsref/image13.gif" alt="Event-based Maintenance Workflow">
</div>
<div class="title">Figure 13. Event-based Maintenance Workflow</div>
</div>
<div class="paragraph">
<p>The workflows are triggered by a change event that is published by a number of sources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Web Center, Identity Manager</p>
</li>
<li>
<p>Provisioning Web Service clients</p>
</li>
<li>
<p>Import workflows, both Tcl-based and Java-based workflows</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The client publishes a change event for an entry if the corresponding entry type is activated in the domain&#8217;s event policy. The message topic includes the entry type, which allows the IdS-J server to invoke the appropriate maintenance workflow. The workflow analyzes the changed attributes and performs several maintenance tasks depending on the entry type. For example, the user maintenance workflow:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Applies consistency rules.</p>
</li>
<li>
<p>Checks for broken links.</p>
</li>
<li>
<p>Applies provisioning rules, if their filters match the user attributes.</p>
</li>
<li>
<p>Resolves the user and updates the accounts, if a permission parameter has been changed.</p>
</li>
<li>
<p>Updates account attributes, if an attribute has been changed that matches a list of configured names or wildcards.</p>
</li>
<li>
<p>Ignores the event, if none of the above conditions applies.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If in the course of a user resolution an account or a group is modified, the workflow publishes a provision request that triggers a provisioning workflow.</p>
</div>
</div>
<div class="sect4">
<h5 id="_scheduled_workflows"><a class="anchor" href="#_scheduled_workflows"></a>Scheduled Workflows</h5>
<div class="paragraph">
<p>You can also define schedules for Java-based workflows. The IdS-J workflow scheduler starts the workflow at the scheduled times.</p>
</div>
<div class="paragraph">
<p>A scheduled workflow operates a little bit differently from the way it operates when triggered by an event. It synchronizes all entries from the source to the destination system. For a synchronization workflow, this means that the workflow reads all accounts and groups from Identity Store and updates them one after the other at the connected system.</p>
</div>
<div class="paragraph">
<p>If you want to define a schedule for cluster workflows (which can provision a set or cluster of homogeneous connected systems), you must specify a search filter for all target systems to be provisioned according this schedule. For each target system, the scheduler starts a workflow instance that provisions only the accounts and groups of this system.</p>
</div>
<div class="paragraph">
<p>Note that starting a real-time workflow manually or on a schedule may not make sense for all types of workflows. This is especially true for</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maintenance workflows: they only process events.</p>
</li>
<li>
<p>Password workflows: they require the new password in the event message.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_starting_a_workflow_manually"><a class="anchor" href="#_starting_a_workflow_manually"></a>Starting a Workflow Manually</h5>
<div class="paragraph">
<p>You can also start a workflow manually in Identity Manager in one of two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the Connectivity configuration, select a Java-based workflow and start it from the context menu. The workflow works as if started by a schedule and provisions the entire target system.</p>
</li>
<li>
<p>In the Identity domain, choose a target system and from the context menu, select Connectivity, then the workflow, and then start the workflow. This method is especially appropriate for cluster workflows: they process only the entries of this target system.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that starting a real-time workflow manually or on a schedule may not make sense for all types of workflows. This is especially true for</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maintenance workflows: they only process events.</p>
</li>
<li>
<p>Password workflows: they require the new password in the event message.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_customizing_java_based_workflows"><a class="anchor" href="#_customizing_java_based_workflows"></a>Customizing Java-based Workflows</h3>
<div class="paragraph">
<p>This section describes how to customize the default set of Java-based workflows provided with DirX Identity. It explains how to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Configure and implement user hooks</p>
</li>
<li>
<p>Create complex mapping functions with Java classes</p>
</li>
<li>
<p>Test real-time workflow mapping</p>
</li>
<li>
<p>Create connector filters that intercept calls to connectors</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_using_user_hooks"><a class="anchor" href="#_using_user_hooks"></a>Using User Hooks</h4>
<div class="paragraph">
<p>User hooks are extensions made by customers to DirX Identity common code that are independent of this code and which therefore do not change with product updates. The DirX Identity default application code is divided into common code (control and central scripts that can change with product updates) and user hooks (customer routines that are protected from product updates).</p>
</div>
<div class="paragraph">
<p>User hooks in a Provisioning workflow are called at various phases while synchronizing a source entry into a destination system. They can</p>
</div>
<div class="paragraph">
<p>Read the source entry, the joined entry and the mapped entry</p>
</div>
<div class="paragraph">
<p>Change the mapped entry</p>
</div>
<div class="paragraph">
<p>Have access to the source and destination systems via the connectors.</p>
</div>
<div class="paragraph">
<p>There are two types of user hook:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A global user hook, which applies to the whole activity</p>
</li>
<li>
<p>A channel user hook, which applies to the entries associated with a channel</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following figure illustrates user hooks.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch1_applsref/image14.gif" alt="User Hooks">
</div>
<div class="title">Figure 14. User Hooks</div>
</div>
<div class="paragraph">
<p>As illustrated in the figure, you can have different user hooks when importing</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an account into Identity domain</p>
</li>
<li>
<p>a user into a connected system</p>
</li>
<li>
<p>a group into a connected system</p>
</li>
<li>
<p>a group into Identity domain.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This section describes how to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Configure a user hook</p>
</li>
<li>
<p>Implement a global user hook</p>
</li>
<li>
<p>Implement a channel user hook</p>
</li>
<li>
<p>Implement a user hook for e-mail notifications.</p>
</li>
<li>
<p>Deploy a user hook.</p>
</li>
<li>
<p>Run executables from a user hook.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_configuring_a_user_hook"><a class="anchor" href="#_configuring_a_user_hook"></a>Configuring a User Hook</h5>
<div class="paragraph">
<p>This section explains how to configure a global and a channel-specific user hook.</p>
</div>
<div class="paragraph">
<p>The global user hook is configured in the XML configuration of a job, which itself is part of an activity configuration. A channel user hook is configured for each channel. Their configuration parameters are the same.</p>
</div>
<div class="paragraph">
<p>A job is configured as part of an activity within a &lt;workflow&gt; element. The global user hook is part of the controller configuration. The XPath expression of the corresponding XML element reads:<br>
workflow/activities/activity[@name='&#8230;&#8203;']/job/controller/operation/user hook.</p>
</div>
<div class="paragraph">
<p>A job configuration collects a number of &lt;port&gt; elements, which itself collect a number of &lt;channel&gt; elements. A channel user hook is a sub-element of the &lt;channel&gt; element. Here the XPath notation:<br>
workflow/activities/activity[@name='&#8230;&#8203;']/job/port/channel/user hook.</p>
</div>
<div class="paragraph">
<p>The XML attributes of the &lt;userhook&gt; element include:</p>
</div>
<div class="paragraph">
<p><strong>classname:</strong>
The full class name of your user hook Java class. It must implement the IGlobalUserHook or the IUserHook interface.</p>
</div>
<div class="paragraph">
<p><strong>implementationLanguage:</strong>
Currently only the value "java" is supported. It&#8217;s also the default, if omitted.</p>
</div>
<div class="paragraph">
<p><strong>data:</strong>
The source of your user hook Java class.</p>
</div>
<div class="paragraph">
<p><strong>code:</strong>
The octets of the compiled unit. This property is loaded by the controller instead of searching a class from the class path. This property will be filled by the Identity Manager in the course of configuration.</p>
</div>
<div class="paragraph">
<p><strong>Sub-properties of &lt;userhook&gt;:</strong>
Some properties are denoted as property sub-elements as follows: &lt;property name="&#8230;&#8203;" value="&#8230;&#8203;"/&gt;. The following properties are evaluated by the controller:</p>
</div>
<div class="paragraph">
<p><strong>sourcepath:</strong>
The full path name of the Java file that contains the source of your user hook implementation. This property is supported for local testing.</p>
</div>
</div>
<div class="sect4">
<h5 id="_implementing_a_global_user_hook"><a class="anchor" href="#_implementing_a_global_user_hook"></a>Implementing a Global User Hook</h5>
<div class="paragraph">
<p>A global user hook is called at the beginning and at the end of a job. It must implement the interface <strong>com.siemens.dxm.join.api.IGlobalUserHook</strong> with the following methods:</p>
</div>
<div class="paragraph">
<p><strong>setGlobalContext</strong></p>
</div>
<div class="paragraph">
<p>With this method, the controller passes a reference to the global context. It gives access to the connectors, the configurations of the job, the controller and the user hook and to the current working directory.</p>
</div>
<div class="paragraph">
<p><strong>prolog:</strong></p>
</div>
<div class="paragraph">
<p>The method prolog() is called at the beginning of a job, before any entry or channel is handled. It allows you to prepare a job and set any global properties into the job context.</p>
</div>
<div class="paragraph">
<p>Among other tasks, the global user hook can add its proprietary properties in the global context. The join engine passes the updated global context to each channel user hook. In order to avoid overlap of other property names, use custom prefixes such as <strong>org.myorg.mydep.MyProperty</strong>.</p>
</div>
<div class="paragraph">
<p><strong>epilog:</strong></p>
</div>
<div class="paragraph">
<p>The epilog() method is called at the end of the job. It allows you to close any open resources, such as file or network handles.</p>
</div>
</div>
<div class="sect4">
<h5 id="_implementing_a_channel_user_hook"><a class="anchor" href="#_implementing_a_channel_user_hook"></a>Implementing a Channel User Hook</h5>
<div class="paragraph">
<p>The join engine calls the channel user hook in various phases while it processes an entry. A user hook implements the interface <em>com.siemens.dxm.join.api.IUserHook</em> and optionally <em>com.siemens.dxm.join.api.IUserHookExt</em>. The following figure provides an overview of the API operations and when they are called from the join engine:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch1_applsref/image15.gif" alt="Join Engine-User Hook Operation Calling Sequence">
</div>
<div class="title">Figure 15. Join Engine-User Hook Operation Calling Sequence</div>
</div>
<div class="paragraph">
<p>As shown in the figure, there are the following user hook operations:</p>
</div>
<div class="paragraph">
<p><strong>prolog</strong>:</p>
</div>
<div class="paragraph">
<p>Before the first entry is processed, the join engine passes the environment properties of the source and the target channel to the user hook. These properties comprise the context properties set by the global user hook and a set of "specific attributes" taken from the following entries of the Connectivity configuration database: channel, connected directory, workflow, global configuration.</p>
</div>
<div class="paragraph">
<p>This action allows the user hook to open a file or a connection to another system or do some other preparation task. It may add its own properties to the target environment. The join engine reads them from the user hook at several times via the method <em>getTgtEnvironment</em> (see below).</p>
</div>
<div class="paragraph">
<p><strong>processSourceEntry</strong></p>
</div>
<div class="paragraph">
<p>After the join engine has read a source entry, it asks the user hook whether to process it. The <em>processSourceEntry</em> method receives the identifier and the list of attributes of the source entry and returns a boolean. In case it is false, the join engine skips processing this entry.</p>
</div>
<div class="paragraph">
<p><strong>preUpdate</strong></p>
</div>
<div class="paragraph">
<p>The join engine reads the joined entry from the target system. Then it calls the <em>preUpdate</em> method of the user hook (note: the method of the IUserhook API). As parameters it passes: identifier and attribute list of source and joined entry, references to connectors to source and target system. This action allows the user hook to read additional information from the source or the target, do some processing at the target or some other task before the entry is updated at the target system.</p>
</div>
<div class="paragraph">
<p>This method returns a boolean. If it is set to false, the join engine skips further processing this entry and continues with the next one.</p>
</div>
<div class="paragraph">
<p>For a method that is called after the mapping and before the update, see the <em>preUpdate</em> method of the <em>IUserHookExt</em> interface.</p>
</div>
<div class="paragraph">
<p><strong>getSrcEnvironment</strong></p>
</div>
<div class="paragraph">
<p>The join engine calls this method several times: before the prolog, before the mapping and before the epilog. It allows the user hook to extend the environment properties related to the source channel by its own proprietary ones.</p>
</div>
<div class="paragraph">
<p><strong>getTgtEnvironment</strong></p>
</div>
<div class="paragraph">
<p>The join engine calls this method several times: before the prolog, before the mapping and before the epilog. It allows the user hook to extend the environment properties related to the target channel by its own proprietary ones.</p>
</div>
<div class="paragraph">
<p><strong>preUpdate (API IUserhookExt)</strong></p>
</div>
<div class="paragraph">
<p>After the join engine has mapped the source entry to the target entry and before it updates the target entry, it calls the <em>preUpdate</em> method of the user hook, if it implements the interface <em>IUserHookExt</em>.<br>
As parameters, it passes the identifier and attribute list of the source and joined entry, the mapped entry, and references to connectors to source and target system. This action allows the user hook to change the mapped entry, do some processing at the target or some other task before the entry is updated at the target system.</p>
</div>
<div class="paragraph">
<p>This method returns a boolean. If it is set to false, the join engine discontinues processing this entry and continues with the next one.</p>
</div>
<div class="paragraph">
<p><strong>getCallDelete</strong></p>
</div>
<div class="paragraph">
<p>When the join engine encounters a mapped entry with request type DELETE, it first asks the user hook whether a custom delete method must be called. When this method returns true, the join engine calls the user hook method <em>delete</em>(). Otherwise it performs the delete request at the connector using the identifier of the mapped entry.</p>
</div>
<div class="paragraph">
<p><strong>delete</strong></p>
</div>
<div class="paragraph">
<p>The join engine calls this method when an entry is to be deleted by the user hook instead of performing the delete request itself; that is, if the <em>getCallDelete</em> method returns true. It passes a reference to the connector for the affected system and the mapped entry. As a result, the user hook can issue its own request at the connector (for example, a modify or extended request) or perform other tasks without the connector.</p>
</div>
<div class="paragraph">
<p><strong>postUpdate</strong></p>
</div>
<div class="paragraph">
<p>After the entry has been updated, the join engine calls this method. It passes the identifier and the attributes of the source and the joined entry, the performed update request, the response with its result code and the source and target connector.</p>
</div>
<div class="paragraph">
<p>The update request and the response can be null if no update was performed because the entry was already up-to-date. These two parameters can also be null if the user-defined <em>delete</em> operation is used; in this case, no information about user-defined update requests and update responses is available; it is even unknown whether an update operation has been executed at all.</p>
</div>
<div class="paragraph">
<p>This action allows the user hook to perform additional requests for the updated entry both at the source and the target system.</p>
</div>
<div class="paragraph">
<p>This method returns a boolean. If it is set to false, the join engine discontinues processing this entry and continues with the next one.</p>
</div>
<div class="paragraph">
<p><strong>epilog</strong></p>
</div>
<div class="paragraph">
<p>This method is called after all the entries of a channel have been processed. This action allows the user hook to close all pending handles (for example, sockets or files).</p>
</div>
<div class="paragraph">
<p>For a detailed description of the parameters, see the Java interface documentation in the folder Documentation/DirXIdentity/RealtimeWorkflows.</p>
</div>
<div class="paragraph">
<p>Review the contents of the <strong>Additions\RealtimeWorkflows\samples</strong> folder in the product DVD for a sample implementation that demonstrates basic handling.</p>
</div>
<div class="paragraph">
<p>For details on how to read and set the identifier and attributes of source or target entries, see the section "Evaluating a Mapping Entry".</p>
</div>
<div class="paragraph">
<p><strong>Deployment</strong></p>
</div>
<div class="paragraph">
<p>Make sure the jar file containing your user hook implementation is deployed in the correct folder of your IdS-J server, which is:</p>
</div>
<div class="paragraph">
<p><em>install_path</em>*/ids-j-<strong><em>domain</em></strong>-S*<em>n</em>*/confdb/common/lib*</p>
</div>
</div>
<div class="sect4">
<h5 id="_implementing_a_user_hook_for_email_notifications"><a class="anchor" href="#_implementing_a_user_hook_for_email_notifications"></a>Implementing a User Hook for Email Notifications</h5>
<div class="paragraph">
<p>It is possible to send an e-mail notification in a user hook. You can find the sample Java-based workflow using the mail notification for account creation in the sample workflows for Extranet Portal, which is the part of the sample My-Company connectivity scenario. See the chapter "Loading the Connectivity Scenario" in the <em>DirX Identity Tutorial</em> for more information about the My-Company scenario. The provided user hook can be found on the DVD as Java class <strong>NotifyMailAccountCreationUserHook.java</strong>. It implements in particular the method <strong>postUpdate,</strong> which takes the <strong>mail</strong> attribute of the account and creates a specially-handled SPMLv1 request; this request is then sent to connector identified by the name "<strong>notify</strong>". If the provided mail is valid and the notify activity is correctly configured, it sends the notification to that mail address about account creation. Tailor this class to your needs if you intend to use special mail notifications in a Java-based workflow.</p>
</div>
</div>
<div class="sect4">
<h5 id="_deploying_a_user_hook"><a class="anchor" href="#_deploying_a_user_hook"></a>Deploying a User Hook</h5>
<div class="paragraph">
<p>Make sure the jar file that contains your user hook class is deployed in the correct folder of your IdS-J Server, which is:</p>
</div>
<div class="paragraph">
<p><em>install_path</em>*/ids-j-<strong><em>domain</em></strong>-S*<em>n</em>*/confdb/common/lib*</p>
</div>
</div>
<div class="sect4">
<h5 id="_running_executables_from_a_user_hook"><a class="anchor" href="#_running_executables_from_a_user_hook"></a>Running Executables from a User Hook</h5>
<div class="paragraph">
<p>DirX Identity provides a general user hook class <strong>UserHookRunExecutable</strong>, which allows running any executable configured in a realtime workflow channel object. It can be used immediately without any extra programming. Specify the class name com.siemens.dxm.join.userhook.common.UserHookRunExecutable in the General tab of the channel and specify the executable name and command line in the channel-specific attributes.</p>
</div>
<div class="paragraph">
<p>For the preUpdate and the postUpdate user hook methods, you can configure an executable with a command line in the channel-specific attributes post_executable, post_cmdline, pre_executable, pre_cmdline. In the postUpdate case, the executable is only called if the update (add or modify) of the object was successful.</p>
</div>
<div class="paragraph">
<p>Architecture</p>
</div>
<div class="paragraph">
<p>The following figure illustrates the architecture of running an executable from a user hook:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch1_applsref/image16.gif" alt="Running Executables from a User Hook">
</div>
<div class="title">Figure 16. Running Executables from a User Hook</div>
</div>
<div class="paragraph">
<p>Concept</p>
</div>
<div class="paragraph">
<p>The following features are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Running executables as part of a user hook.</p>
</li>
<li>
<p>Using the standard user hook with a few configuration steps in any user hook.</p>
</li>
<li>
<p>Using the source code starting point for more complex solutions.</p>
</li>
<li>
<p>Working in a high availability scenario.</p>
</li>
<li>
<p>Running in a multi-threaded environment.</p>
</li>
<li>
<p>Redirecting of logging to the Java-based Server logs by default.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following samples are provided:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A PowerShell script for personal folder creation.</p>
</li>
<li>
<p>Several PowerShell scripts for managing Exchange mailboxes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Command Line Parameters of the Executable</p>
</div>
<div class="paragraph">
<p>The command line parameters specified in the channel specific attributes post_cmdline and/or pre_cmdline can contain fixed parts and variable parts. The variable parts can reuse all mapping variables by specifying the source, target, env and joinedEntry constructs, like ${source.dxrName}, ${target.homeDirRoot}, ${env.domain}, ${joinedEntry.cn}.</p>
</div>
<div class="paragraph">
<p>Central (Shared) Script Folder</p>
</div>
<div class="paragraph">
<p>Beneath each Java-based Server’s repository folder, which can be specified at the Java-based Server object in the Connectivity Expert View, there is a subfolder <strong>scripts</strong> where the executables can be located. In a distributed Java-based Server environment, this high availability location can be shared by all running instances.</p>
</div>
<div class="paragraph">
<p>The absolute path of the <strong>scripts</strong> folder is put into the Java-based Server context and can be accessed from user hooks by the environment variable ${env.scripts}. It can also be specified in the channel-specific attributes; for example, in the post_executable or post_cmdline attribute.</p>
</div>
<div class="paragraph">
<p>Output File and Error Handling</p>
</div>
<div class="paragraph">
<p>By default, the executable&#8217;s standard output and standard error messages and the exit code are written to the Java-based Server log file. If the executable fails, the user hook preUpdate and/or postUpdate methods return “false” to the join engine according to the user hook API, which causes the join engine to pass an error record to the Audit Connector and to the Monitor View and to stop processing this entry.</p>
</div>
<div class="paragraph">
<p>You can also define executable return codes that you classify as successful by specifying the specific attributes post_ok_codes and/or pre_ok_codes for executables started in the related user hook methods. The return codes are specified as integer values and must be separated by blanks. If nothing is specified, the return code “0” is regarded as successful by default.</p>
</div>
<div class="paragraph">
<p>If the executable&#8217;s output is to be written to separate files, specify the output file names in the command line as parameters. The executable must interpret these output file names.</p>
</div>
<div class="paragraph">
<p>If you specify your own output files, we recommend including the Workflow Instance ID in the names of the output files to prevent running workflow instances started through further events from overwriting output files that have already been recorded. The Workflow Instance ID is also contained in the Java-based Server context and can be used by specifying the environment variable ${env.dxm.uh.wfInstID}.</p>
</div>
<div class="paragraph">
<p>The workflow name is accessible in the environment and must be specified by ${env.dxm.uh.wfName}.</p>
</div>
<div class="paragraph">
<p>Interrupting Executables</p>
</div>
<div class="paragraph">
<p>If the activity that starts the executable times out or the Java-based Server shuts down, the Java-based Server sets a cancellation flag. During a "graceful" shutdown period, the running activities (this is a standard task of the controller implementations) check this flag at certain times and finish the process. A good time to perform this task, for example, is after one event has completed in a scheduled synchronization. After the configurable graceful shutdown period has elapsed, the Java-based Server interrupts all running activities. If an executable has not yet finished, the UserHookRunExecutable class catches this interruption and kills the executable, which was started as an asynchronous process.</p>
</div>
<div class="paragraph">
<p>Killing Executables after a Configurable Time Period</p>
</div>
<div class="paragraph">
<p>Independently of this interruption scenario, the UserHookRunExecutable class starts the process running the executable asynchronously and asks for the process return value in a loop for a certain time (by default, 90 seconds) and then kills the process if it has not finished in this time frame. You can configure this time in milliseconds in the channel-specific attribute post_timeout for executables started in the postUpdate user hook method or in the pre_timeout specific attribute for executables started in the preUpdate user hook method.</p>
</div>
<div class="paragraph">
<p>Connection Parameters</p>
</div>
<div class="paragraph">
<p>If the activity’s connection parameters like server, user or password should be passed as parameters to the executable, you can extend the UserHookRunExecutable class by adding the desired parameters to the command line. For example, the connection parameters of the target connector can be accessed in a user hook the following way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DxmConnectionConfig connectionConfig = null;
DxmConnectorConfig connectorConfig = (DxmConnectorConfig) (_tgtEnv.get("dxm.uh.connectorConfByName.ts"));
if(connectorConfig != null) {
    DxmConnectionConfig connectionConfig = (DxmConnectionConfig) connectorConfig.getConnections().firstElement();
    String server = connectionConfig.getServer();
    int port = new Integer(connectionConfig.getPort());
    String user = connectionConfig.getUser();
    String pwd = connectionConfig.getPassword();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This coding example is already contained as a comment in the standard UserHookRunExecutable class provided as source code.</p>
</div>
<div class="paragraph">
<p>The bind parameters in the sample PowerShell scripts delivered with DirX Identity are kept in the scripts. The scripts read the password from a file that contains the password that you have saved encrypted with PowerShell.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mapping_with_java_classes"><a class="anchor" href="#_mapping_with_java_classes"></a>Mapping with Java Classes</h4>
<div class="paragraph">
<p>You can provide Java sources or pre-compiled Java classes to realize complex mapping functions. They can be configured for</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Calculating the identifier of the target entry; for details, see the section "Identifier Mapping".</p>
</li>
<li>
<p>Mapping of attributes; for details see the section "Attribute Mapping".</p>
</li>
<li>
<p>Post mapping; that is, after all attributes have been mapped and before the update of the entry is performed. For details, see the section "Post Mapping".</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This section also provides information how to</p>
</div>
<div class="ulist">
<ul>
<li>
<p>deploy a mapping class.</p>
</li>
<li>
<p>evaluate a mapping entry.</p>
</li>
<li>
<p>handle environment properties.</p>
</li>
<li>
<p>handle the mapped entry.</p>
</li>
<li>
<p>set the map result.</p>
</li>
<li>
<p>write log messages.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can find a sample source that implements all interfaces in the following folder of your installation DVD:</p>
</div>
<div class="paragraph">
<p><strong>Additions\RealtimeWorkflows\samples</strong></p>
</div>
<div class="sect4">
<h5 id="_identifier_mapping"><a class="anchor" href="#_identifier_mapping"></a>Identifier Mapping</h5>
<div class="paragraph">
<p>A class that realizes the mapping of an identifier must implement the interface <em>com.siemens.dxm.join.api.IMapIdentifier</em>. It consists of one method:</p>
</div>
<div class="paragraph">
<p>Identifier <strong>mapId</strong>(MappingEntry source, MappingEntry joined, HashMap&lt;String,Object&gt; environment)</p>
</div>
<div class="paragraph">
<p>The join engine passes the following parameters:</p>
</div>
<div class="paragraph">
<p><strong>source</strong>: the source entry, or null if no source entry exists, which occurs when validation workflows find entries at the target that have no corresponding source entry.</p>
</div>
<div class="paragraph">
<p><strong>joined</strong>: the joined entry, or null if no joined entry has been found.</p>
</div>
<div class="paragraph">
<p><strong>environment</strong>: a map of environment properties collected by the specific attributes taken from the affected channel, connected directory, activity and workflow entries. User hook implementations can append additional properties.</p>
</div>
<div class="paragraph">
<p>The identifier mapper must return the new identifier of the mapped entry.</p>
</div>
<div class="paragraph">
<p>For an example see the file <strong>Idmapping.java</strong> on the DVD in the folder <strong>Additions/RealtimeWorkflows/samples/mappings</strong></p>
</div>
<div class="paragraph">
<p>For details on how to handle these parameters, see the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Evaluating a Mapping Entry</p>
</li>
<li>
<p>Setting the Map Result</p>
</li>
<li>
<p>Handling Environment Properties</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_attribute_mapping"><a class="anchor" href="#_attribute_mapping"></a>Attribute Mapping</h5>
<div class="paragraph">
<p>A class that realizes the mapping of an attribute must implement the interface <em>com.siemens.dxm.join.api.IMapAttribute</em>. It consists of one method:</p>
</div>
<div class="paragraph">
<p>MapResult <strong>mapAttr</strong>(String tgtAttrname, Request.Type reqType, MappingEntry source, MappingEntry joined, HashMap&lt;String,Object&gt; environment)</p>
</div>
<div class="paragraph">
<p>The join engine passes the following parameters:</p>
</div>
<div class="paragraph">
<p><strong>tgtAttrname</strong>: the name of the target attribute.</p>
</div>
<div class="paragraph">
<p><strong>reqType</strong>: the proposed request type. The attribute mapper can change it in the returned map result. Allowed types are: <em>Request.Type.ADD</em>, <em>Request.Type.MODIFY</em>, <em>Request.Type.DELETE</em>.</p>
</div>
<div class="paragraph">
<p><strong>source</strong>: the source entry, or null if no source entry exists, which occurs when validation workflows find entries at the target that have no corresponding source entry.</p>
</div>
<div class="paragraph">
<p><strong>joined</strong>: the joined entry, or null if no joined entry has been found.</p>
</div>
<div class="paragraph">
<p><strong>environment</strong>: a map of environment properties collected by the specific attributes taken from the affected channel, connected directory, activity and workflow entries. User hook implementations may append additional properties.</p>
</div>
<div class="paragraph">
<p>The attribute mapper must return the map result. In the simplest case, it contains only one value for the attribute. But you can also set a series of attribute modifications, a set of operational attributes and also return a changed request type. The request type determines the request to be issued to the target system connector: add a new entry, modify the existing joined entry or delete the existing entry.</p>
</div>
<div class="paragraph">
<p>A note concerning deleted source entries: normally, the join engine deletes an attribute value in the target entry, if the mapped value is empty or null. If the source entry no longer exists, the mapping routines typically produce empty values for the mapped attributes. However, if you want the target entry just to be modified (for example, set the state to DELETED) or moved (tombstone!), you typically do not want the target attribute values to be deleted. To support this operation, the join engine deletes the attribute values only if the modification operation is set to "delete". By default, it is set to "replace". As a result, if you want a target attribute to be deleted if the source entry no longer exists, it is not sufficient to return an empty value. You must explicitly set the operation in the modification to "delete". The following code snippet provides an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DsmlModification targetMod = new DsmlModification();
targetMod.setName(tgtAttrname);
targetMod.setOperation(DsmlModificationOperationType.DELETE);</code></pre>
</div>
</div>
<div class="paragraph">
<p>For details on how to handle the input parameters, see the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Evaluating a Mapping Entry</p>
</li>
<li>
<p>Setting the Map Result</p>
</li>
<li>
<p>Handling Environment Properties</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_post_mapping"><a class="anchor" href="#_post_mapping"></a>Post Mapping</h5>
<div class="paragraph">
<p>A class that realizes the post mapping of an entry must implement the interface <em>com.siemens.dxm.join.api.IPostMapping</em>. It consists of one method:</p>
</div>
<div class="paragraph">
<p>MappedEntry <strong>doPostMapping</strong>(MappedEntry mappedEntry, Request.Type reqType, MappingEntry source, MappingEntry joined, HashMap&lt;String,Object&gt; environment)</p>
</div>
<div class="paragraph">
<p>The join engine passes the following parameters:</p>
</div>
<div class="paragraph">
<p><strong>mappedEntry</strong>: the result of the previous attribute and identifier mappings.</p>
</div>
<div class="paragraph">
<p><strong>reqType</strong>: the proposed request type. The attribute mapper can change it in the returned map result. Allowed types are: <em>Request.Type.ADD</em>, <em>Request.Type.MODIFY</em>, <em>Request.Type.DELETE</em>.</p>
</div>
<div class="paragraph">
<p><strong>source</strong>: the source entry, or null if no source entry exists, which occurs with validation workflows when entries at the target are found that have no corresponding source entry.</p>
</div>
<div class="paragraph">
<p><strong>joined</strong>: the joined entry, or null if no joined entry has been found.</p>
</div>
<div class="paragraph">
<p><strong>environment</strong>: a map of environment properties collected by the specific attributes taken from the affected channel, connected directory, activity and workflow entries. User hook implementations may append additional properties.</p>
</div>
<div class="paragraph">
<p>The post mapping returns the new mapped entry. Post mapping is called after all attribute mappings and the identifier mapping have been performed.</p>
</div>
<div class="paragraph">
<p>The post mapping can modify all attribute modifications, the identifier, operational attributes and the request type. The request type determines the request to be issued to the target system connector: add a new entry, modify the existing joined entry or delete the existing entry.</p>
</div>
<div class="paragraph">
<p>For details on how to handle these parameters, see the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Evaluating a Mapping Entry</p>
</li>
<li>
<p>Handling Environment Properties</p>
</li>
<li>
<p>Handling the Mapped Entry</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_deploying_the_mapping_class"><a class="anchor" href="#_deploying_the_mapping_class"></a>Deploying the Mapping Class</h5>
<div class="paragraph">
<p>Make sure the jar file that contains your mapping class is deployed in the correct folder of your IdS-J server, which is:</p>
</div>
<div class="paragraph">
<p><em>install_path</em>*/ids-j-<strong><em>domain</em></strong>-S*<em>n</em>*/confdb/common/lib*</p>
</div>
</div>
<div class="sect4">
<h5 id="_evaluating_a_mapping_entry"><a class="anchor" href="#_evaluating_a_mapping_entry"></a>Evaluating a Mapping Entry</h5>
<div class="paragraph">
<p>A source or joined entry is represented as Java class <strong>com.siemens.dxm.join.map.MappingEntry</strong>. The mapping entry holds the entry&#8217;s identifier, list of attributes and operational attributes.</p>
</div>
<div class="paragraph">
<p>Read Identifier</p>
</div>
<div class="paragraph">
<p>Each entry has an identifier. It is modelled according the OASIS SPML standard. The identifier has a type (most often DN or generic string), an id value and optionally a list of identifier attributes. The following code snippet shows how to read the identifier value from the joined entry:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Identifier id = null;
String idvalue = null;

if (joined!=null)
    id = joined.getId();
if (id!=null) {
    IdentifierType type = id.getType();
    idvalue = id.getIdentifierChoice().getId();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Read Attributes from the Source or Joined Entry</p>
</div>
<div class="paragraph">
<p>Each source and joined entry contains a list of attributes, where each attribute may have a list of values. The values are typically of type string, but may sometimes also be binary. The following code snippet shows how to read the string attribute 'sn' from a source entry. Reading from the joined entry is identical.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">String srcSn;
if (source != null &amp;&amp; source.getAttrs() != null) {
    DsmlAttr srcSnAttr = (DsmlAttr) source.getAttrs().get("sn");
    if (srcSnAttr != null) {
        srcSn = srcSnAttr.getValue(0);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Reading a multi-value string attribute is almost the same. You get an array of strings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">String[] srcDescriptions;
if (source != null &amp;&amp; source.getAttrs() != null) {
    DsmlAttr srcAttrDescription = (DsmlAttr) source.getAttrs().get("description");
    if (srcAttrDescription != null) {
        srcDescriptions = srcAttrDescription.getValue();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following snippet shows how to get a binary value and assure the attribute&#8217;s member type base64:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// get - fictive - single-value attribute "binaryValue" from source entry
byte[] binValue = null;
if (source != null &amp;&amp; source.getAttrs() != null) {
    DsmlAttr srcBinAttr = (DsmlAttr) source.getAttrs().get("binaryValue".toLowerCase());
    if (srcBinAttr != null) {
        String memberType = srcBinAttr.getMemberType();
        if (DsmlValue.BASE64BINARY_TYPE.equalsIgnoreCase(memberType)) {
            binValue = srcBinAttr.getBinValue(0);
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note: Use lower-case notation for attribute names. When storing attributes internally in the hash map, the join engine uses the lower-case notation of the attribute name as a key.</p>
</div>
<div class="paragraph">
<p>For more details on how to handle attribute,s take a look at the Java integration framework.</p>
</div>
<div class="paragraph">
<p>Read an Operational Attribute</p>
</div>
<div class="paragraph">
<p>Reading an operational attribute from a source entry is nearly identical to reading a 'normal' attribute. Here a sample snippet for the (fictitious) attribute 'dxrPrimaryKeyOld':</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// read operational attribute "dxrPrimaryKeyOld"
String opKey = null;
if (source != null &amp;&amp; source.getOpAttrs() != null) {
    DsmlAttr srcOpAttr = (DsmlAttr) source.getOpAttrs().get("dxrPrimaryKeyOld".toLowerCase());
    if (srcOpAttr != null) {
        opKey = srcOpAttr.getValue(0);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Operational attributes, like the normal ones, can be multi-valued or binary.</p>
</div>
<div class="paragraph">
<p>Note: Use lowercase notation for attribute names. When storing attributes internally in the hash map, the join engine uses the lowercase notation of the attribute name as a key.</p>
</div>
</div>
<div class="sect4">
<h5 id="_handling_environment_properties"><a class="anchor" href="#_handling_environment_properties"></a>Handling Environment Properties</h5>
<div class="paragraph">
<p>All mapping functions have access to environment properties, which are collected from the respective configuration entries (channel, connected directory, activity, workflow) or set by a global or channel user hook.</p>
</div>
<div class="paragraph">
<p>The environment properties are simply a hash map of objects identified by their name of type String. The following snippet read the standard property "user_base":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// read environment property "user_base"
String userBase = (String)environment.get("user_base");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Setting an environment property is also as simple:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// set a custom environment property
environment.put("com.siemens.map.ldap.myEnvProperty", "someValue");</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to avoid naming collisions, we recommend that you use an adequate prefix for your property names that is analogous to the one shown in the example: com.siemens.map.ldap.</p>
</div>
</div>
<div class="sect4">
<h5 id="_handling_the_mapped_entry"><a class="anchor" href="#_handling_the_mapped_entry"></a>Handling the Mapped Entry</h5>
<div class="paragraph">
<p>The mapped entry is first built up by the identifier mapping and the list of attribute mappings. After that, the join engine passes the result to the post mapping (if configured). The post mapping also has access to the source and the joined entry. It can change the complete mapping entry: the identifier, the attribute modifications, the operational attributes and the request type.</p>
</div>
<div class="paragraph">
<p>The sections Identifier Mapping and Evaluating a Mapping Entry show how to read the identifier and the source and joined entry. This section shows how to read the mapping entry and modify it.</p>
</div>
<div class="paragraph">
<p>Identifier</p>
</div>
<div class="paragraph">
<p>Reading and setting the identifier is simply realized by a getter and a setter method as the following code snippet shows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Identifier id = mappedEntry.getIdentifier();
// change the identifier ...
mappedEntry.setIdentifier(id);</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the section on Identifier Mapping for information on how to work with the Identifier.</p>
</div>
<div class="paragraph">
<p>Attribute Modifications</p>
</div>
<div class="paragraph">
<p>You can read the modifications for a single attribute or get a map with the modifications of all attributes. Updating the modifications is done on a per-attribute basis as the following snippet shows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DsmlModification[] snMods = mappedEntry.getModification("sn");
HashMap&lt;String, DsmlModification[]&gt; modMap = mappedEntry.getModifications();
snMods = modMap.get("sn");
// change the modifications for attribute "sn"
mappedEntry.updateModification(snMods);</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more details on working with modifications, see "Evaluating a Mapping Entry" and "Setting the Map Result".</p>
</div>
<div class="paragraph">
<p>Operational Attributes</p>
</div>
<div class="paragraph">
<p>Reading and modifying the operational attributes is very similar to the attribute modifications. You can either get them all as a map or read them one-by-one. Updating is done on a per-attribute basis:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">HashMap&lt;String, DsmlAttr&gt; opAttrMap = mappedEntry.getOpAttrs();
DsmlAttr myOpAttr = mappedEntry.getOpAttr("myOperationalAttribute");
myOpAttr = opAttrMap.get("myOperationalAttribute");
// change the operational attribute
mappedEntry.setOpAttr(myOpAttr);</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more details on working with operational attributes, see "Evaluating a Mapping Entry" and "Setting the Map Result".</p>
</div>
<div class="paragraph">
<p>Request Type</p>
</div>
<div class="paragraph">
<p>The post mapping can get the request type from the parameter list or read it from the mapped entry via the getter method. Updating it is done via the corresponding setter method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">mappedEntry.setRequestType(reqType);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_setting_the_map_result"><a class="anchor" href="#_setting_the_map_result"></a>Setting the Map Result</h5>
<div class="paragraph">
<p>The mapping result for an attribute consists of the following items:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A list of modifications</p>
</li>
<li>
<p>A list of operational attributes</p>
</li>
<li>
<p>The request type</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Request Type</p>
</div>
<div class="paragraph">
<p>The request type determines the kind of operation to be issued at the target system connector: ADD, MODIFY or DELETE. For the list of allowed values see the static enumeration in the class <em>com.siemens.dxm.join.util.Request.</em></p>
</div>
<div class="paragraph">
<p>Initially, the join engine proposes a value:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MODIFY, if it has found a joined entry.</p>
</li>
<li>
<p>ADD if no joined entry is found.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the mapping function, you can change the value according your needs. The following code snippet shows how to set the type to DELETED, which results in a delete request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// delete target entry, if mapped state DELETED
if (IState.DELETED.equalsIgnoreCase(tgtState)) {
    targetMapResult.setRequestType(Request.Type.DELETE);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Attribute Modifications</p>
</div>
<div class="paragraph">
<p>The mapping result contains a list of attribute modifications. Each attribute modification needs the attribute name, the modification operation (replace, delete, add) and the attribute value(s). The modifications are applied as they are, if the request is a MODIFY. In case of an ADD, the join engine transforms them to a list of attribute values; that is, it skips the operation. The mapping function does not usually need to be aware of this.</p>
</div>
<div class="paragraph">
<p>The following code snippet shows how to create a MapResult object, create one attribute modification with the attribute name and the default operation REPLACE, add an attribute value and set the new modification and a request type in the mapping result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">MapResult targetMapResult = new MapResult();
targetMapResult.setRequestType(reqType);
DsmlModification targetMod = new DsmlModification();
targetMod.setName(tgtAttrname);
targetMod.setOperation(DsmlModificationOperationType.REPLACE);
// calculate the attribute value ...
String value = "...";
targetMod.addValue(value);
targetMapResult.addModification(targetMod);</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see from the sample, it&#8217;s even possible to add a number of modifications for the same attribute or for a list of attributes.</p>
</div>
<div class="paragraph">
<p>Operational Attributes</p>
</div>
<div class="paragraph">
<p>The mapping function may append operational attributes to the mapping result. Note that they are specific for a connector or a SPML target service. Here is a short code snippet that shows how to create an operational attribute and add it to the mapping result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// add an operational attribute to the map result
DsmlAttr dstOpAttr = new DsmlAttr();
dstOpAttr.addValue(userBase);
dstOpAttr.setName("myOperationalAttribute");
targetMapResult.addOperationalAttr(dstOpAttr);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_logging"><a class="anchor" href="#_logging"></a>Logging</h5>
<div class="paragraph">
<p>If you want to implement logging, you can use a log support that provides some simple log methods. The following code snippet shows how to obtain the log support and issue a debug log message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Obtain the Log support for your class; here "SampleMapper" +
private static final LogSupport logger = LogSupport.forName(SampleMapper.class);

// Write a debug log +
logger.debug("SampleMapper - Source Entry SN = " + srcSn);</code></pre>
</div>
</div>
<div class="paragraph">
<p>For logging messages with other levels, use the appropriate methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>error</p>
</li>
<li>
<p>warn</p>
</li>
<li>
<p>info</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The messages are written to the same files as that of the other DirX Identity components.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_testing_the_real_time_workflow_mapping_classes"><a class="anchor" href="#_testing_the_real_time_workflow_mapping_classes"></a>Testing the Real-Time Workflow Mapping Classes</h4>
<div class="paragraph">
<p>The following sections provide information on how to develop and test your own Java mapping classes for a specific real-time workflow.</p>
</div>
<div class="sect4">
<h5 id="_about_the_mapping_test"><a class="anchor" href="#_about_the_mapping_test"></a>About the Mapping Test</h5>
<div class="paragraph">
<p>The Java Eclipse Project dxmTestMapping can help you develop and test your Java mapping classes needed for a specific real-time workflow. The project is delivered on the DirX Identity DVD as a zip file and can be unpacked to any location in the file system. It has all the necessary libraries in its own subfolder and is independent of any installed DirX Identity files.</p>
</div>
<div class="paragraph">
<p>The mapping can be tested either by running the batch file runTestMapping.bat or by running the Junit-Test TestSample.java. The Junit Test is configured in build.xml, so it is run automatically by starting the build process with mkTestMapping.bat. It can also be started inside the project by configuring a Junit Test with the TestSample class.</p>
</div>
<div class="paragraph">
<p>In both cases (batch file or Junit Test), the agent framework main class AgtSessionExe is called with the configuration file src.test/confs/sample/conf.xml. The resulting trace and response files can be inspected in the src.test/confs/sample subtree.</p>
</div>
</div>
<div class="sect4">
<h5 id="_about_the_mapping_test_structure"><a class="anchor" href="#_about_the_mapping_test_structure"></a>About the Mapping Test Structure</h5>
<div class="paragraph">
<p>The Java Eclipse Project dxmTestMapping consists of the following subtrees and files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>src.test/confs/sample/conf.xml<br>
This is a standalone agent framework job configuration file containing the mapping of several attributes for one entry including the mapping of the Java source code EmployeeTypeSource.java. This mapping is configured in the first (and only) channel of the TS-port, hence in job/port[@name='TS']/channel/mappingDefinition [XPath notation].<br>
As a controller the class EntryMappingController, which is part of the join package, is specified in conf.xml. It expects a SPML search request in the request.xml file. The search request is passed to the Identity Domain connector, which gives the search result back in domain-response.xml. The controller takes the first (and only) search result entry as the source entry, configures the mapping in the (one and only) channel of the TS-port, creates an add or mod request from the mapped entry and passes it to the TS-connector configured in the TS-port. The response of the TS-connector is passed to the configured response writer, which writes it into the response.xml file.<br>
<br>
The configured connectors are only test connectors that write their requests into files and read responses from files. The TS-connector can also be replaced by a real target system connector if that part of the process should be tested besides the mapping.</p>
</li>
<li>
<p>src.test/confs/sample/request.xml<br>
Holds the SPML search request passed to the Identity Domain connector by the EntryMappingController.</p>
</li>
<li>
<p>src.test/confs/sample/domain-response.xml<br>
Holds a search result entry taken by the EntryMappingController as the source entry when performing the mapping as configured in the channel.</p>
</li>
<li>
<p>src.test/TestSample.java<br>
The Junit test class to run the agent framework job configured in src.test/confs/sample/conf.xml</p>
</li>
<li>
<p>src/map/samplets/accounts/to/EmployeeTypeSource.java<br>
The sample Java source code, for which an attribute mapping with type javasource is configured in conf.xml.</p>
</li>
<li>
<p>src/map/samplets/accounts/to<br>
Folder containing further Java source code mapping files performing an account attribute mapping from TS to Identity.</p>
</li>
<li>
<p>src/map/samplets/accounts/from<br>
Folder for Java source code mapping files performing an account attribute mapping from TS to Identity.</p>
</li>
<li>
<p>src/map/samplets/groups/to<br>
Folder for Java source code mapping files performing a group attribute mapping from Identity to TS.</p>
</li>
<li>
<p>src/map/samplets/groups/from<br>
Folder for Java source code mapping files performing a group attribute mapping from TS to Identity.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_testing_the_ldap_channel_configuration"><a class="anchor" href="#_testing_the_ldap_channel_configuration"></a>Testing the LDAP Channel Configuration</h5>
<div class="paragraph">
<p>After the single mappings have been tested as described, each channel as it is configured in LDAP can be tested as a whole the following way:</p>
</div>
<div class="paragraph">
<p>Go to the corresponding LDAP channel, open the Mapping page and insert a new Java source code mapping if it does not yet exist. Go to the Java source mapping LDAP object and import your tested Java source code mapping file (like the EmployeeTypeSource.java mentioned above). Repeat this for all Java source code attribute mapping files belonging to this channel and then export the resolved channel configuration into a file and copy it into the channel part of your standalone conf.xml file.</p>
</div>
<div class="paragraph">
<p>Now the standalone batch script can be run again to check whether the LDAP configuration is also correct.</p>
</div>
<div class="paragraph">
<p>The environment property source path which you can see in the conf.xml sample no longer exists in the resolved channel, because at this time the compiled code exists in the channel section. As a result, the source path where the files to be compiled can be found if no byte code exists is no longer needed.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_connector_filters"><a class="anchor" href="#_using_connector_filters"></a>Using Connector Filters</h4>
<div class="paragraph">
<p>Connector filters intercept calls from the Provisioning controller (that is, the "join engine") to connectors. They see all requests to and all responses from the connector. The following figure illustrates connector filters.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch1_applsref/image17.gif" alt="Connector Filters">
</div>
<div class="title">Figure 17. Connector Filters</div>
</div>
<div class="paragraph">
<p>A filter can change requests to the connector or responses from the connector, issue new requests to the connector, prohibit sending requests to the connector or even perform other tasks without the connector on the connected system. As an example, it could create or update a share on a Windows file system.</p>
</div>
<div class="paragraph">
<p>By default, DirX Identity uses a connector filter for decrypting and encrypting data, especially passwords. Other custom filters can be inserted before or after the default filter.</p>
</div>
<div class="paragraph">
<p>The connector filters are part of a chain of filters. In its <strong>doFilter()</strong> method, each filter receives the request. Usually, it checks the type of request (is it an Add, a modify, delete or search), optionally modifies it and passes it to the successor in the chain by calling its <strong>doFilter()</strong> method. This method returns the response from the successor. The filter can inspect it, modify it or do anything else. But it must return a response to its predecessor in the chain.</p>
</div>
<div class="paragraph">
<p>The framework passes the configuration options of a connector filter in its <strong>open()</strong> method. Essentially, they are a list of simple properties. The section "Configuring a Connector Filter" provides more detail.</p>
</div>
<div class="paragraph">
<p>Some filters might need to access the connected system directly and bypass the connector. In order to reduce configuration, they have access to the connector configuration, especially to address parameters and binding credentials. For this they must implement the interface <strong>ConnectorFilterConfig</strong>, through which the connector framework passes the connector configuration.</p>
</div>
<div class="sect4">
<h5 id="_configuring_a_connector_filter"><a class="anchor" href="#_configuring_a_connector_filter"></a>Configuring a Connector Filter</h5>
<div class="paragraph">
<p>The connector filter is configured as part of the job configuration, which itself is part of an activity configuration. This section describes the XML format of the configuration that is passed to the framework. For the presentation in Identity Manager, see a filter entry beneath a port.</p>
</div>
<div class="paragraph">
<p>A job configuration contains a number of &lt;port&gt; elements. A &lt;port&gt; contains a &lt;connector&gt; and a list of &lt;filter&gt; and &lt;channel&gt; elements. A &lt;filter&gt; element represents the configuration of a connector filter.</p>
</div>
<div class="paragraph">
<p><strong>XML attributes of &lt;filter&gt;</strong>:</p>
</div>
<div class="paragraph">
<p><strong>classname:</strong>
The full class name of the connector filter Java class; mandatory.</p>
</div>
<div class="paragraph">
<p><strong>name:</strong>
An optional name of the filter.</p>
</div>
<div class="paragraph">
<p><strong>Sub-Elements of &lt;filter&gt;:</strong></p>
</div>
<div class="paragraph">
<p>A &lt;filter&gt; allows only a number of &lt;property&gt; sub-elements. Each &lt;property&gt; supports the following XML attributes:</p>
</div>
<div class="paragraph">
<p><strong>name:</strong>
The name of the configuration property; mandatory.</p>
</div>
<div class="paragraph">
<p><strong>value:</strong>
The value of the configuration property.</p>
</div>
</div>
<div class="sect4">
<h5 id="_deploying_a_connector_filter"><a class="anchor" href="#_deploying_a_connector_filter"></a>Deploying a Connector Filter</h5>
<div class="paragraph">
<p>Make sure the jar file that contains your connector filter implementation is deployed in the correct folder of your IdS-J server, which is:</p>
</div>
<div class="paragraph">
<p><em>install_path</em>*/ids-j-<strong><em>domain</em></strong>-S*<em>n</em>*/confdb/common/lib*</p>
</div>
<div class="paragraph">
<p><strong>Notes</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All dependent jar files for your connector filter must also be deployed in the above folder.</p>
</li>
<li>
<p>For a SAP ECC UM connector filter, you then need to move the files <strong>sapjco3.jar</strong>, the associated shared library (<strong>sapjco3.dll/.so</strong>) and <strong>SapUM4Role.jar</strong> from <strong>confdb/jobs/framework/lib</strong> to the above mentioned folder. Alternatively, you can just put your SAP ECC UM connector filter jar file into the folder <strong>confdb/jobs/framework/lib</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more details on the interfaces, see the chapter on "Java Connector Integration Framework" in the <em>DirX Identity Integration Framework Guide</em>. You can also find information about reading the configuration and working with requests and responses in this guide. A sample is provided on the product DVD in the folder: <strong>Additions\SampleConnectorFilter</strong>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_customizing_password_synchronization_workflows"><a class="anchor" href="#_customizing_password_synchronization_workflows"></a>Customizing Password Synchronization Workflows</h3>
<div class="paragraph">
<p>This section describes how to customize the default set of Java-based workflows provided with DirX Identity for password management with user hooks. User hooks for password synchronization controllers are based on an extended global user hook interface used in common Java-based Provisioning workflows. Currently only User Password Event Manager workflow can use a user hook. The user hook can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Read the source password event, user entry and related account entries.</p>
</li>
<li>
<p>Skip the processing of a source password event for a user entry or for an account.</p>
</li>
<li>
<p>Gain access to the Identity store and other components via the connectors.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This section describes how to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Configure a password user hook.</p>
</li>
<li>
<p>Implement a password user hook.</p>
</li>
<li>
<p>Deploy a password user hook.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_configuring_a_password_user_hook"><a class="anchor" href="#_configuring_a_password_user_hook"></a>Configuring a Password User Hook</h4>
<div class="paragraph">
<p>The password user hook is configured in the XML configuration of the job for the User Password Event Manager controller, which itself is part of an activity configuration.</p>
</div>
<div class="paragraph">
<p>A job is configured as part of an activity within a &lt;workflow&gt; element. The password user hook is part of the controller configuration. The XPath expression of the corresponding XML element reads:</p>
</div>
<div class="paragraph">
<p>workflow/activities/activity[@name='&#8230;&#8203;']/job/controller/operation/user hook.</p>
</div>
<div class="paragraph">
<p>The XML attributes of the &lt;userhook&gt; element include:</p>
</div>
<div class="paragraph">
<p><strong>classname:</strong>
The full class name of your user hook Java class. It must implement the IPasswordUserHook.</p>
</div>
<div class="paragraph">
<p><strong>implementationLanguage:</strong>
Currently only the value "java" is supported. It&#8217;s also the default, if omitted.</p>
</div>
<div class="paragraph">
<p><strong>data:</strong>
The source of your user hook Java class.</p>
</div>
<div class="paragraph">
<p><strong>code:</strong>
The octets of the compiled unit. This property is loaded by the controller instead of searching a class from the class path. This property will be filled by the Identity Manager in the course of configuration.</p>
</div>
<div class="paragraph">
<p>Sub-properties of &lt;userhook&gt;:</p>
</div>
<div class="paragraph">
<p>Some properties are denoted as property sub-elements as follows: &lt;property name="&#8230;&#8203;" value="&#8230;&#8203;"/&gt;. The following properties are evaluated by the controller:</p>
</div>
<div class="paragraph">
<p><strong>sourcepath:</strong>
The full path name of the Java file that contains the source of your user hook implementation. This property is supported for local testing.</p>
</div>
</div>
<div class="sect3">
<h4 id="_implementing_a_password_user_hook"><a class="anchor" href="#_implementing_a_password_user_hook"></a>Implementing a Password User Hook</h4>
<div class="paragraph">
<p>A password user hook is called several times during execution of the workflow job. It must implement the interface <strong>com.siemens.dxm.join.api.IPasswordUserHook</strong> with the following methods:</p>
</div>
<div class="paragraph">
<p><strong>setGlobalContext</strong></p>
</div>
<div class="paragraph">
<p>With this method, the controller passes a reference to the global context. It gives access to the connectors, the configurations of the job, the controller and the user hook and to the current working directory.</p>
</div>
<div class="paragraph">
<p><strong>prolog:</strong></p>
</div>
<div class="paragraph">
<p>The prolog() method is called at the beginning of a job, before any entry is handled. It allows you to prepare a job and set any global properties into the job context.</p>
</div>
<div class="paragraph">
<p><strong>epilog:</strong></p>
</div>
<div class="paragraph">
<p>The epilog() method is called at the end of the job. It allows you to close any open resources, such as file or network handles.</p>
</div>
<div class="paragraph">
<p><strong>processPasswordEvent:</strong></p>
</div>
<div class="paragraph">
<p>The processPasswordEvent() method is called at the start of processing of an incoming JMS message that contains a password change event. It allows you to omit a password change for certain users on specific conditions.</p>
</div>
<div class="paragraph">
<p><strong>preUserPasswordUpdate:</strong></p>
</div>
<div class="paragraph">
<p>The preUserPasswordUpdate() method is called just before a real password change in the Identity store. You can stop the processing or define additional actions.</p>
</div>
<div class="paragraph">
<p><strong>postUserPasswordUpdate:</strong></p>
</div>
<div class="paragraph">
<p>The postUserPasswordUpdate() method is called after successful change of a user password in the Identity store. You can define additional actions like notifications. You can also stop further processing of the accounts.</p>
</div>
<div class="paragraph">
<p><strong>processAccountPassword</strong>:</p>
</div>
<div class="paragraph">
<p>The processAccountPassword() method is called just before a JMS notification for a setPassword workflow is sent. The method is called for all related accounts. You can prevent the workflow from sending the event and stop the processing of the account or define additional actions.</p>
</div>
</div>
<div class="sect3">
<h4 id="_deploying_a_password_user_hook"><a class="anchor" href="#_deploying_a_password_user_hook"></a>Deploying a Password User Hook</h4>
<div class="paragraph">
<p>Make sure the jar file that contains your password user hook class is deployed in the correct folder of your IdS-J Server, which is:</p>
</div>
<div class="paragraph">
<p><em>install_path</em>*/ids-j-<strong><em>domain</em></strong>-S*<em>n</em>*/confdb/common/lib*</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_customizing_event_based_maintenance_workflows"><a class="anchor" href="#_customizing_event_based_maintenance_workflows"></a>Customizing Event-based Maintenance Workflows</h3>
<div class="paragraph">
<p>All event-based maintenance workflows call a user hook during processing of the event. This action is usually performed after normal operation just before the entry is to be stored to LDAP, but might be different for certain entry types. Consult the respective description of the workflow&#8217;s operation.</p>
</div>
<div class="paragraph">
<p>A user hook is a Java class that implements the API <strong>com.siemens.idm.jobs.ebr.api.IEventProcessor</strong>. The user hook has access to the event and the changed entry. It can change the entry and perform other operations in the Identity domain using the available LDAP connection.</p>
</div>
<div class="paragraph">
<p>The following sections describe how to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Implement the user hook</p>
</li>
<li>
<p>Configure the user hook</p>
</li>
<li>
<p>Use event contexts</p>
</li>
<li>
<p>Deploy the user hook</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For a sample, see the folder <strong>Additions/EventMaintenanceWorkflows</strong> on the installation DVD.</p>
</div>
<div class="sect3">
<h4 id="_configuring_a_user_hook_for_an_event_based_maintenance_workflow"><a class="anchor" href="#_configuring_a_user_hook_for_an_event_based_maintenance_workflow"></a>Configuring a User Hook for an Event-based Maintenance Workflow</h4>
<div class="paragraph">
<p>This section explains how to configure a user hook for an event-based maintenance workflow.</p>
</div>
<div class="paragraph">
<p>You configure a user hook in the "join" activity of the workflow. You must supply the class name and optionally also configuration options. Enter these values in the activity&#8217;s Userhook tab. The following figure shows this tab:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch1_applsref/image18.gif" alt="Userhook Tab">
</div>
<div class="title">Figure 18. Userhook Tab</div>
</div>
<div class="paragraph">
<p>Enter the full class name of your implementation into <strong>Userhook Classname</strong>. This value indicates to the workflow that a user hook is to be called.</p>
</div>
<div class="paragraph">
<p>If the user hook expects configuration options, enter them in the <strong>Options</strong> table:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <strong>Property Name</strong> column contains the name of the option as the user hook expects it.</p>
</li>
<li>
<p>The <strong>Value</strong> column contains the string value of the option.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The workflow passes the configuration with the <em>open</em> method. See the implementation section for a snippet how to read the options in your user hook.</p>
</div>
</div>
<div class="sect3">
<h4 id="_implementing_a_user_hook_for_an_event_based_maintenance_workflow"><a class="anchor" href="#_implementing_a_user_hook_for_an_event_based_maintenance_workflow"></a>Implementing a User Hook for an Event-based Maintenance Workflow</h4>
<div class="paragraph">
<p>The event maintenance workflow calls the user hook typically after it has performed the standard operations just before it stores the entry changes. The user hook implements the interface <strong>com.siemens.idm.jobs.ebr.api.IEventProcessor</strong> with the following operations:</p>
</div>
<div class="paragraph">
<p><strong>setEventContext</strong>:</p>
</div>
<div class="paragraph">
<p>This is the first method the workflow calls after instantiating the user hook. In addition to the LDAP connection to the domain, the event context provides some useful methods for reading and searching one or more entries. See "Using Event Contexts" for more details.</p>
</div>
<div class="paragraph">
<p><strong>open(DxmUserhookConfig conf)</strong></p>
</div>
<div class="paragraph">
<p>With this method the workflow passes the configuration options for the user hook before any of the events is processed.</p>
</div>
<div class="paragraph">
<p>The only parameter is the user hook configuration implementing the interface <strong>siemens.dxm.configuration.DxmUserhookConfig</strong>. In addition to some meta information important for the workflow it allows to read configuration properties with its <strong>getProperty</strong> method. The following snippet shows how to read an option "objectclass":</p>
</div>
<div class="paragraph">
<p>Map&lt;String, String&gt; options = new HashMap&lt;String, String&gt;();<br>
options.put("objectclass", (String)conf.getProperty("objectclass"));</p>
</div>
<div class="paragraph">
<p><strong>processAddEvent(AddEvent event, Entry changedEntry)</strong></p>
</div>
<div class="paragraph">
<p>The workflow calls this method, when the entry was created in the Identity domain. It passes the created entry and the add event.</p>
</div>
<div class="paragraph">
<p>Each entry implements the interface <strong>com.siemens.dxm.api.entry.Entry</strong>. This interface allows getting and set attribute values and especially the DN of the LDAP entry. The <strong>siemens.dxm.connector.event.AddEvent</strong> class is generated according an XML schema, which extends a SPMLv1 request with some information about the event topic and the event source. The following snippet shows how to read the values of the attribute "owner" and to set one, if it was empty before:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">String[] values = changedEntry.getValues("owner");
if ((values == null) || (values.length == 0)) {
    changedEntry.setProperty("owner", "cn=DefaultOwner,cn=Users," + eventCtx.getDomainRoot());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you shouldn&#8217;t store the entry changes yourself. This is done by the workflow at the end of the event processing, if the entry was changed. But if you change other entries, you need to store them yourself. See "Using Event Contexts" how to do this.</p>
</div>
<div class="paragraph">
<p><strong>processModifyEvent(ModifyEvent event, Entry changedEntry)</strong></p>
</div>
<div class="paragraph">
<p>The workflow calls this method when the entry was changed in the Identity domain. It passes the changed entry and the modify event.</p>
</div>
<div class="paragraph">
<p>Each entry implements the interface <strong>com.siemens.dxm.api.entry.Entry</strong>. This interface allows getting and set attribute values and especially the DN of the LDAP entry. The <strong>siemens.dxm.connector.event.ModifyEvent</strong> class is generated according an XML schema, which extends a SPMLv1 request with some information about the event topic and the event source. The following snippet shows how to check, if the attribute "dxrState" was modified to the value "TBDEL", i.e. if the entry is to be deleted in the connected system:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">for (DsmlModification mod : event.getModifications().getModification()) {
    if ("dxrState".equalsIgnoreCase(mod.getName()) &amp;&amp; ("TBDEL".equalsIgnoreCase(mod.getValue(0)) {
        entryDeleted = true;
        break;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you shouldn&#8217;t store the entry changes yourself. This is done by the workflow at the end of the event processing, if the entry was changed. But if you change other entries, you need to store them yourself. See "Using Event Contexts" how to do this.</p>
</div>
<div class="paragraph">
<p><strong>processDeleteEvent(DeleteEvent event)</strong></p>
</div>
<div class="paragraph">
<p>The workflow calls this method, when the entry was deleted in the Identity domain. It passes only the delete event as the entry itself is not available any more.</p>
</div>
<div class="paragraph">
<p>The <strong>siemens.dxm.connector.event.DeleteEvent</strong> class is generated according an XML schema. In addition to the event topic and the event source the embedded SPMLv1 delete request contains the DN of the deleted entry. See the following snippet how to read the DN:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">String dn = SpmlUtils.getIdString(event);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This allows you to search for other entries referencing the deleted one and perform some cleanup.</p>
</div>
<div class="paragraph">
<p><strong>close()</strong>:</p>
</div>
<div class="paragraph">
<p>The workflow calls this method after all entries of the batch are processed. It allows the user hook to perform some housekeeping.</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_event_contexts"><a class="anchor" href="#_using_event_contexts"></a>Using Event Contexts</h4>
<div class="paragraph">
<p>A user hook for an event-based maintenance workflow may use an event context object. An event context implements the interface <strong>com.siemens.idm.jobs.ebr.api.EventContext*<em>.</em> It is passed in the method *setEventContext</strong> of the <strong>IEventProcessor</strong> interface.</p>
</div>
<div class="paragraph">
<p>The event context provides some useful helper methods:</p>
</div>
<div class="paragraph">
<p><strong>getDomainRoot()</strong></p>
</div>
<div class="paragraph">
<p>Returns the DN of the Identity domain root node.</p>
</div>
<div class="paragraph">
<p><strong>getLDAPConnection()</strong></p>
</div>
<div class="paragraph">
<p>Returns an established LDAP connection to the Identity domain.</p>
</div>
<div class="paragraph">
<p><strong>getEntry(String dn)</strong></p>
</div>
<div class="paragraph">
<p>Reads the entry with the given DN from the Identity domain. It returns an object, which implements the <strong>com.siemens.dxm.api.entry.Entry</strong> API. This API allows reading and setting attributes.</p>
</div>
<div class="paragraph">
<p><strong>searchEntries(String base, String filter)</strong></p>
</div>
<div class="paragraph">
<p>Performs an LDAP search in the Identity domain with the given search base and filter. The method returns the found entries as an enumeration. Each entry implements the <strong>com.siemens.dxm.api.entry.Entry</strong> API.</p>
</div>
<div class="paragraph">
<p><strong>saveEntry(Entry entry)</strong></p>
</div>
<div class="paragraph">
<p>Stores the entry in the Identity domain.</p>
</div>
<div class="paragraph">
<p>Note that the user hook should not store the entry referenced in the change event, but needs to store all others it has changed.</p>
</div>
</div>
<div class="sect3">
<h4 id="_deploying_a_user_hook_for_an_event_based_maintenance_workflow"><a class="anchor" href="#_deploying_a_user_hook_for_an_event_based_maintenance_workflow"></a>Deploying a User Hook for an Event-based Maintenance Workflow</h4>
<div class="paragraph">
<p>To deploy your user hook, build a jar file with your class and copy this file and any other jar files you need to the following folder of your Java-based Server installation:</p>
</div>
<div class="paragraph">
<p><em>install_path</em>*/ids-j-<strong><em>domain</em></strong>-S*<em>n</em>*/confdb/common/lib*</p>
</div>
<div class="paragraph">
<p>Make sure the user hook is configured and then re-start the IdS-J server.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_combined_workflows"><a class="anchor" href="#_using_combined_workflows"></a>Using Combined Workflows</h3>
<div class="paragraph">
<p>You can combine a set of Java-based workflows into a "combined workflow" and define the sequence in which these workflows should be run. Note that you cannot combine entry change workflows, cluster workflows and combined workflows.</p>
</div>
<div class="paragraph">
<p>For a combined workflow, you select a sequence of workflows. All activities of the selected workflows are copied into the combined workflow (the referenced workflow is only referenced, not changed). Start conditions are adapted so that the activities are started in the defined sequence.</p>
</div>
<div class="paragraph">
<p>The activities are named <em>worklow_name</em>*-<strong><em>join</em></strong>-*<em>sequence<strong>-</strong>nr</em>.Activity <em>n</em>+1 is started after activity <em>n</em> has finished.</p>
</div>
<div class="paragraph">
<p>For every workflow that is included in the combined workflow, you can also define whether or not it should stop if the preceding workflow or activity finishes with the state WARNING.</p>
</div>
<div class="paragraph">
<p>To create a combined workflow, use the New menu and select <strong>Combined</strong> <strong>Realtime</strong> <strong>Workflow</strong>.In the Workflow Sequence tab, insert the workflows in the order you want to run them.</p>
</div>
<div class="paragraph">
<p>You can start a combined workflow with the DirX Identity Manager by using Run workflow from the context menu at the combined workflow object or you can define a schedule for the combined workflow.</p>
</div>
<div class="paragraph">
<p>Using a combined workflow (instead of scheduling each workflow separately with a given start time) guarantees that the workflows are started in sequence one after the other and ensures that there are no overlays or gaps between the workflows.For example, you can define a combined workflow that first performs a source import from a database, next performs a source import from SAP and then performs user resolution for these imported users.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="understanding_tcl_based_workflows"><a class="anchor" href="#understanding_tcl_based_workflows"></a>Understanding Tcl-based Workflows</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The sections in this chapter include information about Tcl-based workflows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Tcl-based Connectivity architecture - defines the concepts of the DirX Identity Tcl-based workflows</p>
</li>
<li>
<p>Understanding server delta handling</p>
</li>
<li>
<p>Customizing Tcl-based workflows - describes customization procedures and hints.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_tcl_based_connectivity_architecture"><a class="anchor" href="#_tcl_based_connectivity_architecture"></a>Tcl-based Connectivity Architecture</h3>
<div class="paragraph">
<p>The Tcl-based connectivity architecture is based on a standard script that is designed to handle all transfers between two connected directories in one step.For two-step workflows (which require an additional agent to access the target connected directory’s API), the standard script handles the meta controller (<strong>metacp</strong>) step.</p>
</div>
<div class="paragraph">
<p>The connectivity standard script can be controlled by about 60 parameters and also by optional user hook routines. It is structured into the following logical sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <strong>control script</strong>, which defines all parameters, including the default values and references to the relevant attributes at the user interface (DirX Identity Manager) level.</p>
</li>
<li>
<p>A <strong>profile script</strong>, which contains the central algorithm for the connectivity script.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The profile script is divided into the following logical sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <strong>prolog section</strong>, which performs preparatory tasks before the loop section is executed, such as opening input and output connections, reading attribute configuration files, and so on.</p>
</li>
<li>
<p>The <strong>loop section</strong>, which performs, for each entry in the source, all of the necessary actions: mapping, joining, operation on the target system side, and so on. This section is the most complex, because it can handle file and LDAP connections and contains most of the script&#8217;s functionality and features.</p>
</li>
<li>
<p>The <strong>epilog section</strong>, which performs all completion tasks, such as releasing handles and closing connections.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All of the parameters that control the script are accessible from Identity Manager. They are distributed into the relevant tabs of the job, channel and connected directory configuration objects, which can be referenced from the relevant wizards.</p>
</div>
<div class="paragraph">
<p>The script&#8217;s design is based on the following requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One script for all applications</p>
</li>
<li>
<p>Controllable by switches and user hooks</p>
</li>
<li>
<p>Clear separation between central, local and user parts</p>
</li>
<li>
<p>Clear separation between entry masters and attribute masters. An entry master can add and delete entries, while an attribute master can only perform attribute modifications.</p>
</li>
<li>
<p>Handling of multi-entry and attribute masters</p>
</li>
<li>
<p>Support of manual masters (such as Web interfaces)</p>
</li>
<li>
<p>Support of purification workflows (for example, the deletion of entries marked for deletion).<br>
Note: This version does not implement this feature.</p>
</li>
<li>
<p>Support of operational attributes (mastership, status, entry and expiration dates)</p>
</li>
<li>
<p>Enhanced tracing (an additional command trace)</p>
</li>
<li>
<p>Delta handling based on date type</p>
</li>
<li>
<p>Tuning parameters (Read DN Only, paged mode)</p>
</li>
<li>
<p>Support of merge and replace modes</p>
</li>
<li>
<p>Standard handling of notifications</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The script can handle the following types of synchronizations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>File to file</p>
</li>
<li>
<p>LDAP to file</p>
</li>
<li>
<p>File to LDAP</p>
</li>
<li>
<p>LDAP to LDAP</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With extra profile scripts, it can handle DirX change log information and HDMS connections.</p>
</div>
<div class="paragraph">
<p>All LDAP connections can work optionally in paged mode.</p>
</div>
<div class="paragraph">
<p>The next sections provide information about:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The script structure</p>
</li>
<li>
<p>The script behavior</p>
</li>
<li>
<p>The switches and parameters that control the script</p>
</li>
<li>
<p>References used in default applications</p>
</li>
<li>
<p>Object class handling</p>
</li>
<li>
<p>The GUID generator</p>
</li>
<li>
<p>Multi-mastered attributes</p>
</li>
<li>
<p>Naming and scopes</p>
</li>
<li>
<p>User hook routines</p>
</li>
<li>
<p>Important Tcl interfaces</p>
</li>
<li>
<p>Global Tcl variables</p>
</li>
<li>
<p>Meta handles</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_connectivity_standard_script_structure"><a class="anchor" href="#_connectivity_standard_script_structure"></a>Connectivity Standard Script Structure</h4>
<div class="paragraph">
<p>The Connectivity standard script consists of logical pieces that are stored in specific physical locations in the installation area or the configuration database. The following sections describe the script&#8217;s logical structure and use an example to illustrate its physical structure.</p>
</div>
<div class="sect4">
<h5 id="_connectivity_standard_script_logical_structure"><a class="anchor" href="#_connectivity_standard_script_logical_structure"></a>Connectivity Standard Script Logical Structure</h5>
<div class="paragraph">
<p>The following figure illustrates the logical structure of the DirX Identity Connectivity standard script.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch1_applsref/image19.gif" alt="DirX Identity Connectivity Script Logical Structure">
</div>
<div class="title">Figure 19. DirX Identity Connectivity Script Logical Structure</div>
</div>
<div class="paragraph">
<p>The <strong>control script</strong> is the script that starts the whole procedure. It contains all of the variables that control the rest of the procedure. The values of these variables are linked by DirX Identity references to the attributes of objects in the configuration directory. It also loads the central routines from the installation area and the profile, mapping and miscellaneous scripts from the job object.</p>
</div>
<div class="paragraph">
<p>The control script calls the <strong>profile script</strong>, which performs the central algorithm. Different profile scripts are delivered to provide different basic algorithms. Most workflows use the standard script <strong>Profile Script</strong>, while others use the <strong>HDMS Export Profile Script</strong> or the <strong>LDIF Change Profile Script</strong>.</p>
</div>
<div class="paragraph">
<p>One of the most important parts of this algorithm - the <strong>mapping script</strong> - must be highly configurable, since it is individual to each workflow. The script is divided into a mapping that occurs before the join operation and a <strong>post join mapping</strong> that occurs after the join operation.</p>
</div>
<div class="paragraph">
<p>All scripts can call common routines provided by the <strong>central script</strong> (routines that are common to any workflow) and the <strong>common script</strong> (routines that are used by this type of workflow).</p>
</div>
<div class="paragraph">
<p>The profile script calls local routines (hooks). Default routines for these hooks are loaded with the <strong>user hooks default script</strong>. You can establish your own extensions by providing routines in the <strong>user hooks script</strong> (they will overload the default routines).</p>
</div>
</div>
<div class="sect4">
<h5 id="_connectivity_standard_script_physical_structure"><a class="anchor" href="#_connectivity_standard_script_physical_structure"></a>Connectivity Standard Script Physical Structure</h5>
<div class="paragraph">
<p>We&#8217;ll use an example to explain the physical structure of the Connectivity standard script and its relationship to other objects in the configuration database and the installation area. The following figure illustrates this example.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch1_applsref/image20.gif" alt="DirX Identity Connectivity Script Physical Structure">
</div>
<div class="title">Figure 20. DirX Identity Connectivity Script Physical Structure</div>
</div>
<div class="paragraph">
<p>The <strong>job MyMetaCPjob</strong> references the <strong>MetaCP agent</strong> that is of <strong>type Meta Controller</strong>, which is described by the "Meta Controller-Job.xml" definition. The job also relates to channels (here <strong>Channel 1</strong>) that access the LDAP directory (for example, <strong>MetaStore</strong>), which is of <strong>type LDAP</strong> and is described by the "LDAP-ConnDir.xml" definition.</p>
</div>
<div class="paragraph">
<p>The <strong>mapping script</strong> and the <strong>user hooks script</strong> are local objects of the workflow. They are downloaded to the work area before each workflow run. Only some of the default application workflows initially contain a user hooks script (for example the RACF workflows).</p>
</div>
<div class="paragraph">
<p>The <strong>central script</strong>, the <strong>common script</strong>, the <strong>post join default script</strong> and the <strong>user hooks default script</strong> (a template) are located in the installation area of DirX Identity (path: <em>install_path</em>*\lib\centralTcl*). They are part of the installation and will not be downloaded before each workflow run. Because the common script&#8217;s size is more than 130 KB, this saves time. For information purposes, a copy of these scripts is shown at the user interface level in the configuration database.</p>
</div>
<div class="paragraph">
<p>Please note that changing these script copies has no effect! You should instead copy the user hooks default script as an individual <strong>user hooks script</strong> or <strong>post join script</strong> under your job object (don’t forget to link it to the job) and modify the routines as required. This user hooks script and all of the other miscellaneous scripts will be downloaded before each workflow run.</p>
</div>
<div class="paragraph">
<p>The <strong>control</strong>, <strong>profile,</strong> <strong>common</strong>, <strong>post join default script</strong> and <strong>user hooks default scripts</strong> (together with the <strong>messages script</strong> that contains all messages) are located in the central configuration area in the section <strong>Tcl</strong> &#8594; <strong>Default</strong>. Only the control, profile and messages scripts will also be downloaded before each workflow run.</p>
</div>
<div class="paragraph">
<p><strong>Warning:</strong> You are not allowed to change the central or common scripts (because any changes will be overwritten during update and upgrade installations!). Instead, you can copy a routine you’d like to change to your local user hooks script. This routine overloads the routine from the central script. The advantage of this method is that you can view all of your changes in one place and that an exchange or update of central script will not affect your workflow at all.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_provisioning_workflow_script_structure"><a class="anchor" href="#_provisioning_workflow_script_structure"></a>Provisioning Workflow Script Structure</h4>
<div class="paragraph">
<p>The DirX Identity Provisioning workflows use the default DirX Identity Connectivity standard script structure. The following figure illustrates how the DirX Identity Provisioning script structure is embedded in the DirX Identity Connectivity script structure.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch1_applsref/image21.gif" alt="DirX Identity Provisioning and Connectivity Script Structure">
</div>
<div class="title">Figure 21. DirX Identity Provisioning and Connectivity Script Structure</div>
</div>
<div class="paragraph">
<p>The left two columns of the figure represent the default DirX Identity Connectivity script structure. The DirX Identity <strong>metacp</strong> scripts (mapping, post-join mapping, and user hooks) call functions in the DirX Identity <strong>provisioning</strong> <strong>common script</strong> and the <strong>provisioning</strong> <em>TS</em> <strong>common script</strong>. The following figure illustrates these interactions in more detail.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch1_applsref/image22.gif" alt="DirX Identity Connectivity and Provisioning Script Function Calls">
</div>
<div class="title">Figure 22. DirX Identity Connectivity and Provisioning Script Function Calls</div>
</div>
<div class="paragraph">
<p>The provisioning <em>TS</em> common script functions include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>accountEnabled()</strong><br>
Checks whether the account is enabled or disabled in the target system depending on the passed target system attribute(s), and sets the passed variable AccEnabled to TRUE or FALSE.</p>
</li>
<li>
<p><strong>setPasswordFlags()</strong><br>
Sets the password-specific flags of an account in a role depending on the passed target system attribute(s).</p>
</li>
<li>
<p><strong>splitLocalRemoteMembers()</strong><br>
Divides the list of the target system group members into local members, which are all members that belong to the target systems users or group root, and remote members, which are outside these roots.</p>
</li>
<li>
<p><strong>setGroupType()</strong><br>
Sets the group type attribute in a role depending on the passed target system attribute.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Provisioning common script functions include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>addAccountInRole()</strong><br>
Sets the dxrTSState attribute of the account in a role to DISABLED or ENABLED depending on the passed AccEnabled parameter. Sets the dxrState attribute to IMPORTED and the dxrToDo attribute to CREATED_IN_TS for a validation workflow.</p>
</li>
<li>
<p><strong>modAccountInRole()</strong><br>
Sets the dxrTSState attribute of the account in a role to DISABLED or ENABLED depending on the passed AccEnabled parameter. The function leaves the dxrState attribute as it is and sets the dxrToDo attribute to RECREATED_IN_TS for a validation workflow if dxrState was in the state DELETED.</p>
</li>
<li>
<p><strong>addGroupInRole()</strong><br>
Sets the dxrTSState and the dxrState attribute of the group in a role to ENABLED. Sets the dxrTSLocal attribute to TRUE and the dxrToDo attribute to CREATED_IN_TS in case of a validation workflow. Sets dxrGroupMemberImported to the local members of the target system, which were calculated by the splitLocalRemoteMembers function.</p>
</li>
<li>
<p><strong>modGroupInRole()</strong><br>
Sets the dxrTSState attribute of the group in a role to ENABLED. The function leaves the dxrState, dxrTSLocal and dxrToDo attributes as they are and sets the group member attributes according to the passed list of local target system group members and of the actual group member states in role.</p>
</li>
<li>
<p><strong>postJoinAddAccInTS()</strong><br>
Depending on the account attributes in a role, calls the following functions of the postJoinMapping script of the sync account job, which perform the target system specific attribute settings:</p>
</li>
<li>
<p>setAccEnabled() if the accounts dxrState in role is ENABLED</p>
</li>
<li>
<p>setAccDisabled() if the accounts dxrState in role is DISABLED</p>
</li>
<li>
<p>setPassword()</p>
</li>
<li>
<p>resetPwdNotRequired()</p>
</li>
<li>
<p>setChgPwdAtLogin()</p>
</li>
<li>
<p>resetPwdCantChange()</p>
</li>
<li>
<p>setPwdNeverExpires() if dxrPwdNeverExpires in role is TRUE</p>
</li>
<li>
<p>resetPwdNeverExpires() if dxrPwdNeverExpires in role is FALSE</p>
</li>
<li>
<p><strong>postJoinModAccInTS()</strong><br>
Depending on the account attributes in a role, calls the following functions of the postJoinMapping script of the sync account job, which perform the target system-specific attribute settings:</p>
</li>
<li>
<p>setAccEnabled() if the accounts dxrState in role is ENABLED</p>
</li>
<li>
<p>setAccDisabled() if the accounts dxrState in role is DISABLED</p>
</li>
<li>
<p>deletePassword()</p>
</li>
<li>
<p>setPwdNotRequired() if dxrPwdNotRequired in role is TRUE</p>
</li>
<li>
<p>resetPwdNotRequired() if dxrPwdNotRequired in role is FALSE</p>
</li>
<li>
<p>setPwdCantChange() if dxrPwdCantChange in role is TRUE</p>
</li>
<li>
<p>resetPwdCantChange() if dxrPwdCantChange in role is FALSE</p>
</li>
<li>
<p>setPwdNeverExpires() if dxrPwdNeverExpires in role is TRUE</p>
</li>
<li>
<p>resetPwdNeverExpires() if dxrPwdNeverExpires in role is FALSE</p>
</li>
<li>
<p><strong>postJoinDelAccInTS()</strong><br>
This function currently does nothing. In the future, it may contain common coding for all target system workflows.</p>
</li>
<li>
<p><strong>postJoinAddGrpInTS()</strong><br>
This function currently does nothing. In the future, it may contain common coding for all target system workflows.</p>
</li>
<li>
<p><strong>postJoinModGrpInTS()</strong><br>
This function currently does nothing. In the future, it may contain common coding for all target system workflows.</p>
</li>
<li>
<p><strong>postJoinDelGrpInTS()</strong><br>
This function currently does nothing. In the future, it may contain common coding for all target system workflows.</p>
</li>
<li>
<p><strong>setTSAttributesInRole()</strong><br>
For a validation workflow, sets the dxrLastValidation attribute of the target system object in a role to the current time and the accountRootInTS and groupRootInTS attributes of the target system object in a role to the values passed to the function.</p>
</li>
<li>
<p><strong>del_TS2Role()</strong><br>
Called only in the validation workflow for all objects in a <strong>metacp</strong> search result that cannot be matched to any source entry in order to either delete or modify the object. The function deletes the object in a role if the dxrState attribute of the object is set to DELETED; otherwise, it sets the dxrTSState attribute to DELETED and writes a dxrToDo message.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_connectivity_standard_script_operation"><a class="anchor" href="#_connectivity_standard_script_operation"></a>Connectivity Standard Script Operation</h4>
<div class="paragraph">
<p>The meta controller is called with the control script as a parameter (see the command line attribute of the job). The next sections describe how the control and profile scripts operate.</p>
</div>
<div class="sect4">
<h5 id="_control_script_operation"><a class="anchor" href="#_control_script_operation"></a>Control Script Operation</h5>
<div class="paragraph">
<p>The Connectivity standard script&#8217;s control script contains all of the variable settings; that is, constants or references to attributes of other objects in the configuration database. These variable settings are grouped into the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Common parameters <strong>-</strong> basic parameters needed for the other sections (for example, the role names of the input and output channels).</p>
</li>
<li>
<p>GUID generator parameters - parameters that control the generation of global unique identifiers.</p>
</li>
<li>
<p>Common job-specific parameters - parameters that belong to the job: tracing, operation control, notification and data control.</p>
</li>
<li>
<p>Source parameters - parameters that control the source connected directory and its channel.</p>
</li>
<li>
<p>Target parameters - parameters that control the target connected directory and its channel.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The control script loads the standard scripts in the following sequence:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Loads the <strong>central.tcl</strong> script with the <strong>source</strong> command. This script contains important routines like <strong>dxm_source</strong> that are necessary to load scripts with another code set.</p>
</li>
<li>
<p>Reads <strong>user_hooks_default.tcl</strong>, which contains all relevant empty user hook routines. This action pre-defines these routines.</p>
</li>
<li>
<p>Reads the <strong>mapping script</strong>.</p>
</li>
<li>
<p>Uses a loop to load all miscellaneous scripts, including the <strong>user_hooks.tcl</strong> script if it is defined by the user and any other routines needed for the job. Note: Scripts that cannot be edited are not loaded (the common script is an example).</p>
</li>
<li>
<p>Reads the <strong>profile script</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The control script&#8217;s loading logic relies on Tcl&#8217;s routine overloading mechanism, in which the last loaded routine is used.</p>
</div>
</div>
<div class="sect4">
<h5 id="_profile_script_operation"><a class="anchor" href="#_profile_script_operation"></a>Profile Script Operation</h5>
<div class="paragraph">
<p>The control flow for the standard script consists of several steps. The <strong>prolog</strong> step prepares all of the necessary prerequisites. The <strong>process entry loop</strong> reads entries from the source, maps the entries, then joins the mapped entries and writes them to the target. The <strong>epilog</strong> step closes all channels and handles and performs notifications if necessary.</p>
</div>
<div class="paragraph">
<p>The profile script contains only the main logic. All detailed routines are contained in the common script or the central script. The following figure illustrates the profile script algorithm.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch1_applsref/image23.gif" alt="Profile Script Algorithm">
</div>
<div class="title">Figure 23. Profile Script Algorithm</div>
</div>
<div class="paragraph">
<p><strong>Profile Script - Prolog</strong></p>
</div>
<div class="paragraph">
<p>The prolog step performs the following tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Initializes the meta controller.</p>
</li>
<li>
<p>Sets all necessary default values.</p>
</li>
<li>
<p>Calls the <strong>uh::Preprocessing</strong> user hook, which prepares everything before the rest of the script logic is executed. Note: no handles are available at this point.</p>
</li>
<li>
<p>Opens connections to the source and target connected directories and creates handles for them. This task consists of the following sub-tasks:</p>
</li>
<li>
<p>Reading the attribute configurations (variables: <strong>File Name</strong> and <strong>Encoding</strong>).</p>
</li>
<li>
<p>Performing a bind if Directory Type = LDAP (variables: <strong>Server Address, Protocol, User, Password, SSL Connection, Authentication, Protocol</strong>).</p>
</li>
<li>
<p>Opening a file if Directory Type = File (variables: <strong>File Name, File Format, File Mode, Encoding</strong>).</p>
</li>
<li>
<p>Creating the necessary handles for the source and target connection.</p>
</li>
<li>
<p>Creating a second handle for the input channel, if <strong>Read DN Only</strong> is set.</p>
</li>
<li>
<p>Defining <strong>Page Size</strong> to allow page mode operation if <strong>Paged Read</strong> is set.</p>
</li>
<li>
<p>Reads the source (variables: <strong>Base Object</strong> and <strong>Subset</strong> both from the input channel as well as a <strong>Search</strong> and <strong>OR</strong> <strong>Filter</strong>) and eventually sort it (if <strong>Sorted List</strong> = true together with <strong>Sort Key</strong> and <strong>Sort Order</strong>). This is only necessary when the search result is not sorted and a sorted result is necessary. If <strong>Paged Read</strong> is set <strong>Page Size</strong> must be defined to allow page mode operation.</p>
</li>
<li>
<p>If the workflow shall replace all entries in the target; that is, if a deletion of entries that are no longer available compared to the source is necessary, a full target search (variables: <strong>Base Object</strong>, <strong>Subset</strong> both from the output channel as well as the <strong>Replace Filter</strong>) with a subsequent sort is required (variables: <strong>Sorted List</strong> = true together with <strong>Sort Key</strong> and <strong>Sort Order</strong>). The result must be sorted because the <strong>Sort Key</strong> is used for the find operation later on in the join operation.</p>
</li>
<li>
<p>Calls the <strong>uh::Prolog</strong> user hook.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now the source and target are prepared. Next, the loop on all entries must be performed.</p>
</div>
<div class="paragraph">
<p><strong>Profile Script - Process Entry Loop</strong></p>
</div>
<div class="paragraph">
<p>The profile script&#8217;s standard entry processing loop (used by the <strong>profile.tcl</strong> script) performs the following tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reads an entry from the source.</p>
</li>
<li>
<p>Initializes the target entry (sets all fields to initial values).</p>
</li>
<li>
<p>Optionally applies an extra filter during the user hook <strong>uh::LoopExtraFilter</strong>. This filter allows the individual exclusion of entries from further actions.</p>
</li>
<li>
<p>Performs the mapping (subroutine <strong>perform_mapping</strong>). This routine delivers the return code <strong>0</strong> for OK and <strong>1</strong> for errors that occurred.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The sequence of steps is different depending on the <strong>Directory Type</strong>.</p>
</div>
<div class="paragraph">
<p>If <strong>Directory Type = LDAP</strong>, the following steps are performed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <strong>Import Mode = Merge</strong>, a search based on the <strong>Join Expression</strong> or <strong>Expert Filter</strong> is performed in the target directory. In this case a list of searches can be performed.</p>
</li>
<li>
<p>If <strong>Import Mode = Replace</strong>, the object is retrieved from the existing (and sorted) search result.</p>
</li>
<li>
<p>Depending on the result, an action is calculated (see the subroutine <strong>Calculate Action</strong>).</p>
</li>
<li>
<p>After calculating the action, a postJoin routine (<strong>uh::LoopPostJoin</strong>) performs an additional mapping step that merges information from the joined entry with the mapped information.</p>
</li>
<li>
<p>Depending on the calculated action and the join result, the <strong>Entry Handling</strong> subroutine is called. The possible actions are:</p>
</li>
<li>
<p><strong>action = add</strong><br>
A new entry will be created.</p>
</li>
<li>
<p><strong>action = mod</strong><br>
The located entry is to be modified.</p>
</li>
<li>
<p><strong>action = modDN</strong><br>
The distinguished name (DN) of the located entry will be modified.</p>
</li>
<li>
<p><strong>action = del</strong><br>
A delete operation will be performed for this entry depending on the selected deletion mode (see the deletion algorithm ). The user hook <strong>uh::Delete</strong> is eventually called.</p>
</li>
<li>
<p><strong>action = done</strong><br>
The action to be taken has already been carried out. No action is necessary.</p>
</li>
<li>
<p><strong>action = error</strong><br>
An error must be reported because something was incorrect. This action will result in a warning at the workflow level.</p>
</li>
<li>
<p>An extra function can be optionally executed (<strong>uh::LoopExtraFunction</strong>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <strong>Directory Type = FILE</strong>, similar procedures are called:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A user-specific join routine can be performed (<strong>uh::LoopPerformJoin</strong>).</p>
</li>
<li>
<p>Depending on the result, an action is calculated (see the <strong>Calculate Action</strong> subroutine).</p>
</li>
<li>
<p>After calculating the action, a postJoin routine (<strong>uh::LoopPostJoin</strong>) performs an additional mapping step that merges information from the joined entry with the mapped information.</p>
</li>
<li>
<p>Writes the record to the file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Profile Script - Calculate Action</strong></p>
</div>
<div class="paragraph">
<p>The profile script&#8217;s "calculate action" subroutine calculates the action to be taken based on any change type, source entry status, and target entry conditions, as illustrated in the following figure.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch1_applsref/image24.gif" alt="Profile Script - Calculate Action Logic">
</div>
<div class="title">Figure 24. Profile Script - Calculate Action Logic</div>
</div>
<div class="paragraph">
<p>As shown in the figure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A ChangeType condition allows the action in the target directory to be controlled by information coming from the source directory (for example, change types defined in LDIF change syntax).</p>
</li>
<li>
<p>When the source directory keeps status information about new or deleted entries (<strong>Source Add Marking Attribute</strong> and <strong>Value</strong> and <strong>Source Del Marking Attribute</strong> and <strong>Value</strong>), this information allows the action to be controlled at the target directory side. For example, a customerStatus attribute with the value <strong>New</strong> in the source directory could force an add operation in the target directory.</p>
</li>
<li>
<p>In some cases, the existence of an attribute in the source directory that comes from the target directory can indicate the existence of a target system entry (<strong>Target Entry Exists</strong>). This indicator only works when a workflow operates in the opposite direction that handles this attribute.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If none of these conditions is met, the action is set to <strong>mod</strong>.</p>
</div>
<div class="paragraph">
<p><strong>Profile Script - Entry Handling</strong></p>
</div>
<div class="paragraph">
<p>Based on the calculated action and the result of the join operation, the entry is handled as shown in the following figure.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch1_applsref/image25.gif" alt="Profile Script - Entry Handling Logic">
</div>
<div class="title">Figure 25. Profile Script - Entry Handling Logic</div>
</div>
<div class="paragraph">
<p>As shown in the figure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If no entry is found and action = del, an error is reported or no further action is performed, depending on the exact action switch. If action = mod, an error is reported or an add operation is performed, depending on the exact action switch</p>
</li>
<li>
<p>If exactly one entry is found and action = del, the entry is deleted. Action = modDN results in a modifyDN operation. If action = mod, the entry is modified. Otherwise, the entry is either modified or an error is reported, depending on the exact action switch</p>
</li>
<li>
<p>If more than one entry is found, an error is reported.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After the entry processing, a user hook (<strong>uh:LoopExtraFunction</strong>) allows you to define user-specific additional processing.</p>
</div>
<div class="paragraph">
<p><strong>Note:</strong> In the loop, an error means that the workflow’s result will be <strong>Warning</strong>. Otherwise one single erroneous entry would abort the workflow.</p>
</div>
<div class="paragraph">
<p><strong>Profile Script - Epilog</strong></p>
</div>
<div class="paragraph">
<p>The profile script&#8217;s epilog step performs the following tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When the script works in replace mode (switch <strong>Import Mode</strong>), it deletes all entries that were not contained in the source but are contained in the target (in a separate loop after the main loop).</p>
</li>
<li>
<p>When the script works in delta mode (switch <strong>Delta Synchronization</strong>), it processes the delta information and delivers it to the C++-based identity server.</p>
</li>
<li>
<p>When notifications are required (switch <strong>Notify Not OK</strong> is set or one of the <strong>Entry Handling</strong> switches <strong>Add Entries</strong>, <strong>Modify Entries</strong> or <strong>Delete Entries</strong> is set to one of the NTF options), it sends notifications.</p>
</li>
<li>
<p>Closes all connections have (unbind for directories, close for files)</p>
</li>
<li>
<p>Writes statistics (switch <strong>Statistics</strong>).</p>
</li>
<li>
<p>Terminates the meta controller and automatically closes all handles.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Profile Script - Delete Entries</strong></p>
</div>
<div class="paragraph">
<p>The delete routine is either called from the central processing loop for each entry or from the separate loop at the end for all unmarked entries. The following figure illustrates its logic:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch1_applsref/image26.gif" alt="Profile Script - Entry Deletion Logic">
</div>
<div class="title">Figure 26. Profile Script - Entry Deletion Logic</div>
</div>
<div class="paragraph">
<p>As shown in the figure, the delete routine:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Does nothing if <strong>Delete Entries</strong> is not activated.</p>
</li>
<li>
<p>Checks whether the entry is in the <strong>Keep Objects</strong> list. If yes, it preserves the entry.</p>
</li>
<li>
<p>If <strong>Operational Attributes</strong> are activated, sets the <strong>dxrState</strong> to TBDEL and sets the <strong>dxrEndDate</strong> to the current date.</p>
</li>
<li>
<p>Otherwise, evaluates the <strong>Deletion Mode</strong>:</p>
</li>
<li>
<p><strong>MARK</strong> - Sets the value of the defined marking attribute.</p>
</li>
<li>
<p><strong>MOVE -</strong> Moves the entry to the tombstone area (by eventually calling <strong>uh::GenerateTombstoneDN</strong>).</p>
</li>
<li>
<p><strong>PHYSICAL -</strong> Physically deletes the entry.</p>
</li>
<li>
<p><strong>USER -</strong> Calls the user hook <strong>uh::Delete</strong>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_connectivity_standard_script_switches_and_parameters"><a class="anchor" href="#_connectivity_standard_script_switches_and_parameters"></a>Connectivity Standard Script Switches and Parameters</h4>
<div class="paragraph">
<p>You use switches and parameters to control the behavior of the Connectivity standard script. The following sections give information about switches and parameters for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Operational control</p>
</li>
<li>
<p>Notification control</p>
</li>
<li>
<p>Global unique identifier (GUID) generation</p>
</li>
<li>
<p>Trace control</p>
</li>
<li>
<p>Source connected directory specification</p>
</li>
<li>
<p>Input channel specification</p>
</li>
<li>
<p>Target connected directory specification</p>
</li>
<li>
<p>Output channel specification</p>
</li>
<li>
<p>Pre-configured operational attribute handling</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_switches_for_operational_control"><a class="anchor" href="#_switches_for_operational_control"></a>Switches for Operational Control</h5>
<div class="paragraph">
<p>The following set of switches control the script&#8217;s operation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <strong>Delta Synchronization</strong> switch allows you to run the meta controller (<strong>metacp</strong>) job in delta mode based on date information (by default based on creation and modification time stamps or optionally on any other time attribute). For details, see "Understanding Delta Handling" in section "Managing the C++-based Server" in chapter "Managing Identity Servers" in the <em>DirX Identity Connectivity Administration Guide</em>.</p>
</li>
<li>
<p>The <strong>Minimum Source Entries</strong> switch helps to avoid situations in which the number of source entries differs a lot (due to an error in the generation of the entries) during subsequent runs of a full update or an export. The switch allows you to specify a minimum number of entries that must be available; otherwise, the workflow terminates with error and returns exit code 12.<br>
<br>
For import workflows running in <strong>MERGE</strong> mode, this parameter is not evaluated. However it is evaluated for import workflows running in <strong>REPLACE</strong> mode. In <strong>REPLACE</strong> mode, this parameter helps to avoid deletion of objects if only a small number of source entries is provided (by mistake).</p>
</li>
<li>
<p>The <strong>Exact Action</strong> switch allows you to control the algorithm&#8217;s automatic correction features.</p>
</li>
<li>
<p>The <strong>Init Mode</strong> switch allows you to run the meta controller either in real mode, where LDAP operations are performed, or trial mode, where trace information is written but LDAP update operations are not performed (searches are performed to simulate the real behavior).</p>
</li>
<li>
<p>The <strong>Test Mapping Only</strong> switch allows you to select whether just a test mapping is performed or if all operations (LDAP and file operations) are executed. You can use the <strong>Test Max Entries</strong> switch to define the number of entries to be mapped.</p>
</li>
<li>
<p>The <strong>Operational Attributes</strong> switch controls whether operational attributes are to be used, which controls the marking of entries with the master name or the handling of status attributes and entry and expiration dates. See the "Pre-Configured Operational Attribute Handling" section for details.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_switches_for_notification_control"><a class="anchor" href="#_switches_for_notification_control"></a>Switches for Notification Control</h5>
<div class="paragraph">
<p>The Connectivity standard script currently implements two basic notification mechanisms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <strong>Notify Not OK</strong> switch, which allows a notification to be created when the meta controller job runs into an error and/or warning situation.</p>
</li>
<li>
<p>The <strong>Entry Handling</strong> switches <strong>Add Entries</strong>, <strong>Modify Entries</strong> and <strong>Delete Entries</strong>, which allow data notification to be executed if the switches are set to one of the NTF options. If set to NTF, notification is performed instead of the operation (add, delete or modify), if set to <em>operation</em>NTF (ADDNTF, MODNTF or DELNTF), the operation is performed but the same information is sent via notification.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_switches_for_guid_generation"><a class="anchor" href="#_switches_for_guid_generation"></a>Switches for GUID Generation</h5>
<div class="paragraph">
<p>The Connectivity standard script allows global unique identifiers (GUIDs) to be generated for each entry that is to be imported into the Identity Store. See the "GUID Generation" section for more information. The parameters for this generation are stored in the field variable GUIDparam.</p>
</div>
</div>
<div class="sect4">
<h5 id="_switches_for_trace_control"><a class="anchor" href="#_switches_for_trace_control"></a>Switches for Trace Control</h5>
<div class="paragraph">
<p>The meta controller can generate a lot of trace information, and you can use the switches <strong>Trace Level</strong> and <strong>Debug Trace</strong> to control the granularity of this output. The parameter <strong>Max Trace Entries</strong> controls the number of hits that are output during a join operation. Trace information can be written into <strong>Trace Files</strong> or <strong>Report Files</strong>.</p>
</div>
<div class="paragraph">
<p>The <strong>Statistics</strong> switch allows you to control whether or not the meta controller writes standard statistics. If you disable the standard statistics, your script must provide its own statistics.</p>
</div>
</div>
<div class="sect4">
<h5 id="_source_directory_parameters"><a class="anchor" href="#_source_directory_parameters"></a>Source Directory Parameters</h5>
<div class="paragraph">
<p>This set of parameters is necessary to connect correctly to the specific type of the source connected directory. The most important parameters are the <strong>Directory Type</strong> and the <strong>Directory Subtype</strong>, which determine the behavior of the connected directory.</p>
</div>
<div class="paragraph">
<p>The script generally needs the file name of the attribute configuration file, which is controlled via the parameters <strong>File Name</strong> and <strong>Encoding</strong>.</p>
</div>
<div class="paragraph">
<p>If <strong>Directory Type = LDAP</strong>, the additional parameters are required to perform an LDAP bind. These parameters are: <strong>Server Address</strong>, <strong>Protocol</strong>, <strong>User</strong>, <strong>Password</strong>, <strong>Authentication</strong>, <strong>Protocol</strong> and <strong>SSL Connection</strong> (see the Service and Bind Profile configuration objects for details).</p>
</div>
<div class="paragraph">
<p>If <strong>Directory Type = FILE</strong>, the following parameters are necessary to handle the file correctly: <strong>File Name</strong>, <strong>File Format</strong>, <strong>File Mode</strong> and <strong>Encoding</strong> (see the section File Item configuration object for details).</p>
</div>
</div>
<div class="sect4">
<h5 id="_input_channel_parameters"><a class="anchor" href="#_input_channel_parameters"></a>Input Channel Parameters</h5>
<div class="paragraph">
<p>The input channel definition allows access to the related connected directory.</p>
</div>
<div class="paragraph">
<p>The parameter <strong>Selected Attributes</strong> defines he list of attributes that must be handled.</p>
</div>
<div class="paragraph">
<p>If <strong>Directory Type = LDAP</strong>, a <strong>Base Object</strong>, the <strong>Subset</strong> definition, a <strong>Search Filter</strong> optionally together with an <strong>OR Filter</strong> and whether the result is to be sorted (<strong>Sorted List</strong> together with the <strong>Sort Key</strong> and the <strong>Sort Order</strong>) must be defined (see Export Properties for details).</p>
</div>
<div class="paragraph">
<p>You can use the switch <strong>Read DN Only</strong> or <strong>Paged Read</strong> together with <strong>Page Size</strong> to optimize memory consumption.</p>
</div>
<div class="paragraph">
<p>If <strong>Directory Type = File</strong>, no additional parameters need to be specified in the input channel definition.</p>
</div>
</div>
<div class="sect4">
<h5 id="_target_directory_parameters"><a class="anchor" href="#_target_directory_parameters"></a>Target Directory Parameters</h5>
<div class="paragraph">
<p>This set of parameters is necessary to connect correctly to the specific type of the target connected directory. The most important parameters are the <strong>Directory Type</strong> and the <strong>Directory Subtype</strong>, which determine the behavior of the connected directory.</p>
</div>
<div class="paragraph">
<p>The script needs generally needs the file name of the attribute configuration file, which is controlled via the parameters <strong>File Name</strong> and <strong>Encoding</strong>.</p>
</div>
<div class="paragraph">
<p>If <strong>Directory Type = LDAP</strong>, the following additional parameters are required to perform an LDAP bind: <strong>Server Address</strong>, <strong>Protocol</strong>, <strong>User</strong>, <strong>Password</strong>, <strong>Authentication</strong>, <strong>Protocol</strong> and <strong>SSL Connection</strong> (see the Service and Bind Profile objects for details).</p>
</div>
<div class="paragraph">
<p>If <strong>Directory Type = FILE</strong>, the following parameters are necessary to handle the file correctly: <strong>File Name</strong>, <strong>File Format</strong>, <strong>File Mode</strong> and <strong>Encoding</strong> (see the section File Item configuration object for details).</p>
</div>
</div>
<div class="sect4">
<h5 id="_output_channel_parameters"><a class="anchor" href="#_output_channel_parameters"></a>Output Channel Parameters</h5>
<div class="paragraph">
<p>The output channel definition allows access to the related connected directory.</p>
</div>
<div class="paragraph">
<p>The <strong>Selected</strong> <strong>Attributes</strong> parameter defines the list of attributes to be handled.</p>
</div>
<div class="paragraph">
<p>If <strong>Directory Type = LDAP</strong>, a <strong>Base Object</strong>, the <strong>Subset</strong> definition, a <strong>Join Expression</strong> (or alternatively <strong>Expert Filters</strong>) and whether the result should be sorted (<strong>Sorted List</strong> together with the <strong>Sort Key</strong> and the <strong>Sort Order</strong>) must be defined (see Import Properties for details).</p>
</div>
<div class="paragraph">
<p>You can use the switch <strong>Read DN Only</strong> or <strong>Paged Read</strong> together with <strong>Page Size</strong> to optimize memory consumption.</p>
</div>
<div class="paragraph">
<p>If <strong>Directory Type = File</strong>, no additional parameters need to be specified in the output channel definition.</p>
</div>
<div class="paragraph">
<p>Entry handling parameters are also required to define the behavior at the target connected directory side. This is the Import Mode that controls whether the script works in merge or replace mode.</p>
</div>
<div class="paragraph">
<p>The <strong>Add Entries</strong>, <strong>Superior Info</strong>, and the source and target <strong>Add Marking Attribute</strong> and <strong>Add Marking Value</strong> parameters can control the addition of entries.</p>
</div>
<div class="paragraph">
<p>The <strong>Modify Entries</strong>, <strong>Modify Marking Attribute</strong>, <strong>Modify Marking Value</strong> and <strong>Rename Entries</strong> switches control entry modification.</p>
</div>
<div class="paragraph">
<p>The switches <strong>Delete Entries</strong>, <strong>Deletion Mode</strong>, the source and target <strong>Del Marking Attribute</strong> and <strong>Del Marking Value</strong> and <strong>Keep Objects</strong> control entry deletion.</p>
</div>
</div>
<div class="sect4">
<h5 id="_switches_for_pre_configured_operational_attribute_handling"><a class="anchor" href="#_switches_for_pre_configured_operational_attribute_handling"></a>Switches for Pre-Configured Operational Attribute Handling</h5>
<div class="paragraph">
<p>DirX Identity provides a pre-configured handling of the operational attributes. By default, <strong>dxmOprMaster</strong>, <strong>dxrStartDate</strong>, <strong>dxrEndDate</strong> and <strong>dxrState</strong> are used as attribute types if the switch <strong>Operational Attributes</strong> is on. You can select your preferred set of operational attributes in the user hooks script. The following description works with the standard set of operational attributes.</p>
</div>
<div class="paragraph">
<p>These attributes are only handled for entry masters depending on the calculated action.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch1_applsref/image27.gif" alt="Table of Operational Attributes for Master handling">
</div>
</div>
<div class="paragraph">
<p><strong>DxmOprMaster Handling</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Add</strong>: this attribute will be set to the <strong>dxmOprMasterName</strong> value of the relevant source connected directory.</p>
</li>
<li>
<p><strong>Modify</strong>, <strong>ModifyDN</strong> and <strong>Delete</strong>: DirX Identity checks the mastership of the relevant entry. Only entries that belong to this entry master may be touched.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Entry and Expiration Date Handling</strong></p>
</div>
<div class="paragraph">
<p>Both date values are always set (empty fields cannot occur):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Add</strong>: the <strong>dxrStartDate</strong> or <strong>dxrEndDate</strong> is either set to the mapped value or if not present to the actual date or to 31.12.2037.</p>
</li>
<li>
<p><strong>Modify</strong>: if new mapped values are available, <strong>dxrStartDate</strong> or <strong>dxrEndDate</strong> are updated.</p>
</li>
<li>
<p><strong>Delete</strong>: <strong>dxrStartDate</strong> is not touched, <strong>dxrEndDate</strong> is set to the actual date.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Status Handling</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Add</strong>: dxrState will be set to<strong><br>
ENABLED</strong> if dxrStartDate &#8656; actual date<strong><br>
NEW</strong> if dxrStartDate &gt; actual date<br>
Note: The entry will be refused if dxrEndDate &#8656; dxmEntryDate.</p>
</li>
<li>
<p><strong>Modify</strong>: dxrState will be set to (tests in this sequence!)*<br>
ENABLED* if dxrStartDate &#8656; actual date<strong><br>
NEW</strong> if dxrStartDate &gt; actual date<strong><br>
TBDEL</strong> if dxrEndDate &#8656; actual date<br>
Note: An error will be reported if dxrEndDate &#8656; dxmEntryDate.</p>
</li>
<li>
<p><strong>Delete</strong>: dxrState will be set to <strong>TBDEL</strong>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_references_in_the_default_connectivity_applications"><a class="anchor" href="#_references_in_the_default_connectivity_applications"></a>References in the Default Connectivity Applications</h4>
<div class="paragraph">
<p>References are widely used in DirX Identity&#8217;s default applications, allowing a high degree flexibility (especially through copy operations) to be combined with the central configuration of important and widely-used parameters. This section describes some general reference concepts that are used in the default applications: base object references and references in filter expressions.</p>
</div>
<div class="paragraph">
<p>Most references are defined in configuration files (Tcl files, INI files, XML files). For a detailed description of how to create and interpret references, see the chapter "Customizing Object References" in the <em>DirX Identity Customization Guide</em>. You can also find some references in attributes at the user interface level.</p>
</div>
<div class="sect4">
<h5 id="_base_object_references"><a class="anchor" href="#_base_object_references"></a>Base Object References</h5>
<div class="paragraph">
<p>DirX Identity uses a two-step approach to make the configuration of the base object fields in channels easy and consistent. The following figure illustrates this approach.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch1_applsref/image28.gif" alt="Base Object Reference Concept">
</div>
<div class="title">Figure 27. Base Object Reference Concept</div>
</div>
<div class="paragraph">
<p>The <strong>Base Object</strong> field in an input or output channel can contain values like:</p>
</div>
<div class="paragraph">
<p><strong>&lt;?$src_base_obj/&gt;</strong> or <strong>&lt;?$tgt_base_obj/&gt;</strong></p>
</div>
<div class="paragraph">
<p>These values are reference variables, which almost completely hide the complexity of references. The DirX Identity default applications contain the following reference variables:</p>
</div>
<div class="paragraph">
<p>&lt;?$src_base_obj/&gt; - occurs in input channels. Points to the source connected directory to the specific attribute <strong>base_obj</strong> (named <strong>Creation / Search Base</strong> at the user interface).</p>
</div>
<div class="paragraph">
<p>&lt;?$tgt_base_obj/&gt; - occurs in output channels. Points to the target connected directory to the specific attribute base_obj (named Creation / Search Base at the user interface).</p>
</div>
<div class="paragraph">
<p>&lt;?$src_master_name/&gt; - occurs in input channels. Points to the source connected directory to the attribute dxmMasterName (named Master Name at the user interface in the Operational Attributes tab).</p>
</div>
<div class="paragraph">
<p>&lt;?$tgt_master_name/&gt; - occurs in output channels. Points to the target connected directory to the attribute dxmMasterName (named Master Name at the user interface in the Operational Attributes tab).</p>
</div>
<div class="paragraph">
<p>&lt;?$tgt_machine_name/&gt; - occurs in output channels. Points to the service object of the target connected directory to the attribute dxmAddress (named IP Address at the user interface).</p>
</div>
<div class="paragraph">
<p>&lt;?$tgt_server_address/&gt; - occurs in output channels. Points to the service object of the target connected directory to the attribute dxmAddress and dxmDataPort (named IP Address and Data Port at the user interface). Note: This reference does not work for SSL connections.</p>
</div>
<div class="paragraph">
<p>You can find the definition of these reference variables in the control Tcl script or at the start of the INI files. The definitions are contained in comments because they only set the variable content that is used later on in other places. They are not visible to the Tcl or INI script. Note: another way to hide this information is to use set_nv instead of set for the variable definition, but this technique makes debugging more difficult because you cannot see the evaluated values.</p>
</div>
<div class="paragraph">
<p>The &lt;?$src_base_obj/&gt; and &lt;?$tgt_base_obj/&gt; reference variables point to the base_obj fields in the connected directories. To make the values here as independent as possible of a specific directory implementation, the values in the base_obj fields can also contain references, for example:</p>
</div>
<div class="paragraph">
<p><strong>ou=mthb,&lt;?Configuration@SpecificAttributes(BaseNode)/&gt;</strong></p>
</div>
<div class="paragraph">
<p>The reference to the specific attribute <strong>Base Node</strong> allows you to set a central definition of the start node in the directory. For example, DirX Directory delivers samples that start with <strong>o=My-Company</strong>. In the example (which is valid for most workflows in DirX Identity&#8217;s default applications), the workflows use ou=mthb,o=My-Company as the base point.</p>
</div>
<div class="paragraph">
<p>Other variables, such as the <strong>Tombstone Base</strong> in a connected directory&#8217;s Operational Attributes tab, can also use this base value, for example, ou=tombstone,&lt;?Configuration@SpecificAttributes(BaseNode)/&gt;. This method creates very consistent scenarios that can easily be adapted to new situations.</p>
</div>
<div class="paragraph">
<p>Another example is the setting in the <strong>Search Base</strong> field of the Import Properties tab of the Ident2ADS workflow: LDAP://&lt;?$tgt_machine_name/&gt;/&lt;?$tgt_base_obj/&gt;. In this case, the search base is built from a constant "LDAP://", then the target machine name, another constant "/" and then the target base_obj.</p>
</div>
</div>
<div class="sect4">
<h5 id="_references_in_filter_expressions"><a class="anchor" href="#_references_in_filter_expressions"></a>References in Filter Expressions</h5>
<div class="paragraph">
<p>Fields like <strong>Search Filter</strong>, <strong>OR Filter</strong>, <strong>Expert Filter</strong> or <strong>Replace Filter</strong> in input or output channels can contain simple or complex LDAP filter expressions, and they can also contain references. For example:</p>
</div>
<div class="paragraph">
<p><strong>\{dxmOprMaster=&lt;?$src_master_name/&gt;}</strong></p>
</div>
<div class="paragraph">
<p>This filter searches for all entries that contain the value of the src_master_name reference in the dxmOprMaster attribute. Simply change the <strong>Master Name</strong> field of your source connected directory to handle another master source. The advantage of these fields is that both the import and export workflows use them. As a result, you don&#8217;t need to set two different values in each workflow - one central change is sufficient.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_object_class_handling"><a class="anchor" href="#_object_class_handling"></a>Object Class Handling</h4>
<div class="paragraph">
<p>The Connectivity standard script supports easy object class handling. Use these two variables to perform object class handling tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>dxm_add_objclass - These object classes will be added to the set of object classes.</p>
</li>
<li>
<p>dxm_rem_objclass - These object classes will be removed from the set of object classes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These two variables permit the object classes to be completely handled during add and modify operations.</p>
</div>
<div class="paragraph">
<p>The object classes are calculated in the following steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the mapped target&#8217;s objectClass attribute value (for example, rh_ldap(objectClass)) as the starting point. This is supported for compatibility reasons.</p>
</li>
<li>
<p>For a <strong>modify</strong> operation only, merge the object classes from the target entry.</p>
</li>
<li>
<p>Merge the object classes from the <strong>Object</strong> <strong>Classes</strong> field in the target connected directory&#8217;s Operational Attributes if available.</p>
</li>
<li>
<p>Merge the list of object classes from dxm_add_objClass.</p>
</li>
<li>
<p>Remove the list of object classes from dxm_rem_objclass</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Examples</strong>:</p>
</div>
<div class="paragraph">
<p>Set dxm_rem_objclass to the object classes of the joined entry. This action removes all object classes from the entry. If you set new object classes with dxm_add_objclass, you can completely replace the object classes.</p>
</div>
<div class="paragraph">
<p>Joined entry object classes = "person inetOrgPerson", dxm_add_objclass = "dxmADsUser", connected directory object classes = "person inetOrgPerson organizationalPerson". These values are merged to "person inetOrgPerson organizationalPerson dxmADsUser".</p>
</div>
</div>
<div class="sect3">
<h4 id="_global_unique_identifier_guid_generation"><a class="anchor" href="#_global_unique_identifier_guid_generation"></a>Global Unique Identifier (GUID) Generation</h4>
<div class="paragraph">
<p>Global unique identifiers (GUIDs) significantly ease synchronization work. All processes such as join operations are well-defined and robust.</p>
</div>
<div class="paragraph">
<p>The basic GUID concept is that each entry in the Identity Store contains a unique identifier that is used as much as possible for all synchronizations to target systems (ideally, this identifier is stored in the target systems). A re-synchronization from the target system to the Identity Store can use this identifier to join to the correct entry exactly without any ambiguity.</p>
</div>
<div class="paragraph">
<p>The Connectivity standard script generates a GUID only during add operations. If a GUID is defined in the mapping, this value is taken. Otherwise, DirX Identity Connectivity supports three mechanisms to create a unique GUID: local GUID generation, central GUID generation, and user-defined GUID generation. You can switch between these modes in the job object&#8217;s <strong>GUID Generation Type</strong>.</p>
</div>
<div class="sect4">
<h5 id="_local_guid_generation"><a class="anchor" href="#_local_guid_generation"></a>Local GUID Generation</h5>
<div class="paragraph">
<p>In local GUID generation, a GUID can be generated from a local unique identifier and a unique prefix from the source system. The employeeNumber is a good example of a unique source system identifier. You define this attribute type in the source connected directory&#8217;s <strong>Local GUID Attribute</strong> field.</p>
</div>
<div class="paragraph">
<p>A unique prefix is necessary for creating a unique identifier for the entire scenario. This prefix must be defined manually. It can be stored in the dxmGuidID attribute value of the source connected directory (<strong>GUID Prefix</strong>).</p>
</div>
<div class="paragraph">
<p>In the target connected directory, you must define the <strong>GUID Attribute</strong>, which stores the GUID values.</p>
</div>
</div>
<div class="sect4">
<h5 id="_central_guid_generation"><a class="anchor" href="#_central_guid_generation"></a>Central GUID Generation</h5>
<div class="paragraph">
<p>DirX Identity Connectivity provides an algorithm that allows for the creation of unique integer numbers. In this case, the highest already used value is stored in a special attribute <strong>dxmActualGUIDvalue</strong> in the target connected directory object.</p>
</div>
<div class="paragraph">
<p>To generate a new GUID value, this value is retrieved, increased by one and stored again in the actual GUID value attribute. The algorithm guarantees that double generation of a number is impossible.</p>
</div>
<div class="paragraph">
<p>Because each add entry operation would require an additional read and a write operation to this actual GUID attribute, it is possible to reserve <em>n</em> GUID values with one read/write operation. If all of these numbers are not used, this method may lead to unused numbers. The highest possible number (2.147.483.647 for Windows) limits this method. You can specify the block size with the <strong>GUID Generation Block Size</strong> parameter in the job object.</p>
</div>
</div>
<div class="sect4">
<h5 id="_user_defined_guid_generation"><a class="anchor" href="#_user_defined_guid_generation"></a>User-Defined GUID Generation</h5>
<div class="paragraph">
<p>DirX Identity Connectivity provides the following user hooks for implementing user-defined GUID generation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>uh:InitCreateGUID</strong> - use this routine to initialize your procedure before processing all entries.</p>
</li>
<li>
<p><strong>uh::CreateGuid</strong> - use this routine to process a single GUID.</p>
</li>
<li>
<p><strong>uh::CleanupCreateGuid</strong> - use this routine to clean up after processing all entries.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_multi_mastered_attributes"><a class="anchor" href="#_multi_mastered_attributes"></a>Multi-Mastered Attributes</h4>
<div class="paragraph">
<p>DirX Identity provides the <strong>dxmOprOriginator</strong> attribute to handle multiple masters for the different values of multi-valued attributes This attribute keeps the organizational information to handle the different values of multi-valued attributes and is part of the dxrUser object class of a user entry. The dxmOprOriginator attribute is a structured attribute of the form:</p>
</div>
<div class="paragraph">
<p><em>master_name</em><mark><em>master_rec_ID</em></mark><em>attribute_name</em>#<em>attribute_value</em></p>
</div>
<div class="paragraph">
<p>where</p>
</div>
<div class="paragraph">
<p><em>master_name</em> is the name of the master directory (and should be the dxmMasterName property of the source directory)</p>
</div>
<div class="paragraph">
<p><em>master_rec_ID</em> is the unique record ID that identifies the record in the source (master) system.</p>
</div>
<div class="paragraph">
<p><em>attribute_name</em> is the name of the multi-valued attribute.</p>
</div>
<div class="paragraph">
<p><em>attribute_value</em> is the value of the multi-valued attribute that is mastered.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="paragraph">
<p>HDMS1#12345#telephoneNumber#+49 89 636 45667<br>
HDMS1#34526#telephoneNumber#+49 89 722 82736<br>
PHONEDIR#43257#telephoneNumber#+49 89 722 34526<br>
HDMS1#12345#faxNumber#+49 89 636 45668</p>
</div>
<div class="paragraph">
<p>In this example, the phone number +49 89 636 45667 is mastered from the record 12345 in the HDMS1 system together with the FAX number +49 89 636 45668.</p>
</div>
<div class="paragraph">
<p>The record 34526 from same system HDMS1 masters the phone number +49 89 722 82736.</p>
</div>
<div class="paragraph">
<p>Another record (43257) from the system PHONEDIR masters a telephone number of the same user: +49 89 722 34526.</p>
</div>
<div class="paragraph">
<p>This example shows that several systems can handle the same attribute and on the other hand that several attributes can be handled from the same master but from different records. Thus the concept covers all possible cases.</p>
</div>
<div class="paragraph">
<p>Note: This mechanism is currently only used by the HDMS workflows.</p>
</div>
</div>
<div class="sect3">
<h4 id="_naming_and_scopes"><a class="anchor" href="#_naming_and_scopes"></a>Naming and Scopes</h4>
<div class="paragraph">
<p>If you want to use your own functions and variables, you should use name spaces. This approach guarantees that there are no collisions in variable names and procedure names.</p>
</div>
<div class="paragraph">
<p>The default applications use the following name spaces, which you therefore must not use:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">uh</dt>
<dd>
<p>- used for user hooks</p>
</dd>
<dt class="hdlist1">dxm</dt>
<dd>
<p>- reserved for future use (for default applications)</p>
</dd>
<dt class="hdlist1">hdms</dt>
<dd>
<p>- used by the HDMS workflow</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>You are also not allowed to re-define the global variables used in <strong>control.tcl</strong> (for details, see the "User Hooks" section).</p>
</div>
</div>
<div class="sect3">
<h4 id="_user_hooks"><a class="anchor" href="#_user_hooks"></a>User Hooks</h4>
<div class="paragraph">
<p>You can control the standard Connectivity script with the switches and parameters described in the "Switches and Parameters" section, and you can also control it by customizing the user hook routines. The following figure shows these routines and their relationship to the standard script structure.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch1_applsref/image29.gif" alt="User Hook Routines">
</div>
<div class="title">Figure 28. User Hook Routines</div>
</div>
<div class="paragraph">
<p>DirX Identity provides the following user hook routines:</p>
</div>
<div class="paragraph">
<p><strong>uh::Initialize</strong></p>
</div>
<div class="paragraph">
<p>Initializes the script. Currently only the array <strong>opr</strong> is set (defines the names of the operational attributes).</p>
</div>
<div class="paragraph">
<p><strong>uh::Preprocessing</strong></p>
</div>
<div class="paragraph">
<p>Prepares everything that’s needed before the rest of the profile code is executed. No files or handles are open at this time. An example is to set additional control variables with references.</p>
</div>
<div class="paragraph">
<p><strong>uh::Prolog</strong></p>
</div>
<div class="paragraph">
<p>Handles everything that is needed before the loop is entered (for example, opening additional files). Here all handles are already available.</p>
</div>
<div class="paragraph">
<p>When the "lStringEncrypt" mapping function is called the very first time, it reads the userCertificate using the latest bind connection. Therefore this user hook provides also the bind information that needs to be used for retrieving the userCertificate. For import workflows, it uses the target connection parameters "tgt_conn_param". For export workflows, it uses the source connection parameters "src_conn_param". If the user data that needs to be encrypted is not stored in the directory server where the ConfDB tree (which includes the userCertificate) is located, then the user hook needs to be changed.</p>
</div>
<div class="paragraph">
<p><strong>uh::RefineSearch</strong></p>
</div>
<div class="paragraph">
<p>If a search returns with a predefined amount of entries (for example, 4096 for RACF), the default applications try to read pieces of the search result. A default mechanism is provided that can be customized (see an application of this user hook in the RACF workflows).</p>
</div>
<div class="paragraph">
<p><strong>uh::GenerateTombstoneDN</strong></p>
</div>
<div class="paragraph">
<p>Used for move mode in the delete procedure. Generates the Tombstone-DN by concatenating the original DN with the tombstone base by default. Another function can be defined here.</p>
</div>
<div class="paragraph">
<p><strong>uh::LoopExtraFilter</strong></p>
</div>
<div class="paragraph">
<p>Filters entries that are not to be processed in the loop (for example, RACF does not permit entries to be read with a filter condition; filtering must be performed in the central script logic on a per-entry basis).</p>
</div>
<div class="paragraph">
<p><strong>(Mapping)</strong></p>
</div>
<div class="paragraph">
<p>You can freely define the mapping between the source and target entries in the mapping script.</p>
</div>
<div class="paragraph">
<p><strong>uh::LoopPerformJoin</strong></p>
</div>
<div class="paragraph">
<p>Performs a user-specific join routine when type is set to FILE. The routine can be used to compare the actual set of entries with a previous set to calculate delta information.</p>
</div>
<div class="paragraph">
<p><strong>uh::LoopPostJoin</strong></p>
</div>
<div class="paragraph">
<p>Runs after the join operation but before the write/update operation to the target system. The mapping can be adapted according to the results from the read entry of the target system.</p>
</div>
<div class="paragraph">
<p><strong>uh::Delete</strong></p>
</div>
<div class="paragraph">
<p>Defines a user-specific entry deletion method. This routine is only used when the switch Deletion Mode is set to ‘User’. It is used during the main loop processing and during the processing of unmarked entries after the main loop.</p>
</div>
<div class="paragraph">
<p><strong>uh::LoopExtraFunction</strong></p>
</div>
<div class="paragraph">
<p>Performs additional actions for an entry (for example, writing additional log file information into a special file).</p>
</div>
<div class="paragraph">
<p><strong>uh::Epilog</strong></p>
</div>
<div class="paragraph">
<p>Closes and finalizes everything that is needed after the loop has been processed (for example, the closing of additional files).</p>
</div>
<div class="paragraph">
<p><strong>uh::ErrorHandler</strong></p>
</div>
<div class="paragraph">
<p>Error codes that are returned as errorCode value by the general function exec_cmd can be changed here. Codes can be ignored, modified or additional actions can be issued.</p>
</div>
<div class="paragraph">
<p><strong>uh::InitCreateGuid</strong></p>
</div>
<div class="paragraph">
<p>Initializes the GUID generator before processing all entries.</p>
</div>
<div class="paragraph">
<p><strong>uh::CreateGuid</strong></p>
</div>
<div class="paragraph">
<p>Creates a user-specific GUID value. Define your own algorithms here and set the GUID Generation Type to "User".</p>
</div>
<div class="paragraph">
<p><strong>uh::CleanupCreateGuid</strong></p>
</div>
<div class="paragraph">
<p>Defines the cleanup code for the GUID generator after processing all entries.</p>
</div>
<div class="paragraph">
<p>See the section "Important Routines" for information about the interfaces to some of these routines.</p>
</div>
<div class="paragraph">
<p>To use the user hook routines:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Select the job object in the DirX Identity Manager&#8217;s expert view.</p>
</li>
<li>
<p>Right-click the job, then select <strong>New</strong> &#8594; <strong>Tcl Script</strong>. Set the name to "User Hooks Script".</p>
</li>
<li>
<p>Open <strong>Configuration</strong> &#8594; <strong>Tcl</strong> &#8594; <strong>Default</strong> &#8594; <strong>User Hooks Default Script</strong>.</p>
</li>
<li>
<p>Select the <strong>Content</strong> tab. Click in the edit window. Select the entire code (for example, with Ctrl-A) and copy it (for example, with Ctrl-C).</p>
</li>
<li>
<p>Click the <strong>Content</strong> tab of your newly created Tcl script. Click <strong>Edit</strong>. Paste the content of the default script into your script object. Click <strong>Save</strong> to store it. Note that you can&#8217;t copy the User Hooks Default Script object as a whole because it is set to read-only. Consequently, you must copy the content.</p>
</li>
<li>
<p>Link the job to your Tcl script: Click the tab <strong>Tcl Scripts</strong>, click <strong>Edit</strong>, create a new line in the <strong>Miscellaneous</strong> table and link it to the User Hooks Tcl script. Click <strong>Save</strong>.</p>
</li>
<li>
<p>Note: We recommend that you delete all of the routines in your user hook scripts that you do not use. This action makes your changes more obvious.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">The user hook routines are defined in the name space <strong>uh::</strong>. All user hook routines must be called with the prefix uh</dt>
<dd>
<p>==== Important Tcl Interfaces</p>
</dd>
</dl>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This section describes some important Tcl interfaces in the <strong>central.tcl</strong>, <strong>user_hooks_default.tcl</strong> and <strong>post_join_mapping.tcl</strong> files.</p>
</div>
<div class="sect4">
<h5 id="_central_tcl_interfaces"><a class="anchor" href="#_central_tcl_interfaces"></a>Central Tcl Interfaces</h5>
<div class="paragraph">
<p>The following Tcl interfaces are provided in <strong>central.tcl</strong>:</p>
</div>
<div class="paragraph">
<p><strong>exec_cmd</strong></p>
</div>
<div class="paragraph">
<p>Executes a <strong>metacp</strong> command and terminates on error.</p>
</div>
<div class="paragraph">
<p><strong>exec_cmd</strong> executes a given command and returns the result of the executed command. The global variable debug_trace should be set to one of the values 8, 9, 12, 13 to make command trace information available in the trace file. The command <strong>meta initialize</strong> should be the very first command that is executed by <strong>exec_cmd</strong>; otherwise tracing can’t be successfully performed.</p>
</div>
<div class="paragraph">
<p>When serious errors occur, <strong>exec_cmd</strong> terminates with exit code 10. <strong>exec_cmd</strong> does not handle some error situations; for example, the error "METACP 4852" (“object doesn’t exist” in case of a search operation) or the error "METACP 4515" (“no more results in a paged result request”). In these cases, these error codes are returned.</p>
</div>
<div class="paragraph">
<p>Synopsis:<br>
<strong>exec_cmd</strong> <em>command</em> <em>directory_subtype</em></p>
</div>
<div class="paragraph">
<p>Parameters:<br>
<em>command</em> - the command to be executed<br>
<em>dir_subtype</em> - the directory subtype, for example, RACF</p>
</div>
<div class="paragraph">
<p>Global variables used:</p>
</div>
<div class="paragraph">
<p><strong>errorCode</strong> - Tcl error code variable</p>
</div>
<div class="paragraph">
<p><strong>debug_trace</strong> - level of debug tracing<br>
0 – no trace<br>
4 – Tcl variable trace to stdout<br>
5 – Tcl variable trace to file<br>
8 – command trace to stdout<br>
9 – command trace to file<br>
12 – Tcl variable trace and command trace to stdout<br>
13 – Tcl variable trace and command trace to file</p>
</div>
<div class="paragraph">
<p><strong>trace_file</strong> - the name of the trace file</p>
</div>
<div class="paragraph">
<p><strong>notify_not_ok</strong> - a flag that indicates whether a notification should be sent in case of errors/warnings</p>
</div>
<div class="paragraph">
<p><strong>notify_notok_file</strong> - a notification file</p>
</div>
<div class="paragraph">
<p><strong>DEBUG_COMMAND</strong> indicates that Tcl commands should be traced</p>
</div>
<div class="paragraph">
<p>Return values:</p>
</div>
<div class="paragraph">
<p><strong>result</strong> - on success, the result string of the executed command.</p>
</div>
<div class="paragraph">
<p><strong>errorCode</strong> - on error, the error code of the executed command (for errors that are not serious)</p>
</div>
<div class="paragraph">
<p>Exit codes:<br>
10 on serious errors</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-tcl hljs" data-lang="tcl">set result [exec_cmd “meta modifyentry –oldentry old –newentry new”]</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>getCurrentTimeGMT</strong></p>
</div>
<div class="paragraph">
<p>Returns the current time as a GENERALIZED_TIME string.</p>
</div>
<div class="paragraph">
<p>Synopsis:<br>
<strong>getCurrentTimeGMT</strong></p>
</div>
<div class="paragraph">
<p>Parameters:<br>
None.</p>
</div>
<div class="paragraph">
<p>Global variables used:<br>
None.</p>
</div>
<div class="paragraph">
<p>Return values:<br>
time_value - the current system time as a GENERALIZED_TIME string</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-tcl hljs" data-lang="tcl">set current_time [getCurrentTimeGMT]</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>int2zulu</strong></p>
</div>
<div class="paragraph">
<p>Converts a time in seconds into a GENERALIZED_TIME value</p>
</div>
<div class="paragraph">
<p>Synopsis:<br>
<strong>Int2zulu</strong> [<em>time_val</em>]</p>
</div>
<div class="paragraph">
<p>Parameters:<br>
<em>time_val</em> - a time value in seconds (optional); if omitted, the current system time is used.</p>
</div>
<div class="paragraph">
<p>Global variables used:<br>
None.</p>
</div>
<div class="paragraph">
<p>Return values:<br>
value - time value as GENERALIZED_TIME string</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-tcl hljs" data-lang="tcl">int2zulu 1000000 - returns the value “19700112134640Z”
int2zulu - returns the current time as GENERALIZED_TIME string</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>trace_out</strong></p>
</div>
<div class="paragraph">
<p>Writes trace information to the trace file.</p>
</div>
<div class="paragraph">
<p>trace_out writes the strings given in the parameters string1, string2, … to the trace file, if the global variable debug_trace permits the operation. The parameter mode defines the kind of information that string1, string2, … represent. If the value of mode matches the value of debug_trace, then the trace information will be written. mode is a bit combination of the global variables DEBUG_VARIABLE, DEBUG_COMMAND, DEBUG_LEVEL1, …, DEBUG_LEVEL4.</p>
</div>
<div class="paragraph">
<p>Synopsis:<br>
<strong>trace_out</strong> <em>mode string1</em> [<em>string2</em> ..]</p>
</div>
<div class="paragraph">
<p>Parameters:<br>
<em>mode</em> - the type of information to be written<br>
<em>string1, string2 …</em> - a list of strings to be written</p>
</div>
<div class="paragraph">
<p>Global variables used:<br>
<strong>debug_trace</strong> - for details, see the description in exec_cmd<br>
<strong>DEBUG_IN_FILE</strong> - defines that trace information should be written into the trace file; if not set, tracing is sent to stdout<br>
<strong>DEBUG_VARIABLE</strong> - defines that variable tracing is switched on<br>
<strong>DEBUG_COMMAND</strong> - defines that command tracing is switched on<br>
<strong>DEBUG_LEVEL1</strong> - defines that trace information of level 1 will be written<br>
<strong>DEBUG_LEVEL2</strong> - defines that trace information of level 2 will be written<br>
<strong>DEBUG_LEVEL3</strong> - defines that trace information of level 3 will be written<br>
<strong>DEBUG_LEVEL4</strong> - defines that trace information of level 4 will be written</p>
</div>
<div class="paragraph">
<p>Return values:<br>
None.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-tcl hljs" data-lang="tcl">proc f {
 global DEBUG_VARIABLE
 trace_out $DEBUG_VARIABLE “rh_ldap(sn)=$rh_ldap(sn)”
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>zulu2int</strong></p>
</div>
<div class="paragraph">
<p>Converts a GENERALIZED_TIME value to its representation in seconds</p>
</div>
<div class="paragraph">
<p>Synopsis:<br>
<strong>zulu2int</strong> <em>time_val</em></p>
</div>
<div class="paragraph">
<p>Parameters:<br>
<em>time_val</em> - a GENERALIZED_TIME value</p>
</div>
<div class="paragraph">
<p>Global variables used:<br>
None.</p>
</div>
<div class="paragraph">
<p>Return values:<br>
<strong>seconds</strong> - the time value in seconds</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-tcl hljs" data-lang="tcl">zulu2int 20031231120000Z - returns the value “1072872000”</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_default_user_hook_tcl_interfaces"><a class="anchor" href="#_default_user_hook_tcl_interfaces"></a>Default User Hook Tcl Interfaces</h5>
<div class="paragraph">
<p>The following Tcl interfaces are provided in <strong>user_hooks_default.tcl</strong>:</p>
</div>
<div class="paragraph">
<p><strong>uh::Delete</strong></p>
</div>
<div class="paragraph">
<p>Defines a user-specific entry deletion method.</p>
</div>
<div class="paragraph">
<p>uh::Delete implements a user-defined method of deleting an entry. You define the action to be executed when an entry should be deleted. The routine is used when the deletion_mode switch is set to "User". This routine is used in the default applications during the main loop processing and during the processing of unmarked entries after the main loop.</p>
</div>
<div class="paragraph">
<p>Synopsis:<br>
<strong>uh::Delete</strong> <em>tgt_data</em></p>
</div>
<div class="paragraph">
<p>Parameters:<br>
<em>tgt_data</em> - an array of attribute values that represent the object to be deleted</p>
</div>
<div class="paragraph">
<p>Global variables used:<br>
<strong>tgt_conn_param</strong> - the connection parameters to be used when performing a directory update operation</p>
</div>
<div class="paragraph">
<p>Return values:<br>
0 in case of success<br>
1 in case of errors</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-tcl hljs" data-lang="tcl">set update_result [uh::Delete tgt]</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>uh::Epilog</strong></p>
</div>
<div class="paragraph">
<p>Closes and finalizes everything that is needed after the loop has been processed (for example, the closing of additional files)</p>
</div>
<div class="paragraph">
<p>Synopsis:<br>
<strong>uh::Epilog</strong></p>
</div>
<div class="paragraph">
<p>Parameters:<br>
None.</p>
</div>
<div class="paragraph">
<p>Global variables used:<br>
None.</p>
</div>
<div class="paragraph">
<p>Return values:<br>
0 - on success</p>
</div>
<div class="paragraph">
<p><em>return_code</em> - on error</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-tcl hljs" data-lang="tcl">set return_code [uh::Epilog]</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>uh::ErrorHandler</strong></p>
</div>
<div class="paragraph">
<p>Handles specific errors that were originally returned in "errorCode" (in exec_cmd).</p>
</div>
<div class="paragraph">
<p>uh::ErrorHandler is called by the exec_cmd procedure when errors occur. Because error operation is different for various directory systems (for example, RACF is very restrictive and very often returns the LDAP error “LDAP_OTHER”), exec_cmd must handle these situations. You should implement uh::ErrorHandler to return “0” for errors that are not serious and that do not prevent the Connectivity standard script from continuing its entry-processing functions, and return “1” for serious errors.</p>
</div>
<div class="paragraph">
<p>Synopsis:<br>
<strong>uh::ErrorHandler</strong> <em>command result dir_subtype</em></p>
</div>
<div class="paragraph">
<p>Parameters:<br>
<em>command</em> - a command string that has been executed by exec_cmd<br>
<em>result</em> - a result returned by exec_cmd<br>
<em>dir_subtype</em> - a directory subtype, e.g., RACF</p>
</div>
<div class="paragraph">
<p>Global variables used:<br>
<strong>errorCode</strong> - Tcl error code variable</p>
</div>
<div class="paragraph">
<p>Return values:<br>
0 if a specific error has been handled by that procedure<br>
1 if the error has not been handled by that procedure</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-tcl hljs" data-lang="tcl">set return_code [uh::ErrorHandler $command $result RACF]</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>uh::GenerateTombstoneDN</strong></p>
</div>
<div class="paragraph">
<p>Generates a DN when an object that should normally be deleted is moved to a different tombstone branch of the DIT.</p>
</div>
<div class="paragraph">
<p>uh::GenerateTombstoneDN generates the tombstone DN by exchanging the target search base object with the tombstone base object.</p>
</div>
<div class="paragraph">
<p>Synopsis:<br>
<strong>uh::GenerateTombstoneDN</strong> <em>current_dn</em></p>
</div>
<div class="paragraph">
<p>Parameters:<br>
<em>current_dn</em> - the DN of the object to be moved to the tombstone branch</p>
</div>
<div class="paragraph">
<p>Global variables used:<br>
<strong>tombstone_base</strong> - the base DN of the tombstone branch<br>
<strong>tgt_search_param</strong> - the target search parameters</p>
</div>
<div class="paragraph">
<p>Return values:<br>
<strong>new_dn</strong> - tombstone DN</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-tcl hljs" data-lang="tcl">set new_dn [uh::GenerateTombstoneDN $current_dn]</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>uh::Initialize</strong></p>
</div>
<div class="paragraph">
<p>Initializes the default applications.</p>
</div>
<div class="paragraph">
<p>uh::Initialize is used to initialize the environment of the default applications. Because it&#8217;s the very first statement of the Connectivity standard script, the meta controller&#8217;s <strong>meta initialize</strong> operation has not yet been called, so no tracing can be done in that routine. The routine currently initializes the names of the operational attributes.</p>
</div>
<div class="paragraph">
<p>Synopsis:<br>
<strong>uh::Initialize</strong></p>
</div>
<div class="paragraph">
<p>Parameters:<br>
None.</p>
</div>
<div class="paragraph">
<p>Global variables used:<br>
<strong>opr</strong> - an array of operational attribute names</p>
</div>
<div class="paragraph">
<p>Return values:<br>
0 - on success<br>
1 - on error</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-tcl hljs" data-lang="tcl">set rc [uh::Initialize]</code></pre>
</div>
</div>
<div class="paragraph">
<p>uh::LoopExtraFilter</p>
</div>
<div class="paragraph">
<p>Filters entries that are not to be processed in the loop (for example, RACF does not permit entries to be read with a filter condition; filtering must be performed in the central script logic on a per-entry basis).</p>
</div>
<div class="paragraph">
<p>For entries that should be ignored, the return code of the function should be set to 1; otherwise, 0 should be returned.</p>
</div>
<div class="paragraph">
<p>Synopsis:<br>
<strong>uh::LoopExtraFilter</strong> <em>data</em></p>
</div>
<div class="paragraph">
<p>Parameters:<br>
<em>data</em> - the name of the Tcl array that holds the source data</p>
</div>
<div class="paragraph">
<p>Global variables used:<br>
None.</p>
</div>
<div class="paragraph">
<p>Return values:<br>
0 if the source entry will not be ignored<br>
1 if the source entry will be ignored</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-tcl hljs" data-lang="tcl">set rc [uh::LoopExtraFilter rh_ldap]</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>uh::LoopExtraFunction</strong></p>
</div>
<div class="paragraph">
<p>Performs additional actions for an entry.</p>
</div>
<div class="paragraph">
<p>uh::LoopExtraFunction allows to perform additional actions for an entry (for example, to write additional log file information into a special file). Both the names of the source data array and the target data array are passed to the routine so that the user can operate on both arrays. In addition, the executed operation is passed in the operation parameter, the result of that operation in the rc parameter.</p>
</div>
<div class="paragraph">
<p>Synopsis:<br>
<strong>uh::LoopExtraFunction</strong> <em>source target operation rc</em></p>
</div>
<div class="paragraph">
<p>Parameters:<br>
<em>source</em> - the name of the Tcl array that holds the source data<br>
<em>target</em> - the name of the Tcl array that holds the mapped target data<br>
<em>operation</em> - the operation that has been performed for the entry:<br>
“add”: if the entry has been created<br>
“del”: if the entry has been deleted<br>
“mod”: if the entry has been modified<br>
“modifyDN”: if the entry&#8217;s name has been changed<br>
“error”: if the entry caused multiple matches<br>
“done”: if the entry doesn’t exist in the DIT</p>
</div>
<div class="paragraph">
<p><em>rc</em> - the return code of the directory operation</p>
</div>
<div class="paragraph">
<p>Global variables used:<br>
None.</p>
</div>
<div class="paragraph">
<p>Return values:<br>
0 if the source entry will not be ignored<br>
1 if the source entry will be ignored</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="paragraph">
<p>set rc [uh::LoopExtraFunction rh_file rh_ldap $action $update_res]</p>
</div>
<div class="paragraph">
<p><strong>uh::LoopPerformJoin</strong></p>
</div>
<div class="paragraph">
<p>Performs a user-specific join routine when an entry is exported to FILE. You can use this routine to calculate delta information by comparing the current set of entries with a previous set.</p>
</div>
<div class="paragraph">
<p>Synopsis:<br>
<strong>uh::LoopPerformJoin</strong> <em>source target joined_entry num</em></p>
</div>
<div class="paragraph">
<p>Parameters:<br>
<em>source name</em> - the Tcl array that holds the source data<br>
<em>target name</em> - the Tcl array that holds the mapped target data<br>
<em>joined_entry</em> - OUT: the array of data fields of the joined entry<br>
<em>num</em> - OUT: the number of matching entries</p>
</div>
<div class="paragraph">
<p>Global variables used:<br>
None.</p>
</div>
<div class="paragraph">
<p>Return values:<br>
0 on success<br>
1 on error</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-tcl hljs" data-lang="tcl">set rc [uh::LoopPerformJoin rh_file rh_ldap entry count]</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note</strong>: When using name spaces, there might be problems using the variable source and target. As an alternative the following expression can be used:</p>
</div>
<div class="paragraph">
<p>"rh_&lt;?job@InputChannel-DN@RoleName/&gt;" for source<br>
"rh_&lt;?job@OutputChannel-DN[Anchor=DATA]@RoleName/&gt;" for target</p>
</div>
<div class="paragraph">
<p><strong>uh::Preprocessing</strong></p>
</div>
<div class="paragraph">
<p>Prepares everything that&#8217;s needed before the profile code is executed. No files or handles are open at this time.</p>
</div>
<div class="paragraph">
<p>Synopsis:<br>
<strong>uh::Preprocessing</strong></p>
</div>
<div class="paragraph">
<p>Parameters:<br>
None.</p>
</div>
<div class="paragraph">
<p>Global variables used:<br>
None.</p>
</div>
<div class="paragraph">
<p>Return values:<br>
0 on success<br>
1 on error</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-tcl hljs" data-lang="tcl">set rc [uh::Preprocessing]</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>uh::Prolog</strong></p>
</div>
<div class="paragraph">
<p>Handles everything that&#8217;s needed before the loop is entered (for example, opening additional files or setting additional control variables with references).</p>
</div>
<div class="paragraph">
<p>Synopsis:<br>
<strong>uh::Prolog</strong></p>
</div>
<div class="paragraph">
<p>Parameters:<br>
None.</p>
</div>
<div class="paragraph">
<p>Global variables used:<br>
None.</p>
</div>
<div class="paragraph">
<p>Return values:<br>
0 on success<br>
1 on error</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-tcl hljs" data-lang="tcl">set rc [uh::Prolog]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_post_join_mapping_tcl_interfaces"><a class="anchor" href="#_post_join_mapping_tcl_interfaces"></a>Post-Join Mapping Tcl Interfaces</h5>
<div class="paragraph">
<p>The following Tcl interfaces are provided in <strong>post_join_mapping.tcl</strong>:</p>
</div>
<div class="paragraph">
<p><strong>uh::LoopPostJoin</strong></p>
</div>
<div class="paragraph">
<p>Performs additional mapping before calling the ADD, DELETE or MODIFY operation. Mappings that are commonly used for ADD, DELETE, and MODIFY operations should be listed in the body of this procedure. Internally, uh::LoopPostJoin calls one of the following subroutines:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>uh::postMappingAdd</p>
</li>
<li>
<p>uh::postMappingDel</p>
</li>
<li>
<p>uh::postMappingMod</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The operation-specific mappings should be listed in one of these procedures.</p>
</div>
<div class="paragraph">
<p>The action parameter is used as an input and an output parameter. When used as an input parameter, it indicates the directory operation that should normally be performed. This operation can change if the situation requires an operation other than the initially calculated one.</p>
</div>
<div class="paragraph">
<p>Synopsis:<br>
<strong>uh::LoopPostJoin</strong> s<em>ource target joined_entry action</em></p>
</div>
<div class="paragraph">
<p>Parameters:<br>
<em>source</em> - the name of the Tcl array that holds the source data<br>
<em>target</em> - OUT: the name of the Tcl array that holds the mapped target data<br>
<em>joined_entry</em> - the name of the Tcl array that holds the joined entry<br>
<em>action</em> - IN/OUT: the calculated action, which is one of the following values:<br>
“add” for object creation<br>
“mod” for object modification<br>
“del” for object deletion</p>
</div>
<div class="paragraph">
<p>Global variables used:<br>
None.</p>
</div>
<div class="paragraph">
<p>Return values:<br>
0 - indicates successful post mapping<br>
1 - indicates an error in post mapping</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-tcl hljs" data-lang="tcl">set rc [uh::LoopPostJoin rh_file rh_ldap entry mod]</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>uh::postMappingAdd</strong></p>
</div>
<div class="paragraph">
<p>uh::postMappingAdd allows you to perform additional mapping procedures before the final directory update operation (which normally is an ADD operation) is called.</p>
</div>
<div class="paragraph">
<p>The action parameter is used as an input and an output parameter. When used as an input parameter, it indicates the directory operation that should normally be performed. This operation can change if the situation requires an operation other than the initially calculated one.</p>
</div>
<div class="paragraph">
<p>Synopsis:<br>
<strong>uh::postMappingAdd</strong> <em>source target action</em></p>
</div>
<div class="paragraph">
<p>Parameters:<br>
<em>source</em> - the name of the Tcl array that holds the source data<br>
<em>target</em> - OUT: the name of the Tcl array that holds the mapped target data<br>
<em>action</em> - IN/OUT: the calculated action, which is one of the following values:<br>
“add” for object creation<br>
“mod” for object modification<br>
“del” for object deletion</p>
</div>
<div class="paragraph">
<p>Global variables used:<br>
None.</p>
</div>
<div class="paragraph">
<p>Return values:<br>
0 - indicates successful post mapping<br>
1 - indicates an error in post mapping</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-tcl hljs" data-lang="tcl">set rc [uh::postMappingAdd rh_file rh_ldap add]</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>uh::postMappingDel</strong></p>
</div>
<div class="paragraph">
<p>uh::postMappingDel allows you to perform additional mapping procedures before the final directory update operation (which normally is a DELETE operation) is called.</p>
</div>
<div class="paragraph">
<p>The action parameter is used as an input and an output parameter. When used as an input parameter, it indicates the directory operation that should normally be performed. This operation can change if the situation requires an operation other than the initially calculated one.</p>
</div>
<div class="paragraph">
<p>Synopsis:<br>
<strong>uh::postMappingDel</strong> <em>source target joined_entry action</em></p>
</div>
<div class="paragraph">
<p>Parameters:<br>
<em>source</em> - the name of the Tcl array that holds the source data<br>
<em>target</em> - OUT: the name of the Tcl array that holds the mapped target data<br>
<em>joined_entry</em> - the name of the Tcl array that holds the joined entry<br>
<em>action</em> - IN/OUT: the calculated action, which is one of the following values:<br>
“add” for object creation<br>
“mod” for object modification<br>
“del” for object deletion</p>
</div>
<div class="paragraph">
<p>Global variables used:<br>
None.</p>
</div>
<div class="paragraph">
<p>Return values:<br>
0 - indicates successful post mapping<br>
1 - indicates an error in post mapping</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-tcl hljs" data-lang="tcl">set rc [uh::postMappingDel rh_file rh_ldap entry del]</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>uh::postMappingMod</strong></p>
</div>
<div class="paragraph">
<p>uh::postMappingMod allows you to perform additional mapping procedures before the final directory update operation (which normally is a MODIFY operation) is called.</p>
</div>
<div class="paragraph">
<p>The action parameter is used as an input and an output parameter. When used as an input parameter, it indicates the directory operation that should normally be performed. This operation can change if the situation requires an operation other than the initially calculated one.</p>
</div>
<div class="paragraph">
<p>Synopsis:<br>
<strong>uh::postMappingMod</strong> <em>source target joined_entry action</em></p>
</div>
<div class="paragraph">
<p>Parameters:<br>
<em>source</em> - name of the Tcl array that holds the source data<br>
<em>target</em> - OUT: name of the Tcl array that holds the mapped target data<br>
<em>joined_entry</em> - name of the Tcl array that holds the joined entry<br>
<em>action</em> - IN/OUT: the calculated action, which is one of the following values:<br>
“add” for object creation<br>
“mod” for object modification<br>
“del” for object deletion</p>
</div>
<div class="paragraph">
<p>Global variables used:<br>
None.</p>
</div>
<div class="paragraph">
<p>Return values:<br>
0 - indicates successful post mapping<br>
1 - indicates an error in post mapping</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-tcl hljs" data-lang="tcl">set rc [uh::postMappingMod rh_file rh_ldap entry del]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_global_tcl_variables"><a class="anchor" href="#_global_tcl_variables"></a>Global Tcl Variables</h4>
<div class="paragraph">
<p>This section describes all of the variables that can be used when working with the Connectivity standard script.</p>
</div>
<div class="sect4">
<h5 id="_control_script_variables"><a class="anchor" href="#_control_script_variables"></a>Control Script Variables</h5>
<div class="paragraph">
<p>The default applications use a set of global variables that are defined in <strong>control.tcl</strong>. Many of these variables can be used in the user hook routines, if not already passed as argument.</p>
</div>
<div class="paragraph">
<p>The description of the user hook interfaces lists only the global Tcl variables that are currently used by the given routine. Because you can set up very complex user hooks, the description of an interface doesn’t list all of the global variables that are available. It’s up to you to select the relevant variables, if required.</p>
</div>
<div class="paragraph">
<p>The most important global variables are (in alphabetical order):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>add_entries</strong> - NONE = no addition, ADD = addition only, NTF = notification only, ADDNTF = addition and notification.</p>
</li>
<li>
<p><strong>debug_trace</strong> - 0 – no trace, 1 – variable trace to screen (compatibility mode), 2 – variable trace to file (compatibility mode), 4 – variable trace to screen, 5 – variable trace to file, 8 – command trace to screen, 9 – command trace to file, 12 – command and variable trace to screen, 13 – command and variable trace to file.</p>
</li>
<li>
<p><strong>delete_entries</strong> - NONE = no deletion, DEL = deletion only, NTF = notification only, DELNTF = deletion and notification.</p>
</li>
<li>
<p><strong>deletion_mode</strong> - PHYSICAL = physical removal of entry, MARK = entry is only marked, MOVE = entry is moved to tombstone area, USER = user hook defines the mechanism.</p>
</li>
<li>
<p><strong>delta_check</strong> - defines whether the script runs in delta mode. FALSE = Delta Mode is off, TRUE = Delta Mode is on.</p>
</li>
<li>
<p><strong>delta_date</strong> - the deltaInputData delivered from the Identity server.</p>
</li>
<li>
<p><strong>exact_action</strong> - (static) Tcl variable:<br>
TRUE = prohibits soft change of action from add to modify or no action when entry is already deleted (if set to TRUE). Reports error instead.<br>
FALSE = allows soft change of action.</p>
</li>
<li>
<p><strong>filter_type</strong> - defines whether the filter or join_expression field shall be taken for the join operation. Either table or expert.</p>
</li>
<li>
<p><strong>GUIDparam</strong> - (static) Tcl array with information for generation of GUIDs; its subcomponents are<br>
type - GUID generation type (none, local, global).<br>
targetIDattr - attribute where to store the generated GUID in the target directory.<br>
blockSize - number of central GUIDs to be generated to minimize read accesses.<br>
user - user name to access the configuration tree of Connectivity.<br>
pass - password to access the configuration tree of Connectivity.<br>
address - server address to access the configuration tree of Connectivity.<br>
base - search base.<br>
nr_free_guids - internal counter for number of free GUIDs in the block.<br>
next_free_guid - next free GUID in the block.<br>
sourceGuidID - fixed value to be used as prefix for the generation of a local GUID.<br>
sourceIDattr - attribute from which to obtain the variable (unique) part of local GUID to be generated.</p>
</li>
<li>
<p><strong>init_mode</strong> - type of script operation:<br>
real = real operation.<br>
trial = simulation (no real operation, only traces).<br>
If trial mode is selected, the meta controller must exit with error (because no valid data has been generated for subsequent steps).</p>
</li>
<li>
<p><strong>join_expression</strong> - join expression filter.</p>
</li>
<li>
<p><strong>master_name</strong> - master name to be filled into the target entry.</p>
</li>
<li>
<p><strong>max_trace_entries</strong> - maximum number of hits displayed in trace file.</p>
</li>
<li>
<p><strong>min_source_entries</strong> - minimum number of source entries that must be present (valid for import and export).</p>
</li>
<li>
<p><strong>modify_entries</strong> - NONE = No modification, MOD = Modification only, NTF = Notification only, MODNTF = Modification and Notification.</p>
</li>
<li>
<p><strong>notif_notok</strong> - 0 = no notification, 1 = notification when workflow ended with warning, 2 = notification when workflow ended with error, 3 = notification when not OK (error or warning).</p>
</li>
<li>
<p><strong>notify_notok_file</strong> - the INI file for the "notify if not ok" operation.</p>
</li>
<li>
<p><strong>notify_data_file</strong> - the INI file for notification to write entries for manual handling.</p>
</li>
<li>
<p><strong>object_class_collection</strong> - the object to which the object_classes belong (for example, user or group).</p>
</li>
<li>
<p><strong>object_classes</strong> - the object classes that must be handled during an add or modify operation.</p>
</li>
<li>
<p><strong>operational_attributes</strong> - whether or not operational attributes like dxrState shall be handled.</p>
</li>
<li>
<p><strong>opr</strong> - the operational attributes to be used (by default, dxmOprMaster, dxrState, dxrStartDate, dxrEndDate).</p>
</li>
<li>
<p><strong>rename_entries</strong> - FALSE = move DN not allowed, TRUE = move DN allowed.</p>
</li>
<li>
<p><strong>src_conn_param</strong> - (static) a Tcl array with information about source connection; its subcomponents are<br>
attr_file - name of attribute configuration file.<br>
attr_file_localcode - code set of the attribute configuration file.<br>
attr_list - list of attributes to be handled at the source side.<br>
dir_type - type of source connection.<br>
dir_subtype - subtype of LDAP directory (RACF, NDS) to react on specific behavior.<br>
superior_info - information to create higher level entries.<br>
data_file - name of data file (if dir_type=File).<br>
file_format - file format (if dir_type=File).<br>
file_mode - read or write mode (if dir_type=File).<br>
file_localcode - code set of file (if dir_type=File).<br>
authentication - type of authentication.<br>
user_name - user name of bind profile.<br>
user_pwd - user password of bind profile.<br>
ssl - FALSE = no SSL connection, TRUE = SSL connection.<br>
server_address - server TCP/IP address and port number.<br>
protocol - LDAP protocol (V2 or V3).<br>
bind_id - internal name of bind connection.<br>
LDIFchangeOutput - write all operations into an LDIF change file instead of direct LDAP operations.<br>
LDIFagreementFolder - the folder where DirX changelogs reside.</p>
</li>
<li>
<p><strong>src_data</strong> - the name of the Tcl array that holds the source entry. The source entry&#8217;s data is available after the source entry has been read from the source directory and therefore can be used in the following user hooks:<br>
uh::LoopExtraFilter<br>
uh::LoopExtraFunction<br>
uh::LoopPerformJoin<br>
uh::LoopPostJoin</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note: When using name spaces, there might be problems using the variable “src_data”. The following expression can be used as an alternative:<br>
"rh_&lt;?job@InputChannel-DN@RoleName/&gt;"</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>src_add_marking_attr</strong> - the attribute type that is used as status attribute to indicate add operations at the source side.</p>
</li>
<li>
<p><strong>src_add_marking_value</strong> - the value that indicates an add operation at the source side.</p>
</li>
<li>
<p><strong>src_del_marking_attr</strong> - the attribute type that is used as status attribute to indicate delete operations at the source side.</p>
</li>
<li>
<p><strong>src_del_marking_value</strong> - the value that indicates a delete operation at the source side.</p>
</li>
<li>
<p><strong>src_search_param</strong> - (static) a Tcl array with information about source search parameters; its subcomponents are<br>
base_obj - the base object at which to start the search.<br>
subset - the search scope, either -baseobject, -onelevel, -subtree.<br>
filter - the filter definition for the search.<br>
or_filter - the OR filter (optional).<br>
read_DN_only - read DNs only. Perform for each entry a separate search afterwards. Either true or false.<br>
paged_read - read in paged read mode, either true or false.<br>
page_size - the page size for paged read.</p>
</li>
<li>
<p><strong>src_sort_param</strong> - (static) a Tcl array with information about source sorting parameters; its subcomponents are<br>
sorted_list - FALSE = result not sorted, TRUE = result sorted.<br>
key - the attribute to sort when the result shall be sorted. DDN cannot be used!<br>
order - ASCENDING = ascending sort order, DESCENDING = descending sort order.</p>
</li>
<li>
<p><strong>start_time</strong> - a Tcl variable that holds the start time.</p>
</li>
<li>
<p><strong>statistics</strong> - a switch that suppresses standard <strong>metacp</strong> statistics.</p>
</li>
<li>
<p><strong>target_entry_exists</strong> - the name of an attribute that is used to indicate whether an entry exists in the target system.</p>
</li>
<li>
<p><strong>test_mapping_only</strong> - FALSE = full operation, TRUE = only mapping is performed.</p>
</li>
<li>
<p><strong>test_max_entries</strong> - the number of entries that are mapped when test_mapping_only is TRUE.</p>
</li>
<li>
<p><strong>tgt_add_marking_attr</strong> - the attribute type that is used as a status attribute to mark add operations.</p>
</li>
<li>
<p><strong>tgt_add_marking_value</strong> - the value that is used as a status attribute to mark add operations.</p>
</li>
<li>
<p><strong>tgt_conn_param</strong> - (static) a Tcl array with information about target connection; its subcomponents are the same as in the <strong>src_conn_param</strong> variable.</p>
</li>
<li>
<p><strong>tgt_data</strong> - the name of the Tcl array that holds the target entry. The target entry&#8217;s data is available after the target entry has been mapped and therefore can be used in the following user hooks:<br>
uh::LoopExtraFilter<br>
uh::LoopExtraFunction<br>
uh::LoopPerformJoin<br>
uh::LoopPostJoin</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note: When using name spaces, there might be problems using the variable “tgt_data”. The following expression can be used as an alternative:<br>
"rh_&lt;?job@OutputChannel-DN[Anchor=DATA]@RoleName/&gt;"</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>tgt_del_marking_attr</strong> - the attribute type that is used as a status attribute to mark delete operations.</p>
</li>
<li>
<p><strong>tgt_del_marking_value</strong> - the value that is used as a status attribute to mark delete operations.</p>
</li>
<li>
<p><strong>tgt_import_mode</strong> - REPLACE = Complete subtree in the target area is replaced by subtree from source, MERGE = Subtree from source is merged into subtree in target.</p>
</li>
<li>
<p><strong>tgt_keep_objects</strong> - the objects that are not to be deleted.</p>
</li>
<li>
<p><strong>tgt_mod_marking_attr</strong> - the attribute type that is used as a status attribute to mark modify operations.</p>
</li>
<li>
<p><strong>tgt_mod_marking_value</strong> - the value that is used as a status attribute to mark modify operations.</p>
</li>
<li>
<p><strong>tgt_search_param</strong> - (static) a Tcl array with information about target search parameters; its subcomponents are<br>
base_obj - the base object from which to start the search.<br>
subset - BASE_OBJECT, ONE_LEVEL, SUBTREE.<br>
filter - the filter to perform a join operation.<br>
delete_filter - the search filter that searches the set of entries for REPLACE mode.<br>
read_DN_only - read DNs only. Perform for each entry a separate search afterwards. Either true or false.<br>
paged_read - read in paged read mode, either true or false.<br>
page_size - the page size for paged read.</p>
</li>
<li>
<p><strong>tgt_sort_param</strong> - (static) a Tcl array with information about target sorting parameters; its subcomponents are the same as the src_sort_param variable.</p>
</li>
<li>
<p><strong>tombstone_base</strong> - the base node at which to place the deleted entries (if deletion_mode = MOVE).</p>
</li>
<li>
<p><strong>trace_file</strong> - the name of the trace file.</p>
</li>
<li>
<p><strong>trace_level</strong> - 1 = Error trace, 2 = Full trace, 3 = Short trace.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_profile_script_variables"><a class="anchor" href="#_profile_script_variables"></a>Profile Script Variables</h5>
<div class="paragraph">
<p>The profile script <strong>profile.tcl</strong> also defines some global variables. These variables are created in the procedures listed in <strong>common.tcl</strong> while executing the synchronization logic.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>counter</strong> - a Tcl array of counters used for additional statistic information; its components are</p>
</li>
<li>
<p>mappingProblem - the number of ignored records/entries due to mapping problems</p>
</li>
<li>
<p>userFilter - the number of ignored records/entries due to user defined filtering</p>
</li>
<li>
<p>wrongDates - the number of ignored records/entries due to expirationDate &lt; entryDate</p>
</li>
<li>
<p>alreadyExpired - the number of ignored records/entries due to expirationDate is already in the past</p>
</li>
<li>
<p>missingSortKey - the number of ignored records/entries due to sorting key attribute not present</p>
</li>
<li>
<p>missingSortKey - the number of ignored records/entries due to sorting key attribute not present</p>
</li>
<li>
<p>illegalFilter - the number of ignored records/entries due to illegal filters</p>
</li>
<li>
<p>nonUnique - the number of ignored records/entries due to non unique objects found in the DIT</p>
</li>
<li>
<p>noPermission - the number of ignored records/entries due to missing permissions</p>
</li>
<li>
<p>nonExistingObj - the number of ignored records/entries due to non existing objects</p>
</li>
<li>
<p>differentMaster - the number of ignored records/entries due to ownership of entry is held by a different master</p>
</li>
<li>
<p>exactAction - the number of ignored records/entries because the calculated action is different from action provided with the record/entry</p>
</li>
<li>
<p>sourceEntryCount - the number of entries processed from source directory</p>
</li>
<li>
<p>guidError - the number of ignored records/entries due to errors while generating a GUID</p>
</li>
<li>
<p><strong>entry_handle</strong> - the name of the handle that represents the current matching entry in the target directory. The handle name is set to "entry_h" (or “entry_h” and “entry_h_next” when paged results are used). It’s available after the join has been performed.</p>
</li>
<li>
<p><strong>ExitCode</strong> - the Tcl variable that holds the current exit code used by <strong>profile.tcl</strong> when terminating. Pre-defined exit codes are the following global values:</p>
</li>
<li>
<p>TCL_ERROR (4) - a Tcl script is syntactically incorrect.</p>
</li>
<li>
<p>SERIOUS_ERROR (10) - a <strong>meta</strong> command of <strong>metacp</strong> failed.</p>
</li>
<li>
<p>ERROR (11) - the parameters defined in <strong>control.tcl</strong> are inconsistent, so the synchronization cannot be performed; for example, sorted results should be generated, but no sort key is given.</p>
</li>
<li>
<p>DATA_ERROR (12) - the minimum number of expected source entries (min_source_entries) is not available.</p>
</li>
<li>
<p>NOTIFICATION_ERROR (59) - errors occurred while sending notifications.</p>
</li>
<li>
<p>WARNING (60) - the workflow terminated with warnings, for example, the object that should be modified belongs to a different master.</p>
</li>
<li>
<p>WARNING_UPDATE (61) - an LDAP update operation terminated with an error.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The meta controller itself can also generate errors. For information about these errors, refer to the <em>DirX Identity</em> <em>Meta Controller Reference</em>.</p>
</div>
<div class="paragraph">
<p>Note: Users can exit in the user hooks directly. But before terminating the meta controller, at least <strong>meta</strong> <strong>terminate</strong> should be called in order to get a consistent trace file output.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>src_conn_handles</strong> - the Tcl array that holds the names of source connection handles; components are:</p>
</li>
<li>
<p>Standard - a connection handle that requests all the attributes to be synchronized. The handle name is set to “src_ch”. It’s available after initChannel for the source channel has been called and therefore can be used in the following user hooks:<br>
uh::LoopExtraFilter<br>
uh::LoopExtraFunction<br>
uh::LoopPerformJoin<br>
uh::LoopPostJoin<br>
uh::GenerateTombstoneDN</p>
</li>
<li>
<p>Minimal - a connection handle that requests just a very limited number of attributes, e.g. DDN, dxrState and the sort key attribute. The handle name is set to “src_min_ch” in case the “read_DN_only” flag is set for that connection. In that case it’s available after initChannel for the source channel has been called and therefore can be used in the following user hooks:<br>
uh::LoopExtraFilter<br>
uh::LoopExtraFunction<br>
uh::LoopPerformJoin<br>
uh::LoopPostJoin<br>
uh::GenerateTombstoneDN</p>
</li>
<li>
<p><strong>src_search_res_handle</strong> - the name of the search result handle used for accessing the source search result. The handle name is set to "src_search_res". It’s available after initChannel for the source channel has been called.</p>
</li>
<li>
<p><strong>start_time</strong> - the Tcl variable that holds the start time of the job. This variable is available after the routine initJob has been called in <strong>profile.tcl</strong>.</p>
</li>
<li>
<p><strong>tgt_conn_handles</strong> - the Tcl array that holds the names of target connection handles; its components are</p>
</li>
<li>
<p>Standard - a connection handle that requests all the attributes to be synchronized. The handle name is set to "tgt_ch". It can be used whenever additional data is to be written into the target connected directory.</p>
</li>
<li>
<p>Minimal - a connection handle that requests just a very limited number of attributes, e.g. DDN dxrState and the sort key attribute. The handle name is set to “tgt_min_ch” in case the “read_</p>
</li>
<li>
<p>LDIF-CHANGE - a connection handle used while processing LDIF change files. The handle name is set to "tgt_ldif_change_ch".</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The handles are available after initChannel for the target channel has been called and therefore can be used in the following user hooks:<br>
uh::LoopExtraFilter<br>
uh::LoopExtraFunction<br>
uh::LoopPerformJoin<br>
uh::LoopPostJoin<br>
uh::GenerateTombstoneDN</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>tgt_del_handles</strong> - the Tcl array that holds the names of target connection handles that are used when deleting/moving objects; its components are</p>
</li>
<li>
<p>ldap_del_ch - the name of the LDAP connection to be used when physically deleting objects. The handle name is set to "del_ch".</p>
</li>
<li>
<p>ldap_del_handle - the name of the handle to be used when physically deleting objects. The handle name is set to "del_hdl".</p>
</li>
<li>
<p>ldap_mark_ch - the name of the LDAP connection to be used for marking objects. The handle name is set to "mod_ch".</p>
</li>
<li>
<p>ldap_mark_handle - the name of the handle to be used when marking objects for deletion. The handle name is set to "rh_mod".</p>
</li>
<li>
<p>ldap_move_ch - the name of the LDAP connection to be used for moving objects. The handle name is set to "mod_ch".</p>
</li>
<li>
<p>ldap_move_handle - the name of the handle to be used when moving objects to the tombstone branch. The handle name is set to "rh_mod".</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The handles are available after initChannel for the target channel has been called and therefore can be used in the following user hooks:<br>
uh::LoopExtraFilter<br>
uh::LoopExtraFunction<br>
uh::LoopPerformJoin<br>
uh::LoopPostJoin<br>
uh::GenerateTombstoneDN</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>tgt_search_res_handle</strong> - the name of the search result handle to be used for accessing the target search result. The handle name is set to "tgt_search_res". It’s available after initChannel for the source channel has been called.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_meta_handles"><a class="anchor" href="#_meta_handles"></a>Meta Handles</h4>
<div class="paragraph">
<p>The default Connectivity applications use the following "meta" handles that can be used in the user hook routines:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>del_ch</strong> - for details, see the description of the Tcl array tgt_del_handles in the section “Global Tcl Variables”.</p>
</li>
<li>
<p><strong>del_hdl</strong> - for details, see the description of the Tcl array tgt_del_handles in the section “Global Tcl Variables”.</p>
</li>
<li>
<p><strong>entry_h</strong> and <strong>entry_h_next</strong> for details, see the description of the Tcl variable entry_handle in the section “Global Tcl Variables”.</p>
</li>
<li>
<p><strong>mod_ch</strong> - for details, see the description of the Tcl array tgt_del_handles in the section “Global Tcl Variables”.</p>
</li>
<li>
<p><strong>rh_mod</strong> - for details, see the description of the Tcl array tgt_del_handles in the section “Global Tcl Variables”.</p>
</li>
<li>
<p><strong>src_ah</strong> - represents the attribute handle for accessing the source attribute configuration file. The handle is available once the routine initChannel has been called for the source channel.</p>
</li>
<li>
<p><strong>src_ch</strong> - for details, see the description of the Tcl array src_conn_handles in the section “Global Tcl Variables”.</p>
</li>
<li>
<p><strong>src_min_ch</strong> - for details, see the description of the Tcl array src_conn_handles in the section “Global Tcl Variables”.</p>
</li>
<li>
<p><strong>src_search_res</strong> - for details, see the description of the Tcl variable src_search_res_handle in the section “Global Tcl Variables”.</p>
</li>
<li>
<p><strong>tgt_ah</strong> - represents the attribute handle for accessing the target attribute configuration file. The handle is available once the routine initChannel has been called for the target channel.</p>
</li>
<li>
<p><strong>tgt_ch</strong> - for details, see the description of the Tcl array tgt_conn_handles in the section “Global Tcl Variables”.</p>
</li>
<li>
<p><strong>tgt_ldif_change_ch</strong> - for details, see the description of the Tcl array tgt_conn_handles in the section “Global Tcl Variables”.</p>
</li>
<li>
<p><strong>tgt_min_ch</strong> - for details, see the description of the Tcl array tgt_conn_handles in the section “Global Tcl Variables”.</p>
</li>
<li>
<p><strong>tgt_search_res</strong> - for details, see the description of the Tcl variable tgt_search_res_handle in the section “Global Tcl Variables”.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_understanding_delta_handling"><a class="anchor" href="#_understanding_delta_handling"></a>Understanding Delta Handling</h3>
<div class="paragraph">
<p>This section describes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The types of delta-handling mechanisms that DirX Identity supports</p>
</li>
<li>
<p>The DirX Identity controls for delta operations</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_types_of_delta_handling"><a class="anchor" href="#_types_of_delta_handling"></a>Types of Delta handling</h4>
<div class="paragraph">
<p>Directory synchronizations typically run in full or delta mode. DirX Identity supports different methods of delta handling. There are three ways that a job can manage delta handling:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Type DATE: Using a date from which entries in the connected directory must be extracted (typically the data of the end of the last synchronization).</p>
</li>
<li>
<p>Type USN: Using unique serial numbers provided by some directories. The number from the last synchronization is used for the next one</p>
</li>
<li>
<p>Type FILE: Using a delta file that contains information about the last run. Some jobs keep delta files from different runs.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Most agents and connected directories only support one of these methods, which means that this is a fixed parameter that cannot be changed. You can use the DirX Identity Manager to view a delta job to see which type of delta is supported (select the Delta Handling tab and then examine the <strong>Delta</strong> <strong>Type</strong> field).</p>
</div>
<div class="paragraph">
<p><strong>Note:</strong> If a workflow contains jobs that work in delta mode, DirX Identity guarantees that the delta information is only updated when the complete workflow runs successfully (does not return closed.completed.error). Thus the next run of the workflow will start the same delta operation as the previous one (the one that failed). This operation ensures that no data is lost.</p>
</div>
<div class="paragraph">
<p><strong>Warning:</strong> Do not use the <strong>Ignore Errors</strong> flag of the Activity object for jobs that use delta handling. This could result in serious data loss! (For details on the <strong>Ignore Errors</strong> flag see the <em>Connectivity Administration Guide</em> &#8594; Context Sensitive Help &#8594; Tcl-based Workflows &#8594; Tcl-based Activity.)</p>
</div>
<div class="sect4">
<h5 id="_date_oriented_delta_handling"><a class="anchor" href="#_date_oriented_delta_handling"></a>Date-Oriented Delta Handling</h5>
<div class="paragraph">
<p>In order to perform date-oriented delta handling, each entry in the configuration database must contain a creation and/or a modification date. If another attribute is used for date oriented delta handling all entries must have this attribute set (see the Delta Time Attribute setting for jobs in the <em>Connectivity Administration Guide</em> &#8594; Context Sensitive Help &#8594; Jobs &#8594; Operation &#8594; Delta Handling).</p>
</div>
<div class="paragraph">
<p>You can then extract and process all entries where the delta time attribute has changed since the last delta date, which must be kept in the configuration database under the corresponding job entry.</p>
</div>
<div class="paragraph">
<p>Note that this type of delta handling cannot detect explicitly deleted entries because they are no longer contained in the directory. Deletions can only be properly handled if they are marked with a specific value (but not deleted) or if they have been moved to a tombstone area.</p>
</div>
<div class="paragraph">
<p>For password synchronization a special algorithm is used that compensates time differences between client and server machines. The mechanism consists of a client side and workflow side part.</p>
</div>
</div>
<div class="sect4">
<h5 id="_client_side_handling"><a class="anchor" href="#_client_side_handling"></a>Client-Side Handling</h5>
<div class="paragraph">
<p>If the client writes a password to a user entry it sets the dxmPwdLastChange attribute to the local time plus a previously calculated offset representing the time difference of the local machine to the machine where the directory server resides (dxmPwdLastChange = localtime + offset).</p>
</div>
<div class="paragraph">
<p>It then reads the entry and checks whether the absolute difference between the dxmPwdLastChange attribute and the modification timestamp is below a defined limit (see for example the Delta Time attribute of the event manager in the <em>Connectivity Administration Guide</em> &#8594; Context Sensitive Help &#8594; Jobs &#8594; Tcl-based Event Manager - Operation). If the comparison fails the dxmPwdLastChange value is set to the value of the modifyTimestamp and the offset value is adapted. Note that the modification timestamp might be slightly higher than the value of the dxmPwdLastChange attribute because the second write operation differs from the first one.</p>
</div>
<div class="paragraph">
<p>The client must calculate the offset after startup during handling of the first entry. It writes the password to the first entry and reads the modifyTimeStamp. It compares it with the local time and stores the difference in offset (offset=modifyTS - localtime). For this entry it writes the dxmPwdLastChange attribute with the modifyTimeStamp value.</p>
</div>
<div class="paragraph">
<p>This algorithm guarantees that the dxmPwdLastChange attribute of the entries differs only within the defined limit even if the client and server machines run with different clock settings. Note that these calculations must be done in GMT time to work properly.</p>
</div>
</div>
<div class="sect4">
<h5 id="_workflow_side_handling"><a class="anchor" href="#_workflow_side_handling"></a>Workflow-Side Handling</h5>
<div class="paragraph">
<p>Even if the dxmPwdLastChange is adjusted by the client side algorithm, the standard script provides a mechanism that allows compensating the remaining difference. You can activate this mechanism with the Password Synchronization flag of a meta controller job. Additionally you must set the Delta Time Attribute to "dxmPwdLastChange" and define the compensation time (Password Delta Time). (For details see <em>Connectivity Administration Guide</em> &#8594; Context Sensitive Help &#8594; Jobs &#8594; Operation &#8594; Delta Handling.) You should set the Password Delta Time to a value slightly higher than the highest limit of all clients. A good value to start is to set the Delta Time of the clients to 2 seconds and the Password Delta Time to 3 or more seconds.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch1_applsref/image30.gif" alt="image30">
</div>
<div class="title">Figure 29. Workflow-Side Delta Handling</div>
</div>
<div class="paragraph">
<p>The workflows retrieve password changes from the directory by using the dxmPwdLastChange attribute as delta time attribute for the DirX Identity delta mechanism. Due to the fact that the dxmPwdLastChange attribute is only exact within some limit (the reason is that the modifyTimestamp attribute is only delivered in seconds) a comparison between the list of retrieved directory entries and a stored delta file in the work area of the password synchronization workflow can be used to identify the real difference. The delta file contains at the beginning the delta_input information and then a set of password changes of the last run. The UID can be any unique attribute that is used for join purposes in the target systems (for example employeeNumber).</p>
</div>
<div class="paragraph">
<p>The fact that the delta workflow can fail due to various reasons complicates this issue (this results in no update of the delta information in the configuration database). Thus the workflow must keep two delta files in his work area. The file names are fixed: _delta_primary.csv and _delta_secondary.csv</p>
</div>
<div class="paragraph">
<p>Based on this concept we must distinguish two possible use cases:</p>
</div>
<div class="paragraph">
<p><strong>Use Case 1</strong>: <strong>Full transfer</strong> - The workflow retrieves all entries from the directory. The delta files must be ignored.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In this case a lot of password updates at the target systems could fail if the password policy is set to 'user cannot set the same password again'. Nevertheless at the end of this workflow all passwords in the target system are up to date.</p>
</li>
<li>
<p>If the target system allows overwriting the same password value the result is up to date passwords, too. If the target system delivers password events (for example via the Windows Password Listener) then a lot of such events could be generated which results in high load of the message system. These changes are blocked at the event manager so the loop is broken here (overwriting the same password is not possible).</p>
</li>
<li>
<p>A new delta file _delta_primary.csv is written at the end that keeps the last few entries according to the Password Delta Time value set (for example the last three seconds).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Full password workflow synchronizations can result in many warnings that should be ignored.</p>
</div>
<div class="paragraph">
<p><strong>Case 2: Delta transfer</strong> - The workflow retrieves delta entries from the directory.</p>
</div>
<div class="paragraph">
<p>The workflow reads all entries based on the delta specification from the directory. In parallel it checks the delta files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If no delta file is available, all entries are transferred to the target systems (this case should normally not happen).</p>
</li>
<li>
<p>If one delta file _delta_primary.csv is available and the delta_input_data is different from the first entry in the file, this file is used as delta list for comparison.</p>
</li>
<li>
<p>If one delta file _delta_primary.csv is available and the delta_input_data is equal (which indicates that the previous run was not successful), the second delta file _delta_secondary.csv is used as delta list for comparison. If this file is not present, all entries are transferred to the target system.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Comparison means that each entry from the source is compared with the delta list via the UID. If a UID is found in this list, the passwords (both encrypted) are compared. If they are equal, this entry was obviously already delivered and is dropped therefore. All other entries are delivered to the target system.</p>
</div>
<div class="paragraph">
<p>This mechanism guarantees that passwords are not delivered twice to the target system if the workflow runs in delta mode. Thus a warning for an entry must have another reason that the administrator should be sure to check.</p>
</div>
</div>
<div class="sect4">
<h5 id="_client_side_delta_handling"><a class="anchor" href="#_client_side_delta_handling"></a>Client-Side Delta Handling</h5>
<div class="paragraph">
<p>If the client writes a password to a user entry it sets the dxmPwdLastChange attribute to the local time plus a previously calculated offset representing the time difference of the local machine to the machine where the directory server resides (dxmPwdLastChange = localtime + offset).</p>
</div>
<div class="paragraph">
<p>It then reads the entry and checks whether the absolute difference between the dxmPwdLastChange attribute and the modification timestamp is below a defined limit (see for example the Delta Time attribute of the event manager). If the comparison fails the dxmPwdLastChange value is set to the value of the modifyTimestamp and the offset value is adapted. Note that the modification timestamp might be slightly higher than the value of the dxmPwdLastChange attribute because the second write operation differs from the first one.</p>
</div>
<div class="paragraph">
<p>The client must calculate the offset after startup during handling of the first entry. It writes the password to the first entry and reads the modifyTimeStamp. It compares it with the local time and stores the difference in offset (offset=modifyTS - localtime). For this entry it writes the dxmPwdLastChange attribute with the modifyTimeStamp value.</p>
</div>
<div class="paragraph">
<p>This algorithm guarantees that the dxmPwdLastChange attribute of the entries differs only within the defined limit even if the client and server machines run with different clock settings. Note that these calculations must be done in GMT time to work properly.</p>
</div>
</div>
<div class="sect4">
<h5 id="_workflow_side_delta_handling"><a class="anchor" href="#_workflow_side_delta_handling"></a>Workflow-Side Delta Handling</h5>
<div class="paragraph">
<p>Even if the dxmPwdLastChange is adjusted by the client side algorithm, the standard script provides a mechanism that allows compensating the remaining difference. You can activate this mechanism with the Password Synchronization flag of a meta controller job. Additionally you must set the Delta Time Attribute to "dxmPwdLastChange" and define the compensation time (Password Delta Time). You should set the Password Delta Time to a value slightly higher than the highest limit of all clients. A good value to start is to set the Delta Time of the clients to 2 seconds and the Password Delta Time to 3 or more seconds.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch1_applsref/image31.gif" alt="Workflow-Side Delta handling">
</div>
<div class="title">Figure 30. Workflow-Side Delta handling</div>
</div>
<div class="paragraph">
<p>The workflows retrieve password changes from the directory by using the dxmPwdLastChange attribute as delta time attribute for the DirX Identity delta mechanism. Due to the fact that the dxmPwdLastChange attribute is only exact within some limit (the reason is that the modifyTimestamp attribute is only delivered in seconds) a comparison between the list of retrieved directory entries and a stored delta file in the work area of the password synchronization workflow can be used to identify the real difference. The delta file contains at the beginning the delta_input information and then a set of password changes of the last run. The UID can be any unique attribute that is used for join purposes in the target systems (for example employeeNumber).</p>
</div>
<div class="paragraph">
<p>The fact that the delta workflow can fail due to various reasons complicates this issue (this results in no update of the delta information in the configuration database). Thus the workflow must keep two delta files in his work area. The file names are fixed: _delta_primary.csv and _delta_secondary.csv</p>
</div>
<div class="paragraph">
<p>Based on this concept we must distinguish two possible use cases:</p>
</div>
<div class="paragraph">
<p><strong>Use Case 1: Full transfer</strong> - The workflow retrieves all entries from the directory. The delta files must be ignored.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In this case a lot of password updates at the target systems could fail if the password policy is set to 'user cannot set the same password again'. Nevertheless at the end of this workflow all passwords in the target system are up to date.</p>
</li>
<li>
<p>If the target system allows overwriting the same password value the result is up to date passwords, too. If the target system delivers password events (for example via the Windows Password Listener) then a lot of such events could be generated which results in high load of the message system. These changes are blocked at the event manager so the loop is broken here (overwriting the same password is not possible).</p>
</li>
<li>
<p>A new delta file _delta_primary.csv is written at the end that keeps the last few entries according to the Password Delta Time value set (for example the last three seconds).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Full password workflow synchronizations can result in many warnings that should be ignored.</p>
</div>
<div class="paragraph">
<p><strong>Case 2: Delta transfer</strong> - The workflow retrieves delta entries from the directory.</p>
</div>
<div class="paragraph">
<p>The workflow reads all entries based on the delta specification from the directory. In parallel it checks the delta files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If no delta file is available, all entries are transferred to the target systems (this case should normally not happen).</p>
</li>
<li>
<p>If one delta file _delta_primary.csv is available and the delta_input_data is different from the first entry in the file, this file is used as delta list for comparison.</p>
</li>
<li>
<p>If one delta file _delta_primary.csv is available and the delta_input_data is equal (which indicates that the previous run was not successful), the second delta file _delta_secondary.csv is used as delta list for comparison. If this file is not present, all entries are transferred to the target system.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Comparison means that each entry from the source is compared with the delta list via the UID. If a UID is found in this list, the passwords (both encrypted) are compared. If they are equal, this entry was obviously already delivered and is dropped therefore. All other entries are delivered to the target system.</p>
</div>
<div class="paragraph">
<p>This mechanism guarantees that passwords are not delivered twice to the target system if the workflow runs in delta mode. Thus a warning for an entry must have another reason that the administrator should be sure to check.</p>
</div>
</div>
<div class="sect4">
<h5 id="_usn_oriented_delta_handling"><a class="anchor" href="#_usn_oriented_delta_handling"></a>USN-Oriented Delta Handling</h5>
<div class="paragraph">
<p>In order to perform USN-oriented delta handling, each change in the connected directory must be written into a special tree (the "changelog" tree). A unique serial number (USN) identifies each entry in this tree. The content of this entry is the type of change and a reference to the entry that was changed.</p>
</div>
<div class="paragraph">
<p>You can extract this "changelog" information from the connected directory, analyze the contained information and process the corresponding entries.</p>
</div>
<div class="paragraph">
<p>This type of delta handling mechanism can handle deletions correctly.</p>
</div>
<div class="paragraph">
<p><strong>Note:</strong> Some implementations only keep the DN of the deleted entry. If you need other information like a global unique identifier for removal of this entry in your target system, you must store the DN in your target system!</p>
</div>
</div>
<div class="sect4">
<h5 id="_file_oriented_delta_handling"><a class="anchor" href="#_file_oriented_delta_handling"></a>File-Oriented Delta Handling</h5>
<div class="paragraph">
<p>In order to perform file-oriented delta handling, an external delta database must exist against which the current state of the directory can be compared (this means that the directory does not support any delta mechanism). The external delta database is usually a file with partial content (hashed entries are also possible).</p>
</div>
<div class="paragraph">
<p>The agent for the directory must create and maintain these files and handle the compare operation. All types of changes (also deletions) can be processed correctly.</p>
</div>
<div class="paragraph">
<p>This type of delta-handling mechanism is very time-consuming, especially for large amounts of data.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_delta_handling_control"><a class="anchor" href="#_delta_handling_control"></a>Delta Handling Control</h4>
<div class="paragraph">
<p>At the user interface, all of the delta-handling types are reduced to a list of dates where delta runs were performed. This list is part of the delta-handling properties of the related job configuration object. Normally the next delta run is performed on the result of the last one (the value RECENT indicates this mode).</p>
</div>
<div class="paragraph">
<p>In special cases (for example, when a connected directory must be restored due to a severe error), the administrator can select a specific date to perform the next run.</p>
</div>
<div class="paragraph">
<p>The delta information stored in the configuration database is a list of date/time stamps with the necessary values (a date, a USN, a file name) denoting the time points where former synchronizations took place. This list is extended by the items RECENT and FULL to indicate a request for synchronization of all data changed since the last synchronization.</p>
</div>
<div class="paragraph">
<p>The following figure illustrates the delta information as it appears in the job configuration object viewed with the DirX Identity Manager Expert View.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ch1_applsref/image32.jpg" alt="Job Object Delta Information">
</div>
<div class="title">Figure 31. Job Object Delta Information</div>
</div>
<div class="paragraph">
<p>The relevant fields are:</p>
</div>
<div class="paragraph">
<p><strong>Delta type:</strong> the type of delta handling (DATE, USN, FILE).</p>
</div>
<div class="paragraph">
<p><strong>Info Items:</strong> the list of delta information in the format number, time, delta_value which keeps the results of all delta runs in the configuration database. You cannot see this list from the DirX Identity Manager. Examples are:</p>
</div>
<div class="paragraph">
<p>USN delta Example: 2;20010503123400Z=1234<br>
DATE delta Example: 7;20010503123400Z=20010503123400Z<br>
FILE delta Example: 5;20010503123400Z=delta1.txt</p>
</div>
<div class="paragraph">
<p>USN full Example: 1;FULL=1<br>
DATE full Example: 1;FULL=19800101000000Z<br>
FILE full Example: 1;FULL=</p>
</div>
<div class="paragraph">
<p><strong>Selected:</strong> the value from the <strong>Info Items</strong> list to start the next delta run:<br>
RECENT - (value 0) takes the item with the highest sequence number in the list<br>
FULL - takes the item number 1<em><br>
date value -</em> represents one of the stored delta runs</p>
</div>
<div class="paragraph">
<p><strong>MaxDeltaBase:</strong> the maximum number of <strong>Info Items</strong> entries (used to clean up the item area).</p>
</div>
<div class="paragraph">
<p>The next sections discuss how to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Control delta runs</p>
</li>
<li>
<p>Configure delta handling</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_how_to_control_delta_runs"><a class="anchor" href="#_how_to_control_delta_runs"></a>How to Control Delta Runs</h5>
<div class="paragraph">
<p>Normally the value of the field selected is RECENT, but you can select another value for the next run, either FULL or a date which characterizes older delta run results (refer to the previous figure, which shows an example of type FILE).</p>
</div>
<div class="paragraph">
<p>When the C++-based Server starts the corresponding activity during the next run, it delivers the content of the relevant Info Item field to the agent controller based on the value of the Selected field.</p>
</div>
<div class="paragraph">
<p>The agent controller performs the delta operation. If it completes successfully, the agent controller returns as a result the current time value with the specific delta information (the USN, date or file name).</p>
</div>
<div class="paragraph">
<p>DirX Identity stores this information in the <strong>Info Items</strong> list with the next available item number when it was not a temporary run and resets the <strong>Selected</strong> field to RECENT.</p>
</div>
<div class="paragraph">
<p><strong>Note:</strong> If a workflow contains jobs that work in delta mode, DirX Identity guarantees that the delta information is only updated when the complete workflow runs successfully (does not return closed.completed.error). Thus the next run of the workflow will start the same delta operation as the previous one (the one that failed). This operation ensures that no data is lost.</p>
</div>
<div class="paragraph">
<p><strong>Warning:</strong> Do not use the <strong>Ignore Errors</strong> flag of the Activity object for jobs that use delta handling. This could result in serious data loss! (For details on the <strong>Ignore Errors</strong> flag see the <em>Connectivity Administration Guide</em> &#8594; Context Sensitive Help &#8594; Tcl-based Workflows &#8594; Tcl-based Activity.)</p>
</div>
</div>
<div class="sect4">
<h5 id="_configuring_delta_handling"><a class="anchor" href="#_configuring_delta_handling"></a>Configuring Delta Handling</h5>
<div class="paragraph">
<p>When you define a new job, you must set up DeltaType in the configuration database. Set the field <strong>Delta</strong> <strong>Type</strong> in the <strong>Delta</strong> <strong>Handling</strong> tab of the job object or use a wizard in the DirX Identity Manager Global View. The <strong>Info Items</strong> field is automatically initialized to:</p>
</div>
<div class="paragraph">
<p>USN full Example: 1;FULL=1<br>
DATE full Example: 1;FULL=19800101000000Z<br>
FILE full Example: 1;FULL=</p>
</div>
<div class="paragraph">
<p>Please note that if you change the DeltaType field at any time later on, DirX Identity Manager will reset the existing <strong>Info ltems</strong> list to the FULL-entry. The <strong>Selected</strong> field is set to Recent.</p>
</div>
<div class="paragraph">
<p><strong>Hint:</strong> DirX Identity agents are designed to work with the agent controller to support delta handling in the correct way, but any other agent can also use the delta handling feature of DirX Identity:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The delta information from the last run can be obtained via the reference <strong>&lt;?DeltaInputData/&gt;</strong>. You can use this reference in the command line or in any configuration file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The new delta information, which should be stored into the Connectivity configuration, must be written into the first line of the file <strong>deltaoutputdata.txt</strong> (location must be the work path).</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_customizing_tcl_based_workflows"><a class="anchor" href="#_customizing_tcl_based_workflows"></a>Customizing Tcl-based Workflows</h3>
<div class="paragraph">
<p>Each Tcl-based workflow has a number of parameters that you can change. These parameters are common to most Tcl-based workflows and can all be accessed from the corresponding workflow wizard. The topics in this section describe these parameters for workflows that export data from the Identity Store and workflows that import data from the Identity Store.</p>
</div>
<div class="sect3">
<h4 id="_customizing_identity_store_export_workflows"><a class="anchor" href="#_customizing_identity_store_export_workflows"></a>Customizing Identity Store Export Workflows</h4>
<div class="paragraph">
<p>The most important parameters for workflows that export data from the Identity Store are attribute mapping, base object, filter and tracing. Clicking <strong>Help</strong> in the relevant wizard step gives you more information about these parameters.</p>
</div>
<div class="sect4">
<h5 id="_attribute_mapping_2"><a class="anchor" href="#_attribute_mapping_2"></a>Attribute Mapping</h5>
<div class="paragraph">
<p>You need source and target attributes for attribute mapping. Use the <strong>source selected attributes</strong> to define the attributes to be exported from the Identity Store. Use the <strong>target selected attributes</strong> to define the attributes to be imported into the target system. Use the mapping editor to define the mapping from source to target. You can use the pre-defined mapping functions or create additional ones.</p>
</div>
<div class="paragraph">
<p>If the left-hand list in the selected attributes editor does not contain the necessary attributes, you need to add the attributes to your source or target connected directory. Double-click the connected directory icon in the Global View and select the Attribute Configuration step. Add the necessary attributes to the list and set the correct parameters. If the connected directory is of type LDAP or ADS, you can update the list by synchronizing the schema.</p>
</div>
</div>
<div class="sect4">
<h5 id="_base_object_export_properties_tab"><a class="anchor" href="#_base_object_export_properties_tab"></a>Base Object (Export Properties Tab)</h5>
<div class="paragraph">
<p>This parameter defines the base point at which the search is to be performed.</p>
</div>
<div class="paragraph">
<p>For the <strong>creation workflows</strong>, this variable is set to</p>
</div>
<div class="paragraph">
<p>o=My-Company,&lt;?Job@InputChannel-DN@ConnDir-DN@SpecificAttributes(Role_user_base)/&gt;</p>
</div>
<div class="paragraph">
<p>which is a combination of a constant (o=My-Company) and a reference.</p>
</div>
<div class="paragraph">
<p>The reference fetches the specific attribute role_user_base from the connected directory. It starts at the job object, selects the connected directory via the input channel, and from the connected directory it uses the specific attribute role_user_base.</p>
</div>
<div class="paragraph">
<p>For the <strong>Provisioning synchronization workflows</strong>, this variable is set to:</p>
</div>
<div class="paragraph">
<p>&lt;?Workflow@Activity-DN[Anchor=TSagent]@RunObject-DN@InputChannel-DN@ConnDir-DN@SpecificAttributes(Role_TS_Account_Base)/&gt;</p>
</div>
<div class="paragraph">
<p>The reference starts at the workflow object, goes down to the start activity and then to the job object. At the job level, it selects the connected directory via the input channel, and from the connected directory it takes the specific attribute role_ts_account_base.</p>
</div>
<div class="paragraph">
<p>You could set these parameters directly to the correct values, but then you would lose the advantage of being able to change parameters for an entire set of workflows at the same time because each workflow uses an individual value. In this case, the validation and synchronization workflows use such central parameters.</p>
</div>
</div>
<div class="sect4">
<h5 id="_filter_export_properties_tab"><a class="anchor" href="#_filter_export_properties_tab"></a>Filter (Export Properties Tab)</h5>
<div class="paragraph">
<p>This parameter allows you to define a <strong>filter condition</strong> in LDAP notation. In the default Connectivity scenario, this field is set in several ways.</p>
</div>
<div class="paragraph">
<p>For the <strong>creation workflows</strong>, the filter is usually set to a constant value, for example:</p>
</div>
<div class="paragraph">
<p>( not ( c="DE" ) and not ( c="IT" ) and not ( c="US" ) )</p>
</div>
<div class="paragraph">
<p>For <strong>Provisioning</strong> <strong>synchronization</strong> <strong>workflows</strong>, the filter is set, for example, to:</p>
</div>
<div class="paragraph">
<p>(objectClass="dxrTargetSystemAccount" and not ( dxrTSState="DELETED" ) )</p>
</div>
<div class="paragraph">
<p>In this case, the workflow exports target system accounts whose dxrTSState values are not in the DELETED state.</p>
</div>
</div>
<div class="sect4">
<h5 id="_tracing"><a class="anchor" href="#_tracing"></a>Tracing</h5>
<div class="paragraph">
<p>Set the <strong>trace parameters</strong> adequately to debug your workflow during configuration.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_customizing_identity_store_import_workflows"><a class="anchor" href="#_customizing_identity_store_import_workflows"></a>Customizing Identity Store Import Workflows</h4>
<div class="paragraph">
<p>The most important parameters for workflows that import data to the Identity Store are mapping and selected attributes, base object, import mode, filters for merge/replace, entry handling, tracing, and page mode. Clicking <strong>Help</strong> in the relevant wizard step gives you more information about these parameters.</p>
</div>
<div class="sect4">
<h5 id="_mapping_and_selected_attributes"><a class="anchor" href="#_mapping_and_selected_attributes"></a>Mapping and Selected Attributes</h5>
<div class="paragraph">
<p>You need source and target selected attributes for the mapping. Use the <strong>source selected attributes</strong> to define the attributes to be exported from the source system. Use the <strong>target selected attributes</strong> to define the attributes to be imported into the Identity Store. It is important to set the correct flags that influence whether attributes may be added, deleted or modified. A combination of these flags for a specific attribute defines the mastership for that attribute.</p>
</div>
<div class="paragraph">
<p>Use the mapping editor to define the mapping from source to target. You can use the pre-defined mapping functions or create additional ones.</p>
</div>
<div class="paragraph">
<p>If the left-hand list in the selected attributes editor does not contain the necessary attributes, you need to add them to your source or target connected directory. Double-click the connected directory icon in the global view and select the Attribute Configuration step. Add the necessary attributes to the list and set the correct parameters. If the connected directory is of type LDAP or ADS, you can update the list by synchronizing the schema.</p>
</div>
</div>
<div class="sect4">
<h5 id="_base_object_import_properties_tab"><a class="anchor" href="#_base_object_import_properties_tab"></a>Base Object (Import Properties tab)</h5>
<div class="paragraph">
<p>This parameter defines the base point for the join operation.</p>
</div>
<div class="paragraph">
<p>For <strong>creation workflows</strong>, this value is set to a reference:</p>
</div>
<div class="paragraph">
<p>&lt;?Job@OutputChannel-DN@ConnDir-DN@SpecificAttributes(Role_user_base)/&gt;</p>
</div>
<div class="paragraph">
<p>The reference retrieves the specific attribute role_user_base from the Identity Store object.</p>
</div>
<div class="paragraph">
<p>For <strong>Provisioning synchronization workflows</strong>, the base point is set to a reference:</p>
</div>
<div class="paragraph">
<p>&lt;?Workflow@Activity-DN[Anchor=TSagent]@RunObject-DN@InputChannel-DN@ConnDir-DN@SpecificAttributes(Role_TS_Account_Base)/&gt;</p>
</div>
<div class="paragraph">
<p>See the export section for an explanation of this reference.</p>
</div>
</div>
<div class="sect4">
<h5 id="_import_mode_import_properties_tab"><a class="anchor" href="#_import_mode_import_properties_tab"></a>Import Mode (Import Properties Tab)</h5>
<div class="paragraph">
<p>For import operations, you can choose between two modes: <strong>Replace</strong> and <strong>Merge</strong>.</p>
</div>
<div class="paragraph">
<p><strong>Replace</strong> mode assumes the existence of a full set of entries and therefore cannot handle delta information. In this mode, the source and the target are identical after the operation. This mode can be used for up to 250,000 entries without any problems (typical execution times are 2.5 hours or less). This mode is particularly useful for initial loads. In this case, it is about four times faster than merge mode.</p>
</div>
<div class="paragraph">
<p><strong>Merge</strong> mode can handle all kinds of input. Content information can be handled as a full import or as a delta set if only addition and modification are enabled (see the Entry Handling tab for these settings). If the source delivers an operation code (especially for deleted entries), then deletions can be handled in this mode, too. Large numbers of entries (500,000 entries and more) should be handled with this mode in conjunction with a delete operations code.</p>
</div>
<div class="paragraph">
<p>Creation and provisioning workflows use merge mode in the default scenario.</p>
</div>
</div>
<div class="sect4">
<h5 id="_filters_for_merge_replace_import_properties_tab"><a class="anchor" href="#_filters_for_merge_replace_import_properties_tab"></a>Filters for Merge / Replace (Import Properties Tab)</h5>
<div class="paragraph">
<p>Depending on the value of the import mode parameter (<strong>Merge</strong> or <strong>Replace</strong>), you need to set either the Filters for Merge or the Filters for Replace parameter.</p>
</div>
<div class="paragraph">
<p>If the import mode is <strong>Merge</strong>, you use the Join table either in table or expert mode (for details, see the description of this element). Each row in this table defines a separate filter condition that is evaluated one after the other until exactly one match is found. For example, you can first search for the employeeNumber, then for a combination of sn, givenName and telephoneNumber and so on.</p>
</div>
<div class="paragraph">
<p>If the import mode is <strong>Replace</strong>, you define a Replace Filter, which is a condition that retrieves all entries in the target into the meta controller&#8217;s memory. The meta controller compares all source entries with this memory list. Entries that it finds are marked and modified if the content has changed. Entries that it does not find must be added to the target. At the end, all entries that are not marked in the list are subject to be deleted from the target. This algorithm guarantees a consistent set of entries after the operation. In this mode, it is important that the retrieved memory list is sorted with the field that is used for comparison. This field is to be defined as Sort Key.</p>
</div>
</div>
<div class="sect4">
<h5 id="_entry_handling_properties_tab"><a class="anchor" href="#_entry_handling_properties_tab"></a>Entry Handling Properties Tab</h5>
<div class="paragraph">
<p>This tab contains a set of properties that allow you to define together with the Import Mode parameter the specific behavior of the entry handling at the target side. You can define parameters for <strong>Add</strong>, <strong>Modify</strong> and <strong>Delete</strong> operations.</p>
</div>
<div class="paragraph">
<p>The <strong>Add Entries/Modify Entries/Delete Entries</strong> switches each allow four options. You can either forbid the operation (None), allow it (Add, Modify or Delete) or choose instead only notification (NTF), where a file is generated for this type of operation and is sent via e-mail to an administrator, who must then perform the requested task manually. The fourth option permits the performance of both the operation and the notification. This option is useful if the administrator wants to check the operations regularly and is especially useful for additions and deletions.</p>
</div>
<div class="paragraph">
<p>For <strong>Add</strong>, you should set the <strong>Superior Info</strong> information. This is not necessary if you are absolutely sure that creation of upper-level nodes is never required.</p>
</div>
<div class="paragraph">
<p>For <strong>Modify</strong>, you can choose whether you want to allow a DN rename operation (<strong>Rename Entries</strong>)</p>
</div>
<div class="paragraph">
<p>For <strong>Delete</strong>, you can choose the <strong>Deletion Mode</strong>. The selection must be consistent with your delivered data. You can use the <strong>Keep</strong> <strong>Objects</strong> field to define DNs that your workflow should not delete.</p>
</div>
<div class="paragraph">
<p>See the script structure sections in the chapter "Understanding the Default Application Workflow Technology" for information about the other entry handling properties.</p>
</div>
</div>
<div class="sect4">
<h5 id="_tracing_2"><a class="anchor" href="#_tracing_2"></a>Tracing</h5>
<div class="paragraph">
<p>Set the adequate <strong>trace parameters</strong> to debug your workflow during configuration.</p>
</div>
</div>
<div class="sect4">
<h5 id="_page_mode"><a class="anchor" href="#_page_mode"></a>Page Mode</h5>
<div class="paragraph">
<p>DirX Identity&#8217;s default workflows are configured to run without paging by default. However, if you intend to work with large amounts of data, use paging wherever possible. Otherwise you could reach the limits of the directory server or the operating system. In the latter case, the result is not predictable. Note that for comparison of two result lists, sorting is absolutely necessary if you work in paged mode.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
